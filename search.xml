<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Handleræœºåˆ¶ä¹‹ThreadLocal]]></title>
    <url>%2Fposts%2F64f0a9f6.html</url>
    <content type="text"><![CDATA[ç®€ä»‹ThreadLocalæ˜¯ä¸€ä¸ªçº¿ç¨‹å†…éƒ¨çš„æ•°æ®å‚¨å­˜ç±»ï¼Œé€šè¿‡ä»–å¯ä»¥åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚æ•°æ®å­˜å‚¨ä»¥åï¼Œåªæœ‰åœ¨æŒ‡å®šçš„çº¿ç¨‹ä¸­å¯ä»¥è·å–åˆ°å­˜å‚¨çš„æ•°æ®ï¼Œå¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´åˆ™æ— æ³•è·å–ã€‚ åœ¨æºç ä¸­æ˜¯è¿™æ ·å†™çš„ï¼š This class provides thread-local variables. These variables differ fromtheir normal counterparts in that each thread that accesses one (via its{@code get} or {@code set} method) has its own, independently initializedcopy of the variable. {@code ThreadLocal} instances are typically privatestatic fields in classes that wish to associate state with a thread (e.g.,a user ID or Transaction ID). ç¿»è¯‘è¿‡æ¥ï¼Œå°±æ˜¯è¯´è¿™ä¸ªç±»æä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œä½†æ˜¯ä»–å’Œæ™®é€šå˜é‡ä¸åŒï¼Œä»–æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ªç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚è€Œé€šè¿‡get()å’Œset()æ–¹æ³•å°±èƒ½å¾—åˆ°å’Œè®¾ç½®å½“å‰çº¿ç¨‹å¯¹åº”çš„è¯¥å˜é‡çš„å€¼ã€‚ ç¤ºä¾‹æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼Œåœ¨ä¸€ä¸ªActivityçš„onCreateæ–¹æ³•ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334public class MainActivity extends AppCompatActivity &#123; // éœ€è¦æ·»åŠ çš„ä»£ç  private static final String TAG = "MainActivity"; // éœ€è¦æ·»åŠ çš„ä»£ç  private ThreadLocal&lt;Boolean&gt; mBooleanThreadLocal = new ThreadLocal&lt;&gt;(); @Override protected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); // éœ€è¦æ·»åŠ çš„ä»£ç  mBooleanThreadLocal.set(true); Log.d(TAG, "[Thread#main]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); // éœ€è¦æ·»åŠ çš„ä»£ç  new Thread("Thread#1") &#123; @Override public void run() &#123; mBooleanThreadLocal.set(false); Log.d(TAG, "[Thread#1]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); &#125; &#125;.start(); // éœ€è¦æ·»åŠ çš„ä»£ç  new Thread("Thread#2") &#123; @Override public void run() &#123; Log.d(TAG, "[Thread#2]mBooleanThreadLocal=" + mBooleanThreadLocal.get()); &#125; &#125;.start(); &#125;&#125; æ ¹æ®æˆ‘ä»¬ä¸Šé¢è¯´çš„ThreadLocalçš„ç‰¹æ€§ï¼Œå°±å¯ä»¥çŒœå‡ºåº”è¯¥ä¼šè¾“å‡ºï¼š 123[Thread#main]mBooleanThreadLocal=true[Thread#1]mBooleanThreadLocal=false[Thread#2]mBooleanThreadLocal=null ç„¶åè¿è¡Œè¾“å‡ºçš„ç»“æœï¼Œä¸å‡ºæ‰€æ–™ï¼Œæœç„¶å’Œä¸Šé¢ä¸€æ ·ã€‚ ä½¿ç”¨åœºæ™¯ä¸€èˆ¬æ¥è¯´ï¼Œå½“æŸäº›æ•°æ®æ˜¯ä»¥çº¿ç¨‹ä½œä¸ºä½œç”¨åŸŸå¹¶ä¸”ä¸åŒçº¿ç¨‹å…·æœ‰ä¸åŒçš„æ•°æ®å‰¯æœ¬çš„æ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ThreadLocalã€‚æ¯”å¦‚å¯¹äºHandleræ¥è¯´ï¼Œå®ƒéœ€è¦è·å–å½“å‰çº¿ç¨‹çš„Looperï¼Œå¾ˆæ˜¾ç„¶Looperçš„ä½œç”¨åŸŸå°±æ˜¯çº¿ç¨‹å¹¶ä¸”ä¸åŒçº¿ç¨‹å…·æœ‰ä¸åŒçš„Looperï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡ThreadLocalå°±å¯ä»¥è½»æ¾å®ç°Looperåœ¨çº¿ç¨‹ä¸­çš„å­˜å–ï¼Œå¦‚æœä¸é‡‡ç”¨ThreadLocalï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¿…é¡»æä¾›ä¸€ä¸ªå…¨å±€çš„å“ˆå¸Œè¡¨ä¾›HandleræŸ¥æ‰¾æŒ‡å®šçº¿ç¨‹çš„Looperï¼Œè¿™æ ·ä¸€æ¥å°±å¿…é¡»æä¾›ä¸€ä¸ªç±»ä¼¼äºLooperManagerçš„ç±»äº†ï¼Œä½†æ˜¯ç³»ç»Ÿå¹¶æ²¡æœ‰è¿™ä¹ˆåšè€Œæ˜¯é€‰æ‹©äº†ThreadLocalï¼Œè¿™å°±æ˜¯ThreadLocalçš„å¥½å¤„ã€‚ å¦ä¸€ä¸ªä½¿ç”¨åœºæ™¯å°±æ˜¯å¤æ‚é€»è¾‘ä¸‹çš„å¯¹è±¡ä¼ é€’ã€‚æ¯”å¦‚ç›‘å¬å™¨çš„ä¼ é€’ï¼Œæœ‰äº›æ—¶å€™ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»»åŠ¡è¿‡äºå¤æ‚ï¼Œè¿™å¯èƒ½è¡¨ç°ä¸ºå‡½æ•°è°ƒç”¨æ ˆæ¯”è¾ƒæ·±ä»¥åŠä»£ç å…¥å£çš„å¤šæ ·æ€§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆéœ€è¦ç›‘å¬å™¨èƒ½å¤Ÿè´¯ç©¿æ•´ä¸ªçº¿ç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥æ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®å°±å¯ä»¥é‡‡ç”¨ThreadLocalï¼Œé‡‡ç”¨ThreadLocalå¯ä»¥è®©ç›‘å¬å™¨ä½œä¸ºçº¿ç¨‹å†…çš„å…¨å±€å¯¹è±¡è€Œå­˜åœ¨ï¼Œåœ¨çº¿ç¨‹å†…éƒ¨åªè¦é€šè¿‡getæ–¹æ³•å°±å¯ä»¥è·å–åˆ°ç›‘å¬å™¨ã€‚è€Œå¦‚æœä¸é‡‡ç”¨ThreadLocalï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„å¯èƒ½æ˜¯å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼šç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°†ç›‘å¬å™¨é€šè¿‡å‚æ•°çš„å½¢å¼åœ¨å‡½æ•°è°ƒç”¨æ ˆä¸­è¿›è¡Œä¼ é€’ï¼Œç¬¬äºŒç§æ–¹æ³•å°±æ˜¯å°†ç›‘å¬å™¨ä½œä¸ºé™æ€å˜é‡ä¾›çº¿ç¨‹è®¿é—®ã€‚ä¸Šè¿°è¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯æœ‰å±€é™æ€§çš„ã€‚ç¬¬ä¸€ç§æ–¹æ³•çš„é—®é¢˜æ—¶å½“å‡½æ•°è°ƒç”¨æ ˆå¾ˆæ·±çš„æ—¶å€™ï¼Œé€šè¿‡å‡½æ•°å‚æ•°æ¥ä¼ é€’ç›‘å¬å™¨å¯¹è±¡è¿™å‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™ä¼šè®©ç¨‹åºçš„è®¾è®¡çœ‹èµ·æ¥å¾ˆç³Ÿç³•ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯å¯ä»¥æ¥å—çš„ï¼Œä½†æ˜¯è¿™ç§çŠ¶æ€æ˜¯ä¸å…·æœ‰å¯æ‰©å……æ€§çš„ï¼Œæ¯”å¦‚å¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆå°±éœ€è¦æä¾›ä¸¤ä¸ªé™æ€çš„ç›‘å¬å™¨å¯¹è±¡ï¼Œå¦‚æœæœ‰10ä¸ªçº¿ç¨‹åœ¨å¹¶å‘æ‰§è¡Œå‘¢ï¼Ÿæä¾›10ä¸ªé™æ€çš„ç›‘å¬å™¨å¯¹è±¡ï¼Ÿè¿™æ˜¾ç„¶æ˜¯ä¸å¯æ€è®®çš„ï¼Œè€Œé‡‡ç”¨ThreadLocalæ¯ä¸ªç›‘å¬å™¨å¯¹è±¡éƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹å†…éƒ¨å­˜å‚¨ï¼Œæ ¹æ®å°±ä¸ä¼šæœ‰æ–¹æ³•2çš„è¿™ç§é—®é¢˜ã€‚ æºç ä½œä¸ºä¸€ä¸ªå­˜å‚¨æ•°æ®çš„ç±»ï¼Œå…³é”®ç‚¹å°±åœ¨getå’Œsetæ–¹æ³•ã€‚ ThreadLocal # set123456789101112131415161718192021222324252627282930public void set(T value) &#123; // è·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); // å®é™…ä¸Šå­˜å‚¨æ•°æ®çš„ç»“æ„ç±»å‹ // -&gt;&gt; åˆ†æ1 ThreadLocalMap map = getMap(t); // å¦‚æœå­˜åœ¨Mapå°±ç›´æ¥setï¼Œæ²¡æœ‰å°±åˆ›å»ºmapå¹¶set if (map != null) map.set(this, value); else // -&gt;&gt; åˆ†æ2 createMap(t, value);&#125;/** * åˆ†æ1ï¼šgetMap()æ–¹æ³• */ThreadLocalMap getMap(Thread t) &#123; // è¿”å›ä¼ å…¥çº¿ç¨‹çš„ThreadLocalMap return t.threadLocals;&#125;/** * åˆ†æ2ï¼šcreateMap()æ–¹æ³• */void createMap(Thread t, T firstValue) &#123; // åˆ›å»ºä¸€ä¸ªæ–°çš„ThreadLocalMapå¹¶å°†å€¼ä¼ å…¥ t.threadLocals = new ThreadLocalMap(this, firstValue);&#125; å½“ä½ è°ƒç”¨setæ–¹æ³•æ—¶ï¼Œå°±ä¼šæ‹¿åˆ°å½“å‰çº¿ç¨‹å¹¶å¾—åˆ°å½“å‰çº¿ç¨‹çš„ThreadLocalMapï¼Œå¦‚æœmapä¸ä¸ºç©ºï¼Œé‚£å°±ç›´æ¥æŠŠå€¼ä¼ å…¥mapï¼›å¦‚æœmapä¸ºç©ºé‚£å°±æ–°å»ºä¸€ä¸ªå†ä¼ å€¼ã€‚ è¿™å—æˆ‘ä»¬å°±èƒ½æ‡‚ä¸ºå•¥ThreadLocalèƒ½åªæ“ä½œè‡ªå·±çº¿ç¨‹é‡Œé¢çš„ä¸œè¥¿äº†ï¼Œå› ä¸ºæ‰€æœ‰ThreadLocaléƒ½ä¸ä»–çº¿ç¨‹ä¸­çš„ThreadLocalMapæœ‰å…³ã€‚ é‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ThreadLocalMapã€‚ ThreadLocalMapå±æ€§å˜é‡å…ˆæ¥çœ‹ä¸‹ThreadLocalMapçš„ä¸€äº›å˜é‡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445// å­˜å‚¨æ•°æ®çš„ç»“æ„ä¸ºEntryï¼Œè€Œä¸”keyæ˜¯å¼±å¼•ç”¨static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123; Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) &#123; super(k); value = v; &#125;&#125;// tableçš„åˆå§‹å®¹é‡private static final int INITIAL_CAPACITY = 16;// tableç”¨äºå­˜å‚¨æ•°æ®private Entry[] table;// private int size = 0;// è´Ÿè½½å› å­ï¼Œç”¨äºæ‰©å®¹private int threshold; // Default to 0// è®¾ç½®è´Ÿè½½å› å­ï¼Œé»˜è®¤ä¸ºå½“å‰å¤§å°çš„2/3private void setThreshold(int len) &#123; threshold = len * 2 / 3;&#125;// ä¸‹ä¸€ä¸ªç´¢å¼•private static int nextIndex(int i, int len) &#123; return ((i + 1 &lt; len) ? i + 1 : 0);&#125;// ä¸Šä¸€ä¸ªç´¢å¼•private static int prevIndex(int i, int len) &#123; return ((i - 1 &gt;= 0) ? i - 1 : len - 1);&#125;// æ„é€ å‡½æ•°ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123; table = new Entry[INITIAL_CAPACITY]; int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1); table[i] = new Entry(firstKey, firstValue); size = 1; setThreshold(INITIAL_CAPACITY);&#125; ThreadLocalMap # set()1234567891011121314151617181920212223242526272829private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; Entry[] tab = table; int len = tab.length; // æ ¹æ®å“ˆå¸Œç®—æ³•æ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ int i = key.threadLocalHashCode &amp; (len-1); //åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœkeyå€¼ç›¸åŒï¼Œå°±æ›¿æ¢ï¼Œå¦‚æœä¸åŒåˆ™æ‰¾ç©ºä½æ”¾æ•°æ®ã€‚ for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; ThreadLocal&lt;?&gt; k = e.get(); //åˆ¤æ–­keyå€¼ç›¸åŒå¦ï¼Œå¦‚æœæ˜¯ç›´æ¥è¦†ç›– ï¼ˆç¬¬ä¸€ç§æƒ…å†µï¼‰ if (k == key) &#123; e.value = value; return; &#125; //å¦‚æœå½“å‰Entryå¯¹è±¡å¯¹åº”Keyå€¼ä¸ºnull,åˆ™æ¸…ç©ºæ‰€æœ‰Keyä¸ºnullçš„æ•°æ®ï¼ˆç¬¬äºŒç§æƒ…å†µï¼‰ if (k == null) &#123; replaceStaleEntry(key, value, i); return; &#125; &#125; //ä»¥ä¸Šæƒ…å†µéƒ½ä¸æ»¡è¶³ï¼Œç›´æ¥æ·»åŠ ï¼ˆç¬¬ä¸‰ç§æƒ…å†µï¼‰ tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash();&#125; å…ˆæ ¹æ®keyé€šè¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°å¯¹åº”çš„iï¼Œç„¶åå†å¼€å§‹ä»è¿™ä¸ªiå¼€å§‹éå†ï¼Œè¿›è¡Œåˆ¤æ–­ï¼Œç”±äºä¸‹é¢ä¸‰ä¸ªåˆ¤æ–­æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†å¼€æ¥è®²ã€‚ ç¬¬ä¸€ç§æƒ…å†µè¿™ç§æƒ…å†µä¸‹ï¼Œkeyå€¼ç›¸åŒï¼Œå°±éœ€è¦å°†valueæ›¿æ¢æ‰ã€‚ ç¬¬äºŒç§æƒ…å†µè¿™ç§æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå…ˆçœ‹ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114private void replaceStaleEntry(ThreadLocal&lt;?&gt; key, Object value, int staleSlot) &#123; Entry[] tab = table; int len = tab.length; Entry e; int slotToExpunge = staleSlot; // å…ˆå¾€å‰è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦èƒ½æ‰¾åˆ°ç©ºçš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°äº†å°±æ›´æ–°slotToExpunge for (int i = prevIndex(staleSlot, len); (e = tab[i]) != null; i = prevIndex(i, len)) if (e.get() == null) slotToExpunge = i; // å†å¾€åéå† for (int i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) &#123; ThreadLocal&lt;?&gt; k = e.get(); // å¦‚æœå½“å‰ièŠ‚ç‚¹çš„keyå’Œä¼ å…¥çš„keyç›¸åŒï¼Œé‚£å°±è¿›è¡Œæ›¿æ¢ if (k == key) &#123; e.value = value; tab[i] = tab[staleSlot]; tab[staleSlot] = e; /* * å¦‚æœåœ¨æ•´ä¸ªæ‰«æè¿‡ç¨‹ä¸­ï¼ˆåŒ…æ‹¬å‡½æ•°ä¸€å¼€å§‹çš„å‘å‰æ‰«æä¸iä¹‹å‰çš„å‘åæ‰«æï¼‰ * æ‰¾åˆ°äº†ä¹‹å‰çš„æ— æ•ˆslotåˆ™ä»¥é‚£ä¸ªä½ç½®ä½œä¸ºæ¸…ç†çš„èµ·ç‚¹ï¼Œ * å¦åˆ™åˆ™ä»¥å½“å‰çš„iä½œä¸ºæ¸…ç†èµ·ç‚¹ */ if (slotToExpunge == staleSlot) slotToExpunge = i; // è¿›è¡Œä¸€æ¬¡è¿ç»­æ®µçš„æ¸…ç†ï¼Œå†åšä¸€æ¬¡å¯å‘å¼æ¸…ç† // -&gt;&gt; åˆ†æ1 // -&gt;&gt; åˆ†æ2 cleanSomeSlots(expungeStaleEntry(slotToExpunge), len); return; &#125; // å¦‚æœå½“å‰çš„slotå·²ç»æ— æ•ˆï¼Œå¹¶ä¸”å‘å‰æ‰«æè¿‡ç¨‹ä¸­æ²¡æœ‰æ— æ•ˆslotï¼Œåˆ™æ›´æ–°slotToExpungeä¸ºå½“å‰ä½ç½® if (k == null &amp;&amp; slotToExpunge == staleSlot) slotToExpunge = i; &#125; // å¦‚æœkeyåœ¨tableä¸­ä¸å­˜åœ¨ï¼Œåˆ™åœ¨åŸåœ°æ”¾ä¸€ä¸ªå³å¯ tab[staleSlot].value = null; tab[staleSlot] = new Entry(key, value); // åœ¨æ¢æµ‹è¿‡ç¨‹ä¸­å¦‚æœå‘ç°ä»»ä½•æ— æ•ˆslotï¼Œåˆ™åšä¸€æ¬¡æ¸…ç†ï¼ˆè¿ç»­æ®µæ¸…ç†+å¯å‘å¼æ¸…ç†ï¼‰ // -&gt;&gt; åˆ†æ1 // -&gt;&gt; åˆ†æ2 if (slotToExpunge != staleSlot) cleanSomeSlots(expungeStaleEntry(slotToExpunge), len);&#125;/** * åˆ†æ1ï¼šexpungeStaleEntry() * ä½œç”¨ï¼šæŠŠè¿ç»­æ®µå†…æ‰€æœ‰æ— æ•ˆçš„slotéƒ½æ¸…ç†ä¸€é */private int expungeStaleEntry(int staleSlot) &#123; Entry[] tab = table; int len = tab.length; tab[staleSlot].value = null; tab[staleSlot] = null; size--; Entry e; int i; for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == null) &#123; e.value = null; tab[i] = null; size--; &#125; else &#123; int h = k.threadLocalHashCode &amp; (len - 1); if (h != i) &#123; tab[i] = null; while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; &#125; &#125; &#125; return i;&#125;/** * åˆ†æ2ï¼šcleanSomeSlots() * ä½œç”¨ï¼šéå†åˆ é™¤æ‰€æœ‰ä½ç½®ä¸‹key==nullçš„æ•°æ® */private boolean cleanSomeSlots(int i, int n) &#123; boolean removed = false; Entry[] tab = table; int len = tab.length; do &#123; i = nextIndex(i, len); Entry e = tab[i]; if (e != null &amp;&amp; e.get() == null) &#123; n = len; removed = true; // -&gt;&gt; åˆ†æ3 i = expungeStaleEntry(i); &#125; &#125; while ( (n &gt;&gt;&gt;= 1) != 0); return removed;&#125; ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç¬¬ä¸‰ç§æƒ…å†µç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯ä¸Šé¢ä¸¤ç§æƒ…å†µéƒ½ä¸æ»¡è¶³çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ’å…¥çš„ä½ç½®ä¸ºnullçš„æ—¶å€™ï¼Œå°±ç›´æ¥æ‰©å¤§ThreadLocalMapï¼Œç„¶åå†æ’å…¥ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950tab[i] = new Entry(key, value);int sz = ++size;// -&gt;&gt; cleanSomeSlotsè§ä¸Šé¢ç¬¬äºŒç§æƒ…å†µçš„åˆ†æ2if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) // -&gt;&gt; åˆ†æ1 rehash();/** * åˆ†æ1ï¼šrehash() */private void rehash() &#123; // -&gt;&gt; expungeStaleEntriesè§ä¸Šé¢ç¬¬äºŒç§æƒ…å†µçš„åˆ†æ1 expungeStaleEntries(); if (size &gt;= threshold - threshold / 4) // -&gt;&gt; åˆ†æ2 resize();&#125;/** * åˆ†æ2ï¼šresize() */private void resize() &#123; Entry[] oldTab = table; int oldLen = oldTab.length; int newLen = oldLen * 2; Entry[] newTab = new Entry[newLen]; int count = 0; for (int j = 0; j &lt; oldLen; ++j) &#123; Entry e = oldTab[j]; if (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == null) &#123; e.value = null; // Help the GC &#125; else &#123; int h = k.threadLocalHashCode &amp; (newLen - 1); while (newTab[h] != null) h = nextIndex(h, newLen); newTab[h] = e; count++; &#125; &#125; &#125; setThreshold(newLen); size = count; table = newTab;&#125; ThreadLocalMap # getEntry()12345678910111213141516171819202122232425262728293031private Entry getEntry(ThreadLocal&lt;?&gt; key) &#123; int i = key.threadLocalHashCode &amp; (table.length - 1); Entry e = table[i]; if (e != null &amp;&amp; e.get() == key) return e; else // -&gt;&gt; åˆ†æ1 return getEntryAfterMiss(key, i, e);&#125;/** * åˆ†æ1ï¼šgetEntryAfterMiss() */private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123; Entry[] tab = table; int len = tab.length; // ä»å½“å‰å¾€åä¸€ä¸ªä¸ªè¿›è¡Œéå†ï¼Œç›´è‡³æ‰¾åˆ°å’Œkeyç›¸ç­‰çš„ç„¶åè¿”å› while (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) return e; if (k == null) expungeStaleEntry(i); else i = nextIndex(i, len); e = tab[i]; &#125; return null;&#125; ThreadLocalMap # remove()123456789101112131415private void remove(ThreadLocal&lt;?&gt; key) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; if (e.get() == key) &#123; // æ˜¾å¼æ–­å¼€å¼±å¼•ç”¨ e.clear(); expungeStaleEntry(i); return; &#125; &#125;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç </tag>
        <tag>Handler</tag>
        <tag>ThreadLocal</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Viewçš„äº‹ä»¶åˆ†å‘]]></title>
    <url>%2Fposts%2Fbfb9e8a9.html</url>
    <content type="text"><![CDATA[ä»æˆ‘åˆšè¿›å®éªŒå®¤çš„æ—¶å€™ï¼Œå­¦é•¿å­¦å§å°±è¯´Viewçš„äº‹ä»¶åˆ†å‘æœºåˆ¶æ˜¯Androidé‡Œé¢ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹ï¼Œè¦æˆ‘ä»¬å¥½å¥½å­¦ã€‚ ä½†æ˜¯éšç€è‡ªå·±å¯¹Androidäº†è§£çš„æ·±å…¥ï¼Œè¶Šå‘è§‰å¾—è¿™ä¸ªä¸œè¥¿å¾ˆæœ‰å¿…è¦äº†è§£ä¸‹ï¼Œæ­£å¥½Androidè‰ºæœ¯å¼€å‘æ¢ç´¢ä¹Ÿçœ‹åˆ°äº†Viewè¿™å—ï¼Œä¹Ÿçœ‹äº†éƒ­éœ–å¤§ç¥çš„åšå®¢å’Œå¦ä¸€ä½å¤§ç¥çš„åšå®¢ï¼Œæ‰€ä»¥å°±å¥½å¥½å­¦ä¹ äº†ä¸€ç•ªï¼Œå¹¶å†™äº†æ­¤åšå®¢ã€‚ 1. MotionEventåœ¨å¼€å§‹è®²Viewäº‹ä»¶åˆ†å‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹MotionEventã€‚ è¿™ä¸ªå°±æ˜¯æ‰‹æŒ‡è§£é™¤åˆ°å±å¹•åæ‰€äº§ç”Ÿçš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œä¸»è¦ä¸ºä¸€ä¸‹ä¸‰ä¸ªå…¸å‹äº‹ä»¶ï¼š ACTION_DOWMâ€”â€”æ‰‹æŒ‡åˆšæ¥è§¦å±å¹• ACTION_MOVEâ€”â€”æ‰‹æŒ‡åœ¨å±å¹•ä¸Šç§»åŠ¨ ACTION_UPâ€”â€”æ‰‹æŒ‡ä»å±å¹•ä¸Šæ¾å¼€ ACTION_CANCELâ€”â€”ç»“æŸäº‹ä»¶ï¼ˆéäººä¸ºï¼‰ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€æ¬¡æ‰‹æŒ‡è§¦æ‘¸å±å¹•ç„¶åç¦»å¼€å¯èƒ½è§¦å‘ä¸€ä¸‹ä¸¤ç§æƒ…å†µï¼š ç‚¹å‡»å±å¹•ç„¶åæ¾å¼€ï¼šACTION_DOWN -&gt; ACTION_UP ç‚¹å‡»å±å¹•ç„¶åæ»‘åŠ¨å†æ¾å¼€ï¼šACTION_DOWN -&gt; ACTION_MOVE -&gt; ACTION_UP ä¸‹é¢ä¸€ä¸ªå›¾ç‰‡æ¥æ¦‚æ‹¬ä¸‹ï¼š 2. äº‹ä»¶åˆ†å‘ä¼ é€’è§„åˆ™ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroidUIæ˜¯ç”±Activityã€ViewGroupã€ViewåŠå…¶æ´¾ç”Ÿç±»ç»„æˆçš„ã€‚ å¤§è‡´ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å…¶ä¸­ï¼š Activityï¼šæ§åˆ¶ç”Ÿå‘½å‘¨æœŸæˆ–è€…å¤„ç†äº‹ä»¶ ViewGroupï¼šä¸€ç»„Viewæˆ–è€…å¤šä¸ªViewçš„é›†åˆã€‚ä¹Ÿæ˜¯å¸ƒå±€Layoutçš„åŸºç±»ã€‚ä½†æ˜¯ç‰¹åˆ«çš„æ˜¯ï¼Œä»–ä¹Ÿé›†æˆè‡ªViewã€‚ Viewï¼šæ‰€æœ‰UIç»„ä»¶çš„åŸºç±» ä»ä¸Šå›¾æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œäº‹ä»¶åˆ†å‘çš„é¡ºåºå°±æ˜¯ï¼šActivity -&gt; ViewGroup -&gt; Viewã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªç‚¹å‡»äº‹ä»¶äº§ç”Ÿï¼Œå…ˆäº¤ç”±Activityï¼Œå†ä¼ åˆ°ViewGroupï¼Œå†ä¼ åˆ°Viewã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­åªè¦æœ‰ä¸€ä¸ªéƒ¨åˆ†è¯´è¦æ‹¦æˆªï¼Œå°±ä¸ä¼šå†ç»§ç»­å¾€ä¸‹ä¼ é€’ã€‚ 3. äº‹ä»¶åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•å…¶å®æ—¶é—´åˆ†å‘çš„æ ¸å¿ƒæ–¹æ³•å¾ˆç®€å•ï¼Œå°±ç”±ä¸‰ä¸ªæ–¹æ³•ç»„æˆï¼š public boolean dispatchTouchEvent(MotionEvent ev)ç”¨æ¥è¿›è¡Œäº‹ä»¶çš„åˆ†å‘ã€‚å¦‚æœäº‹ä»¶èƒ½å¤Ÿä¼ é€’ç»™å½“å‰Viewï¼Œé‚£ä¹ˆæ­¤æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœå—å½“å‰Viewçš„onTouchEventå’Œä¸‹çº§Viewçš„dispatchTouchEventæ–¹æ³•çš„å½±å“ï¼Œè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ã€‚ public boolean onInterceptTouchEvent(MotionEvent event)åœ¨dispatchTouchEventæ–¹æ³•å†…éƒ¨è°ƒç”¨ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ‹¦æˆªæŸä¸ªäº‹ä»¶ï¼Œå¦‚æœå½“å‰Viewæ‹¦æˆªäº†æŸä¸ªäº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨åŒä¸€äº‹ä»¶åºåˆ—å½“ä¸­ï¼Œæ­¤æ–¹æ³•ä¸ä¼šå†æ¬¡è¢«è°ƒç”¨ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ‹¦æˆªå½“å‰äº‹ä»¶ã€‚ï¼ˆåªæœ‰ViewGroupä¸­æ‰æœ‰æ­¤æ–¹æ³•ï¼ŒViewä¸­æ²¡æœ‰ï¼‰ public boolean onTouchEvent(MotionEvent event)åœ¨dispatchTouchEventæ–¹æ³•ä¸­è°ƒç”¨ï¼Œç”¨æ¥å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè¿”å›ç»“æœè¡¨ç¤ºæ˜¯å¦æ¶ˆè€—å½“å‰äº‹ä»¶ï¼Œå¦‚æœä¸æ¶ˆè€—ï¼Œåˆ™åœ¨åŒä¸€ä¸ªäº‹ä»¶åºåˆ—ä¸­ï¼Œå½“å‰Viewæ— æ³•å†æ¬¡æ¥æ”¶åˆ°äº‹ä»¶ã€‚ ä¸‰ä¸ªæ–¹æ³•é—´çš„å…³ç³»å¯ä»¥æŒ‰ä¸‹é¢ä¸€æ®µä¼ªä»£ç è¡¨ç¤ºï¼šï¼ˆå‚è€ƒçš„ä»£ç ï¼‰ 1234567891011121314151617181920212223242526/** * ç‚¹å‡»äº‹ä»¶äº§ç”Ÿå */ // æ­¥éª¤1ï¼šè°ƒç”¨dispatchTouchEventï¼ˆï¼‰ public boolean dispatchTouchEvent(MotionEvent ev) &#123; boolean consume = false; //ä»£è¡¨ æ˜¯å¦ä¼šæ¶ˆè´¹äº‹ä»¶ // æ­¥éª¤2ï¼šåˆ¤æ–­æ˜¯å¦æ‹¦æˆªäº‹ä»¶ if (onInterceptTouchEvent(ev)) &#123; // a. è‹¥æ‹¦æˆªï¼Œåˆ™å°†è¯¥äº‹ä»¶äº¤ç»™å½“å‰Viewè¿›è¡Œå¤„ç† // å³è°ƒç”¨onTouchEvent (ï¼‰æ–¹æ³•å»å¤„ç†ç‚¹å‡»äº‹ä»¶ consume = onTouchEvent (ev) ; &#125; else &#123; // b. è‹¥ä¸æ‹¦æˆªï¼Œåˆ™å°†è¯¥äº‹ä»¶ä¼ é€’åˆ°ä¸‹å±‚ // å³ ä¸‹å±‚å…ƒç´ çš„dispatchTouchEventï¼ˆï¼‰å°±ä¼šè¢«è°ƒç”¨ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ // ç›´åˆ°ç‚¹å‡»äº‹ä»¶è¢«æœ€ç»ˆå¤„ç†ä¸ºæ­¢ consume = child.dispatchTouchEvent (ev) ; &#125; // æ­¥éª¤3ï¼šæœ€ç»ˆè¿”å›é€šçŸ¥ è¯¥äº‹ä»¶æ˜¯å¦è¢«æ¶ˆè´¹ï¼ˆæ¥æ”¶ &amp; å¤„ç†ï¼‰ return consume;&#125; å¯¹äºä¸€ä¸ªæ ¹ViewGroupï¼Œç‚¹å‡»äº‹ä»¶äº§ç”Ÿåï¼Œå°±ä¼šä¼ é€’ç»™ä»–ï¼Œè¿™æ—¶ä»–çš„dispatchTouchEventå°±ä¼šè¢«è°ƒç”¨ï¼Œç„¶åå°±å¼€å§‹åˆ¤æ–­ä»–æ˜¯å¦æ‹¦æˆªã€‚å¦‚æœæ‹¦æˆªï¼Œé‚£ä¹ˆç‚¹å‡»äº‹ä»¶å°±ä¼šç»™ViewGroupå»å¤„ç†ï¼Œå¦‚æœä¸æ‹¦æˆªï¼Œå°±è°ƒç”¨child.dispatchTouchEvent (ev) ä¼ ç»™å­æ§ä»¶çš„dispatchTouchEventæ–¹æ³•ã€‚ç„¶åç»§ç»­å¾ªç¯ï¼Œç›´åˆ°åˆ°æœ€åº•å±‚viewï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰childçš„æ—¶å€™ï¼Œæˆ–è€…ç›´åˆ°äº‹ä»¶è¢«æ‹¦æˆªã€‚ 4. æºç åˆ†æ4.1 Activityäº‹ä»¶åˆ†å‘é¦–å…ˆå…ˆæ¥çœ‹dispatchTouchEventæ–¹æ³•ï¼š æºç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889public boolean dispatchTouchEvent(MotionEvent ev) &#123; if (ev.getAction() == MotionEvent.ACTION_DOWN) &#123; onUserInteraction(); // -&gt;&gt; åˆ†æ1 &#125; if (getWindow().superDispatchTouchEvent(ev)) &#123; // -&gt;&gt; åˆ†æ2 return true; &#125; return onTouchEvent(ev); // -&gt;&gt; åˆ†æ5&#125;/** * åˆ†æ1ï¼šonUserInteraction() * è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘æ˜¯åœ¨æ²¡ææ‡‚è¿™ä¸ªæ–¹æ³•æ˜¯å¹²å˜›çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥ç²˜è´´äº†carsonè¿™ä½å¤§ç¥çš„è¯´æ˜ * ä½œç”¨ï¼šå®ç°å±ä¿åŠŸèƒ½ * æ³¨ï¼š * a. è¯¥æ–¹æ³•ä¸ºç©ºæ–¹æ³• * b. å½“æ­¤activityåœ¨æ ˆé¡¶æ—¶ï¼Œè§¦å±ç‚¹å‡»æŒ‰homeï¼Œbackï¼Œmenué”®ç­‰éƒ½ä¼šè§¦å‘æ­¤æ–¹æ³• */public void onUserInteraction() &#123;&#125;/** * åˆ†æ2ï¼šgetWindow().superDispatchTouchEvent(ev) * ç‚¹å¼€ä¹‹åè¿›å…¥Windowç±»ï¼Œ * ä½†æ˜¯å‘ç°è¿™ä¸ªç±»æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ã€‚ * * äº†è§£è¿‡Viewçš„åŒå­¦éƒ½çŸ¥é“ï¼ŒWindowçš„å”¯ä¸€å®ç°ç±»å°±æ˜¯PhoneWindow * é‚£æˆ‘ä»¬è¿›å…¥PhoneWindowçœ‹ä¸‹ä»–çš„superDispatchTouchEventæ–¹æ³• */public abstract boolean superDispatchTouchEvent(MotionEvent event);// -&gt;&gt; åˆ†æ3/** * åˆ†æ3ï¼šPhoneWindow.superDispatchTouchEvent() * å®é™…ä¸Šåˆè°ƒç”¨äº†DecorViewçš„superDispatchTouchEventæ–¹æ³•ï¼ŒDecorViewæ˜¯æœ€é¡¶å±‚çš„View */@Overridepublic boolean superDispatchTouchEvent(MotionEvent event) &#123; return mDecor.superDispatchTouchEvent(event); // -&gt;&gt; åˆ†æ4&#125;/** * åˆ†æ4ï¼šDecorView.superDispatchTouchEvent() * æ³¨ï¼š * a. DecorViewç»§æ‰¿è‡ªFrameLayoutï¼Œè€ŒFrameLayoutç»§æ‰¿è‡ªViewGroupï¼Œä¹Ÿå°±æ˜¯è¯´DecorViewå°±æ˜¯ViewGroupã€‚ * b. DecorViewè°ƒç”¨äº†çˆ¶ç±»çš„dispatchTouchEventæ–¹æ³•ï¼Œä¹Ÿå°±ç›¸å½“äºViewGroupçš„dispatchTouchEventæ–¹æ³•ï¼Œå°±æŠŠäº‹ä»¶äº¤ç»™äº†ViewGroupå»å¤„ç†ï¼Œè¿™å—åé¢å†è¯´ */public boolean superDispatchTouchEvent(MotionEvent event) &#123; return super.dispatchTouchEvent(event);&#125;/** * åˆ†æ5ï¼šreturn onTouchEvent(ev) * å½“è§¦æ‘¸å±äº‹ä»¶æœªç”±å…¶ä¸‹çš„ä»»ä½•è§†å›¾å¤„ç†æ—¶è°ƒç”¨ * */public boolean onTouchEvent(MotionEvent event) &#123; if (mWindow.shouldCloseOnTouch(this, event)) &#123; // -&gt;&gt; åˆ†æ6 finish(); return true; &#125; return false; // åªæœ‰åœ¨ç‚¹å‡»äº‹ä»¶åœ¨Windowè¾¹ç•Œå¤–æ‰ä¼šè¿”å›trueï¼Œä¸€èˆ¬æƒ…å†µéƒ½è¿”å›falseï¼Œåˆ†æå®Œæ¯•&#125;/** * åˆ†æ6ï¼šWindow.shouldCloseOnTouch() * * è¿”å›ï¼š * è¿”å›trueï¼šè¯´æ˜äº‹ä»¶åœ¨è¾¹ç•Œå¤–ï¼Œå³ æ¶ˆè´¹äº‹ä»¶ * è¿”å›falseï¼šæœªæ¶ˆè´¹ï¼ˆé»˜è®¤ï¼‰ */public boolean shouldCloseOnTouch(Context context, MotionEvent event) &#123; final boolean isOutside = event.getAction() == MotionEvent.ACTION_DOWN &amp;&amp; isOutOfBounds(context, event) || event.getAction() == MotionEvent.ACTION_OUTSIDE; // ä¸»è¦æ˜¯å¯¹äºå¤„ç†è¾¹ç•Œå¤–ç‚¹å‡»äº‹ä»¶çš„åˆ¤æ–­ï¼šæ˜¯å¦æ˜¯DOWNäº‹ä»¶ï¼Œeventçš„åæ ‡æ˜¯å¦åœ¨è¾¹ç•Œå†…ç­‰ if (mCloseOnTouchOutside &amp;&amp; peekDecorView() != null &amp;&amp; isOutside) &#123; // peekDecorViewæ˜¯è¿”å›PhoneWindowçš„mDecor return true; &#125; return false;&#125; æµç¨‹ 4.2 ViewGroupäº‹ä»¶åˆ†å‘æºç ç”±äºæ­¤éƒ¨åˆ†ä»£ç è¿‡é•¿ï¼Œæˆ‘ä»¬å°†ä»£ç æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼š part11234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@Overridepublic boolean dispatchTouchEvent(MotionEvent ev) &#123; ...// ä»…è´´å‡ºå…³é”®ä»£ç  boolean handled = false; /** * onFilterTouchEventForSecurity(ev) * ç­›é€‰touchäº‹ä»¶ï¼Œè¿›å»ä¹‹åçš„åˆ¤æ–­æ ¸å¿ƒå°±æ˜¯å½“å‰è§†å›¾æ˜¯å¦è¢«å…¶å®ƒçª—å£é®æŒ¡æˆ–è€…éšè— */ if (onFilterTouchEventForSecurity(ev)) &#123; final int action = ev.getAction(); final int actionMasked = action &amp; MotionEvent.ACTION_MASK; // Handle an initial down. // -&gt;&gt; åˆ†æ1 if (actionMasked == MotionEvent.ACTION_DOWN) &#123; // Throw away all previous state when starting a new touch gesture. // The framework may have dropped the up or cancel event for the previous gesture // due to an app switch, ANR, or some other state change. cancelAndClearTouchTargets(ev); resetTouchState(); &#125; // Check for interception. final boolean intercepted; /** * åˆ†æ2 * å¯ä»¥çœ‹åˆ°ä¼šæœ‰ä¸¤ç§æƒ…å†µä¸‹æ‹¦æˆªäº‹ä»¶ï¼šäº‹ä»¶ç±»å‹ä¸ºDOWNï¼Œæˆ–è€…mFirstTouchTarget != nullã€‚ * é‚£ä¹ˆè¿™ä¸ªmFirstTouchTargetæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ * ä»åé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå½“ViewGroupä¸æ‹¦æˆªäº‹ä»¶äº¤ç»™å­å…ƒç´ å¤„ç†çš„æ—¶å€™ï¼ŒmFirstTouchTargetä¸ä¸ºnullã€‚ * æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´å½“MotionEventä¸ºUPæˆ–è€…MOVEçš„æ—¶å€™ï¼Œéƒ½è¿›ä¸å»è¿™ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä¸è°ƒç”¨ViewGroupçš„onInterceptTouchEventï¼Œä»–ä¸æ‹¦æˆªäº‹ä»¶ */ if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) &#123; final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0; if (!disallowIntercept) &#123; intercepted = onInterceptTouchEvent(ev); ev.setAction(action); // restore action in case it was changed &#125; else &#123; intercepted = false; &#125; &#125; else &#123; // There are no touch targets and this action is not an initial down // so this view group continues to intercept touches. intercepted = true; &#125; /** * åˆ†æ1 * äº‹ä»¶å¼€å§‹æ—¶ä¼šè°ƒç”¨resetTouchState()æ¥æ¸…ç©ºmFirstAndClearTouchTarget */if (actionMasked == MotionEvent.ACTION_DOWN) &#123; cancelAndClearTouchTargets(ev); // æ ¸å¿ƒç›®çš„å°±æ˜¯æ¸…ç©ºmFirstAndClearTouchTarget resetTouchState();&#125; part2123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118 ...//çœç•¥ä¸­é—´ä»£ç  // è¿›å…¥ifè¯­å¥ï¼Œåˆ¤æ–­æ¡ä»¶ä¸ºæ²¡æœ‰å¯¹äº‹ä»¶è¿›è¡Œæ‹¦æˆªï¼ŒåŒæ—¶äº‹ä»¶æ²¡æœ‰ç»“æŸã€‚å¯¹ViewGroupçš„å­å…ƒç´ è¿›è¡Œéå† if (!canceled &amp;&amp; !intercepted) &#123; ...//ç»§ç»­çœç•¥ä¸­é—´ä»£ç  // å¾—åˆ°æ‰€æœ‰çš„å­View final View[] children = mChildren; // å¯¹å­Viewè¿›è¡Œéå† for (int i = childrenCount - 1; i &gt;= 0; i--) &#123; final int childIndex = getAndVerifyPreorderedIndex( childrenCount, i, customOrder); final View child = getAndVerifyPreorderedView( preorderedList, children, childIndex); // If there is a view that has accessibility focus we want it // to get the event first and if not handled we will perform a // normal dispatch. We may do a double iteration but this is // safer given the timeframe. // è¯¥viewgroupè®¾ç½®äº‹ä»¶äº†æŒ‡å‘ç„¦ç‚¹Viewå¹¶ä¸”ç„¦ç‚¹Viewåœ¨å‰é¢å·²ç»æ‰¾åˆ°äº† if (childWithAccessibilityFocus != null) &#123; // åˆ¤æ–­éå†çš„æ­¤Viewæ˜¯å¦æ˜¯ç„¦ç‚¹Viewï¼Œå¦‚æœä¸æ˜¯å°±ç›´æ¥ä¸‹ä¸€éå¾ªç¯ if (childWithAccessibilityFocus != child) &#123; continue; &#125; // å¦‚æœæ˜¯çš„è¯å°±å°†æ‰¾åˆ°çš„ç„¦ç‚¹viewç½®ç©º // iå›åˆ°åˆ°æ•°ç¬¬ä¸€ä¸ªä¸‹æ ‡ // è¿™æ ·åšçš„ç›®çš„æ˜¯å…ˆè®©è¯¥ç„¦ç‚¹viewå°è¯•è¿›è¡Œä¸‹é¢çš„æ™®é€šåˆ†å‘æ“ä½œ // å¦‚æœæˆåŠŸäº†ï¼Œä¼šåœ¨ä¸‹é¢è·³å‡ºå¾ªç¯ã€‚ // å¦‚æœä¸æˆåŠŸï¼Œå°±å°†è®°å½•çš„ç„¦ç‚¹viewç½®ç©ºï¼Œ // ä»æœ€åä¸€ä¸ªå¼€å§‹é‡æ–°éå†ï¼Œä¸å†è¿›å…¥è¿™ä¸ªåˆ¤æ–­ã€‚ childWithAccessibilityFocus = null; i = childrenCount - 1; &#125; // åˆ¤æ–­å½“å‰å­Viewæ˜¯å¦èƒ½è·å–ç„¦ç‚¹æˆ–è€…æ˜¯å¦æ­£åœ¨åšåŠ¨ç”» if (!canViewReceivePointerEvents(child) || !isTransformedTouchPointInView(x, y, child, null)) &#123; ev.setTargetAccessibilityFocus(false); continue; &#125; newTouchTarget = getTouchTarget(child); if (newTouchTarget != null) &#123; // Child is already receiving touch within its bounds. // Give it the new pointer in addition to the ones it is handling. newTouchTarget.pointerIdBits |= idBitsToAssign; break; &#125; resetCancelNextUpFlag(child); // -&gt;&gt; åˆ†æ1 if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) &#123; // Child wants to receive touch within its bounds. mLastTouchDownTime = ev.getDownTime(); if (preorderedList != null) &#123; // childIndex points into presorted list, find original index for (int j = 0; j &lt; childrenCount; j++) &#123; if (chifcldren[childIndex] == mChildren[j]) &#123; mLastTouchDownIndex = j; break; &#125; &#125; &#125; else &#123; mLastTouchDownIndex = childIndex; &#125; mLastTouchDownX = ev.getX(); mLastTouchDownY = ev.getY(); // -&gt;&gt; åˆ†æ2 newTouchTarget = addTouchTarget(child, idBitsToAssign); alreadyDispatchedToNewTouchTarget = true; break; &#125; // The accessibility focus didn't handle the event, so clear // the flag and do a normal dispatch to all children. ev.setTargetAccessibilityFocus(false); &#125; ... //çœç•¥ &#125;/** * åˆ†æ1 dispatchTransformedTouchEvent() * * æ ¸å¿ƒå°±æ˜¯é‚£ä¸ªif (child == null)ã€‚ * å¦‚æœchildä¸ä¸ºç©ºï¼Œé‚£ä¹ˆäº‹ä»¶å°±äº¤ç»™å­Viewå¤„ç† */private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel, View child, int desiredPointerIdBits) &#123; final boolean handled; // Canceling motions is a special case. We don't need to perform any transformations // or filtering. The important part is the action, not the contents. final int oldAction = event.getAction(); if (cancel || oldAction == MotionEvent.ACTION_CANCEL) &#123; event.setAction(MotionEvent.ACTION_CANCEL); if (child == null) &#123; handled = super.dispatchTouchEvent(event); &#125; else &#123; handled = child.dispatchTouchEvent(event); &#125; event.setAction(oldAction); return handled; &#125; ...//çœç•¥&#125;/** * åˆ†æ2 * å¦‚æœå­Viewèƒ½å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆå°±è°ƒç”¨addTouchTargetæ–¹æ³•ï¼Œå¯¹mFirstTouchTargetæ–¹æ³•è¿›è¡Œå¤åˆ¶ï¼Œç„¶åå†è¿›å…¥part1ä¸­åˆ†æ2ã€‚ */private TouchTarget addTouchTarget(@NonNull View child, int pointerIdBits) &#123; final TouchTarget target = TouchTarget.obtain(child, pointerIdBits); target.next = mFirstTouchTarget; mFirstTouchTarget = target; return target;&#125; part31234567891011121314151617181920212223242526272829303132333435363738394041 // Dispatch to touch targets. // å¦‚æœpart2å¼€å¤´çš„é‚£ä¸ªifæ²¡æœ‰è¿›ï¼Œä¹Ÿå°±æ˜¯å¯¹äº‹ä»¶è¿›è¡Œæ‹¦æˆªçš„è¯ï¼Œç›´æ¥åˆ°è¿™æ¥ // å¹¶ä¸”å¦‚æœæ²¡æœ‰è¿›å…¥part2ï¼Œé‚£ä¹ˆmFirstTouchTargetä»ç„¶ä¸ºç©ºï¼Œé‚£ä¹ˆå°±è¿›å…¥if if (mFirstTouchTarget == null) &#123; // No touch targets so treat this as an ordinary view. // æ­¤å¤„åœ¨ä¸Šé¢åˆ†æè¿‡äº†ï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ç”±äºchildç›´æ¥ä¼ å…¥äº†nullï¼Œé‚£ä¹ˆå°±æ‰§è¡Œsuper.dispatchTouchEvenã€‚ // é‚£ä¹ˆsuperæ˜¯è°å‘¢ï¼Ÿæˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼ŒViewGroupæ˜¯ç»§æ‰¿è‡ªViewçš„ï¼Œé‚£ä¹ˆä»–å°±æ˜¯æ‰§è¡ŒViewçš„dispatchTouchEventã€‚ handled = dispatchTransformedTouchEvent(ev, canceled, null, TouchTarget.ALL_POINTER_IDS); &#125; else &#123; ... //çœç•¥ &#125; // Update list of touch targets for pointer up or cancel, if needed. if (canceled || actionMasked == MotionEvent.ACTION_UP || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123; // -&gt;&gt; åˆ†æ1 resetTouchState(); &#125; else if (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123; final int actionIndex = ev.getActionIndex(); final int idBitsToRemove = 1 &lt;&lt; ev.getPointerId(actionIndex); removePointersFromTouchTargets(idBitsToRemove); &#125; &#125; ...//çœç•¥ &#125;/** * åˆ†æ1 * åœ¨åŒä¸€äº‹ä»¶ç³»åˆ—ç»“æŸåè°ƒç”¨resetTouchState(); */private void resetTouchState() &#123; // å¯¹mFirstTouchTargetæ¸…ç©ºè¿˜åŸ clearTouchTargets(); resetCancelNextUpFlag(this); mGroupFlags &amp;= ~FLAG_DISALLOW_INTERCEPT; mNestedScrollAxes = SCROLL_AXIS_NONE;&#125; æµç¨‹æ­¤å›¾æ¬è‡ªCarson_Hoå¤§ä½¬çš„åšå®¢ 4.3 Viewäº‹ä»¶åˆ†å‘æºç dispatchTouchEvent1234567891011121314151617181920212223242526272829303132public boolean dispatchTouchEvent(MotionEvent event) &#123; ...//çœç•¥ boolean result = false; ...//çœç•¥ // å’ŒViewGroupä¸€æ ·çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰è§†å›¾æ˜¯å¦è¢«é®æŒ¡æˆ–è€…ä¸å¯è§ if (onFilterTouchEventForSecurity(event)) &#123; if ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) &#123; result = true; &#125; //noinspection SimplifiableIfStatement ListenerInfo li = mListenerInfo; // æ£€æµ‹æœ‰æ²¡æœ‰è®¾ç½®OnTOuchListenerï¼Œå¦‚æœæœ‰ï¼Œå¹¶ä¸”onTouchæ–¹æ³•è¿”å›trueé‚£ä¹ˆè¿›å…¥ifï¼Œç»“æœå¯¼è‡´onTouchEventä¸è¢«æ‰§è¡Œ if (li != null &amp;&amp; li.mOnTouchListener != null &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; li.mOnTouchListener.onTouch(this, event)) &#123; result = true; &#125; // å¦‚æœæ²¡è¿›å…¥ä¸Šé¢çš„ifï¼Œä¹Ÿå°±ç›¸å½“äºæ²¡æœ‰è®¾ç½®OnTouchListenerï¼Œé‚£ä¹ˆæ‰§è¡ŒonTOuchEvent if (!result &amp;&amp; onTouchEvent(event)) &#123; result = true; &#125; &#125; ...//çœç•¥ return result;&#125; ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒonTouchçš„ä¼˜å…ˆçº§é«˜äºonTouchEventã€‚ onTouchEvent1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889public boolean onTouchEvent(MotionEvent event) &#123; final float x = event.getX(); final float y = event.getY(); final int viewFlags = mViewFlags; final int action = event.getAction(); /** * æ³¨é‡Š1 * åªæœ‰åœ¨Clickã€LongClickã€contextClickéƒ½ä¸å¯ç”¨çš„æ—¶å€™æ‰ä¸ºfalse */ final boolean clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE) || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE; // é¦–å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯ä¸å¯ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›å…¥if if ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123; if (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != 0) &#123; setPressed(false); &#125; mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN; // A disabled view that is clickable still consumes the touch // events, it just doesn't respond to them. // -&gt;&gt; æ³¨é‡Š1ï¼ˆè§ä¸Šé¢ğŸ‘†ï¼‰ return clickable; &#125; // å¦‚æœViewæœ‰ä»£ç†ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³• if (mTouchDelegate != null) &#123; if (mTouchDelegate.onTouchEvent(event)) &#123; return true; &#125; &#125; // è¿™å—æˆ‘ä»¬åªè°ƒå‡ºACTION_UPæ¥çœ‹ // åªè¦clickableä¸ºtrue(è§ä¸Šé¢æ³¨é‡Š1ğŸ‘†)æˆ–è€…TOOLTIP(å¯èƒ½æ˜¯Android8.0æ–°å‡ºçš„æç¤ºåŠŸèƒ½å§) if (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) &#123; switch (action) &#123; case MotionEvent.ACTION_UP: ...//çœç•¥ if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) &#123; // This is a tap, so remove the longpress check removeLongPressCallback(); // Only perform take click actions if we were in the pressed state if (!focusTaken) &#123; // Use a Runnable and post this rather than calling // performClick directly. This lets other visual state // of the view update before click actions start. if (mPerformClick == null) &#123; mPerformClick = new PerformClick(); &#125; if (!post(mPerformClick)) &#123; // -&gt;&gt; åˆ†æ1 performClickInternal(); &#125; &#125; &#125; ... //çœç•¥ &#125; mIgnoreNextUpEvent = false; break; ... //çœç•¥å…¶å®ƒå‡ ç§MotionEvent &#125; return true; &#125; // ç”±ä»£ç å¯çŸ¥åªè¦ä¸Šé¢çš„ifè¯­å¥æˆç«‹ï¼Œä¸ç®¡è¿›å…¥switchä¸­çš„ä»»ä½•ACTIONæˆ–æ˜¯éƒ½ä¸è¿›å…¥ï¼Œè¿”å›å€¼éƒ½æ˜¯trueï¼Œå³äº‹ä»¶æ¶ˆè´¹äº†ã€‚ return false;&#125;/** * åˆ†æ1ï¼šperformClickï¼ˆï¼‰ */public boolean performClick() &#123; if (mOnClickListener != null) &#123; playSoundEffect(SoundEffectConstants.CLICK); mOnClickListener.onClick(this); return true; // åªè¦æˆ‘ä»¬é€šè¿‡setOnClickListenerï¼ˆï¼‰ä¸ºæ§ä»¶cvViewæ³¨å†Œ1ä¸ªç‚¹å‡»äº‹ä»¶ // é‚£ä¹ˆå°±ä¼šç»™mOnClickListenerå˜é‡èµ‹å€¼ï¼ˆå³ä¸ä¸ºç©ºï¼‰ // åˆ™ä¼šå¾€ä¸‹å›è°ƒonClickï¼ˆï¼‰ &amp; performClickï¼ˆï¼‰è¿”å›true &#125; return false; &#125; æµç¨‹]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
        <tag>æºç </tag>
        <tag>äº‹ä»¶åˆ†å‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OpenGL ES 2.0ç¬”è®°2â€”â€”é¡¶ç‚¹ã€åæ ‡ã€å›¾å…ƒ]]></title>
    <url>%2Fposts%2F268eb1c2.html</url>
    <content type="text"><![CDATA[ä¸ŠèŠ‚æˆ‘ä»¬å¯¹OpenGLåšäº†ä¸€ä¸ªå¤§è‡´çš„ä»‹ç»ï¼Œå¹¶å†™äº†ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ï¼Œåœ¨è¿™èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šä»‹ç»é¡¶ç‚¹ã€åæ ‡ç³»å’Œå›¾å…ƒ é¡¶ç‚¹åœ¨OpenGLä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿çš„ç»“æ„éƒ½æ˜¯ä»ä¸€ä¸ªé¡¶ç‚¹å¼€å§‹çš„ã€‚ æ‰€è°“é¡¶ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªå‡ ä½•å›¾å½¢çš„æ‹ç‚¹ã€‚åœ¨ä»‹ç»é¡¶ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸‹OpenGLåæ ‡ã€‚ OpenGLåæ ‡ç³»å¦‚æœæœ‰ä¼šAndroidå¼€å‘çš„æœ‹å‹ï¼Œä¸€å®šä¼šé»˜è®¤ä¸ºä»å±å¹•çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œæ°´å¹³å¾€å³æ˜¯xè½´ï¼Œç«–ç›´å‘ä¸‹æ˜¯yè½´ã€‚ ä½†æ˜¯åœ¨OpenGLä¸­æ˜¯ä¸åŒçš„ï¼ŒOpenGLæ˜¯ä»æ˜¾ç¤ºè§†çª—çš„æ­£ä¸­å¿ƒæ˜¯ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯$(0, 0)$ï¼Œè€Œå±å¹•æœ€å·¦è¾¹çš„xè½´åæ ‡æ˜¯-1ï¼Œå±å¹•æœ€å³è¾¹çš„xè½´åæ ‡æ˜¯1ï¼Œå±å¹•æœ€ä¸Šé¢çš„yè½´åæ ‡æ˜¯1ï¼Œå±å¹•æœ€ä¸‹é¢çš„yè½´åæ ‡æ˜¯-1ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å¹…å›¾ï¼š åœ¨ä»£ç ä¸­å®šä¹‰é¡¶ç‚¹åœ¨OpenGLä¸­å®šä¹‰é¡¶ç‚¹æœ‰ç‚¹ç‰¹æ®Šï¼Œæˆ‘ä»¬ç¬¬ä¸€ååº”éƒ½æ˜¯ç›´æ¥æ‹¿æ•°ç»„å°†é¡¶ç«¯å­˜èµ·æ¥å°±è¡Œäº†ï¼Œä½†æ˜¯åœ¨OpenGLä¸­ï¼Œä½ é™¤äº†è¦å°†é¡¶ç‚¹çš„åæ ‡ç”¨æ•°ç»„å­˜èµ·æ¥ä»¥å¤–ï¼Œè¿˜å¾—å®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼Œç”¨æ¥æ ‡è®°ä¸€ä¸ªé¡¶ç‚¹æœ‰ä¸¤ä¸ªåˆ†é‡ï¼š 1234567891011121314151617181920private static final int POSITION_COMPONENT_COUNT = 2;float[] tableVerticesWithTriangles = &#123; // Triangle 1 -0.5f, -0.5f, 0.5f, 0.5f, -0.5f, 0.5f, // Triangle 2 -0.5f, -0.5f, 0.5f, -0.5f, 0.5f, 0.5f, // Line 1 -0.5f, 0f, 0.5f, 0f, // Mallets 0f, -0.25f, 0f, 0.25f&#125;; æˆ‘ä»¬é‡‡ç”¨æµ®ç‚¹æ•°çš„é¡ºåºåˆ—è¡¨å®šä¹‰é¡¶ç‚¹æ•°æ®ï¼Œè¿™ä¸ªæ•°ç»„é€šå¸¸è¢«æˆä¸ºé¡¶ç‚¹å±æ€§ã€‚ å›¾å…ƒåœ¨OpenGLä¸­ï¼Œåªèƒ½ç»˜åˆ¶ç‚¹ã€ç›´çº¿å’Œä¸‰è§’å½¢ï¼Œè¿™ä¸‰ä¸ªä¹Ÿè¢«ç§°ä¸ºå›¾å…ƒã€‚ ä¹Ÿå°±æ„å‘³ç€ï¼Œå…¶å®ƒæ‰€æœ‰çš„å›¾å½¢éƒ½å¾—é€šè¿‡è¿™ä¸‰ä¸ªåŸºæœ¬å›¾å…ƒæ¥å®ç°ã€‚ å¦‚æœæˆ‘ä»¬éœ€è¦ç»˜åˆ¶ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆä¸€ä¸ªåæ ‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ç»˜åˆ¶ä¸€æ¡ç›´çº¿ï¼Œå°±éœ€è¦ä¸¤ä¸ªåæ ‡ï¼Œå¦‚æœç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼Œå°±éœ€è¦ä¸‰ä¸ªåæ ‡ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±ä»¥ç»˜åˆ¶ä¸€ä¸ªæ­£æ–¹å½¢ä¸¾ä¾‹ï¼š 123456float[] squareVerticesWithTriangles = &#123; -0.5f, -0.5f, 0.5f, 0.5f, -0.5f, 0.5f, 0.5f, -0.5f&#125;; å¦‚æœæˆ‘è¦åœ¨è¿™ä¸ªæ­£æ–¹å½¢ä¸­é—´åŠ ä¸€ä¸ªæ¨ªçº¿çš„è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥åœ¨ä¸Šé¢çš„æ•°ç»„é‡Œé¢å»åŠ ï¼Œåˆ°æ—¶å€™è¦å°†é¡¶ç‚¹ç€è‰²å™¨åŠ è½½åˆ°å›¾å½¢ä¸­çš„æ—¶å€™å†å»å¤„ç†ï¼š 1234567891011float[] squareVerticesWithTriangles = &#123; // Square -0.5f, -0.5f, 0.5f, 0.5f, -0.5f, 0.5f, 0.5f, -0.5f, // Line -0.5f, 0, 0.5f, 0&#125;; è®©æ•°æ®å¯ä»¥è¢«OpenGLè¯»å–åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é¡¶ç‚¹çš„å®šä¹‰ï¼Œä½†æ˜¯ç°åœ¨OpenGLå°šè¿˜ä¸èƒ½è¯»å–ä»–ä»¬ã€‚å…¶åŸå› æ˜¯è¿™äº›ä»£ç çš„è¿è¡Œç¯å¢ƒä¸OpenGLè¿è¡Œç¯å¢ƒä½¿ç”¨äº†ä¸ä¸€æ ·çš„è¯­è¨€ã€‚ å½“æˆ‘ä»¬è¿è¡ŒJavaè¯­è¨€çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„ï¼Œè€Œæ˜¯è¿è¡Œåœ¨JVM(çº¯Java)æˆ–è€…Dalvik(Android)è™šæ‹Ÿæœºä¸Šçš„ï¼Œå¹¶ä¸”è¿è¡Œåœ¨è¿™äº›è™šæ‹Ÿæœºä¸Šçš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ç›´æ¥è®¿é—®æœ¬åœ°ç¯å¢ƒï¼›å…¶æ¬¡ï¼Œè™šæ‹Ÿæœºè¿˜é‡‡ç”¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå½“æ£€æµ‹åˆ°å˜é‡ã€å¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾æ‰è¿™äº›å†…å­˜ã€‚ ä½†æ˜¯æœ¬åœ°ç¯å¢ƒä¸èƒ½è¿™æ ·ï¼Œå› ä¸ºä»–æ˜¯ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šçš„ï¼Œä»–ä¸å¸Œæœ›å†…å­˜ä¼šè¢«ç§»æ¥ç§»å»æˆ–è€…è‡ªåŠ¨é‡Šæ”¾ã€‚ æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæ–¹æ¡ˆï¼Œè®©Androidç¨‹åºä¸OpenGLè¿›è¡Œé€šä¿¡ã€‚å…¶å®Androidä»£ç ä¸ç¡¬ä»¶é€šä¿¡æœ‰ä¸¤ç§æ–¹æ³•ï¼š é€šè¿‡JNIæŠ€æœ¯ï¼› é€šè¿‡è°ƒç”¨android.opengl.GLES20åŒ…é‡Œé¢çš„æ–¹æ³•ã€‚ æˆ‘ä»¬è¿™å—ä¸»è¦æ˜¯é€šè¿‡ç¬¬äºŒç§æ–¹æ³•ã€‚ Javaä¸­æœ‰ä¸€ç§ç‰¹æ®Šçš„é›†åˆï¼Œå¯ä»¥åˆ†é…æœ¬åœ°çš„å†…å­˜å—ï¼Œå¹¶å°†Javaçš„æ•°æ®å¤åˆ¶åˆ°æœ¬åœ°å†…å­˜ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213// å› ä¸ºJavaä¸­å›½ä¸€ä¸ªFloatå‹æ•°æ®å 4ä¸ªå­—èŠ‚private static final int BYTES_PER_FLOAT = 4;// å£°æ˜ä¸€ä¸ªå­—èŠ‚ç¼“å†²åŒºprivate final FloatBuffer vertexData; vertexData = ByteBuffer // åˆ†é…ä¸€å—æœ¬åœ°å†…å­˜ï¼Œæ‰€ä»¥æ˜¯æ•°ç»„é•¿åº¦ * ç±»å‹æ‰€å å­—èŠ‚ .allocateDirect(tableVerticesWithTriangles.length * BYTES_PER_FLOAT) // æŒ‰ç…§æœ¬åœ°å­—èŠ‚åºç»„ç»‡å†…å®¹ .order(ByteOrder.nativeOrder()) .asFloatBuffer(); // å°†æ•°æ®å­˜å…¥ .put(tableVerticesWithTriangles);]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>OpenGL</tag>
        <tag>å›¾åƒå¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OpenGL ES 2.0ç¬”è®°1â€”â€”ç®€ä»‹]]></title>
    <url>%2Fposts%2Fa92b4a54.html</url>
    <content type="text"><![CDATA[OpenGLæ˜¯ä»€ä¹ˆï¼ŸOpenGL ESåˆæ˜¯ä»€ä¹ˆï¼Ÿç®€ä»‹OpenGLæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„è½¯ä»¶æ¥å£è¯­è¨€ï¼Œç”¨äºè°ƒç”¨ç¡¬ä»¶çš„2Dã€3Då›¾å½¢å¤„ç†å™¨ã€‚ ç„¶è€Œå—é™äºç°åœ¨çš„ç§»åŠ¨è®¾å¤‡æ€§èƒ½ï¼Œå¦‚æœå°†OpenGLç›´æ¥ç”¨åœ¨ä»–ä»¬ä¸Šé¢å°†ä¼šç‰¹åˆ«å¡ï¼Œäºæ˜¯å°±å‡ºç°äº†OpenGL ESã€‚ OpenGL ESæ˜¯OpenGLçš„åˆ†æ”¯ï¼Œä»–ä¸“é—¨ä½œç”¨äºåµŒå…¥å¼è®¾å¤‡ï¼Œå»æ‰äº†OpenGLå¾ˆå¤šä¸å¿…è¦çš„åŠŸèƒ½ã€‚ åº”ç”¨åœºæ™¯ æ¸¸æˆ è§†é¢‘æ’­æ”¾å™¨ è§†é¢‘ç¼–è¾‘åº”ç”¨ å›¾ç‰‡ç¼–è¾‘åº”ç”¨ ç­‰å¯¹å›¾åƒå¤„ç†çš„åŠæ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ã€‚ Androidå¯¹OpenGL ES çš„æ”¯æŒ OpenGL ES ç‰ˆæœ¬ åŸºäºOpenGLçš„ç‰ˆæœ¬ Androidå¼•å…¥çš„ç‰ˆæœ¬ å…¼å®¹æ€§ åŠŸèƒ½ã€ç‰¹è‰² 1.0&amp;1.1 1.3&amp;1.5 Android 1.0 - å›ºå®šçš„å›¾åƒç®¡é“ï¼Œå¼€å‘éš¾åº¦ç›¸æ¯”2.0ä½ 2.0 2.0 Android 2.2 ä¸å…¼å®¹1.x å¯ç¼–ç¨‹çš„æ¸²æŸ“ç®¡é“ï¼Œæ€§èƒ½æ•ˆç‡æ›´é«˜ï¼Œå¼€å‘éš¾åº¦æ›´é«˜ 3.0 3.x Android 4.3 å…¼å®¹2.0 æ€§èƒ½æ›´é«˜ï¼Œæ”¯æŒETC2æ ¼å¼çš„é€æ˜çº¹ç†å‹ç¼© 3.1 4.x Android 5.0 å…¼å®¹2.0/3.0 æ–°å¢è®¡ç®—ç€è‰²å™¨ã€å•ç‹¬çš„ç€è‰²å™¨å¯¹è±¡ç­‰æ–°ç‰¹æ€§ ç‰ˆæœ¬çš„é€‰æ‹©ç”±äºæ­¤ç¯‡åšå®¢æ˜¯å­¦ä¹ é˜¶æ®µå†™çš„ï¼Œè€Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„å¤§éƒ¨åˆ†åšå®¢éƒ½æ˜¯2.0ï¼Œæ‰€ä»¥å°±ä»¥2.0ä¸ºä¸»ã€‚ å…¶å®æˆ‘è§‰å¾—åº”è¯¥æ˜¯3.0ï¼Œ2.0ç¡®å®å¤ªè€äº†ï¼Œç°åœ¨Android4.3çš„æ‰‹æœºéƒ½è¾ƒå°‘è§äº†ï¼Œè€Œ3.1åˆå¤ªæ–°äº†ã€‚ å¯¼å…¥é¦–å…ˆä½ å¾—åœ¨AndroidManifest.xmlä¸­åŠ å…¥&lt;uses-feature android:glEsVersion=&quot;0x00020000&quot; android:required=&quot;true&quot; /&gt; å…¶ä¸­ä¸åŒç‰ˆæœ¬å¯¹åº”å€¼ï¼š OpenGL ES ç‰ˆæœ¬ glEsVersion ç‰ˆæœ¬ 2.0 0x00020000 3.0 0x00030000 3.1 0x00030001 åŸºæœ¬æ¡†æ¶Androidæ¡†æ¶é‡Œé¢æä¾›äº†ä¸¤ä¸ªç±»æ¥ç»™ä½ ä½¿ç”¨OpenGL ES APIåˆ›å»ºå’Œæ“ä½œå›¾å½¢ï¼šGLSrufaceViewå’ŒGLSurfaceView.Rendererã€‚ GLSrufaceViewè¿™æ˜¯ä¸€ä¸ªè§†å›¾ç±»ï¼Œä½ å¯ä»¥é€šè¿‡OpenGL ES APIæ¥ç»˜åˆ¶å’Œæ“ä½œå›¾å½¢å¯¹è±¡ï¼Œä»–åœ¨åŠŸèƒ½ä¸Šå¾ˆç±»ä¼¼ä¸SurfaceViewã€‚ä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªSurfaceViewçš„å®ä¾‹å¹¶æ·»åŠ ä½ çš„æ¸²æŸ“å™¨æ¥ä½¿ç”¨è¿™ä¸ªç±»ã€‚ ä»–çš„å¸¸ç”¨æ–¹æ³•æœ‰ï¼š setEGLContextClientVersionï¼šè®¾ç½®OpenGL ESç‰ˆæœ¬ï¼Œ2.0åˆ™è®¾ç½®2 onPauseï¼šæš‚åœæ¸²æŸ“ï¼Œæœ€å¥½æ˜¯åœ¨Activityã€Fragmentçš„onPause()æ–¹æ³•å†…è°ƒç”¨ï¼Œå‡å°‘ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ï¼Œé¿å…ä¸å¿…è¦çš„å´©æºƒ onResumeï¼šæ¢å¤æ¸²æŸ“ï¼Œç”¨æ³•ç±»æ¯”onPause() setRendererï¼šè®¾ç½®æ¸²æŸ“å™¨ setRenderModeï¼šè®¾ç½®æ¸²æŸ“æ¨¡å¼ requestRender: è¯·æ±‚æ¸²æŸ“ï¼Œç”±äºæ˜¯è¯·æ±‚å¼‚æ­¥çº¿ç¨‹è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥ä¸æ˜¯åŒæ­¥æ–¹æ³•ï¼Œè°ƒç”¨åä¸ä¼šç«‹åˆ»å°±è¿›è¡Œæ¸²æŸ“ã€‚æ¸²æŸ“ä¼šå›è°ƒåˆ°Rendereræ¥å£çš„onDrawFrame()æ–¹æ³•ã€‚ queueEventï¼šæ’å…¥ä¸€ä¸ªRunnableä»»åŠ¡åˆ°åå°æ¸²æŸ“çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ç›¸åº”çš„ï¼Œæ¸²æŸ“çº¿ç¨‹ä¸­å¯ä»¥é€šè¿‡Activityçš„runOnUIThreadçš„æ–¹æ³•æ¥ä¼ é€’äº‹ä»¶ç»™ä¸»çº¿ç¨‹å»æ‰§è¡Œ å…¶ä¸­ï¼ŒGLSurfaceViewçš„æ¸²æŸ“æ¨¡å¼æœ‰ï¼š RENDERMODE_CONTINUOUSLYï¼šä¸åœåœ°æ¸²æŸ“ RENDERMODE_WHEN_DIRTYï¼šåªæœ‰è°ƒç”¨äº†requestRender()ä¹‹åæ‰ä¼šè§¦å‘æ¸²æŸ“å›è°ƒonDrawFrameæ–¹æ³• GLSurfaceView.Rendereræ­¤æ¥å£å®šä¹‰äº†åœ¨GLSurfaceViewä¸­ç»˜åˆ¶å›¾å½¢æ‰€éœ€çš„æ–¹æ³•ã€‚å¿…é¡»å°†æ­¤æ¥å£çš„å®ç°ä½œä¸ºå•ç‹¬çš„ç±»æä¾›ï¼Œå¹¶ä½¿ç”¨GLSurfaceView.setRenderer()å°†å…¶æ·»åŠ åˆ°GLSurfaceViewçš„å®ç°ç±»ä¸­ã€‚ ä»–çš„ä¸»è¦æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š onSurfaceCreated(GL10 gl, EGLConfig config)ï¼šGLSurfaceViewå†…çš„Surfaceè¢«åˆ›å»ºæ—¶ä¼šè¢«è°ƒç”¨åˆ° onSurfaceChanged(GL10 gl, int width, int height)ï¼šSurfaceå°ºå¯¸æ”¹å˜æ—¶è°ƒç”¨åˆ° onDrawFrame(GL10 gl)ï¼šæ¸²æŸ“ç»˜åˆ¶æ¯ä¸€å¸§æ—¶è°ƒç”¨åˆ° ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¦–æ¬¡åˆ›å»ºGLSurfaceViewæ—¶ï¼Œä¼šé¡ºåºè°ƒç”¨onSurfaceCreated() -&gt; onSurfaceChanged() -&gt; onDrawFrame()ã€‚ç„¶åæ¯ç»˜åˆ¶ä¸€å¸§ï¼Œéƒ½ä¼šä¸åœåœ°å›è°ƒonDrawFrame()æ–¹æ³•ã€‚ ç¼–å†™æµç¨‹é¦–å…ˆæˆ‘ä»¬æ¥å†™ä¸€ä¸ªåŸºæœ¬æ¡†æ¶ã€‚ åˆ›å»ºä¸€ä¸ªAndroidé¡¹ç›®ï¼Œç„¶åActivityé€‰æ‹©EmptyActivityã€‚ æ³¨æ„ï¼šæœ¬é¡¹ç›®æŸäº›ç±»æˆ–è€…æ–¹æ³•é€šè¿‡AndroidStudioå¯¼å…¥çš„æ—¶å€™ä¼šè®©ä½ é€‰æ‹©æ˜¯ä»å“ªä¸ªåŒ…é‡Œé¢å¯¼å…¥ï¼Œä¸€è‡´é€‰æ‹©android.opengl.GLES20 ç¼–å†™Activityæ‰“å¼€æˆ‘ä»¬é¡¹ç›®çš„MainActivityï¼Œä½ å°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„onCreateæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å¯¹è¿™ä¸ªActivityè¿›è¡Œä¸€äº›æ›´æ”¹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªGLSurfaceViewçš„å¯¹è±¡,å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„æˆå‘˜å˜é‡ï¼š 12private GLSurfaceView glSurfaceView;private boolean rendererSet = false; æ¥ä¸‹æ¥å°†setContentView()ç§»é™¤ï¼Œå¹¶å¯¹glSurfaceViewè¿›è¡Œåˆå§‹åŒ–ï¼š 12345@Overridepublic void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); glSurfaceView = new GLSurfaceView(this);&#125; ç”±äºæˆ‘ä»¬æ˜¯åœ¨å†™OpenGL ES2.0çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ£€æµ‹å½“å‰è¿è¡ŒAPPçš„ç³»ç»Ÿæ”¯ä¸æ”¯æŒOpenGL ES2.0ã€‚æˆ‘ä»¬å°†ä¸‹é¢å‡ è¡Œä»£ç æ·»åŠ åˆ°onCreate()é‡Œé¢å»: 123final ActivityManager activityManager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);final ConfigurationInfo configurationInfo = activityManager.deviceConfigurationInfo();final boolean supportsEs2 = configurationInfo.reqGlEsVersion &gt;= 0x20000; ä½†æ˜¯è¿™æ®µä»£ç åœ¨æ¨¡æ‹Ÿå™¨ä¸Šä¸èƒ½å·¥ä½œï¼Œå› ä¸ºGPUæ¨¡æ‹Ÿéƒ¨åˆ†æœ‰ç¼ºé™·ã€‚ä¸ºäº†ä½¿ä»£ç åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬è¦æŒ‰å¦‚ä¸‹ä»£ç ä¿®æ”¹æ£€æŸ¥æ¡ä»¶ï¼š 1234567final boolean supportsEs2 = configurationInfo.reqGlEsVersion &gt;= 0x20000 || (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.ICE_CREAM_SANDWICH_MR1 &amp;&amp; (Build.FINGERPRINT.startsWith("generic") || Build.FINGERPRINT.startsWith("unknown") || Build.MODEL.contains("google_sdk") || Build.MODEL.contains("Emulator") || Build.MODEL.contains("Android SDK build for x86"))) æ¥ä¸‹æ¥å°±æ˜¯é…ç½®æ¸²æŸ“è¡¨é¢ï¼š 12345678910111213if (supportsEs2) &#123; // é…ç½®è¿™ä¸ªsurfaceè§†å›¾ glSurfaceView.setEGLContextClientVersion(2); // é…ç½®Renderer glSurfaceView.setRenderer(FirstOpenGLProjectRenderer()); rendererSet = true;&#125; else &#123; Toast.makeText(this, "This device does not support OpenGL ES 2.0", Toast.LENGTH_SHORT).show(); return;&#125;setContentView(glSurfaceView); æœ€åæˆ‘ä»¬è¿˜å¾—å¤„ç†ä¸‹Activityçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯å°†GLSurfaceViewçš„ç”Ÿå‘½å‘¨æœŸè·ŸActivityçš„ç”Ÿå‘½å‘¨æœŸç»‘å®šèµ·æ¥ï¼š 123456789101112131415@Overridevoid onPause() &#123; super.onPause(); if (rendererSet) glSurfaceView.onPause();&#125;@Overridevoid onResume() &#123; super.onResume(); if (rendererSet) glSurfaceView.onResume();&#125; ç¼–å†™Rendereråˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå‘½åä¸ºFirstOpenGLProjectRendererï¼Œè®©è®©è¿™ä¸ªç±»ç»§æ‰¿è‡ªGLSurfaceView.Rendererã€‚ æ¥ç€å°±å®ç°ä¸‰ä¸ªå¿…å¤‡æ–¹æ³•: onSurfaceCreate()ï¼šåˆ›å»ºæ—¶è¢«è°ƒç”¨ 1234@Overridepublic void onSurfaceCreated(GL10 glUnsed, EGLConfig config) &#123; glClearColor(1.0f, 0.0f, 0.0f, 0.0f); //è®¾ç½®ä¸€ä¸ªæ¸…ç©ºå±å¹•ç”¨çš„é¢œè‰²&#125; onSurfaceChanged()ï¼šåˆ›å»ºåæ¯å½“Surfaceå°ºå¯¸æ”¹å˜æ—¶ï¼Œéƒ½è°ƒç”¨æ­¤æ–¹æ³• 1234@Overridepublic void onSurfaceChanged(GL10 glUnsed, int width, int height) &#123; glViewport(0, 0, width, height); //è®¾ç½®è§†çª—å°ºå¯¸&#125; onDrawFrame()ï¼šç»˜åˆ¶æ¯ä¸€å¸§æ—¶è°ƒç”¨ 1234@Overridepublic void onDrawFrame(GL10 glUnsed) &#123; glClear(GL_COLOR_BUFFER_BIT); //æ¸…ç©ºå±å¹•&#125; ç„¶åå°±å¯ä»¥è¿è¡Œç¨‹åºäº†ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ•´ä¸ªå±å¹•éƒ½æˆäº†çº¢è‰²ï¼Œè¿™æ˜¯ä¸ºå•¥å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬åœ¨onSurfaceCreatedæ–¹æ³•é‡Œé¢è®¾ç½®äº†glClearColor(1.0f,0.0f,0.0f,0.0f)ã€‚è¿™ä¸ªæ–¹æ³•çš„å‚æ•°å¯¹åº”çš„æ˜¯RGBAï¼Œç„¶åæˆ‘ä»¬åˆåœ¨onDrawFrameæ–¹æ³•ä¸­è®¾ç½®äº†æ¸…å±ï¼Œæ‰€ä»¥è¿™æ ·ä½ å°±ä¼šçœ‹åˆ°çš„æ˜¯çº¢è‰²äº†ã€‚]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>OpenGL</tag>
        <tag>å›¾åƒå¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(8)â€”â€”å¤©æ°”é¢„æŠ¥ç¬¬äºŒæ­¥-é€‰æ‹©çœã€å¸‚ã€åŒºç•Œé¢åŠç½‘ç»œè¯·æ±‚]]></title>
    <url>%2Fposts%2Ff0e3723.html</url>
    <content type="text"><![CDATA[é¡¹ç›®Githubåœ°å€ï¼ša1203991686/CoolWeather_Flutter åœ¨ç¬¬å…­ç« ä¸­æˆ‘ä»¬å†™äº†å¤©æ°”é¢„æŠ¥çš„é¡µé¢ï¼Œ ä½†æ˜¯ä½ ä½œä¸ºå¤©æ°”é¢„æŠ¥è‚¯å®šèƒ½é€‰æ‹©åŸå¸‚å§ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨æ¥å†™é€‰æ‹©çœã€å¸‚ã€åŒºçš„ç•Œé¢ã€‚ æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯éƒ­éœ–å¤§ç¥åœ¨ç¬¬ä¸€è¡Œä»£ç æœ€åé¢é…·æ¬§å¤©æ°”çš„APIã€‚ 1. å®ç°ç•Œé¢æ—¢ç„¶æ˜¯ä¸€ä¸ªé€‰æ‹©çœå¸‚åŒºçš„ç•Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç”¨ListViewã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹å¤§è‡´ç•Œé¢ï¼š å°±ç›´æ¥ä½¿ç”¨ListViewçš„builder()æ–¹æ³•ï¼Œå¿˜äº†çš„åŒå­¦å¯ä»¥çœ‹å‰é¢ç¬¬5ç« ã€‚ çœåœ¨viewæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»provinces_page.dartï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ï¼š 12345678910111213141516171819202122232425262728class ProvincesPageWidget extends StatefulWidget &#123; ProvincesPageWidget(&#123;Key key&#125;) : super(key: key); @override ProvincesPageStateWidget createState() =&gt; new ProvincesPageStateWidget();&#125;class ProvincesPageStateWidget extends State&lt;ProvincesPageWidget&gt; &#123; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: new AppBar( title: Text( "çœä»½", style: TextStyle(fontSize: 25.0), ), ), body: ListView.builder( itemCount: 30, itemBuilder: (context, index) &#123; return ListTile( title: Text("$index"), ); &#125;, ), ); &#125;&#125; å¸‚å’Œçœä¸€æ ·ã€‚åœ¨viewæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»city_page.dartï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ã€‚ç…§ç€çœçš„ä¾è‘«èŠ¦ç”»ç“¢ï¼Œå†™ä¸€ä¸ªListViewã€‚ åŒºå’Œçœä¸€æ ·ã€‚åœ¨viewæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªç±»counties_page.dartï¼Œæ¥ä¸‹æ¥å°±åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™ä»£ç ã€‚ç…§ç€çœçš„ä¾è‘«èŠ¦ç”»ç“¢ï¼Œå†™ä¸€ä¸ªListViewã€‚ 2. ç½‘ç»œè¯·æ±‚ç½‘ç»œè¯·æ±‚å¯ä»¥çœ‹ä¸‹ä¹‹å‰ç¬¬7ç« çš„å†…å®¹ã€‚ä¸»è¦æ˜¯é€šè¿‡Dioè¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚å¤§å®¶å¯ä»¥çœ‹ä¸‹ç¬¬7ç« ç½‘ç»œè¯·æ±‚çš„å†…å®¹ã€‚ æˆ‘ä»¬ç½‘ç»œè¯·æ±‚ä¸»è¦éœ€è¦ä»¥ä¸‹å‡ ä¸ªAPIï¼š è¯·æ±‚çœä»½åˆ—è¡¨ï¼šhttp://guolin.tech/api/china è¯·æ±‚å¯¹åº”å¸‚åˆ—è¡¨ï¼šhttp://guolin.tech/api/china/provinceID è¯·æ±‚å¯¹åº”åŒºå¿åˆ—è¡¨ï¼šhttp://guolin.tech/api/china/provinceID/cityID ç”±äºæˆ‘ä»¬åœ¨ä¹‹å‰æ–‡ç« ä¸­ä½¿ç”¨çš„çœä½œä¸ºä¾‹å­ï¼Œè¿™å—æˆ‘ä»¬å°±ç”¨åŒºå¿ä½œä¸ºä¾‹å­ï¼š è½¬ä¸ºDartç±»é¦–å…ˆä½¿ç”¨ç½‘ç«™https://caijinglong.github.io/json2dart/æ¥è®²Jsonæ•°æ®è½¬ä¸ºDartå®ä½“ç±»ï¼š ç„¶ååœ¨é¡¹ç›®libç›®å½•æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚åä¸ºbeanã€‚è¿™ä¸ªæ–‡ä»¶å¤¹ä¸»è¦å­˜æ”¾å®ä½“ç±»çš„ä»£ç ã€‚ç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºä¸€ä¸ªdartæ–‡ä»¶ï¼Œå‘½åä¸ºCountiesã€‚ç„¶åæŠŠç”Ÿæˆçš„Dartä»£ç å¤åˆ¶ç²˜è´´è¿›å»ã€‚ä½†æ˜¯ä½ ä¼šå‘ç°å¤åˆ¶è¿›å»åä¼šæŠ¥é”™ï¼Œè¿™ä¸ªä¸ç”¨æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¤„ç†é”™è¯¯ã€‚ ç”Ÿæˆ.g.dartæ–‡ä»¶æ¥ä¸‹æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•çš„pubspec.yamlæ–‡ä»¶çš„dependenciesé¡¹ä¸‹é¢æ·»åŠ ä¾èµ–json_annotationã€dev_dependenciesé¡¹ä¸‹é¢æ·»åŠ build_runnerå’Œjson_serializableã€‚ æ¥ç€æ‰“å¼€ç»ˆç«¯ï¼Œå®šä½åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œè¾“å…¥flutter packages pub run build_runner buildï¼Œè¿è¡Œå³å¯ã€‚è¿è¡Œå®Œæ¯•ä½ å°±ä¼šå‘ç°ä½ é¡¹ç›®çš„å­˜å®ä½“ç±»çš„lib/beanç›®å½•å¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸ºCounties.g.dartã€‚åŒæ—¶ä½ Counties.darté‡Œé¢çš„é”™è¯¯ä¹Ÿæ²¡æœ‰äº†ã€‚ ç½‘ç»œè¯·æ±‚æœ€åä½ å°±å¯ä»¥é€šè¿‡Dioæ¥è¿›è¡Œç½‘ç»œè¯·æ±‚äº†ã€‚ 1Dio().get(http://guolin.tech/api/china/$_provinceID/$_cityID); é‚£ä¹ˆåˆ°è¿™æœ‰çš„åŒå­¦å¯èƒ½å°±ä¼šé—®äº†ï¼Œä½ ç½‘å€é‡Œé¢æœ‰provinceIDå’ŒcityIDï¼Œé‚£è¿™ä¸¤ä¸ªæ€ä¹ˆè·å–ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—ç”¨ä¸Šå¸¦å€¼è·¯ç”±è·³è½¬äº†ã€‚ æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯è¿™æ ·çš„ä¸€ä¸ªé€»è¾‘:å…ˆé€‰æ‹©çœä»½ã€å†é€‰æ‹©åŸå¸‚ã€æœ€åé€‰æ‹©åŒºå’Œå¿ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªCountyPageWidgetè‚¯å®šæ˜¯ç”±CityPageWidgetè°ƒç”¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨CityPageWidgetçš„ListViewé‡Œé¢å°†Texté€šè¿‡GestureDetectoråŒ…èµ·æ¥ï¼Œç„¶åå°†GestureDetectorçš„onTapæ–¹æ³•è®¾ç½®ä¸ºè·³è½¬åˆ°CountyPageWidgetã€‚CityPageWidgetçš„ListViewä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819ListView.builder( itemCount: _cityList.cities.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$&#123;_cityList.cities[index].name&#125;"), ), onTap: () &#123; Navigator.push(context, MaterialPageRoute(builder: (context) &#123; return CountiesPageWidget( provinceID: _provinceID, //ç”±CityWidgetçš„ä¸Šä¸€çº§ProvinceWidgetä¼ è¿‡æ¥ï¼Œ cityID: _cityList.cities[index].id, // ç”±ç½‘ç»œè¯·æ±‚å›æ¥çš„æ•°æ®ä¼ å…¥ ); &#125;)); &#125;, ); &#125;,); è¿™æ ·CountyPageWidgetæ‰€éœ€çš„provinceIDå’ŒcityIDéƒ½æ˜¯ç”±CityPageWidgetä¼ å…¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¯¹ä»–ä¼ å…¥çš„å€¼è¿›è¡Œå¤„ç†å‘¢ï¼Œæ€ä¹ˆæŠŠå®ƒæ·»åŠ åˆ°ç½‘å€é‡Œå»ï¼Ÿæ¥ä¸‹æ¥å¤§å®¶çœ‹ä»£ç å°±è¡Œäº†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041class CountyPageWidget extends StatefulWidget &#123; //åœ¨Widgetä¸­å®šä¹‰ä¸¤ä¸ªï¼Œæ–¹ä¾¿ç”±å…¶ä»–Widgetä¼ å…¥ final int provinceID; final int cityID; // è®¾ç½®æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸¤ä¸ªå˜é‡ CountyPageWidget(&#123;Key key, this.provinceID, this.cityID&#125;) : super(key: key); @override CountyPageWidgetState createState() =&gt; CountyPageWidgetState();&#125;class CountyPageWidgetState extends State&lt;CountyPageWidget&gt; &#123; // åœ¨Stateä¸­å®šä¹‰ä¸¤ä¸ªå˜é‡ int _provinceID; int _cityID; List&lt;County&gt; _county; @override void initState() &#123; // åœ¨æ­¤å°†Widgetä¸­çš„ä¸¤ä¸ªå˜é‡èµ‹å€¼ç»™Stateä¸­çš„å˜é‡ _provinceID = widget.provinceID; _cityID = widget.cityID; super.initState(); &#125; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: new AppBar( title: Text( "åŒºå¿", style: TextStyle(fontSize: 25.0), ), ), body: FutureBuilder( // UIå¼‚æ­¥æ›´æ–°ç»„ä»¶ // è¿™å—å°±å¯ä»¥è°ƒç”¨äº† future: Dio().get("http://guolin.tech/api/china/$_provinceID/$_cityID"), builder: (BuildContext context, AsyncSnapshot snapshot) &#123; ...çœç•¥åé¢æ‰€æœ‰ä»£ç &#125; 3. UIå¼‚æ­¥æ›´æ–°ä¸å¼‚æ­¥æ›´æ–°ç›¸å…³çš„çŸ¥è¯†å¤§å®¶ä¹Ÿå¯ä»¥çœ‹æˆ‘ä»¬ä¹‹å‰çš„ç¬¬7ç« åšå®¢ï¼Œè¿™å—åªè®²åº”ç”¨ã€‚ çœå°†Scaffoldçš„bodyå‚æ•°è®¾ç½®ä¸ºFutureBuilderï¼Œå¹¶åœ¨FutureBuilderé‡Œé¢è°ƒç”¨ListView: 12345678910111213141516171819202122232425262728293031323334FutureBuilder( future: Dio().get("http://guolin.tech/api/china"), builder: (BuildContext context, AsyncSnapshot snapshot) &#123; if (snapshot.connectionState == ConnectionState.done) &#123; Response response = snapshot.data; //å‘ç”Ÿé”™è¯¯ if (snapshot.hasError) &#123; return Text(snapshot.error.toString()); &#125; provinceList = getProvinceList(response.data); //è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView return ListView.builder( itemCount: provinceList.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$&#123;provinceList[index].name&#125;"), ), onTap: () &#123; Navigator.push(context, MaterialPageRoute(builder: (context) &#123; return CityPageWidget( provinceID: provinceList[index].id, ); &#125;)); &#125;, ); &#125;, ); &#125; // è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading return CircularProgressIndicator(); &#125;,) å¸‚ä¸çœåŒç†: 1234567891011121314151617181920212223242526272829303132333435FutureBuilder( future: Dio().get("http://guolin.tech/api/china/$_provinceID"), builder: (BuildContext context, AsyncSnapshot snapshot) &#123; if (snapshot.connectionState == ConnectionState.done) &#123; Response response = snapshot.data; //å‘ç”Ÿé”™è¯¯ if (snapshot.hasError) &#123; return Text(snapshot.error.toString()); &#125; _cityList = getCityList(response.data); //è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView return ListView.builder( itemCount: _cityList.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$&#123;_cityList[index].name&#125;"), ), onTap: () &#123; Navigator.push(context, MaterialPageRoute(builder: (context) &#123; return CountiesPageWidget( provinceID: _provinceID, cityID: _cityList[index].id, ); &#125;)); &#125;, ); &#125;, ); &#125; // è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading return CircularProgressIndicator(); &#125;,) åŒºå¿ä¸çœåŒç†: 1234567891011121314151617181920212223242526272829303132333435FutureBuilder( future: Dio().get("http://guolin.tech/api/china/$_provinceID/$_cityID"), builder: (BuildContext context, AsyncSnapshot snapshot) &#123; if (snapshot.connectionState == ConnectionState.done) &#123; Response response = snapshot.data; //å‘ç”Ÿé”™è¯¯ if (snapshot.hasError) &#123; return Text(snapshot.error.toString()); &#125; _county = getCountyList(response.data); //è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView return ListView.builder( itemCount: _county.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$&#123;_county[index].name&#125;"), ), onTap: () &#123; _saveCityID(_county[index].weatherId); Navigator.push(context, MaterialPageRoute(builder: (context) &#123; return MainPage( cityID: _county[index].weatherId, ); &#125;)); &#125;, ); &#125;, ); &#125; // è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading return CircularProgressIndicator(); &#125;,)]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(7)â€”â€”Httpç½‘ç»œè¯·æ±‚ã€Jsonè½¬Dartå®ä½“ç±»åŠå¼‚æ­¥æ›´æ–°UI]]></title>
    <url>%2Fposts%2F163d319c.html</url>
    <content type="text"><![CDATA[ç›¸å…³Demoæºç å¯è§Github a1203991686/CoolWeather_Flutter Flutter Http ç½‘ç»œè¯·æ±‚Flutterç½‘ç»œè¯·æ±‚å¯åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼Œä¸€ç§ä¸ºDart:IOåº“ä¸­ä¸ºæˆ‘ä»¬æä¾›çš„HttpClientï¼Œå¦ä¸€ç§ä¸ºDartç¬¬ä¸‰æ–¹åº“Dioã€‚ HttpClientHttpClientæ˜¯Dart:IOåº“è‡ªå¸¦çš„ä¸€ä¸ªç±»ï¼Œé€šè¿‡ä»–æ¥å®ç°ç½‘ç»œè¯·æ±‚æœ€åº•å±‚ã€ä¹Ÿå¯ä»¥å®Œå®Œå…¨å…¨çš„è‡ªå®šä¹‰è®¾ç½®ï¼Œä½†æ˜¯ç›¸å¯¹äºå…¶ä»–äººå°è£…å¥½çš„ç¬¬ä¸‰æ–¹åº“æ¥è¯´æ˜¾å¾—å¤æ‚ã€‚ å¼•å…¥å¯¼å…¥Dart:IOåº“ï¼š 1import 'dart:io'; åˆ›å»ºä¸€ä¸ªHttpClient:1HttpClient httpClient = new HttpClient(); åˆ›å»ºä¸€ä¸ªUriå¦‚æœä½ æ˜¯Httpè¯·æ±‚ï¼š 1234567var uri = new Uri.http( host, queryParameters: &#123; "xx":"xx", "yy":"dd" &#125;); å¦‚æœä½ æ˜¯Httpsè¯·æ±‚ï¼š 1234567var uri = new Uri.https( host, queryParameters: &#123; "xx":"xx", "yy":"dd" &#125;); æ ¹æ®uriè·å–è¿”å›æ•°æ®12HttpClientRequest request = await httpClient.getUrl(uri);HttpClientResponse response = await request.close(); è¯»å–å†…å®¹è¿›è¡Œè¿™ä¸€æ­¥å¾—å¯¼å…¥dart:convertåº“ï¼š 1234567import 'dart:convert';... //çœç•¥ä¸­é—´ä»£ç  String responseBody = await response.transform(Utf8Decoder()).join();print(respinseBody) æœ€åå…³é—­Client1httpClient.close(); DioDioæ˜¯Dartç¤¾åŒºä¸Šåˆ«äººä¸Šä¼ çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä»–å°è£…äº†HttpClientï¼Œç›¸è¾ƒæ¥è¯´æ›´ä¸ºç®€å•ã€æ–¹ä¾¿ã€‚ å¼•å…¥åœ¨é¡¹ç›®çš„pubspec.yamlæ–‡ä»¶çš„dependenciesä¸­å¯¼å…¥Dioï¼š 123dependencies: dio: // å¦‚æœå†’å·åé¢ä¸å¸¦å…·ä½“ç‰ˆæœ¬ä¿¡æ¯åˆ™è¡¨ç¤ºè‡ªåŠ¨ä¸‹è½½æœ€æ–°ç‰ˆ æ¥ç€åœ¨éœ€è¦ä½¿ç”¨çš„ä»£ç æ–‡ä»¶é‡Œé¢ï¼Œimportå¯¼å…¥ä»–ï¼š 1import 'package:dio/dio.dart'; æ¥ç€æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Dioäº†ã€‚ ç¤ºä¾‹é¦–å…ˆå¾—åˆ›å»ºä¸€ä¸ªDioå¯¹è±¡ã€‚ 1Dio dio = Dio(); å‘èµ·GETè¯·æ±‚ï¼š 123Response response;response=await dio.get(uri)print(response.data.toString()); å‘èµ·POSTè¯·æ±‚ï¼š 1response=await dio.post(uri); Jsonè½¬Dartæ‰‹åŠ¨ç”ŸæˆDartå®ä½“ç±»é¦–å…ˆå¾—å¤§å®¶å®‰åˆ©ä¸€ä¸ªç½‘ç«™ï¼Œå› ä¸ºDartå®ä½“ç±»æ¯”Javaå®ä½“ç±»å¤šäº†å‡ ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç›¸å¯¹æ¥è¯´éº»çƒ¦ï¼Œé€šè¿‡è¿™ä¸ªç½‘ç«™å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆjsonæ•°æ®å¯¹åº”çš„å®ä½“ç±»:https://caijinglong.github.io/json2dart/ æ¯”æ–¹è¯´æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªé“¾æ¥(http://guolin.tech/api/china)ï¼Œå¹¶è®©ä»–è‡ªåŠ¨è½¬dartï¼š æ¥ä¸‹æ¥åªéœ€è¦åˆ›å»ºdartæ–‡ä»¶ï¼Œç„¶åå†æŠŠä»£ç å¤åˆ¶è¿›å»å°±è¡Œäº†ã€‚ ä¸å‡ºæ„å¤–ï¼Œä»£ç è‚¯å®šä¼šæŠ¥é”™ã€‚ æŠ¥é”™ä¿¡æ¯ä¸º: 12345error: Target of URI hasn't been generated: 'province.g.dart'. (uri_has_not_been_generated at [cool_weather] lib/bean/province.dart:3)error: The method '_$ProvinceFromJson' isn't defined for the class 'Province'. (undefined_method at [cool_weather] lib/bean/province.dart:31)error: The method '_$ProvinceToJson' isn't defined for the class 'Province'. (undefined_method at [cool_weather] lib/bean/province.dart:33) è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é¡¹ç›®ä¸‹è¿˜æ²¡æœ‰province.g.dartè¿™ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ ¹æ®dartå®ä½“ç±»è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆç”Ÿæˆä»–å‘¢ï¼Ÿ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨pubspec.yamlæ–‡ä»¶ä¸­å¯¼å…¥ä¸‰ä¸ªä¾èµ–åŒ…ï¼šæˆ‘ä»¬é‡ç‚¹åªéœ€è¦ç®¡ä¸‰ä¸ªå†™ç€éœ€è¦å¯¼å…¥çš„ã€‚è¾“å…¥ä¹‹åç‚¹å‡»pubspec.yamlæ–‡ä»¶å³ä¸Šè§’çš„packages getï¼Œå°±ä¼šè‡ªåŠ¨ä¸‹è½½åŒ…äº†ã€‚ ç„¶ååœ¨ç»ˆç«¯ä¸­ï¼Œè½¬åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¾“å…¥ 1flutter packages pub run build_runner build æ¥ç€ä½ å°±ä¼šæƒŠå–œçš„å‘ç°ï¼Œåœ¨ä½ çš„dartå®ä½“ç±»ä¸‹é¢å¤šäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ä½ æ‰€ç¼ºå¤±çš„~.g.dartæ–‡ä»¶ï¼Œå¹¶ä¸”å®ä½“ç±»ä¸­é‚£äº›æŠ¥é”™ä¹Ÿéƒ½æ²¡äº†ã€‚ å°†è¯·æ±‚å›æ¥çš„Responseè½¬ä¸ºDartå®ä½“ç±»æ¥ç€HttpClientè¿”å›æ¥çš„responseBodyæˆ–è€…Dioè¿”å›çš„response 12List&lt;Province&gt; provinceList;provinceList = ProvinceList.getProvinceList(jsonResponse); provinceListå°±æ˜¯è¿”å›æ¥çš„æ•°æ®è½¬æˆçš„å®ä½“ç±»çš„å¯¹è±¡äº†ã€‚ å¼‚æ­¥æ›´æ–°UIåœ¨æ­¤å¤„ä»‹ç»ä¸¤ç§æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯æˆ‘è‡ªå·±æƒ³å‡ºæ¥çš„æ²™é›•æ–¹æ³•ï¼Œç¬¬äºŒç§æ˜¯é€šè¿‡Flutteræä¾›çš„ä¸“é—¨ç”¨äºå¼‚æ­¥æ›´æ–°UIçš„ç»„ä»¶FutureBuilderã€‚ æ²™é›•æ–¹æ³•åœ¨æ­¤è¯´ä¸€ä¸‹æˆ‘è¿™ä¸ªæ–¹æ³•çš„æƒ³æ³•ã€‚ å¤§å®¶å¯ä»¥å›é¡¾ä¸‹æˆ‘ä¹‹å‰è®²Widgetçš„æ—¶å€™è¯´è¿‡ï¼ŒWidgetæœ‰ä¸€ä¸ªæ–¹æ³•initStateå¯ä»¥ç”¨æ¥åŠ è½½UIï¼Œä»¥åŠä¸€ä¸ªsetStateæ–¹æ³•å¯ç”¨æ¥æé†’Flutteré‡æ–°åŠ è½½UIã€‚ è¯´åˆ°è¿™å¾ˆå¤šåŒå­¦ä¸€å®šæƒ³åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·å–åˆ°æ•°æ®ä¹‹åé€šè¿‡setStateæ–¹æ³•æ¥æ›´æ–°UIã€‚ è·å–åˆ°æ•°æ®è¿™ä¸ªä¸åŒå¤šè¯´ï¼Œä¸Šé¢è®²çš„å…¨éƒ½æ˜¯è·å–æ•°æ®ã€‚ è®¾ç½®ä¸€ä¸ªç©ºçš„å®ä½“ç±»æ­¤å¤„æˆ‘è¿˜æ˜¯æ‹¿ä¸Šé¢çš„Province.dartæ¥åšä¾‹å­ã€‚æˆ‘ä»¬æ­£å¸¸æƒ…å†µä¸‹è·å–åˆ°çš„æ•°æ®è½¬æˆçš„å®ä½“ç±»çš„å¯¹è±¡æ˜¯List&lt;Province&gt; provinceListã€‚æ‰€ä»¥æˆ‘ä»¬æ­¤å¤„å…ˆè®¾ç½®ä¸€ä¸ªç©ºçš„å¯¹è±¡:List&lt;Province&gt; _provinceListã€‚ æ¥ç€åœ¨initStateé‡Œé¢è°ƒç”¨ç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ï¼š 12345@overridevoid initState() &#123; getProvince(); super.initState();&#125; ç„¶ååœ¨getProvinceæ–¹æ³•é‡Œé¢è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®provinceListä¼ ç»™_provinceListï¼š 1234567void getProvince() async &#123; var response = await Dio().get("http://guolin.tech/api/china"); provinceList = ProvinceList.getProvinceList(response); setState(() &#123; _provinces = provinceList; &#125;);&#125; è¿™æ ·å°±å¯ä»¥å½“è·å–åˆ°æ•°æ®çš„æ—¶å€™å°±é€šçŸ¥Flutteræ›´æ–°çŠ¶æ€äº†ã€‚è¿™ä¸ªæ—¶å€™æœ‰çš„åŒå­¦å¯èƒ½ä¼šé—®æˆ‘ï¼Œä½ è¿™ä¸ªä¹Ÿåªæ˜¯è·å–åˆ°æ•°æ®çš„æ—¶å€™æ‰æ›´æ–°å•Šï¼Œé‚£å½“è¿˜æ²¡è·å–åˆ°æ•°æ®çš„æ—¶å€™å‘¢ï¼Ÿ è¿™å—å°±ä½“ç°åˆ°äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®¾ç½®ä¸€ä¸ª_provincesäº†ã€‚ æˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨buildæ–¹æ³•è®¾ç½®ä¸‹ï¼Œåˆ¤æ–­ä¸‹_provincesä¸ºä¸ä¸ºç©º:å¦‚æœä¸ºç©ºï¼Œå°±è¯æ˜æ²¡æ•°æ®ï¼Œå°±åŠ è½½å…¶å®ƒé¡µé¢ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå°±è¯æ˜æœ‰æ•°æ®äº†ï¼Œé‚£å°±åŠ è½½æ•°æ®ã€‚ 12345body: _provinces == null ? new Text("æ­£åœ¨è¯·æ±‚") : new ListView.builder( ... //çœå»ä»£ç ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯å°†_provincesçš„æ•°æ®åŠ è½½ListViewé‡Œé¢ï¼Œä¸€ä¸ªListViewçš„åŸºæœ¬æ„é€ æ–¹æ³• ) FutureBuilderå›å½’æ­£é¢˜ï¼Œæˆ‘ä¸Šé¢é‚£ä¸ªæ–¹æ³•çœŸçš„æ˜¯æœ‰å¤Ÿæ²™é›•çš„ã€‚ é‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåæ­£è¨€é¡ºçš„Flutteräº²ç”Ÿå„¿å­FutureBuilderã€‚ é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹å®šä¹‰ï¼š 12345FutureBuilder(&#123; this.future, this.initialData, @required this.builder,&#125;) futureï¼šå¼‚æ­¥ä»»åŠ¡ï¼› initialDataï¼šåˆå§‹åŒ–æ•°æ®ï¼› builderï¼šbuilderæ–¹æ³•ã€‚ ç¤ºä¾‹1234567891011121314151617181920212223242526272829303132333435body: FutureBuilder( future: Dio().get("http://guolin.tech/api/china"), builder: (BuildContext context, AsyncSnapshot snapshot) &#123; if (snapshot.connectionState == ConnectionState.done) &#123; Response response = snapshot.data; print(response.toString()); //å‘ç”Ÿé”™è¯¯ if (snapshot.hasError) &#123; return Text(snapshot.error.toString()); &#125; provinceList = ProvinceList.fromJson(response.data); //è¯·æ±‚æˆåŠŸï¼Œé€šè¿‡é¡¹ç›®ä¿¡æ¯æ„å»ºç”¨äºæ˜¾ç¤ºé¡¹ç›®åç§°çš„ListView return ListView.builder( itemCount: provinceList.provinces.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$&#123;provinceList.provinces[index].name&#125;"), ), onTap: () &#123; Navigator.push(context, MaterialPageRoute(builder: (context) &#123; return CityPageWidget( cityID: provinceList.provinces[index].id); &#125;)); &#125;, ); &#125;, ); &#125; // è¯·æ±‚æœªå®Œæˆæ—¶å¼¹å‡ºloading return CircularProgressIndicator(); &#125;,)]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(6)â€”â€”å¤©æ°”é¢„æŠ¥ç¬¬ä¸€æ­¥-ç•Œé¢]]></title>
    <url>%2Fposts%2F15395a84.html</url>
    <content type="text"><![CDATA[ç»è¿‡å‰é¢çš„å¯¹äºFlutterçš„ä»‹ç»ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å¯ä»¥å¼€å§‹å†™æˆ‘ä»¬çš„å¤©æ°”é¢„æŠ¥APPçš„ç•Œé¢äº†ã€‚ é¡¹ç›®Githubåœ°å€ï¼ša1203991686/CoolWeather_Flutter 1. å¤§è‡´ç•Œé¢æœ€ç»ˆå†™æˆçš„å¤§è‡´ç•Œé¢å¦‚å›¾ï¼š æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç•Œé¢æ‹†åˆ†æˆå¦‚ä¸‹éƒ¨åˆ†ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬APPä¸»è¦æœ‰æœ€ä¸Šé¢ç”¨æ¥æ˜¾ç¤ºåœ°ç‚¹å’Œåˆ·æ–°æ—¶é—´çš„Titleã€æ˜¾ç¤ºæ¸©åº¦å’Œå¤©æ°”çš„ä¸¤ä¸ªTextã€æ˜¾ç¤º3å¤©é¢„æŠ¥çš„ListViewã€æ˜¾ç¤ºç©ºæ°”è´¨é‡çš„GridViewã€ä»¥åŠæœ€åæ˜¾ç¤ºç”Ÿæ´»å»ºè®®çš„ListViewã€‚ æ­¤å¤„ä¼šç”¨åˆ°æˆ‘ä»¬å‰é¢å­¦è¿‡çš„æ‰€æœ‰çŸ¥è¯†ï¼Œå¦‚æœæœ‰åŒå­¦æ²¡æœ‰çœ‹è¿‡å‰é¢å†…å®¹çš„ï¼Œå¯ä»¥çœ‹ä¸‹æœ¬ç³»åˆ—å‰é¢çš„æ–‡ç« ã€‚ 2. åˆ›å»ºé¡¹ç›®é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Flutteré¡¹ç›®ï¼š åœ¨AndroidStudioç‚¹å‡»File-&gt;New Flutter Projectï¼› æ¥ç€é€‰æ‹©Flutter Application-&gt;NEXTã€‚æ¥ç€å¡«å†™ä½ çš„é¡¹ç›®åç§°ç­‰ä¸€ç³»åˆ—ä¿¡æ¯åç‚¹å‡»nextï¼› æ¥ç€è¾“å…¥ä½ çš„ç»„ç»‡/å…¬å¸åç§°ä½œä¸ºåŒ…åï¼Œæœ€åç‚¹å‡»Finishå³å¯ï¼Œè¿™æ ·å°±æ–°å»ºäº†ä¸€ä¸ªFlutteré¡¹ç›®ï¼Œå¹¶ä¸”Flutterä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆä¸€ä¸ªè®¡æ•°å™¨Demoï¼› è®©æˆ‘ä»¬æŠŠmian.darté‡Œé¢çš„æ‰€æœ‰æ³¨é‡Šä»¥åŠ_MyHomePageStateé‡Œé¢çš„buildæ–¹æ³•é‡Œé¢çš„ä»£ç éƒ½åˆ æ‰ï¼› æ¥ç€åœ¨libæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåå«viewï¼Œåˆ°æ—¶å€™æˆ‘ä»¬æŠŠæ‰€æœ‰ä¸ç•Œé¢æœ‰å…³çš„ä»£ç æ–‡ä»¶éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼› ç„¶åæˆ‘ä»¬åœ¨viewæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºä¸€ä¸ªdartæ–‡ä»¶ï¼Œå‘½åä¸ºmain_pageã€‚è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„å¤©æ°”è¯¦æƒ…é¡µã€‚ 3. è®¾è®¡å¥½å¤©æ°”è¯¦æƒ…é¡µæ¡†æ¶é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¼å…¥materialåŒ…ï¼Œæˆ‘ä»¬é¡¹ç›®ä¸»è¦ç”¨materialé£æ ¼UIæ¥å†™ã€‚ åœ¨å¼€å¤´è¾“å…¥import &#39;package:flutter/material.dart&#39;;ï¼Œè¿™æ ·å°±å¯¼å…¥äº†materialåŒ…ã€‚æ¥ç€åˆ›å»ºæˆ‘ä»¬çš„ç•Œé¢ç±»MainPageã€‚ ç”±äºæˆ‘ä»¬åœ¨åˆ°æ—¶å€™å†™å¥½ç½‘ç»œè¯·æ±‚åï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å¾—ä»ç½‘ç»œè·å–ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å¼‚æ­¥çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å…ˆæŠŠé¡µé¢åŠ è½½äº†ç„¶åç­‰è·å–çš„æ•°æ®å›æ¥äº†åœ¨é€šçŸ¥Flutteræ›´æ–°çŠ¶æ€ï¼Œæ‰€ä»¥è¿™å—æˆ‘ä»¬å¾—ä½¿ç”¨StatefulWidgetã€‚ 12345678910111213class MainPage extends StatefulWidget &#123; MainPage(&#123;Key key&#125;) : super(key: key); @override MainPageState createState() =&gt; new MainPageState();&#125;class MainPageState extends State&lt;MainPage&gt; &#123; @override Widget build(BuildContext context) &#123; &#125;&#125; æ¥ç€æˆ‘ä»¬å°±å¾—å¼€å§‹å†™build()é‡Œé¢çš„å†…å®¹äº†ã€‚ç”±äºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨å±çš„èƒŒæ™¯å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä½¿ç”¨Containerä½œä¸ºæˆ‘ä»¬æœ€å¤–å±‚çš„Widgetï¼Œå¹¶ä½¿ç”¨BoxDecorationè£…é¥°å®¹å™¨é…åˆDecorationImageæ¥æ”¾ç½®å›¾ç‰‡ï¼š 123456789101112@overrideWidget build(BuildContext context) &#123; return Container( decoration: BoxDecoration( image: DecorationImage( image: NetworkImage("http://blog.mrabit.com/bing/today"), //å¿…åº”æ¯æ—¥ä¸€å›¾èƒŒæ™¯ fit: BoxFit.cover, // è®¾ç½®ä¸ºå…¨å± ), ), child: _weatherBody(), );&#125; è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„è¿è¡Œç»“æœå¦‚å›¾(â‘ ä½ èƒŒæ™¯å›¾ç‰‡å¤šåŠå’Œæˆ‘ä¸ä¸€æ ·ï¼Œå› ä¸ºä¸Šé¢é‚£ä¸ªUriè·å–çš„æ˜¯å¿…åº”çš„æ¯æ—¥ä¸€å›¾ï¼Œæ¯å¤©å›¾ç‰‡éƒ½ä¸ä¸€æ ·ï¼›â‘¡è¿è¡Œçš„æ—¶å€™è®°å¾—æŠŠchild: _weatherBody(),ç»™æ³¨é‡Šæ‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰_weatherBody()è¿™ä¸ªæ–¹æ³•): 4. è®¾è®¡titleä¸ºäº†æ–¹ä¾¿æˆ‘å°±ç›´æ¥æŠŠå‰©ä¸‹çš„å¸ƒå±€å•é¢†å‡ºæ¥æ”¾åˆ°_weatherBody()è¿™ä¸ªæ–¹æ³•: 123Widget _weatherBody() &#123; return&#125; ç”±äºæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæœ‰Titleçš„é¡µé¢ï¼Œæ‰€ä»¥æœ€å¤–å±‚æˆ‘é€‰ç”¨äº†Scaffoldï¼š 12345678910111213141516171819202122232425Widget _weatherBody() &#123; return Scaffold( backgroundColor: Colors.transparent, //èƒŒæ™¯é€æ˜ appBar: AppBar( centerTitle: true, title: Text( "åŒ—äº¬", style: TextStyle(fontSize: 25.0), ), backgroundColor: Colors.transparent, //èƒŒæ™¯é€æ˜ actions: &lt;Widget&gt;[ //å³ä¾§Widgetï¼Œç›¸å½“äºAndroid Toolbarä¸­çš„menu Container( alignment: Alignment.center, //å‘ä¸­é—´å¯¹é½ child: Text( "12:10", textAlign: TextAlign.center, //æ–‡å­—å‘ä¸­é—´å¯¹é½ ), ) ], ), body: SingleChildScrollView( // ç”±äºåˆ°æ—¶å€™æ•´ä¸ªé¡µé¢ä¸€ä¸ªå±å¹•å¯èƒ½æ”¾ä¸ä¸‹ï¼Œå°±æ”¾ç½®äº†ä¸€ä¸ªæ»šåŠ¨å¸ƒå±€ ), );&#125; è¿™ä¸ªæ—¶å€™çš„è¿è¡Œç»“æœæ˜¯ï¼š 5. è®¾è®¡ä¸‹é¢å¤©æ°”é¢„æŠ¥é¡µé¢æ¥ä¸‹æ¥å¯ä»¥å¼€å§‹ä¸‹ä¸‹é¢çš„å¤©æ°”æ˜¾ç¤ºé¡µé¢äº†ã€‚ å½“å‰æ¸©åº¦å’Œå¤©æ°”æƒ…å†µé¦–å…ˆå†™ä¸€ä¸ªçºµå‘çº¿æ€§å¸ƒå±€Column: 1234567body: SingleChildScrollView( child: Column( children: &lt;Widget&gt;[ ] )), ç”±äºæˆ‘ä»¬è¦æ˜¾ç¤ºåœ¨å±å¹•æœ€å³è¾¹ï¼Œæ‰€ä»¥ä½¿ç”¨Align: 1234567891011121314151617181920212223242526body: SingleChildScrollView( child: Column( children: &lt;Widget&gt;[ Align( alignment: Alignment.centerRight, child:Text( "26Â°C", style: TextStyle( fontSize: 50.0, color: Colors.white, ), ), ), Align( alignment: Alignment.centerRight, child:Text( "é˜´", style: TextStyle( fontSize: 20.0, color: Colors.white, ), ), ), ] )), è¿è¡Œç»“æœæ˜¯ï¼š æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ˜¾ç¤º3å¤©å¤©æ°”é¢„æŠ¥ã€å¤©æ°”è´¨é‡ä»¥åŠç”Ÿæ´»å»ºè®®çš„ä¸‰ä¸ªå­æ§ä»¶ï¼ŒåŒæ ·ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä¹ŸæŠŠä»–ä»¬ç»™å•é¢†å‡ºæ¥ï¼Œäºæ˜¯ä¸Šé¢çš„Columnæ¥ä¸‹æ¥å¯ä»¥è¿™æ ·å†™ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940body: SingleChildScrollView( child: Column( children: &lt;Widget&gt;[ ... //ä¸Šé¢çš„ä¸¤ä¸ªText Padding( padding: EdgeInsets.only( left: 15.0, right: 15.0, bottom: 15.0, ), child: Container( color: Colors.black54, child: _weatherList(), //3å¤©å¤©æ°”é¢„æŠ¥ ), ), Padding( padding: EdgeInsets.only( left: 15.0, right: 15.0, ), child: Container( color: Colors.black54, child: _atmosphereList(), //ç©ºæ°”è´¨é‡ ), ), Padding( padding: EdgeInsets.only( top: 15.0, left: 15.0, right: 15.0, bottom: 15.0, ), child: Container( color: Colors.black54, child: _lifestyleList(), //ç”Ÿæ´»å»ºè®® ), ), ] )), 3å¤©å¤©æ°”é¢„æŠ¥å¯¹äº3å¤©å¤©æ°”é¢„æŠ¥æˆ‘ä»¬ä¸»è¦é€šè¿‡ListViewæ¥å®ç°ï¼Œç”±äºåˆ°æ—¶å€™æ•°æ®æ¯”è¾ƒçµæ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨ListView.Builderæ¥å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546List&lt;String&gt; dates = ["2019/10/01", "2019/10/02", "2019/10/03"];List&lt;String&gt; temperatures = ["29/14", "30/18", "29/18"];List&lt;String&gt; texts = ["é˜´", "æ™´", "é›¨"];Widget _weatherList() &#123; return Column( children: &lt;Widget&gt;[ Align( alignment: Alignment.centerLeft, child: Text( "é¢„æŠ¥", style: TextStyle( color: Colors.white, fontSize: 20.0, ), ), ), ListView.builder( shrinkWrap: true, //è¿™ä¸ªæ˜¯æŒ‡æ ¹æ®ListViewæ‰€æœ‰å­Widgetçš„é•¿åº¦æ¥è®¾å®šListViewçš„é•¿åº¦ physics: NeverScrollableScrollPhysics(), //ç¦æ­¢ListViewè‡ªå·±çš„æ»‘åŠ¨ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å¤–é¢ç”¨äº†ä¸ªSingleChildScrollViewï¼Œæˆ‘ä»¬é€šè¿‡ä»–çš„æ»‘åŠ¨å°±å¯ä»¥äº† itemCount: dates.length, //ListViewå­é¡¹ä¸ªæ•° itemBuilder: (BuildContext context, int index) &#123; return ListTile( title: Row( mainAxisAlignment: MainAxisAlignment.spaceBetween, //è¿™ä¸ªæ˜¯Rowçš„ä¸»è½´çš„å­é¡¹çš„åˆ†å¸ƒæ ¼å¼ï¼ŒspaceBetweenæ˜¯æŒ‡å¹³å‡åˆ†å¸ƒ mainAxisSize: MainAxisSize.max, children: &lt;Widget&gt;[ Text( "$&#123;dates[index]&#125;", style: TextStyle(color: Colors.white), ), Text( "$&#123;temperatures[index]&#125;", style: TextStyle(color: Colors.white), ), Text( "$&#123;texts[index]&#125;", style: TextStyle(color: Colors.white), ), ], ), ); &#125;), ], );&#125; è¿™ä¸ªæ—¶å€™è¿è¡Œç»“æœæ˜¯ï¼š ç©ºæ°”è´¨é‡è¿™å—æˆ‘ä»¬éœ€è¦ç”¨åˆ°GridViewï¼Œç”±äºåªæœ‰ä¸¤ä¸ªæ˜¾ç¤ºå†…å®¹ï¼Œè€Œä¸”æˆ‘ä»¬åæœŸä¹Ÿæ²¡æœ‰éœ€è¦åŠ¨æ€æ·»åŠ çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨GridViewæ„é€ æ–¹æ³•ï¼Œè€Œä¸å»ä½¿ç”¨GridViewçš„builderæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364List&lt;String&gt; atmospheres = ["16", "56"];Widget _atmosphereList() &#123; return Column( children: &lt;Widget&gt;[ Align( alignment: Alignment.centerLeft, child: Text( "ç©ºæ°”è´¨é‡", style: TextStyle( color: Colors.white, fontSize: 20.0, ), ), ), GridView( shrinkWrap: true, //è§ä¸Šé¢3å¤©å¤©æ°”é¢„æŠ¥çš„ListViewå¤„ physics: NeverScrollableScrollPhysics(), //è§ä¸Šé¢3å¤©å¤©æ°”é¢„æŠ¥çš„ListViewå¤„ gridDelegate: SliverGridDelegateWithFixedCrossAxisCount( crossAxisCount: 2, //æ¨ªè½´ä¸‰ä¸ªå­widget childAspectRatio: 2 //æ˜¾ç¤ºåŒºåŸŸå®½é«˜ç›¸ç­‰ ), children: &lt;Widget&gt;[ Column( children: &lt;Widget&gt;[ Text( "$&#123;atmospheres[0]&#125;", style: TextStyle( color: Colors.white, fontSize: 40.0, ), ), Text( "èƒ½è§åº¦", style: TextStyle( color: Colors.white, fontSize: 20.0, ), ), ], ), Column( children: &lt;Widget&gt;[ Text( "$&#123;atmospheres[1]&#125;", style: TextStyle( color: Colors.white, fontSize: 40.0, ), ), Text( "æ¹¿åº¦", style: TextStyle( color: Colors.white, fontSize: 20.0, ), ), ], ), ], ), ], );&#125; è¿è¡Œåçš„æ•ˆæœæ˜¯ï¼š ç”Ÿæ´»å»ºè®®è¿™å—å’Œ3å¤©å¤©æ°”é¢„æŠ¥ä¸€æ ·ï¼Œè€Œä¸”æ•°æ®æ¯”3å¤©å¤©æ°”é¢„æŠ¥æ›´å¤šï¼Œæ‰€ä»¥ä»–æ›´é€‚åˆç”¨ListView.builderï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263List&lt;String&gt; _lifestyleWeatherBrf = [ "è¾ƒèˆ’é€‚", "è¾ƒèˆ’é€‚", "é€‚å®œ", "é€‚å®œ", "å¼±", "è¾ƒé€‚å®œ", "ä¸­"];List&lt;String&gt; _lifestyleWeatherTxt = [ "ç™½å¤©å¤©æ°”æ™´å¥½ï¼Œæ—©æ™šä¼šæ„Ÿè§‰åå‡‰ï¼Œåˆåèˆ’é€‚ã€å®œäººã€‚", "å»ºè®®ç€è–„å¤–å¥—ã€å¼€è¡«ç‰›ä»”è¡«è£¤ç­‰æœè£…ã€‚å¹´è€ä½“å¼±è€…åº”é€‚å½“æ·»åŠ è¡£ç‰©ï¼Œå®œç€å¤¹å…‹è¡«ã€è–„æ¯›è¡£ç­‰ã€‚", "å„é¡¹æ°”è±¡æ¡ä»¶é€‚å®œï¼Œæ— æ˜æ˜¾é™æ¸©è¿‡ç¨‹ï¼Œå‘ç”Ÿæ„Ÿå†’æœºç‡è¾ƒä½ã€‚", "å¤©æ°”è¾ƒå¥½ï¼Œèµ¶å¿«æŠ•èº«å¤§è‡ªç„¶å‚ä¸æˆ·å¤–è¿åŠ¨ï¼Œå°½æƒ…æ„Ÿå—è¿åŠ¨çš„å¿«ä¹å§ã€‚", "å¤©æ°”è¾ƒå¥½ï¼Œä½†ä¸æ¯«ä¸ä¼šå½±å“æ‚¨å‡ºè¡Œçš„å¿ƒæƒ…ã€‚æ¸©åº¦é€‚å®œåˆæœ‰å¾®é£ç›¸ä¼´ï¼Œé€‚å®œæ—…æ¸¸ã€‚", "ç´«å¤–çº¿å¼ºåº¦è¾ƒå¼±ï¼Œå»ºè®®å‡ºé—¨å‰æ¶‚æ“¦SPFåœ¨12-15ä¹‹é—´ã€PA+çš„é˜²æ™’æŠ¤è‚¤å“ã€‚", "è¾ƒé€‚å®œæ´—è½¦ï¼Œæœªæ¥ä¸€å¤©æ— é›¨ï¼Œé£åŠ›è¾ƒå°ï¼Œæ“¦æ´—ä¸€æ–°çš„æ±½è½¦è‡³å°‘èƒ½ä¿æŒä¸€å¤©ã€‚", ",æ°”è±¡æ¡ä»¶å¯¹ç©ºæ°”æ±¡æŸ“ç‰©ç¨€é‡Šã€æ‰©æ•£å’Œæ¸…é™¤æ— æ˜æ˜¾å½±å“ï¼Œæ˜“æ„Ÿäººç¾¤åº”é€‚å½“å‡å°‘å®¤å¤–æ´»åŠ¨æ—¶é—´ã€‚"];Widget _lifestyleList() &#123; return Column( children: &lt;Widget&gt;[ Align( alignment: Alignment.centerLeft, child: Text( "ç”Ÿæ´»å»ºè®®", style: TextStyle( color: Colors.white, fontSize: 20.0, ), ), ), ListView.builder( shrinkWrap: true, physics: NeverScrollableScrollPhysics(), itemCount: _lifestyleWeatherBrf.length, itemBuilder: (BuildContext context, int index) &#123; return ListTile( title: Column( mainAxisAlignment: MainAxisAlignment.start, crossAxisAlignment: CrossAxisAlignment.start, children: &lt;Widget&gt;[ Text( "$&#123;_lifestyleWeatherBrf[index]&#125;", style: TextStyle( color: Colors.white, ), ), Text( "$&#123;_lifestyleWeatherTxt[index]&#125;", style: TextStyle( color: Colors.white, ), ), ], ), ); &#125;, ), ], );&#125; è¿è¡Œç»“æœæ˜¯:]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(5)â€”â€”SingleChildScrollViewã€ListViewå’ŒGridView]]></title>
    <url>%2Fposts%2F30ff421d.html</url>
    <content type="text"><![CDATA[ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹Flutterä¸­çš„æ»‘åŠ¨æ§ä»¶SingleChildScrollViewã€åˆ—è¡¨ListViewå’Œè¡¨æ ¼GridViewã€‚ SingleChildScrollViewSingleChildScrollViewç±»ä¼¼äºAndroidä¸­çš„ScrollViewï¼Œæˆ‘ä½¿ç”¨çš„è¾ƒæµ…ï¼Œåœ¨æˆ‘ç›®å‰çœ‹æ¥ï¼Œä»–å’ŒScrollViewçš„å”¯ä¸€åŒºåˆ«å°±æ˜¯å®ƒè¿˜å¯ä»¥æ¨ªå‘æ»šåŠ¨ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä»–çš„å®šä¹‰ï¼š 123456789SingleChildScrollView(&#123; this.scrollDirection = Axis.vertical, //æ»šåŠ¨æ–¹å‘ï¼Œé»˜è®¤æ˜¯å‚ç›´æ–¹å‘ this.reverse = false, this.padding, bool primary, this.physics, this.controller, this.child,&#125;) scrollDirectionï¼šè®¾å®šæ»šåŠ¨çš„æ–¹å‘ï¼Œå¯ä»¥è®¾å®šAxis.verticalæˆ–è€…Axis.horizonï¼› reverseï¼šæ˜¯å¦æŒ‰ç…§é˜…è¯»æ–¹å‘çš„åæ–¹å‘æ»‘åŠ¨ï¼Œemmmè¿™ä¸ªå¯èƒ½æœ‰ç‚¹è§‰å¾—è«åå…¶å¦™ï¼Œä½†æ˜¯å¦‚é˜¿æ‹‰ä¼¯è¯­è¨€åœ°åŒºï¼Œä»–ä»¬é˜…è¯»å’Œæˆ‘å›½å¤æ—¶å€™ä¸€æ ·æ˜¯ä»å³å‘å·¦çš„ï¼Œæ‰€ä»¥å¦‚æœreverseä¸ºtrueï¼Œä¸”æ»šåŠ¨æ–¹å‘æ˜¯æ°´å¹³æ»šåŠ¨çš„è¯ï¼Œå¦‚æœç³»ç»Ÿæ—¶é˜¿æ‹‰ä¼¯è¯­ç­‰ä»å³å‘å·¦é˜…è¯»çš„è¯­è¨€æ—¶ï¼Œæ–¹å‘æ˜¯ä»å³å‘å·¦çš„ï¼› paddingï¼šç•™ç™½çš„å¤§å°ï¼Œå’ŒPaddingçš„ç”¨æ³•ä¸€æ ·ï¼Œé€šè¿‡EdgeInsetsæ¥è®¾å®šï¼Œå…·ä½“å¯ä»¥çœ‹å‰å‡ ç« å°†FlutteråŸºç¡€Widgetï¼› primaryï¼šæŒ‡æ˜¯å¦ä½¿ç”¨widgetæ ‘ä¸­é»˜è®¤çš„PrimaryScrollControllerï¼›å½“æ»‘åŠ¨æ–¹å‘ä¸ºå‚ç›´æ–¹å‘ï¼ˆscrollDirectionå€¼ä¸ºAxis.verticalï¼‰å¹¶ä¸”æ²¡æœ‰æŒ‡å®šcontrolleræ—¶ï¼Œprimaryé»˜è®¤ä¸ºtrueï¼› physicsï¼šç”¨äºæ§åˆ¶æ»šåŠ¨æ–¹å¼ï¼Œè¿™ä¸ªç­‰ä¼šé‡ç‚¹è®²è§£ï¼› controllerï¼šç”¨äºæ»šåŠ¨ç›‘å¬åŠæ§åˆ¶ï¼› childï¼šå­Widgetã€‚ physicsè¿™ä¸ªå‚æ•°æ˜¯ç”¨äºæ§åˆ¶æ»šåŠ¨æ–¹å¼ï¼Œæœ‰å‡ ç§å‚æ•°ï¼š NeverScrollablePhysicsï¼šå‘ˆç°ä¸å¯æ»šåŠ¨çŠ¶æ€ï¼› BouncingScrollPhysicsï¼šå½“åˆ—è¡¨æ»‘åŠ¨ç»“æŸæ—¶ï¼Œä¼šå›å¼¹åˆ—è¡¨ï¼Œç±»ä¼¼äºiOSçš„åˆ—è¡¨æ»‘åŠ¨æ•ˆæœï¼› ClampingScrollPhysicsï¼šæ»‘åŠ¨ç»“æŸæ—¶ä¼šæ˜¾ç¤ºæ°´æ³¢çº¹é˜´å½±ï¼Œç±»ä¼¼äºAndroidçš„åˆ—è¡¨æ»‘åŠ¨æ•ˆæœï¼› FixedExtentScrollPhysicsï¼šå¯ä»¥è‡ªå·±åˆ¶ä½œæ»‘åŠ¨æ•ˆæœï¼Œä½†æ˜¯æˆ‘ä¹Ÿä¸ä¼šï¼Œæ‰€ä»¥åœ¨æ­¤ä¸åšè§£é‡ŠğŸ˜ã€‚ ListViewListViewå¯ä»¥æ²¿ä¸€ä¸ªæ–¹å‘ä¸Šçº¿æ€§æ’å¸ƒæ‰€æœ‰å­ç»„ä»¶ï¼ˆä¸ä»…å±€é™äºç«–ç›´æ–¹å‘ï¼‰ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„å®šä¹‰ï¼š 1234567891011121314151617181920ListView(&#123; ... //å¯æ»šåŠ¨widgetå…¬å…±å‚æ•° Axis scrollDirection = Axis.vertical, bool reverse = false, ScrollController controller, bool primary, ScrollPhysics physics, EdgeInsetsGeometry padding, //ListViewå„ä¸ªæ„é€ å‡½æ•°çš„å…±åŒå‚æ•° double itemExtent, bool shrinkWrap = false, bool addAutomaticKeepAlives = true, bool addRepaintBoundaries = true, double cacheExtent, //å­widgetåˆ—è¡¨ List&lt;Widget&gt; children = const &lt;Widget&gt;[],&#125;) å…¬å…±å±æ€§æˆ‘ä»¬å°±ä¸è®²äº†ï¼Œä¸Šé¢SingleChildScrollViewå·²ç»è®²è¿‡äº†ï¼Œæˆ‘ä»¬ç°åœ¨åªè®²ä»–ç‰¹æœ‰çš„ï¼š itemExtentï¼šç”¨äºæ§åˆ¶ListViewçš„é•¿åº¦ï¼Œå¦‚æœä¸ä¸ºnullï¼Œåˆ™å¼ºåˆ¶æ‰€æœ‰å­Widgetåˆèµ·æ¥çš„é•¿åº¦å°äºè®¾å®šçš„å€¼ï¼šå¦‚æœListViewæ˜¯æ¨ªå‘çš„ï¼Œåˆ™æ‰€æœ‰å­Widgetæ¨ªå‘é•¿åº¦çš„å’Œå°äºå®ƒï¼›å¦‚æœListViewæ˜¯çºµå‘çš„ï¼Œåˆ™æ‰€æœ‰å­Widgetçºµå‘é•¿åº¦çš„å’Œå°äºå®ƒï¼› shrinkWrapï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦æ ¹æ®å­ç»„ä»¶çš„æ€»é•¿åº¦æ¥è®¾ç½®ListViewçš„é•¿åº¦ï¼Œé»˜è®¤å€¼ä¸ºfalse ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒListViewçš„ä¼šåœ¨æ»šåŠ¨æ–¹å‘å°½å¯èƒ½å¤šçš„å ç”¨ç©ºé—´ã€‚å½“ListViewåœ¨ä¸€ä¸ªæ— è¾¹ç•Œ(æ»šåŠ¨æ–¹å‘ä¸Š)çš„å®¹å™¨ä¸­æ—¶ï¼ŒshrinkWrapå¿…é¡»ä¸ºtrueï¼› addAutomaticKeepAlivesï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦å°†åˆ—è¡¨é¡¹ï¼ˆå­ç»„ä»¶ï¼‰åŒ…è£¹åœ¨AutomaticKeepAliveç»„ä»¶ä¸­ï¼›å…¸å‹åœ°ï¼Œåœ¨ä¸€ä¸ªæ‡’åŠ è½½åˆ—è¡¨ä¸­ï¼Œå¦‚æœå°†åˆ—è¡¨é¡¹åŒ…è£¹åœ¨AutomaticKeepAliveä¸­ï¼Œåœ¨è¯¥åˆ—è¡¨é¡¹æ»‘å‡ºè§†å£æ—¶å®ƒä¹Ÿä¸ä¼šè¢«GCï¼ˆåƒåœ¾å›æ”¶ï¼‰ï¼Œå®ƒä¼šä½¿ç”¨KeepAliveNotificationæ¥ä¿å­˜å…¶çŠ¶æ€ã€‚å¦‚æœåˆ—è¡¨é¡¹è‡ªå·±ç»´æŠ¤å…¶KeepAliveçŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤å‚æ•°å¿…é¡»ç½®ä¸ºfalseï¼› addRepaintBoundariesï¼šè¯¥å±æ€§è¡¨ç¤ºæ˜¯å¦å°†åˆ—è¡¨é¡¹ï¼ˆå­ç»„ä»¶ï¼‰åŒ…è£¹åœ¨RepaintBoundaryç»„ä»¶ä¸­ã€‚å½“å¯æ»šåŠ¨ç»„ä»¶æ»šåŠ¨æ—¶ï¼Œå°†åˆ—è¡¨é¡¹åŒ…è£¹åœ¨RepaintBoundaryä¸­å¯ä»¥é¿å…åˆ—è¡¨é¡¹é‡ç»˜ï¼Œä½†æ˜¯å½“åˆ—è¡¨é¡¹é‡ç»˜çš„å¼€é”€éå¸¸å°ï¼ˆå¦‚ä¸€ä¸ªé¢œè‰²å—ï¼Œæˆ–è€…ä¸€ä¸ªè¾ƒçŸ­çš„æ–‡æœ¬ï¼‰æ—¶ï¼Œä¸æ·»åŠ RepaintBoundaryåè€Œä¼šæ›´é«˜æ•ˆã€‚å’ŒaddAutomaticKeepAliveä¸€æ ·ï¼Œå¦‚æœåˆ—è¡¨é¡¹è‡ªå·±ç»´æŠ¤å…¶KeepAliveçŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤å‚æ•°å¿…é¡»ç½®ä¸ºfalseï¼› cacheExtentï¼šè®¾å®šç¼“å­˜å¤§å°ã€‚ é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªä¸€ä¸ªè®¾å®šchildrenå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ï¼ŒFlutterè¿˜æä¾›äº†ä¸€ä¸ªbuilderæ„é€ æ–¹æ³•ï¼š ListView.builder1234567ListView.builder(&#123; // ListViewå…¬å…±å‚æ•°å·²çœç•¥ ... @required IndexedWidgetBuilder itemBuilder, int itemCount, ...&#125;) itemCountï¼šæ˜¯éœ€è¦åŠ è½½å­Widgetçš„é•¿åº¦ï¼› itemBuilderï¼šåˆ—è¡¨é¡¹çš„æ„é€ å™¨ï¼Œå½“åˆ—è¡¨æ»šåŠ¨åˆ°å…·ä½“çš„indexä½ç½®æ—¶ï¼Œä¼šè°ƒç”¨è¯¥æ„å»ºå™¨æ„å»ºåˆ—è¡¨é¡¹ã€‚ çœ‹ä¾‹å­ï¼š 123456789101112ListView.builder( itemCount: _provinces.length, itemBuilder: (context, index) &#123; return GestureDetector( child: ListTile( title: Text("$index"), ), onTap: () &#123;&#125;)); &#125;, ); &#125;,) ListView.separatedç”¨äºæ·»åŠ åˆ†å‰²çº¿ã€‚ç›¸è¾ƒäºListView.builderå¤šäº†ä¸€ä¸ªseparatorBuilderå‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªåˆ†å‰²ç»„ä»¶ç”Ÿæˆå™¨ã€‚ ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼šå¥‡æ•°è¡Œæ·»åŠ ä¸€æ¡è“è‰²ä¸‹åˆ’çº¿ï¼Œå¶æ•°è¡Œæ·»åŠ ä¸€æ¡ç»¿è‰²ä¸‹åˆ’çº¿ã€‚ 12345678910111213141516171819class ListView3 extends StatelessWidget &#123; @override Widget build(BuildContext context) &#123; //ä¸‹åˆ’çº¿widgeté¢„å®šä¹‰ä»¥ä¾›å¤ç”¨ã€‚ Widget divider1=Divider(color: Colors.blue,); Widget divider2=Divider(color: Colors.green); return ListView.separated( itemCount: 100, //åˆ—è¡¨é¡¹æ„é€ å™¨ itemBuilder: (BuildContext context, int index) &#123; return ListTile(title: Text("$index")); &#125;, //åˆ†å‰²å™¨æ„é€ å™¨ separatorBuilder: (BuildContext context, int index) &#123; return index%2==0?divider1:divider2; &#125;, ); &#125;&#125; GridViewGridViewå¯ä»¥æ„é€ ä¸€ä¸ªç½‘æ ¼åˆ—è¡¨ï¼Œå®šä¹‰å¦‚ä¸‹: 1234567891011121314GridView(&#123; Axis scrollDirection = Axis.vertical, bool reverse = false, ScrollController controller, bool primary, ScrollPhysics physics, bool shrinkWrap = false, EdgeInsetsGeometry padding, @required SliverGridDelegate gridDelegate, //æ§åˆ¶å­widget layoutçš„å§”æ‰˜ bool addAutomaticKeepAlives = true, bool addRepaintBoundaries = true, double cacheExtent, List&lt;Widget&gt; children = const &lt;Widget&gt;[],&#125;) å¤§éƒ¨åˆ†å‚æ•°å’ŒListViewéƒ½ç›¸åŒï¼Œæˆ‘ä»¬åªå…³æ³¨gridDelegateè¿™ä¸ªå‚æ•°ï¼šgridDelegateä½œç”¨æ˜¯æ§åˆ¶GridViewå­ç»„ä»¶å¦‚ä½•æ’åˆ—ï¼ŒFlutterä¸­æä¾›äº†ä¸¤ä¸ªç±»SliverGridDelegateWithFixedCrossAxisCountå’ŒSliverGridDelegateWithMaxCrossAxisExtentï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥ä»‹ç»ä¸€ä¸‹å®ƒä»¬ã€‚ SliverGridDelegateWithFixedCrossAxisCountè¯¥å­ç±»å®ç°äº†ä¸€ä¸ªæ¨ªè½´ä¸ºå›ºå®šæ•°é‡å­å…ƒç´ çš„layoutç®—æ³•ï¼Œå…¶æ„é€ å‡½æ•°ä¸ºï¼š 123456SliverGridDelegateWithFixedCrossAxisCount(&#123; @required double crossAxisCount, double mainAxisSpacing = 0.0, double crossAxisSpacing = 0.0, double childAspectRatio = 1.0,&#125;) crossAxisCountï¼šæ¨ªè½´å­å…ƒç´ çš„æ•°é‡ã€‚æ­¤å±æ€§å€¼ç¡®å®šåå­å…ƒç´ åœ¨æ¨ªè½´çš„é•¿åº¦å°±ç¡®å®šäº†ï¼Œå³ViewPortæ¨ªè½´é•¿åº¦é™¤ä»¥crossAxisCountçš„å•†ã€‚ mainAxisSpacingï¼šä¸»è½´æ–¹å‘çš„é—´è·ã€‚ crossAxisSpacingï¼šæ¨ªè½´æ–¹å‘å­å…ƒç´ çš„é—´è·ã€‚ childAspectRatioï¼šå­å…ƒç´ åœ¨æ¨ªè½´é•¿åº¦å’Œä¸»è½´é•¿åº¦çš„æ¯”ä¾‹ã€‚ç”±äºcrossAxisCountæŒ‡å®šåï¼Œå­å…ƒç´ æ¨ªè½´é•¿åº¦å°±ç¡®å®šäº†ï¼Œç„¶åé€šè¿‡æ­¤å‚æ•°å€¼å°±å¯ä»¥ç¡®å®šå­å…ƒç´ åœ¨ä¸»è½´çš„é•¿åº¦ã€‚ SliverGridDelegateWithMaxCrossAxisExtentè¯¥å­ç±»å®ç°äº†ä¸€ä¸ªæ¨ªè½´å­å…ƒç´ ä¸ºå›ºå®šæœ€å¤§é•¿åº¦çš„layoutç®—æ³•ï¼Œå…¶æ„é€ å‡½æ•°ä¸ºï¼š 123456SliverGridDelegateWithMaxCrossAxisExtent(&#123; double maxCrossAxisExtent, double mainAxisSpacing = 0.0, double crossAxisSpacing = 0.0, double childAspectRatio = 1.0,&#125;) maxCrossAxisExtentä¸ºå­å…ƒç´ åœ¨æ¨ªè½´ä¸Šçš„æœ€å¤§é•¿åº¦ï¼Œä¹‹æ‰€ä»¥æ˜¯â€œæœ€å¤§â€é•¿åº¦ï¼Œæ˜¯å› ä¸ºæ¨ªè½´æ–¹å‘æ¯ä¸ªå­å…ƒç´ çš„é•¿åº¦ä»ç„¶æ˜¯ç­‰åˆ†çš„ã€‚å…¶å®ƒå‚æ•°å’ŒSliverGridDelegateWithFixedCrossAxisCountç›¸åŒã€‚ GridView.builderå’ŒListViewä¸€æ ·ï¼Œå½“å­Widgetæ•°é‡è¾ƒå¤šæ—¶ï¼Œä¹Ÿæä¾›äº†builderæ–¹æ³•: 12345GridView.builder( ... @required SliverGridDelegate gridDelegate, @required IndexedWidgetBuilder itemBuilder,) è¿™ä¸ªå°±ä¸åœ¨è¿™ä¸¾ä¾‹äº†ï¼ŒgridDelegateå’Œå‰é¢ä¸€æ ·çš„ï¼ŒitemBuilderå’ŒListViewçš„ä¸€æ ·çš„ã€‚]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(4)â€”â€”åŸºç¡€Widget]]></title>
    <url>%2Fposts%2Fa3b37eac.html</url>
    <content type="text"><![CDATA[åˆ°è¿™ç« æˆ‘ä»¬å°±å·®ä¸å¤šå¯ä»¥å¼€å§‹å†™å¤©æ°”é¢„æŠ¥äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€äº›åŸºç¡€ç®€å•çš„Widgetã€‚ åŸºç¡€ç»„ä»¶æ–‡æœ¬Textç”¨äºæ˜¾ç¤ºç®€å•çš„æ–‡æœ¬ï¼ŒåŒ…å«ä¸€äº›æ§åˆ¶æ–‡æœ¬æ˜¾ç¤ºçš„å±æ€§ã€‚ 1234567891011Text( "1234",),Text( "1234", style: TextStyle( color: Colors.purple, fontSize: 32.0, fontWeight: FontWeight.bold, ),), éœ€è¦æ˜¾ç¤ºçš„æ–‡æœ¬ä¿¡æ¯ç›´æ¥æ”¾åˆ°ä¸€ä¸ªåŒå¼•å·é‡Œé¢å°±å¯ä»¥äº†ï¼› textAlignï¼šæ–‡æœ¬å¯¹é½æ–¹å¼ï¼› maxLinesï¼šæ–‡æœ¬æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•°ï¼› overflowï¼šæŒ‡å®šå¤šä½™æ–‡æœ¬çš„æˆªæ–­æ–¹å¼ï¼› textScaleFactorï¼šæŒ‡å®šæ–‡æœ¬ç›¸å¯¹äºå½“å‰å­—ä½“å¤§å°çš„ç¼©æ”¾å› å­ï¼› TextStyleï¼šè®¾ç½®æ˜¾ç¤ºæ–‡æœ¬çš„å­—ä½“ã€é¢œè‰²ã€ç²—ç»†ç­‰æ ·å¼ï¼š heightï¼šæŒ‡å®šè¡Œé«˜ï¼Œä½†æ˜¯ä¸æ˜¯ç»å¯¹å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå› å­ï¼Œç›¸å½“äºfontsize * heightï¼› fontFamilyï¼šè®¾ç½®å­—ä½“ï¼› fontSizeï¼šè®¾ç½®å­—ä½“å¤§å° æŒ‰é’®ä¸åŒçš„ç»„ä»¶åº“æœ‰ä¸åŒçš„æŒ‰é’®ï¼Œæˆ‘ä»¬ç°åœ¨åªæ‹¿Materialç»„ä»¶åº“ä¸­çš„æŒ‰é’®ä¸¾ä¾‹ã€‚ RaisedButtonæ¼‚æµ®æŒ‰é’®ï¼Œå¸¦æœ‰é˜´å½±å’Œç°è‰²èƒŒæ™¯ã€‚æŒ‰ä¸‹åé˜´å½±ä¼šå˜å¤§ã€‚ 1234RaisedButton( child: Text("1234"), onPressed: () &#123;&#125;,); FlatButtonæ‰å¹³åŒ–æŒ‰é’®ï¼ŒèƒŒæ™¯é€æ˜ä¸”ä¸å¸¦é˜´å½±ï¼ŒæŒ‰ä¸‹åä¼šæœ‰èƒŒæ™¯è‰²ã€‚ 1234FlatButton( child: Text("1234"), onPressed: () &#123;&#125;,) IconButtonå¯ç‚¹å‡»çš„Iconï¼Œé»˜è®¤æ²¡æœ‰èƒŒæ™¯ï¼ŒæŒ‰ä¸‹åå‡ºç°é˜´å½± 1234IconButton( icon: Icon(Icons.thumb_up), onPressed: () &#123;&#125;,) å›¾ç‰‡æˆ‘ä»¬é€šè¿‡Imageæ¥æ˜¾ç¤ºå›¾ç‰‡ï¼Œæ¥æºå¯ä»¥æ˜¯assetã€ç½‘ç»œç­‰ä½ç½®ã€‚ ä»assetåŠ è½½å›¾ç‰‡ ç°åœ¨é¡¹ç›®æ ¹ç›®å½•(ä¹Ÿå°±æ˜¯å’Œandroidã€iosã€libç­‰ç›®å½•åŒçº§)æ–°å»ºä¸€ä¸ªimagesç›®å½•ï¼Œå¹¶æŠŠå›¾ç‰‡main.pngæ‹·è¿›å»ï¼› åœ¨pubspec.yamlä¸­çš„flutteréƒ¨åˆ†æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š åŠ è½½è¯¥å›¾ç‰‡ 123Image( image: AssetImage("images/amoled.png"),); Imageä¹Ÿæä¾›äº†ä¸€ä¸ªå¿«é€Ÿæ„é€ å‡½æ•°ï¼š 123Image.asset( "images/amoled.png",) ä»ç½‘ç»œåŠ è½½å›¾ç‰‡1234Image( image: NetworkImage( "https://s2.ax1x.com/2019/05/27/VZrQ3V.png"),) æˆ–è€… 123Image.network( "https://s2.ax1x.com/2019/05/27/VZrQ3V.png",) å‚æ•°Imageæœ‰ä¸€äº›åŸºæœ¬å‚æ•° 123456789const Image(&#123; ... this.width, //å›¾ç‰‡çš„å®½ this.height, //å›¾ç‰‡é«˜åº¦ this.fit,//ç¼©æ”¾æ¨¡å¼ this.alignment = Alignment.center, //å¯¹é½æ–¹å¼ this.repeat = ImageRepeat.noRepeat, //é‡å¤æ–¹å¼ ...&#125;) widthå’Œheightï¼šå®½å’Œé«˜ï¼› fitï¼šç¼©æ”¾æ¨¡å¼ï¼š fillï¼šæ‹‰ä¼¸å›¾ç‰‡çŸ¥é“å¡«æ»¡ï¼› coverï¼šæŒ‰åŸå›¾é•¿å®½æ¯”æ”¾å¤§å›¾ç‰‡æ¥å¡«æ»¡ï¼Œå¤šä½™çš„éƒ¨åˆ†èˆå»ï¼› containï¼šåœ¨ä¿è¯å›¾ç‰‡é•¿å®½æ¯”ä¸å˜çš„æƒ…å†µä¸‹å°½å¯èƒ½å»å¡«æ»¡ï¼› fitWidthï¼šå®½åº¦ä¼šç¼©æ”¾åˆ°æ˜¾ç¤ºç©ºé—´çš„å®½åº¦ï¼Œé«˜åº¦ä¼šæŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œå¦‚æœæœ‰å¤šä½™çš„éƒ¨åˆ†ä¼šè¢«èˆå»ï¼› fitHeightï¼šä¸fitWidthåŒç†ï¼› noneï¼šæ²¡æœ‰é€‚åº”ç­–ç•¥ï¼Œå›¾ç‰‡å¤šå¤§å°±æ˜¾ç¤ºå¤šå¤§ï¼Œå¦‚æœå›¾ç‰‡åŸå°ºå¯¸å°äºæ˜¾ç¤ºç©ºé—´å°±åªæ˜¾ç¤ºåŸå°ºå¯¸ï¼›å¦‚æœå¤§äºåˆ™èˆå¼ƒå¤šä½™éƒ¨åˆ†åªæ˜¾ç¤ºä¸­é—´éƒ¨åˆ†ï¼› repeatï¼šå½“å›¾ç‰‡å°äºæ˜¾ç¤ºç©ºé—´æ—¶ï¼Œä¼šå°†å›¾ç‰‡é‡å¤æ˜¾ç¤ºã€‚ å¸ƒå±€ç»„ä»¶çº¿æ€§å¸ƒå±€(Rowã€Column)çº¿æ€§å¸ƒå±€å°±ç›¸å½“äºAndroidé‡Œé¢çš„LinearLayoutï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯Flutterå°†ç«–ç›´å’Œæ°´å¹³å¸ƒå±€å•ç‹¬æ‹¿äº†å‡ºæ¥ã€‚ çº¿æ€§å¸ƒå±€åˆ†ä¸ºç«–ç›´å¸ƒå±€Columnå’Œæ°´å¹³å¸ƒå±€Rowã€‚ä»–ä¸¤å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ã€‚å†è¯´å±æ€§ä¹‹å‰æˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸¤ä¸ªæ¦‚å¿µï¼šä¸»è½´å’Œäº¤å‰è½´ã€‚å¦‚æœæ˜¯Columnï¼Œä¸»è½´æ˜¯ç«–ç›´è½´ï¼Œäº¤å‰è½´æ˜¯æ°´å¹³è½´ï¼›å¦‚æœæ˜¯Rowï¼Œä¸»è½´æ˜¯æ°´å¹³è½´ï¼Œäº¤å‰è½´æ˜¯ç«–ç›´è½´ã€‚ 1234567Row(&#123; ... MainAxisSize mainAxisSize = MainAxisSize.max, MainAxisAlignment mainAxisAlignment = MainAxisAlignment.start, CrossAxisAlignment crossAxisAlignment = CrossAxisAlignment.center, List&lt;Widget&gt; children = const &lt;Widget&gt;[],&#125;) mainAxisSizeï¼šä¸»è½´å ç”¨ç©ºé—´ã€‚é»˜è®¤æ˜¯MainAxisSize.maxï¼Œæ˜¯æŒ‡å ç”¨å…¨éƒ¨ä¸»è½´ç©ºé—´ã€‚å¦‚æœè®¾ç½®ä¸ºMainAxisSize.minï¼Œé‚£å°±åªå ç”¨æ‰€æœ‰å­ç»„ä»¶æ‰€éœ€è¦çš„ç©ºé—´ï¼› mainAxisAlignmentï¼šå­Widgetåœ¨ä¸»è½´çš„å¯¹å…¶æ–¹å‘ï¼› crossAxisAlignmentï¼šå­Widgetåœ¨äº¤å‰è½´çš„å¯¹å…¶æ–¹å‘ï¼› childrenï¼šæ‰€æœ‰çš„å­Widgetã€‚ å¼¹æ€§å¸ƒå±€(Flex)å…¶å®è¿™ä¸ªå¸ƒå±€å’Œçº¿æ€§å¸ƒå±€å¾ˆæœ‰æ¸Šæºï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸ºRowå’ŒColumnéƒ½ç»§æ‰¿è‡ªå®ƒã€‚å› æ­¤å…³äºä»–å’Œçº¿æ€§å¸ƒå±€é‡å¤çš„åœ°æ–¹æˆ‘ä»¬ç°åœ¨å°±ä¸å†è®²äº†ï¼Œæˆ‘ä»¬ç›´è¯´ä»–â€œå¼¹æ€§â€çš„éƒ¨åˆ†ã€‚ Expandedå¯ä»¥æŒ‰æ¯”ä¾‹â€œæ‹‰ä¼¸â€Rowã€Columnå’ŒFlexå­ç»„ä»¶æ‰€å çš„ç©ºé—´ã€‚ 1234const Expanded(&#123; int flex = 1, @required Widget child,&#125;) flexä¸ºå¼¹æ€§ç³»æ•°ï¼Œå¦‚æœä¸º0æˆ–è€…nullï¼Œåˆ™childä¸ä¼šé˜”ä¼¸å ç”¨çš„æ§ä»¶ã€‚å¦‚æœå¤§äº0ï¼Œåˆ™ä¼šæŒ‰ç…§flexçš„æ¯”ä¾‹æ¥åˆ†éš”ä¸»è½´å…¨éƒ¨ç©ºé—²ç©ºé—´ã€‚å…¶å®è¯´ç™½äº†ï¼Œå°±å’ŒAndroidé‡Œé¢LinearLayoutçš„weightä¸€æ ·çš„ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ¥ä¸¾ä¸ªä¾‹å­å§ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869return Scaffold( appBar: new AppBar( title: Text("$_title"), ), body: Center( child: Flex( children: &lt;Widget&gt;[ Flex( direction: Axis.horizontal, children: &lt;Widget&gt;[ Expanded( flex: 1, child: Container( color: Colors.blue, child: Text("1234"), ), ), Expanded( flex: 2, child: Container( color: Colors.red, child: Text("1234"), ), ), ], ), Flex( direction: Axis.horizontal, children: &lt;Widget&gt;[ Expanded( flex: 3, child: Container( color: Colors.blue, child: Text("1234"), ), ), Expanded( flex: 1, child: Container( color: Colors.red, child: Text("1234"), ), ), ], ), Flex( direction: Axis.horizontal, children: &lt;Widget&gt;[ Expanded( flex: 1, child: Container( color: Colors.blue, child: Text("1234"), ), ), Expanded( flex: 1, child: Container( color: Colors.red, child: Text("1234"), ), ), ], ), ], direction: Axis.vertical, ), ),); æµå¼å¸ƒå±€(Wrapã€Flow)å¦‚æœä½¿ç”¨çº¿æ€§å¸ƒå±€çš„è¯ï¼Œå½“éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è¶…å‡ºå±å¹•è¾¹ç•Œçš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æµå¼å¸ƒå±€ã€‚å½“éœ€è¦æ˜¾ç¤ºçš„å†…å®¹è¶…å‡ºå±å¹•è¾¹ç•Œçš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨æŠ˜è¡Œæ¥ç»§ç»­æ˜¾ç¤ºã€‚ Flutterä¸­é€šè¿‡Wrapå’ŒFlowæ¥å®ç°æµå¼å¸ƒå±€ã€‚ Wrapæˆ‘ä»¬æ¥çœ‹ä¸‹Wrapä¸»è¦çš„ä¸€äº›å‚æ•°ï¼š 123456789101112Wrap(&#123; ... this.direction = Axis.horizontal, this.alignment = WrapAlignment.start, this.spacing = 0.0, this.runAlignment = WrapAlignment.start, this.runSpacing = 0.0, this.crossAxisAlignment = WrapCrossAlignment.start, this.textDirection, this.verticalDirection = VerticalDirection.down, List&lt;Widget&gt; children = const &lt;Widget&gt;[],&#125;) å…¶ä¸­å¾ˆå¤šå‚æ•°Rowå’ŒColumnä¸­éƒ½æœ‰ï¼Œå°±ä¸å†ä»‹ç»äº†ï¼Œä¸»è¦ä»‹ç»ç‚¹ä¸åŒçš„ï¼š spacingï¼šä¸»è½´æ–¹å‘å­widgetçš„é—´è· runSpacingï¼šçºµè½´æ–¹å‘çš„é—´è· runAlignmentï¼šçºµè½´æ–¹å‘çš„å¯¹é½æ–¹å¼ ä¸‹é¢æœ‰ä¸€ä¸ªç¤ºä¾‹ï¼š 1234567891011121314151617181920212223Wrap( spacing: 8.0, // ä¸»è½´(æ°´å¹³)æ–¹å‘é—´è· runSpacing: 4.0, // çºµè½´ï¼ˆå‚ç›´ï¼‰æ–¹å‘é—´è· alignment: WrapAlignment.center, //æ²¿ä¸»è½´æ–¹å‘å±…ä¸­ children: &lt;Widget&gt;[ new Chip( avatar: new CircleAvatar(backgroundColor: Colors.blue, child: Text('A')), label: new Text('Hamilton'), ), new Chip( avatar: new CircleAvatar(backgroundColor: Colors.blue, child: Text('M')), label: new Text('Lafayette'), ), new Chip( avatar: new CircleAvatar(backgroundColor: Colors.blue, child: Text('H')), label: new Text('Mulligan'), ), new Chip( avatar: new CircleAvatar(backgroundColor: Colors.blue, child: Text('J')), label: new Text('Laurens'), ), ],) FlowFlowè¾ƒå¤æ‚ï¼Œéœ€è¦è‡ªå·±å®ç°å­Widgetçš„ä½ç½®è½¬æ¢ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨Flowã€‚ä½†æ˜¯å¦‚æœéœ€è¦è‡ªå®šä¹‰å¸ƒå±€ç­–ç•¥ï¼Œæˆ–è€…å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—ç”¨Flowäº†ã€‚ ä½†æ˜¯ç”±äºå¤ªè¿‡äºå¤æ‚ï¼Œæˆ‘ä¹Ÿæ²¡å’‹ç”¨è¿‡ï¼Œæˆ‘å°±ä¸åœ¨è¿™è®²äº†ğŸ˜ï¼Œå¤§å®¶æœ‰éœ€è¦çš„å¯ä»¥ç™¾åº¦ï¼Œæˆ–è€…çœ‹æˆ‘æ¨èçš„è¿™ç¯‡ï¼š4.4 æµå¼å¸ƒå±€-ã€ŠFlutterå®æˆ˜ã€‹ å±‚å å¸ƒå±€(Stack)è¿™ä¸ªå¸ƒå±€ç±»ä¼¼äºAndroidä¸­çš„Frameï¼Œå…è®¸åœ¨çˆ¶å¸ƒå±€çš„ä»»æ„åœ°æ–¹æ”¾ç½®å¸ƒå±€ã€‚ 1234567Stack(&#123; this.alignment = AlignmentDirectional.topStart, this.textDirection, this.fit = StackFit.loose, this.overflow = Overflow.clip, List&lt;Widget&gt; children = const &lt;Widget&gt;[],&#125;) alignmentï¼šå†³å®šå¦‚ä½•å»å¯¹é½ï¼› textDirectionï¼šç¡®å®šalignmentçš„å‚è€ƒç³»ï¼› fitï¼šæ²¡æœ‰å®šä½çš„å­Widgetå¦‚ä½•å»é€‚åº”Stackçš„å¤§å°ï¼› overflowï¼šå†³å®šè¶…å‡ºStackæ˜¾ç¤ºç©ºé—´çš„å­Widgetå¦‚ä½•å»æ˜¾ç¤ºï¼Œå¦‚æœOverflow.clipï¼Œåˆ™è¶…å‡ºéƒ¨åˆ†ä¼šéšè—ï¼ŒOverflow.visibleåˆ™ä¸ä¼šã€‚ å¯¹é½ä¸ç›¸å¯¹å®šä½(Align)Alignå¯ä»¥è°ƒæ•´å­Widgetçš„ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å­Widgetçš„å®½é«˜æ¥ç¡®å®šè‡ªèº«çš„å®½é«˜ã€‚ 1234567Align(&#123; Key key, this.alignment = Alignment.center, this.widthFactor, this.heightFactor, Widget child,&#125;) alignmentï¼šä»£è¡¨å­Widgetåœ¨çˆ¶Widgetçš„èµ·å§‹ä½ç½®ï¼› widthFactorå’ŒheightFactorç¡®å®šAlignæœ¬èº«çš„å®½é«˜ã€‚ æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š 1234567891011Container( height: 120.0, width: 120.0, color: Colors.blue[50], child: Align( alignment: Alignment.topRight, child: FlutterLogo( size: 60, ), ),) è¿è¡Œç»“æœï¼š 3. å®¹å™¨ç±»ç»„ä»¶å¡«å……(Padding)ç”¨è¿‡Androidçš„åŒå­¦ä¸€å®šç†Ÿæ‚‰ï¼ŒPaddingå°±æ˜¯è´Ÿè´£ç•™ç™½çš„å˜›ã€‚ä½†æ˜¯è·ŸAndroidé‡Œé¢ä¸åŒçš„æ˜¯ï¼Œåœ¨Androidé‡Œé¢æˆ‘ä»¬ä¸€èˆ¬æ˜¯åœ¨ä¸€ä¸ªViewé‡Œé¢æ·»åŠ Paddingï¼Œä½†æ˜¯åœ¨Flutteré‡Œé¢ï¼ŒPaddingç›´æ¥å˜æˆäº†ä¸€ä¸ªWidgetã€ä¸€ä¸ªå¸ƒå±€ã€‚ ä½¿ç”¨æ–¹æ³•ï¼š 1234Padding (&#123; EdgeInsetsGeometry padding, Widget child,&#125;) å¯¹äºEdgeInsetsGeometryæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨EdgeInsetsç±»ã€‚ EdgeInsetsEdgeInsetsç±»æä¾›äº†å‡ ä¸ªä¾¿æ·çš„æ–¹æ³•ï¼š fromLTRB(double left, double top, double right, double bottom)ï¼šåˆ†åˆ«æŒ‡å®šå››ä¸ªæ–¹å‘çš„å¡«å……ï¼› all(double value) : æ‰€æœ‰æ–¹å‘å‡ä½¿ç”¨ç›¸åŒæ•°å€¼çš„å¡«å……ï¼› only({left, top, right ,bottom })ï¼šå¯ä»¥è®¾ç½®å…·ä½“æŸä¸ªæ–¹å‘çš„å¡«å……(å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ–¹å‘)ï¼› symmetric({ vertical, horizontal })ï¼šç”¨äºè®¾ç½®å¯¹ç§°æ–¹å‘çš„å¡«å……ï¼ŒverticalæŒ‡topå’Œbottomï¼ŒhorizontalæŒ‡leftå’Œrightï¼› ç¤ºä¾‹ï¼š 12345678910111213141516body: Column( children: &lt;Widget&gt;[ Padding( padding: EdgeInsets.only(left: 12.0, bottom: 10.0), child: Text("1234"), ), Padding( padding: EdgeInsets.fromLTRB(0.0, 0.0, 10.0, 10.0), child: Text("1234"), ), Padding( padding: EdgeInsets.symmetric(vertical: 10.0), child: Text("1234"), ), ],), è¿è¡Œç»“æœï¼š]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(3)â€”â€”Widget]]></title>
    <url>%2Fposts%2Ffc77cdce.html</url>
    <content type="text"><![CDATA[ç®€ä»‹åœ¨Flutterä¸­ï¼ŒWidgetæ˜¯ä¸ªéå¸¸åŸºæœ¬çš„ä¸œè¥¿ï¼Œæˆ‘åœ¨ä¸Šä¸€ç« å°±è¯´è¿‡ï¼ŒFlutterä¸­åªè¦æ˜¯ç•Œé¢éƒ½æ˜¯Widgetï¼Œä½ å¯ä»¥æŠŠå®ƒå°±ç†è§£æˆæ˜¯æ§ä»¶ï¼Œä½†æ˜¯åˆå’ŒAndroidçš„Viewæ§ä»¶ä¸åŒçš„æ˜¯ï¼Œåœ¨Flutterä¸­ï¼ŒåŒ…æ‹¬Paddingã€Alignã€æ‰‹åŠ¿æ£€æµ‹çš„GestureDetectorç­‰ç­‰ï¼Œéƒ½ç®—æ˜¯Widgetã€‚ å…¶å®å¤§å¤šæ•°æ—¶å€™ï¼Œä½ å°±å¯ä»¥æŠŠWidgetç›´æ¥ç†è§£æˆUIæ§ä»¶å°±è¡Œäº†ï¼Œå› ä¸ºPaddingã€Alignã€GestureDetectorç­‰ç­‰ä¹Ÿéƒ½æ˜¯ä¸ºUIæœåŠ¡çš„ï¼Œä½ å°±å¯ä»¥ç†è§£æˆFlutterä¸­åªè¦ä¸UIæœ‰å…³çš„å±æ€§éƒ½å¯ä»¥ç®—æ˜¯æ§ä»¶ã€‚ Widgetçš„çŠ¶æ€åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡æ›´æ–°æ•°æ®æ¥è¾¾åˆ°åˆ·æ–°UIçš„ç›®çš„ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨Flutterï¼Œå°±åƒæˆ‘ä»¬å‰é¢è¯´çš„è®¡æ•°å™¨çš„Demoï¼Œå¦‚æœç›´æ¥é€šè¿‡StatelessWidgetä¹Ÿå°±æ˜¯æ— çŠ¶æ€Widgetçš„è¯ï¼Œæ˜¯æ²¡æ³•è¿›è¡Œåˆ·æ–°UIçš„ï¼Œåªèƒ½å†™ä¸€ä¸ªæ­»ç•Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨Flutterä¸­ç•Œé¢å†™å‡ºæ¥çš„å°±æ˜¯ä¸€ä¸ªæ­»ç•Œé¢ï¼Œåªæœ‰é€šè¿‡åˆ·æ–°çŠ¶æ€æ‰èƒ½æ›´æ–°UIã€‚ Widgetæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»ï¼šStatelessWidgetå’ŒStatefulWidgetï¼š StatelessWidgetï¼šè¿™ä¸ªæ˜¯æ— çŠ¶æ€Widgetï¼Œå®ç°build()æ–¹æ³•åï¼Œå°±ä¸å¯å†å˜åŒ–ï¼Œå“ªæ€•ä»–çš„çŠ¶æ€æ”¹å˜äº†ã€‚è¿™å¥è¯å¯èƒ½æœ‰ç‚¹çŸ›ç›¾ï¼Œä½†æ˜¯æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”æ–¹è¯´ç°åœ¨æœ‰ä¸€ä¸ªStatelessWidgetï¼Œä»–çš„å†…å®¹å°±æ˜¯ä¸€ä¸ªTextï¼Œè€Œè¿™ä¸ªTextçš„å†…å®¹åˆ™æ˜¾ç¤ºäº†counterè¿™ä¸ªå˜é‡ã€‚å½“è¿™ä¸ªé¡µé¢å‡ºç°çš„æ—¶å€™ï¼Œå–äº†å½“æ—¶counterçš„å€¼å¹¶æ˜¾ç¤ºäº†å‡ºæ¥ï¼Œä½†æ˜¯æˆ‘ä»¬åç»­ä¸ç®¡counterè¿™ä¸ªå€¼æ€ä¹ˆæ”¹å˜ï¼Œç•Œé¢éƒ½æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥çš„ã€‚ StatefulWidgetï¼šè¿™ä¸ªæ˜¯æœ‰çŠ¶æ€Widgetï¼Œå½“ä½ æœ‰çŠ¶æ€éœ€è¦æ”¹å˜çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡ä»–æ¥æ”¹å˜çŠ¶æ€ã€‚ Stateçš„å‡ ç§çŠ¶æ€ï¼š åç§° çŠ¶æ€ initState createä¹‹åè¢«insertåˆ°æ¸²æŸ“æ ‘æ—¶è°ƒç”¨çš„ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡ didChangeDependencies stateä¾èµ–çš„å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ didUpdateWidget WidgetçŠ¶æ€æ”¹å˜æ—¶å€™è°ƒç”¨ï¼Œå¯èƒ½ä¼šè°ƒç”¨å¤šæ¬¡ build æ„å»ºWidgetæ—¶è°ƒç”¨ deactivate å½“ç§»é™¤æ¸²æŸ“æ ‘çš„æ—¶è°ƒç”¨ dispose Widgetå³å°†é”€æ¯æ—¶è°ƒç”¨ StatelessWidgetè¿™ä¸ªç±»ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å®ç°build()æ–¹æ³•å°±å¯ä»¥äº†ã€‚ StatelessWidgetç”¨äºä¸éœ€è¦ç»´æŠ¤çŠ¶æ€çš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä»–éœ€è¦æ˜¾ç¤ºçš„æŸä¸€ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿå˜åŒ–äº†ä»–ä¹Ÿä¸å˜ã€‚ 123456789101112131415class Test extends StatelessWidget &#123; Test(&#123;Key key, this.title&#125;) : super(key: key); final String title; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: new AppBar( title: Text("$title"), ), body: Text("1234"), ); &#125;&#125; ä¸Šé¢ä»£ç å°±æ¼”ç¤ºäº†ä¸€ä¸ªStatelessWidgetçš„ä¾‹å­ï¼ŒåŠŸèƒ½æ˜¯æ ¹æ®ä¼ å…¥çš„titleåœ¨ç•Œé¢çš„titleäº†ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚åªå®ç°äº†build()æ–¹æ³•å’Œæ„é€ æ–¹æ³•ã€‚å…¶ä¸­æ„é€ æ–¹æ³•å‚æ•°Keyæ˜¯å¿…é¡»å¾—æœ‰çš„ï¼Œè€Œä¸”å¦‚æœè¯¥Widgetè¿˜æœ‰å…¶ä»–çŠ¶æ€çš„è¯ï¼Œä¹Ÿéœ€è¦å†™å…¥æ„é€ æ–¹æ³•ã€‚æ¥ç€è°ƒç”¨build()æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„titleåœ¨ç•Œé¢çš„titleä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨å®ƒï¼š 12345678910@override Widget build(BuildContext context) &#123; return MaterialApp( title: 'Flutter Demo', theme: ThemeData( primarySwatch: Colors.blue, ), home: Test(title: 'Flutter Demo Home Page'), ); &#125; ç»“æœæ˜¯ï¼š StatefulWidgetä¸StatelessWidgetç›¸å¯¹çš„å°±æ˜¯StatefulWidgetã€‚å®ƒçš„é‡ç‚¹åœ¨äºå¯ä»¥æ ¹æ®çŠ¶æ€æ¥æ›´æ–°ã€‚ ä»–è¾ƒäºStatelessWidgetï¼Œå°‘äº†æˆ‘ä»¬å¸¸ç”¨çš„build()æ–¹æ³•ï¼Œå¤šäº†createState()æ–¹æ³•ã€‚ä¸‹é¢æˆ‘å°±æ¥è®²ä¸€ä¸‹ä»–çš„ç”¨æ³•ï¼Œæˆ‘è¿˜æ˜¯æ‹¿ä¸Šé¢çš„Teståšä¾‹å­ã€‚ 123456789101112131415161718192021222324252627282930class Test extends StatefulWidget &#123; Test(&#123;Key key, this.title&#125;) : super(key: key); final String title; @override _TestState createState() =&gt; _TestState();&#125;class _TestState extends State&lt;Test&gt; &#123; String _title; @override void initState() &#123; setState(() &#123; _title = widget.title; &#125;); super.initState(); &#125; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: new AppBar( title: Text("$_title"), ), body: Text("1234"), ); &#125;&#125; å…ˆçœ‹Testç±»ï¼Œä»–ç»§æ‰¿è‡ªStatefulWidgetï¼Œç”±äºè¿™ä¸ªé¡µé¢éœ€è¦æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥æ˜¾ç¤ºtitleï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªçŠ¶æ€titleï¼Œå¹¶åœ¨æ„é€ æ–¹æ³•ä¸­å†™å…¥äº†ä»–ã€‚æ¥ç€è°ƒç”¨äº†createState()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æ‰€æœ‰StatefulWidgetå¿…é¡»çš„ï¼Œä¸»è¦æ˜¯ä¸ºè¿™ä¸ªWidgetåˆ›å»ºä»–å¯¹åº”çš„Stateã€‚ äºæ˜¯æˆ‘ä»¬å°±åœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œç±»åå«_TestStateï¼Œç»§æ‰¿è‡ªState&lt;Test&gt;ã€‚ç”±äºWidgetæœ‰titleè¿™ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ä¸ºäº†é™ä½ä»–ä»¬çš„è€¦åˆåº¦ï¼Œæˆ‘ä»¬åœ¨Stateç±»ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªå«_titleçš„çŠ¶æ€ï¼Œå¹¶_title = widget.title;ã€‚ æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªinitState()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯Stateå¿…é¡»çš„ï¼Œåœ¨ä¸Šé¢Widgetçš„çŠ¶æ€ä¸­æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œè¿™ä¸ªæ˜¯åˆå§‹åŒ–Stateçš„ï¼ŒåŒæ—¶åœ¨initSate()é‡Œé¢ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªsetState()ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å‘Šè¯‰Flutterè¯´è¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ”¹å˜äº†æ¥ç€Widgetçš„çŠ¶æ€ä¹Ÿå¾—æ”¹å˜ã€‚æœ€åå°±æ˜¯build()æ–¹æ³•ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨å®ƒï¼š 12345678910@override Widget build(BuildContext context) &#123; return MaterialApp( title: 'Flutter Demo', theme: ThemeData( primarySwatch: Colors.blue, ), home: Test(title: '1234'), ); &#125; ç»“æœæ˜¯ï¼š]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(2)â€”â€”Flutterè®¡æ•°å™¨Demo]]></title>
    <url>%2Fposts%2F956d1e66.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ ·ä¾‹éƒ½æ˜¯ä½¿ç”¨çš„AndroidStudioï¼Œå¦‚æœä½ ä½¿ç”¨Xcodeæˆ–è€…vscodeï¼Œä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯IDEåˆ›å»ºé¡¹ç›®çš„æ–¹å¼ä»¥åŠè¿è¡ŒæŒ‰é”®ä½ç½®ä¸åŒè€Œå·²ã€‚ åˆ›å»ºFlutteré¡¹ç›®AndroidStudioä¸­é€‰æ‹©File-&gt;New-&gt;New Flutter Project-&gt;Flutter Application-&gt;NEXTã€‚æ¥ç€å¡«å†™ä½ çš„é¡¹ç›®åç§°ç­‰ä¸€ç³»åˆ—ä¿¡æ¯åå°±åˆ›å»ºæˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°AndroidStudioå·²ç»ä¸ºæˆ‘ä»¬åˆ›å»ºå¥½äº†ä¸€ä¸ªDemoï¼Œæ¥ç€è¿ä¸Šä½ çš„æ‰‹æœºæˆ–è€…æ‰“å¼€ä½ çš„è™šæ‹Ÿæœºï¼ŒæŒ‰ä¸‹AndroidStudioçš„è¿è¡Œé”®ï¼Œä¸ä¸€ä¼šå„¿ï¼Œä½ å°±ä¼šæƒŠå–œçš„å‘ç°ä½ çš„æ‰‹æœºä¸Šå°±æœ‰ä¸€ä¸ªFlutterè®¡æ•°å™¨Demoäº†ã€‚ ä»‹ç»ä¸‹AndroidStudioç•Œé¢è¿™æ˜¯æˆ‘çš„AndroidStudioç•Œé¢ï¼Œæ¥ä¸‹æ¥æˆ‘åˆ†ä¸‰ä¸ªéƒ¨åˆ†ä»‹ç»ä¸‹AndroidStudioçš„å¤§è‡´ç•Œé¢ã€‚ æ§åˆ¶åŒº ä¸€æ¬¡ä»‹ç»æ¯ä¸€ä¸ªæŒ‰é’®çš„åŠŸèƒ½ã€‚ ç¬¬ä¸€ä¸ªæ˜¯ç”¨æ¥é€‰æ‹©è¿è¡Œè®¾å¤‡çš„ï¼Œæ¯”æ–¹è¯´æˆ‘ç°åœ¨å°±é€‰çš„æ˜¯æˆ‘çš„è™šæ‹Ÿæœºï¼Œç„¶åæˆ‘æŒ‰ä¸‹è¿è¡Œåå°±å¯ä»¥å°†é¡¹ç›®è¿è¡Œåˆ°æˆ‘çš„è™šæ‹Ÿæœºä¸Šè€Œä¸ä¼šè¿è¡Œåˆ°è¿ç€æˆ‘çš„ç”µè„‘çš„æ‰‹æœºä¸Šå»ï¼› ç¬¬äºŒä¸ªæ˜¯é€‰æ‹©è¿è¡Œå“ªä¸ªFlutter moduleï¼Œå¦‚æœä½ åŒä¸€ä¸ªé¡¹ç›®é‡Œé¢æœ‰å¤šä¸ªmoduleï¼Œä½ å°±å¯ä»¥åœ¨æ­¤é€‰æ‹©ä½ æƒ³è¦è¿è¡Œçš„moduleï¼› ç¬¬ä¸‰ä¸ªç°è‰²çš„é€‰é¡¹æ¡†æˆ‘ä¹Ÿæ²¡å¼„æ‡‚å¥¹æ˜¯å¹²å˜›çš„ï¼Œæˆ‘è‡³ä»Šéƒ½æ²¡èƒ½é€‰æ‹©è¿‡ï¼Œä¸€ç›´éƒ½æ˜¯ç°çš„ï¼› ç»¿è‰²çš„ä¸‰è§’å½¢ï¼Œå¤§å®¶ç†ŸçŸ¥ï¼Œè¿è¡Œé”®ï¼› çº¢è‰²çš„ç“¢è™«ï¼Œå¤§å®¶ç†ŸçŸ¥ï¼Œdebugé”®ï¼› ä¸çŸ¥é“å¹²å˜›çš„ï¼› FlutterAPPçš„æ€§èƒ½ç›‘è§†å™¨ï¼› é—ªç”µï¼Œè¿™ä¸ªæ˜¯é‡ç‚¹ï¼Œä¹Ÿæ˜¯Flutterçš„ä¸€å¤§ç‰¹æ€§ï¼Œçƒ­é‡è½½é”®ï¼Œä»–èƒ½åšåˆ°ä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç å°±èƒ½å°†ä½ ä¿®æ”¹çš„ä»£ç çš„æ•ˆæœåœ¨ä½ çš„APPä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼› ä¸çŸ¥é“å¹²å˜›çš„ï¼› çº¢è‰²çš„æ­£æ–¹å½¢ï¼Œåœæ­¢è¿è¡ŒæŒ‰é’®ã€‚ Runè¿è¡ŒåŒºå°±æ˜¯Flutterçš„ä¿¡æ¯æ˜¾ç¤ºåŒºï¼Œç±»ä¼¼äºAndroidStudioçš„Logcatï¼Œèƒ½æ˜¾ç¤ºFlutterAPPè¿è¡Œä¸­çš„ä¸€äº›ä¿¡æ¯ã€‚ Flutter Outline/Flutter InspectoråŒºç”¨äºæ˜¾ç¤ºå½“å‰ç•Œé¢çš„ä¸€äº›æ„å»ºä¿¡æ¯ã€‚ Flutteré¡¹ç›®ç»“æ„ æˆ‘ä»¬æŒ‘ä¸€äº›é‡è¦çš„è¯´ä¸€ä¸‹ï¼š .ideaæ–‡ä»¶å¤¹ï¼ŒAndroidStudioè¯†åˆ«é¡¹ç›®çš„å¿…å¤‡æ–‡ä»¶å¤¹ï¼Œä¸ç”¨ç®¡ï¼› Androidæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteræ„å»ºçš„Androidé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼› iosæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteræ„å»ºçš„iOSé¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼› libæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾Flutteré¡¹ç›®å’Œèµ„æºçš„æ–‡ä»¶å¤¹ï¼› pubspec.yamlæ–‡ä»¶ï¼Œå­˜æ”¾Flutteré¡¹ç›®ç›¸å…³ä¿¡æ¯ï¼Œå¦‚é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä¾èµ–ç­‰ç­‰ï¼Œç±»ä¼¼äºAndroidé¡¹ç›®çš„build.gradleæ–‡ä»¶ã€‚ main.dartæ–‡ä»¶æˆ‘ä»¬é€šè¿‡è®²è¿™ä¸ªæ–‡ä»¶æ¥ç»™å¤§å®¶å¤§è‡´ä»‹ç»ä¸‹Flutteré¡¹ç›®ä»£ç ç»“æ„ã€‚ å…¨éƒ¨æºä»£ç åœ¨æ­¤ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import 'package:flutter/material.dart';void main() =&gt; runApp(MyApp());class MyApp extends StatelessWidget &#123; @override Widget build(BuildContext context) &#123; return MaterialApp( title: 'Flutter Demo', theme: ThemeData( primarySwatch: Colors.blue, ), home: MyHomePage(title: 'Flutter Demo Home Page'), ); &#125;&#125;class MyHomePage extends StatefulWidget &#123; MyHomePage(&#123;Key key, this.title&#125;) : super(key: key); final String title; @override _MyHomePageState createState() =&gt; _MyHomePageState();&#125;class _MyHomePageState extends State&lt;MyHomePage&gt; &#123; int _counter = 0; void _incrementCounter() &#123; setState(() &#123; _counter++; &#125;); &#125; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: AppBar( title: Text(widget.title), ), body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: &lt;Widget&gt;[ Text( 'You have pushed the button this many times:', ), Text( '$_counter', style: Theme.of(context).textTheme.display1, ), ], ), ), floatingActionButton: FloatingActionButton( onPressed: _incrementCounter, tooltip: 'Increment', child: Icon(Icons.add), ), ); &#125;&#125; importé¦–å…ˆæˆ‘ä»¬çœ‹æœ€å¼€å§‹çš„importåŒºã€‚ è¿™å—ç›¸å½“äºC/C++çš„includeï¼Œåè€Œä¸åƒjavaçš„importã€‚æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œä½ æƒ³ä¸€ä¸‹ï¼Œä½ å†™javaç¨‹åºçš„æ—¶å€™ï¼Œä½ æ˜¯éœ€è¦å“ªä¸ªç±»å°±ç›´æ¥åœ¨ä»£ç ä¸­è¾“å…¥ç±»åï¼Œç„¶åIDEä¼šè‡ªåŠ¨ç»™ä½ æ˜¾ç¤ºæœ‰è¿™ä¸ªç±»çš„æ‰€æœ‰çš„åŒ…ï¼Œç„¶åè®©ä½ é€‰åŒ…å»å¯¼å…¥ï¼›è€Œå†™dartæ˜¯éœ€è¦ä½ å…ˆå¯¼å…¥åŒ…ï¼Œæ‰èƒ½åœ¨ä»£ç ä¸­å†™è¿™ä¸ªåŒ…ä¸­çš„ç±»ï¼Œå¦‚æœä½ æ²¡æœ‰å…ˆå¯¼å…¥åŒ…è€Œç›´æ¥åˆ°ä¸‹é¢å†™çš„è¯ï¼ŒIDEæ˜¯ä¸ä¼šæç¤ºä½ è¿™ä¸ªç±»å¯èƒ½ä¼šåœ¨å“ªä¸ªåŒ…ä¸­ï¼Œè€Œæ˜¯ç›´æ¥æŠ¥é”™ï¼Œè¿™ç‚¹å’ŒC/C++æ¯”è¾ƒç±»ä¼¼ã€‚ é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆå¯¼å…¥çš„æ˜¯flutter/material.dartè¿™ä¸ªåŒ…å‘¢ï¼Ÿæˆ‘åœ¨ç¬¬ä¸€èŠ‚é‡Œé¢è¯´è¿‡ï¼ŒFlutterä»–å†…ç½®äº†Androidçš„Material Designé£æ ¼å’ŒiOSçš„Cupertinoé£æ ¼çš„UIï¼›æ‰€ä»¥è¿™å—å°±æ˜¯å¯¼å…¥Material Designé£æ ¼UIæ–‡ä»¶ï¼Œè€Œå¦‚æœä½ è¦ä½¿ç”¨Cupertinoé£æ ¼UIæ–‡ä»¶çš„è¯ï¼ŒæŠŠå®ƒæ”¹æˆCupertinoå°±è¡Œäº†ã€‚ main()1234567891011121314void main() =&gt; runApp(MyApp());class MyApp extends StatelessWidget &#123; @override Widget build(BuildContext context) &#123; return MaterialApp( title: 'Flutter Demo', theme: ThemeData( primarySwatch: Colors.blue, ), home: MyHomePage(title: 'Flutter Demo Home Page'), ); &#125;&#125; ç¬¬ä¸€è¡Œï¼ŒæŒ‡æ˜é¡¹ç›®çš„å…¥å£å°±æ˜¯MyApp()ã€‚å›ºå®šæ ¼å¼ï¼Œå¯ä»¥ä¸ç”¨ç®¡ã€‚ ç¬¬äºŒè¡Œå°±å®šä¹‰äº†ä¸€ä¸ªç±»MyAppç»§æ‰¿è‡ªStatelessWidgetï¼Œå¹¶é‡å†™äº†çˆ¶ç±»çš„build()æ–¹æ³•ã€‚Widgetå¯ä»¥çœ‹æˆFlutterä¸­çš„é¡µé¢ï¼Œåªè¦æ˜¯Flutterä¸­çš„é¡µé¢ï¼Œéƒ½å¿…é¡»ç»§æ‰¿è‡ªWidgetã€‚ä»–æœ‰ç‚¹ç±»ä¼¼äºAndroidä¸­çš„Viewï¼Œä½†æ˜¯ä¸åŒäºViewçš„æ˜¯ï¼ŒFlutterä¸­çš„paddingã€alignã€layoutç­‰å±…ç„¶ä¹Ÿæ˜¯Widgetã€‚ å¦‚æœæ˜¯StatelessWidgetï¼Œåˆ™ä»£è¡¨å¥¹æ˜¯ä¸€ä¸ªâ€œçŠ¶æ€å°‘â€çš„Widgetï¼Œæˆ‘çš„ç†è§£å°±æ˜¯çŠ¶æ€ç›¸å½“äºWidgetçš„ä¸€äº›æ•°å€¼ï¼Œæ¯”æ–¹è¯´é¡µé¢è¦æ˜¾ç¤ºè®¡æ•°å™¨çš„è®¡æ•°countï¼Œé‚£ä¹ˆè¿™ä¸ªcountå°±æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œåªè¦æœ‰çŠ¶æ€å°±ä½¿ç”¨StatefulWidgetã€‚åƒMyAppå®ƒæ²¡æœ‰çŠ¶æ€ï¼Œäºæ˜¯å°±ç”¨StatelessWidgetã€‚ ç»§æ‰¿è‡ªStatelessWidgetçš„ç±»å¿…é¡»å®ç°build()æ–¹æ³•ï¼Œç›¸å½“äºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæ­»é¡µé¢ï¼Œåªéœ€è¦å±•ç¤ºå›ºå®šçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦çŠ¶æ€ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡build()ç›´æ¥å†™å…¥ç•Œé¢å°±è¡Œã€‚ build()æ–¹æ³•å¿…é¡»åŒæ ·è¿”å›ä¸€ä¸ªWidgetï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä½¿ç”¨MaterialAppï¼Œå…¶ä¸­æˆ‘ä»¬ç»™ä»–çš„titleã€themeã€homeè¿›è¡Œäº†èµ‹å€¼ï¼ŒåŒå­¦ä»¬åº”è¯¥éƒ½èƒ½å¤§è‡´è¯»æ‡‚å•¥æ„æ€ï¼Œé¦–é¡µhomeåˆ™ç»™äº†MyHomePage. MyHomePage123456789101112131415161718192021222324252627282930313233343536373839404142434445class MyHomePage extends StatefulWidget &#123; MyHomePage(&#123;Key key, this.title&#125;) : super(key: key); final String title; @override _MyHomePageState createState() =&gt; _MyHomePageState();&#125;class _MyHomePageState extends State&lt;MyHomePage&gt; &#123; int _counter = 0; void _incrementCounter() &#123; setState(() &#123; _counter++; &#125;); &#125; @override Widget build(BuildContext context) &#123; return Scaffold( appBar: AppBar( title: Text(widget.title), ), body: Center( child: Column( mainAxisAlignment: MainAxisAlignment.center, children: &lt;Widget&gt;[ Text( 'You have pushed the button this many times:', ), Text( '$_counter', style: Theme.of(context).textTheme.display1, ), ], ), ), floatingActionButton: FloatingActionButton( onPressed: _incrementCounter, tooltip: 'Increment', child: Icon(Icons.add), ), ); &#125;&#125; MyHomePageæˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼Œå¦‚æœä¸€ä¸ªé¡µé¢æœ‰æ•°æ®ä¹Ÿå°±æ˜¯â€œçŠ¶æ€â€çš„è¯ï¼Œé‚£ä¹ˆä»–å°±å¾—ç»§æ‰¿è‡ªStatefulWidgetã€‚ å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ªStatefulWidgetï¼Œé‚£è¿™ä¸ªç±»ä¼šå¾ˆç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ä¸­å†™å…¥keyä»¥åŠè¯¥Widgetéœ€è¦çš„æ•°æ®ã€‚ç„¶åé‡å†™createState()æ–¹æ³•ã€‚ MyHomePageStateå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ªStatefulWIdgetï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªä»–çš„Stateç±»å¹¶ç»§æ‰¿è‡ªState&lt;è¯¥ç±»&gt;ï¼Œå°±åƒclass _MyHomePageState extends State&lt;MyHomePage&gt;ä¸€æ ·ã€‚ é‚£æˆ‘ä»¬æ¥çœ‹çœ‹Stateç±»é‡Œé¢æœ‰äº›å•¥ä¸œè¥¿: é¦–å…ˆå…ˆå®šä¹‰â€œçŠ¶æ€â€ï¼šç”±äºæˆ‘ä»¬è¿™ä¸ªAPPä¸»è¦çš„åŠŸèƒ½æ˜¯ç”¨æ¥è®¡æ•°ï¼Œæ‰€ä»¥å¿…é¡»å®šä¹‰ä¸€ä¸ªintå‹å˜é‡æ¥è®¡æ•°ï¼š 1int _counter = 0; æ¥ç€å¦‚æœæˆ‘ä»¬è¿™ä¸ª_counterå˜é‡å˜äº†ï¼Œé‚£å°±å¾—é€šçŸ¥flutterè¯´çŠ¶æ€å˜äº†ï¼Œéœ€è¦æ›´æ–°UIï¼š 12345void _incrementCounter() &#123; setState(() &#123; _counter++; &#125;);&#125; å…¶ä¸­ï¼ŒsetState()æ–¹æ³•å°±æ˜¯ç”¨æ¥é€šçŸ¥Flutterè¿™ä¸ªçŠ¶æ€æ”¹å˜äº†ï¼Œè¦å»æ›´æ–°UIçš„ã€‚ æœ€åé‡å†™build()æ–¹æ³•æ¥å†™å…¥ç•Œé¢ï¼š Scaffoldæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒæä¾›äº†é»˜è®¤çš„å¯¼èˆªæ ã€æ ‡é¢˜å’ŒåŒ…å«ä¸»å±å¹•widgetæ ‘ï¼ˆååŒâ€œç»„ä»¶æ ‘â€æˆ–â€œéƒ¨ä»¶æ ‘â€ï¼‰çš„bodyå±æ€§ã€‚ bodyåé¢æ˜¯ä¸€ä¸ªCenterç»„ä»¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å®ƒçš„å­Widgetå®šä½åˆ°çˆ¶Widgetçš„ä¸­é—´ã€‚ Centeråé¢æ˜¯ä¸€ä¸ªColumnç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ç±»ä¼¼äºAndroidä¸­çš„LinearLayoutçš„orientation: Verticalï¼Œä¹Ÿå°±æ˜¯å‚ç›´å‘çš„çº¿æ€§å¸ƒå±€ã€‚åŒæ—¶Flutterä¹Ÿæä¾›äº†Rowè¿™ä¸ªæ°´å¹³å‘çš„çº¿æ€§å¸ƒå±€ã€‚ä»–ä»¬çš„å­Widgetæ˜¯childrenå±æ€§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªWidgetã€‚ Columné‡Œé¢æ˜¯ä¸¤ä¸ªTextï¼Œè¿™ä¸ªæ²¡å•¥è®²çš„ æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªFloatingActionButtonï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæµ®åŠ¨æŒ‰é’®ï¼ŒAndroidé‡Œé¢æœ‰è¿™ä¸ªæ§ä»¶ï¼Œæ ¸å¿ƒæ˜¯ä»–çš„onPressedå±æ€§ï¼Œè¿™ä¸ªå°±ç›¸å½“äºonClick()ï¼Œç”¨äºå¤„ç†ç‚¹å‡»äº‹ä»¶ã€‚ ä½“éªŒçƒ­é‡å¯é¦–å…ˆå…ˆè®©é¡¹ç›®åœ¨è™šæ‹Ÿæœºæˆ–è€…æ‰‹æœºä¸Šè¿è¡Œç€ï¼Œç„¶åæˆ‘ä»¬æŠŠé¡µé¢Textä¸­çš„â€You have pushed the button this many times:â€æ”¹ä¸ºâ€You have clicked the button this many times:â€ï¼Œç„¶åæŒ‰çƒ­é‡å¯é”®ï¼ˆmacOSç‰ˆAndroidStudioé»˜è®¤æ˜¯commond+sé”®ï¼‰ï¼Œæ¥ç€ä½ å°±èƒ½é‡Œé¢åœ¨è™šæ‹Ÿæœºæˆ–è€…æ‰‹æœºä¸Šçœ‹åˆ°ä¿®æ”¹ä¹‹åçš„ç»“æœã€‚]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Flutterå…¥é—¨å¹¶å¼€å‘å¤©æ°”é¢„æŠ¥APP(1)â€”â€”Flutterå®‰è£…]]></title>
    <url>%2Fposts%2F4bf666bf.html</url>
    <content type="text"><![CDATA[Flutteræ˜¯ä»€ä¹ˆFlutteræ˜¯ç”±è°·æ­Œæ¨å‡ºçš„ä¸€ä¸ªç§»åŠ¨UIæ¡†æ¶ï¼Œå¯ä»¥è®©å¼€å‘è€…å¿«é€Ÿçš„åœ¨Androidå’ŒiOSä¸Šæ„å»ºé«˜è´¨é‡çš„åŸç”Ÿç”¨æˆ·ç•Œé¢ã€‚ é€šè¿‡å®ƒæ¥ç¼–å†™APPçš„å¥½å¤„åœ¨äºï¼š å®ƒå†…ç½®äº†Androidçš„Material Designé£æ ¼å’ŒiOSçš„Cupertinoé£æ ¼çš„UIï¼› å®ƒé€šè¿‡Dartè¯­è¨€ç¼–å†™ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä»½ä»£ç å°±èƒ½åœ¨Androidå’ŒiOSè®¾å¤‡ä¸Šå¾—åˆ°åŒæ ·çš„è¿è¡Œæ•ˆæœï¼› ä»–æœ‰çƒ­é‡è½½åŠŸèƒ½ï¼Œåªéœ€è¦è¿è¡ŒAPPåï¼Œä»£ç æ›´æ”¹ä¸€ç‚¹ç„¶åç‚¹å‡»çƒ­é‡è½½é”®å°±èƒ½å¿«é€Ÿæ˜¾ç¤ºå‡ºä¿®æ”¹åçš„ç•Œé¢ã€‚ ä½¿ç”¨é•œåƒå®‰è£…ç”±äºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼ŒFlutteråœ¨å›½å†…è®¿é—®æœ‰æ—¶å€™ä¼šå—åˆ°é™åˆ¶ï¼Œå› æ­¤Flutterå®˜æ–¹ä¸ºå›½å†…å¼€å‘è€…æ­å»ºäº†ä¸´æ—¶é•œåƒï¼Œå¤§å®¶å¯ä»¥å°†ä¸‹é¢çš„ç¯å¢ƒå˜é‡æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼š 12export PUB_HOSTED_URL=https://pub.flutter-io.cnexport FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn ç”±äºæˆ‘ç”¨çš„æ˜¯macOSï¼Œå› æ­¤æˆ‘å°±åªæ¼”ç¤ºmacOSçš„ã€‚å¦‚æœæœ‰Linuxçš„ç”¨æˆ·åˆ™å’ŒmacOS çš„å®‰è£…æ–¹å¼ç±»ä¼¼ï¼Œç”šè‡³å¯ä»¥è¯´ä¸€æ ·ï¼›ä½†æ˜¯å¯¹äºWindowsç”¨äºï¼Œéœ€è¦å¤§å®¶æ¡Œé¢å³é”®æ­¤ç”µè„‘-&gt;å±æ€§-&gt;å¼¹å‡ºé¡µé¢å·¦ä¾§æ çš„é«˜çº§ç³»ç»Ÿè®¾ç½®-&gt;ç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ ä¸­ç‚¹å‡»æ–°å»ºï¼Œå˜é‡åè¾“å…¥ä¸Šé¢ç­‰å·å·¦è¾¹çš„å¤§å†™å†…å®¹ï¼Œä¸è¦exportï¼Œå€¼è¾“å…¥ç­‰å·å³è¾¹çš„å†…å®¹ï¼Œè¾“å…¥ä¸€ç»„ä¹‹åå†ç‚¹å‡»æ–°å»ºæ¥ç€è¾“å…¥ä¸‹ä¸€ç»„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¯´macOSã€‚ é¦–å…ˆä½ å¾—ç¡®å®šä½ ç”¨çš„æ˜¯ä»€ä¹ˆshellå¦‚æœä½ æ²¡æ›´æ”¹è¿‡ä½ macOSç»ˆç«¯è®¾ç½®ï¼Œé‚£ä¹ˆä½ é»˜è®¤å°±æ˜¯bashï¼Œä½†æ˜¯å¦‚æœä½ æ›´æ”¹è¿‡ï¼Œæ¯”æ–¹è¯´æˆ‘å°±æ¢æˆäº†zshï¼Œé‚£ä¹ˆæˆ‘è§‰å¾—ä½ åº”è¯¥çŸ¥é“åœ¨å“ªè®¾ç½®ç¯å¢ƒå˜é‡ã€‚ å¦‚æœä½ æ˜¯bashé¦–å…ˆæ‰“å¼€ä½ macOSçš„ç»ˆç«¯ï¼Œåœ¨å¯åŠ¨å°é‡Œé¢å¯ä»¥æ‰¾åˆ°ï¼Œæ¥ç€å¯¹bashçš„ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œè¾“å…¥ 1vim ~/.bash_profile å›è½¦ï¼Œè¿›å…¥.bash_profileæ–‡ä»¶çš„ç¼–è¾‘é¡µé¢ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜Ié”®ï¼Œè¿›å…¥vimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥æŠŠä¸Šé¢çš„exportç¯å¢ƒå˜é‡èµ‹å€¼ç²˜è´´è¿›å»ã€‚ç„¶åæŒ‰ä¸‹Escé”®é€€å‡ºvimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥è¾“å…¥:wqå›è½¦ä¿å­˜å¹¶é€€å‡ºã€‚æ¥ç€è¾“å…¥ 1source ~/.bash_profile è®©åˆšåˆšé…ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆå³å¯ã€‚ å¦‚æœä½ æ˜¯zshé¦–å…ˆæ‰“å¼€ä½ macOSçš„ç»ˆç«¯ï¼Œåœ¨å¯åŠ¨å°é‡Œé¢å¯ä»¥æ‰¾åˆ°ï¼Œæ¥ç€å¯¹zshçš„ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œè¾“å…¥ 1vim ~/.zshrc å›è½¦ï¼Œè¿›å…¥.zshrcæ–‡ä»¶çš„ç¼–è¾‘é¡µé¢ï¼Œæ‰¾åˆ°å¦‚å›¾æ‰€ç¤ºéƒ¨åˆ†ï¼ˆé‡ç‚¹åœ¨äºæœ‰# export MANPATH=&quot;/Usrs/......çš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘è¿˜æœ‰å…¶å®ƒçš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä½ çš„å¯èƒ½å’Œæˆ‘çš„ä¸åŒï¼‰ï¼š åœ¨# exportä¸‹é¢ï¼ŒæŒ‰ä¸‹é”®ç›˜Ié”®ï¼Œè¿›å…¥vimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥æŠŠä¸Šé¢çš„exportç¯å¢ƒå˜é‡èµ‹å€¼ç²˜è´´è¿›å»ã€‚è§æˆ‘å›¾ä¸­æœ€ä¸‹é¢æ ‡çº¢çš„é‚£åœ°æ–¹ï¼Œè‡³äºæœ€åä¸€è¡Œexport PATH=~/development/flutter/bin:$PATHå…ˆä¸ç®¡ã€‚ç„¶åæŒ‰ä¸‹Escé”®é€€å‡ºvimçš„ç¼–è¾‘æ¨¡å¼ï¼Œç„¶åç›´æ¥è¾“å…¥:wqå›è½¦ä¿å­˜å¹¶é€€å‡ºã€‚æ¥ç€è¾“å…¥ 1source ~/.zshrc è®©åˆšåˆšé…ç½®çš„ç¯å¢ƒå˜é‡ç”Ÿæ•ˆå³å¯ã€‚ ä¸‹è½½Flutter SDKå…ˆå»Flutterçš„å®˜ç½‘å»ä¸‹è½½ä½ å¯¹åº”ç³»ç»Ÿçš„Flutter SDK æ‰“å¼€å®˜ç½‘ä¸‹è½½é¡µï¼šFlutter SDK release é€‰æ‹©ä½ çš„ç³»ç»Ÿå¯¹åº”çš„ç›®å½•ï¼Œç„¶åé»˜è®¤é€‰æ‹©Stable channelä¸‹è½½ã€‚(*Master channelè¿™ä¸ªæ˜¯ç›´æ¥ä»githubè·å–çš„githubä¸Šçš„æœ€æ–°ç‰ˆï¼Œä¹Ÿå°±æ˜¯è¯´Flutterçš„å¼€å‘è€…ä»–å†™äº†ç‚¹ä»€ä¹ˆæ”¹äº†ç‚¹ä»€ä¹ˆéƒ½ä¼šé‡Œé¢åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸Šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬æ„å‘³ç€éå¸¸ä¸ç¨³å®šï¼Œå¯èƒ½bugå¾ˆå¤šï¼›Dev channelæ˜¯å¼€å‘ç‰ˆï¼ŒMaster channelç»è¿‡ä¸€å®šæµ‹è¯•ä¹‹åçš„ç‰ˆæœ¬ä¼šå‘å¸ƒåˆ°Dev channelä¸Šï¼Œä½†æ˜¯ä¸æ˜¯å¤§é‡çš„æµ‹è¯•ï¼Œæ‰€ä»¥å¯èƒ½è¿˜æ˜¯ä¸å¤ªç¨³å®šï¼›Beta channelæ˜¯æµ‹è¯•ç‰ˆï¼Œæ¯æœˆå‘å¸ƒä¸€æ¬¡ï¼Œä¼šæŠŠä¸Šä¸ªæœˆæ‰€é‡Šæ”¾çš„æ‰€æœ‰Dev channelä¸­æœ€ç¨³å®šçš„ç‰ˆæœ¬é‡Šæ”¾åˆ°Beta channelä¸Šï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æœ‰ç‚¹ä¸ç¨³å®šï¼Œé€‚åˆæƒ³å°é²œçš„å¼€å‘è€…ï¼›State channelæ˜¯æ ‡å‡†ç‰ˆï¼Œå½“Flutterç»´æŠ¤äººå‘˜è®¤ä¸ºæŸä¸ªç‰ˆæœ¬è¶³å¤Ÿç¨³å®šä¹‹åï¼Œå°±ä¼šå‘é€åˆ°è¿™ä¸ªç‰ˆæœ¬ä¸Šå»ï¼Œä¸€èˆ¬å¼€å‘è€…æœ€å¥½è¿˜æ˜¯ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬) è§£å‹å®‰è£…åŒ…åˆ°ä½ æƒ³è¦çš„ç›®å½•ä¾‹å¦‚ 123// Linux/macOScd ~/developmentunzip ~/Downloads/flutter_macos_v0.5.1-beta.zip æ·»åŠ Fluuterè·¯å¾„åˆ°ç¯å¢ƒå˜é‡ä¸­å›é¡¾ç¬¬2é¡¹ï¼ŒæŠŠå¦‚ä¸‹å†…å®¹æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­å» 1export PATH=/ä½ ä¸Šä¸€æ­¥flutterè§£å‹çš„ç›®å½•/flutter/bin:$PATH è¿è¡ŒFlutter doctorå¦‚æœæ˜¯macOS/Linuxï¼Œç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥flutter doctorå³å¯ã€‚å¦‚æœæ˜¯Windowsï¼Œåˆ™å³é”®å¼€å§‹ï¼Œé€‰æ‹©PowerShellï¼Œç„¶åè¾“å…¥flutter doctorå³å¯ã€‚ è¿™ä¸ªå‘½ä»¤çš„åŠŸèƒ½æ˜¯æ£€æŸ¥ä½ çš„Flutteræ˜¯å¦æ­£å¸¸å®‰è£…ã€‚ å¦‚æœæ­£å¸¸å®‰è£…çš„è¯ä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š 1234567891011121314151617181920212223242526Doctor summary (to see all details, run flutter doctor -v):[âœ“] Flutter (Channel stable, v1.9.1+hotfix.4, on Mac OS X 10.13.6 17G65, locale zh-Hans-CN) [âœ“] Android toolchain - develop for Android devices (Android SDK version 29.0.1)[âœ—] Xcode - develop for iOS and macOS âœ— Xcode installation is incomplete; a full installation is necessary for iOS development. Download at: https://developer.apple.com/xcode/download/ Or install Xcode via the App Store. Once installed, run: sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer âœ— CocoaPods not installed. CocoaPods is used to retrieve the iOS and macOS platform side's plugin code that responds to your plugin usage on the Dart side. Without CocoaPods, plugins will not work on iOS or macOS. For more info, see https://flutter.dev/platform-plugins To install: sudo gem install cocoapods pod setup[âœ“] Android Studio (version 3.5)[!] IntelliJ IDEA Community Edition (version 2019.2.3) âœ— Flutter plugin not installed; this adds Flutter specific functionality. âœ— Dart plugin not installed; this adds Dart specific functionality.[âœ“] VS Code (version 1.38.1)[âœ“] Connected device (1 available)! Doctor found issues in 2 categories. æˆ‘çš„ç”µè„‘è¿è¡Œä¹‹åä¼šå‡ºç°ä¸¤ä¸ªé”™è¯¯ï¼Œå› ä¸ºFlutter doctorä¼šè‡ªåŠ¨æ£€æŸ¥ç”µè„‘ä¸­æ‰€æœ‰èƒ½è¿è¡ŒFlutterçš„ç¼–è¾‘å™¨æˆ–è€…IDEï¼Œç„¶ååˆ¤æ–­ä»–ä»¬é…æ²¡é…ç½®Flutterã€‚æˆ‘çš„ç”µè„‘æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…Xcodeä»¥åŠæˆ‘æ²¡æœ‰åœ¨IDEAä¸­é…ç½®Flutterï¼Œæ‰€ä»¥æˆ‘è¿™ä¸¤é¡¹å‡ºé”™ã€‚ å…¶å®ä½ åªè¦ä¿è¯é™¤äº†IDEä¹‹å¤–çš„é¡¹ç›®éƒ½æ˜¯æ­£å¸¸çš„å°±è¡Œäº†ï¼Œå¦‚æœæœ‰é”™çš„è¯ç›´æ¥æŠŠæŠ¥é”™ä¿¡æ¯æ”¾åˆ°ç™¾åº¦é‡Œé¢è¿›è¡Œæœç´¢å°±å¯ä»¥äº†ã€‚è‡³äºIDEé¡¹ç›®ï¼Œå¦‚æœä½ æ˜¯iOSå¼€å‘è€…ï¼Œåˆ™ä¿è¯Xcodeæˆ–è€…æ˜¯AppCodeå•¥çš„å‰é¢æ˜¯âœ”ï¸å°±è¡Œäº†çš„ï¼Œè‡³äºä½ ç”µè„‘ä¸Šçš„å…¶å®ƒä¾‹å¦‚IDEAæˆ–è€…vscodeå•¥çš„å¯ä»¥ä¸ç”¨ç®¡ï¼›å¦‚æœä½ æ˜¯Androidå¼€å‘è€…ï¼Œåˆ™ä¿è¯ä½ å¸¸ç”¨çš„IDEå¦‚Android Studioå‰é¢æ˜¯âœ”ï¸å°±è¡Œäº†çš„ï¼Œè‡³äºä½ ç”µè„‘ä¸Šçš„å…¶å®ƒä¾‹å¦‚IDEAæˆ–è€…vscodeå•¥çš„å¯ä»¥ä¸ç”¨ç®¡ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œç¡®ä¿é™¤äº†IDEä¹‹å¤–çš„å…¶å®ƒé¡¹å‰é¢æ˜¯å¯¹å‹¾ï¼Œç„¶åç¡®å®šä¸€ä¸ªä½ å¸¸ç”¨çš„å†™ä»£ç çš„å·¥å…·å‰é¢æœ‰å¯¹å‹¾å°±è¡Œäº†ï¼Œå¦‚æœä½ é™¤äº†IDEä¹‹å¤–çš„å…¶å®ƒé¡¹æœ‰é—®é¢˜ï¼Œå°±æŠŠé”™è¯¯ä¿¡æ¯ç›´æ¥ç™¾åº¦ï¼›å¦‚æœæ˜¯ä½ å¸¸ç”¨çš„IDEå‰é¢æ²¡å¯¹å‹¾ï¼Œé‚£å°±ç™¾åº¦ä½ å¸¸ç”¨çš„IDE+Flutteræ¥å‚è€ƒåˆ«äººçš„é…ç½®æ•™ç¨‹ã€‚ ç”±äºæˆ‘æ²¡æœ‰ç”¨è¿‡xcodeæ‰€ä»¥å°±ä¸è®²xcodeå¦‚ä½•é…ç½®Flutteräº†ï¼Œå°±åˆ†åˆ«è®²å¦‚ä½•åœ¨AndroidStudioå’Œvscodeé…ç½®Flutterã€‚ Android Studioé…ç½®Flutter æ‰“å¼€ä½ Android Studioçš„è®¾ç½®/é¦–é€‰é¡¹/Preferencesï¼Œç„¶åé€‰æ‹©Pluginsï¼Œåœ¨Marketplaceé‡Œé¢æœç´¢Flutterï¼š æ¥ç€ç‚¹å‡»INSTALLå®‰è£…å°±è¡Œäº†ï¼Œå¹¶ä¸”å®‰è£…Flutteræ’ä»¶ä¼šè‡ªåŠ¨é¡ºå¸¦å®‰è£…Dartæ’ä»¶ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…Dartæ’ä»¶ï¼Œä½ å°±ä¸€æ ·çš„æœç´¢Dartç„¶åå®‰è£…å³å¯ï¼› å®‰è£…å®Œæˆå¹¶é‡å¯Android Studioä¹‹åï¼Œä»ç„¶æ‰“å¼€è®¾ç½®/é¦–é€‰é¡¹/Preferencesï¼Œé€‰æ‹©Languages &amp; Frameworks-&gt;Flutterï¼Œåœ¨æœ€ä¸Šé¢çš„SDKä¸­çš„Flutter SDK pathé€‰æ‹©ä½ ç¬¬ä¸‰æ­¥Flutter SDKè§£å‹ç¼©çš„è·¯å¾„ï¼Œä¸å‡ºæ„å¤–çš„è¯ä¸‹é¢Versionä¼šè‡ªåŠ¨æ˜¾ç¤ºä½ Flutter SDKçš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”Languages &amp; Frameworks-&gt;Darté‡Œé¢çš„Dart SDK pathä¹Ÿä¼šè‡ªåŠ¨å‡ºç°ã€‚ æ¥ç€å’Œä¹‹å‰ä¸€æ ·è¿è¡Œflutter doctor,çœ‹çœ‹Android Studioå‰é¢æœ‰æ²¡æœ‰âœ”ï¸ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¼šæœ‰çš„ã€‚ vscode é…ç½®Flutter åœ¨vscodeæ‹“å±•é‡Œé¢æœç´¢Flutterå’ŒDartï¼Œå®‰è£…ï¼› æ¥ç€å’Œä¹‹å‰ä¸€æ ·è¿è¡Œflutter doctor,çœ‹çœ‹vscodeå‰é¢æœ‰æ²¡æœ‰âœ”ï¸ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¼šæœ‰çš„ã€‚]]></content>
      <categories>
        <category>Flutter</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ6--æ­»é”]]></title>
    <url>%2Fposts%2F68dc89d4.html</url>
    <content type="text"><![CDATA[6.1 æ­»é”çš„å¼•å…¥åœ¨ä¹‹å‰æˆ‘ä»¬æˆ–å¤šæˆ–å°‘éƒ½æ¶‰åŠåˆ°äº†æ­»é”ï¼Œæœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å“²å­¦å®¶å°±é¤ç­·å­ï¼Œå¦‚æœæ¯ä¸€ä¸ªå“²å­¦å®¶éƒ½æ‹¿èµ·äº†ä»–çš„å³æ‰‹çš„ç­·å­ï¼Œç°åœ¨éƒ½åœ¨ç­‰å·¦è¾¹çš„ç­·å­ã€‚è¿™æ ·ä¸€ç›´ç»•ä¸‹å»ï¼Œä»è€Œäº§ç”Ÿäº†æ­»é”ã€‚ 6.1.1 èµ„æºé—®é¢˜åœ¨ç³»ç»Ÿä¸­å­˜åœ¨ç€å¾ˆå¤šä¸åŒç±»å‹çš„èµ„æºï¼Œå…¶ä¸­å¯ä»¥å¼•èµ·çš„æ­»é”çš„ä¸»è¦æ˜¯éœ€è¦é‡‡ç”¨äº’æ–¥è®¿é—®æ–¹æ³•çš„ã€ä¸å¯ä»¥è¢«æŠ¢å çš„èµ„æºã€ 6.1.1.1 å¯é‡ç”¨æ€§èµ„æºå’Œæ¶ˆè€—æ€§èµ„æºå¯é‡ç”¨æ€§èµ„æºå¯é‡ç”¨æ€§èµ„æºæ˜¯ä¸€ç§å¯ä¾›ç”¨æˆ·é‡å¤ä½¿ç”¨å¤šæ¬¡çš„èµ„æºï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š æ¯ä¸€ä¸ªå¯é‡ç”¨æ€§èµ„æºä¸­çš„å•ä½åªèƒ½åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä¸å…è®¸å¤šä¸ªè¿›ç¨‹å…±äº« è¿›ç¨‹åœ¨ä½¿ç”¨å¯é‡ç”¨æ€§èµ„æºæ—¶ï¼Œé¡»æŒ‰ç…§è¿™æ ·çš„é¡ºåºï¼šè¯·æ±‚èµ„æº -&gt; ä½¿ç”¨èµ„æº -&gt; é‡Šæ”¾èµ„æº ç³»ç»Ÿä¸­æ¯ä¸€ç±»å¯é‡ç”¨æ€§èµ„æºä¸­çš„å•å…ƒæ•°ç›®æ˜¯ç›¸å¯¹å›ºå®šçš„ï¼Œè¿›ç¨‹åœ¨è¿è¡ŒæœŸé—´æ—¢ä¸èƒ½åˆ›å»ºä¹Ÿä¸èƒ½åˆ é™¤å®ƒ å¯æ¶ˆè€—æ€§èµ„æºå¯æ¶ˆè€—æ€§èµ„æºåˆç§°ä¸ºä¸´æ—¶æ€§èµ„æºï¼Œå®ƒæ˜¯åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´ï¼Œç”±è¿›ç¨‹åŠ¨æ€çš„åˆ›å»ºå’Œæ¶ˆè€—çš„ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š æ¯ä¸€ç±»å¯æ¶ˆè€—æ€§èµ„æºçš„å•å…ƒæ•°ç›®åœ¨è¿›ç¨‹è¿è¡ŒæœŸé—´æ˜¯å¯ä»¥ä¸æ–­å˜åŒ–çš„ï¼Œæœ‰æ—¶å®ƒå¯ä»¥æœ‰å¾ˆå¤šï¼Œæœ‰æ—¶å¯èƒ½ä¸º0 è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¸æ–­åœ°åˆ›é€ å¯æ¶ˆè€—æ€§èµ„æºçš„å•å…ƒï¼Œå°†å®ƒä»¬æ”¾å…¥è¯¥èµ„æºç±»çš„ç¼“å†²åŒºä¸­ï¼Œä»¥å¢åŠ è¯¥èµ„æºç±»çš„å•å…ƒæ•°ç›® è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¯·æ±‚è‹¥å¹²ä¸ªå¯æ¶ˆè€—æ€§èµ„æºå•å…ƒï¼Œç”¨äºè¿›ç¨‹è‡ªå·±çš„æ¶ˆè€—ï¼Œä¸å†å°†å®ƒä»¬è¿”å›ç»™è¯¥èµ„æºç±»ä¸­ 6.1.1.2 å¯æŠ¢å æ€§èµ„æºå’Œä¸å¯æŠ¢å æ€§èµ„æºå¯æŠ¢å æ€§èµ„æºå¯æŠŠç³»ç»Ÿä¸­çš„èµ„æºåˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å¯æŠ¢å æ€§èµ„æºï¼Œæ˜¯æŒ‡æŸè¿›ç¨‹åœ¨è·å¾—è¿™ç±»èµ„æºåï¼Œè¯¥èµ„æºå¯ä»¥å†è¢«å…¶å®ƒè¿›ç¨‹æˆ–ç³»ç»ŸæŠ¢å  ä¸å¯æŠ¢å æ€§èµ„æºå¦ä¸€ç±»èµ„æºæ˜¯ä¸å¯æŠ¢å èµ„æºï¼Œä¸€æ—¦ç³»ç»ŸæŠŠæŸèµ„æºåˆ†é…ç»™è¯¥è¿›ç¨‹ä¹‹åï¼Œå°±ä¸èƒ½å°†å®ƒå¼ºè¡Œå›æ”¶ï¼Œåªèƒ½åœ¨è¿›ç¨‹ç”¨å®Œåè‡ªè¡Œé‡Šæ”¾ 6.1.2 æ­»é”çš„èµ·å› 6.1.2.1 ç«äº‰ä¸å¯æŠ¢å æ€§èµ„æºå¼•èµ·çš„æ­»é”é€šå¸¸ç³»ç»Ÿä¸­æ‰€æ‹¥æœ‰çš„ä¸å¯æŠ¢å æ€§èµ„æºå…¶æ•°é‡ä¸è¶³ä»¥æ»¡è¶³å¤šä¸ªè¿›ç¨‹è¿è¡Œçš„éœ€è¦ï¼Œä½¿å¾—è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå› äº‰å¤ºèµ„æºè€Œé™·å…¥åƒµå±€ã€‚ ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œè¿›ç¨‹$P_1$å’Œ$P_2$åœ¨å¹¶å‘æ‰§è¡Œï¼Œä»–ä»¬éƒ½è¦å†™ä¸¤ä¸ªæ–‡ä»¶$F_1$å’Œ$F_2$ã€‚å…¶ä¸­$P_1$å’Œ$P_2$çš„ä»£ç åˆ†åˆ«ä¸ºï¼š 123456789 P1 ....Open(f1, w);Open(f2, w); P2 ....Open(f2, w);Open(f1, w); å¦‚æœè¿™ä¸¤ä¸ªè¿›ç¨‹åœ¨å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œå¦‚æœ$P_1$å…ˆæ‰“å¼€$F_1$å’Œ$F_2$ï¼Œç„¶å$P_2$æ‰å»æ‰“å¼€$F_1$(æˆ–$F_2$)ï¼Œç”±äºæ–‡ä»¶$F_1$(æˆ–$F_2$)å·²ç»è¢«æ‰“å¼€ï¼Œå› æ­¤$P_2$ä¼šè¢«é˜»å¡ã€‚å½“$P_1$ä½¿ç”¨å®Œ$F_1$(æˆ–$F_2$)ï¼Œè¿™æ—¶$P_2$æ‰å¯ä»¥å»æ‰“å¼€$F_1$(æˆ–$F_2$)ï¼Œè¿™æ ·ç¨‹åºç»§ç»­è¿è¡Œä¸‹å»ã€‚ ä½†æ˜¯å¦‚æœåœ¨$P_1$æ‰“å¼€$F_1$çš„åŒæ—¶ï¼Œ$P_2$å»æ‰“å¼€$F_2$ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½å æœ‰ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œæ­¤æ—¶å°±å¯èƒ½å‡ºç°é—®é¢˜ã€‚å› ä¸ºå½“$P_1$è¯•å›¾å»æ‰“å¼€$F_2$,è€Œ$F_2$è¯•å›¾å»æ‰“å¼€$F_1$æ—¶ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½ä¼šå› æ–‡ä»¶å·²è¢«æ‰“å¼€è€Œé˜»å¡ï¼Œå› æ­¤è¿™ä¸¤ä¸ªè¿›ç¨‹å°†ä¼šæ— é™æœŸåœ°ç­‰å¾…ä¸‹å»ï¼Œä»è€Œå½¢æˆæ­»é”ã€‚ 6.1.2.2 ç«äº‰å¯æ¶ˆè€—èµ„æºå¼•èµ·çš„æ­»é”å¦‚å›¾æ‰€ç¤ºï¼Œ$m_1$ã€$m_3$ã€$m_3$æ˜¯å¯æ¶ˆè€—èµ„æºã€‚è¿›ç¨‹$P_1$ä¸€æ–¹é¢äº§ç”Ÿæ¶ˆæ¯$m_1$ï¼Œåˆ©ç”¨send(p2,m1)å°†å®ƒå‘é€ç»™$P_2$ï¼Œå¦ä¸€æ–¹é¢ï¼Œæœ‰è¦æ±‚ä»$P_3$æ¥å—æ¶ˆæ¯$m_2$ï¼›è€Œ$P_2$ã€$P_3$ä¾æ¬¡ç±»æ¨ã€‚ å¦‚æœä¸‰ä¸ªè¿›ç¨‹æŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š 123P1: ...send(p2, m1); receive(p3, m3);...P2: ...send(p3, m2); receive(p1, m1);...P3: ...send(p1, m3); receive(p2, m2);... è¿™ä¸‰ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å…ˆå°†æ¶ˆæ¯å‘é€ç»™ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œç›¸åº”åœ°ä»–ä»¬ä¹Ÿéƒ½èƒ½éƒ½æ¥æ”¶åˆ°ä»ä¸Šä¸€ä¸ªè¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯ï¼Œå› æ­¤ä¸‰ä¸ªè¿›ç¨‹éƒ½å¯ä»¥é¡ºåˆ©çš„è¿›è¡Œä¸‹å»ï¼Œä¸ä¼šå‘ç”Ÿæ­»é”ã€‚ ä½†æ˜¯å¦‚æœä¸‰ä¸ªè¿›ç¨‹éƒ½å…ˆæ‰§è¡Œreceiveï¼Œåœ¨æ‰§è¡Œsendï¼ŒæŒ‰ä¸‹é¢çš„é¡ºåºè¿è¡Œï¼š 123P1: ...receive(p3, m3); send(p2, m1);...P2: ...receive(p1, m1); send(p3, m2);...P3: ...receive(p2, m2); send(p1, m3);... é‚£ä¹ˆè¿™ä¸‰ä¸ªè¿›ç¨‹å°±ä¼šæ°¸è¿œé˜»å¡åœ¨å®ƒä»¬çš„receiveæ“ä½œä¸Šï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ã€‚ 6.2 æ­»é”çš„å®šä¹‰ã€å¿…è¦æ¡ä»¶å’Œå¤„ç†æ–¹æ³•6.2.1 æ­»é”çš„å®šä¹‰å¦‚æœä¸€ç»„è¿›ç¨‹ä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä»…ç”±è¯¥ç»„è¿›ç¨‹ä¸­çš„å…¶å®ƒè¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œé‚£ä¹ˆè¯¥ç»„è¿›ç¨‹æ˜¯æ­»é”çš„ã€‚ 6.2.2 äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶äº§ç”Ÿæ­»é”å¿…é¡»åŒæ—¶å…·å¤‡ä¸‹é¢å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œåªè¦å…¶ä¸­ä»»ä¸€ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿï¼š äº’æ–¥æ¡ä»¶ã€‚è¿›ç¨‹å¯¹æ‰€åˆ†é…çš„èµ„æºè¿›è¡Œæ’ä»–æ€§ä½¿ç”¨ã€‚å³è¯¥èµ„æºåªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå…¶ä»–è¿›ç¨‹å¦‚æœè¯·æ±‚è¯¥èµ„æºåªèƒ½ç­‰å¾…ã€‚ è¯·æ±‚å’Œä¿æŒæ¡ä»¶ã€‚è¿›ç¨‹å·²ç»ä¿æŒä¸€è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œæ–°èµ„æºå·²è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œå¯¼è‡´è¿›ç¨‹è¢«é˜»å¡ã€‚ ä¸å¯æŠ¢å æ¡ä»¶ã€‚ è¿›ç¨‹å·²è·å¾—çš„èµ„æºåœ¨ä¸ºä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«æŠ¢å ï¼Œåªæœ‰è¿›ç¨‹åœ¨ä½¿ç”¨å®Œä¹‹åæ‰èƒ½é‡Šæ”¾ã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹èµ„æºå¾ªç¯é“¾ï¼Œå³è¿›ç¨‹é›†åˆ$[P_0, P_1, P_2, Â·Â·Â·, P_n]$ä¸­$P_0$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_1$å ç”¨çš„èµ„æºï¼Œ$P_1$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_2$å ç”¨çš„èµ„æºï¼Œâ€¦â€¦ï¼Œ$P_n$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_0$å ç”¨çš„èµ„æº 6.2.3 å¤„ç†æ­»é”çš„åŠæ³•ç›®å‰å¤„ç†æ­»é”çš„æ–¹æ³•å¯å½’ç»“ä¸ºå››ç§ï¼š é¢„é˜²æ­»é”ã€‚é€šè¿‡è®¾ç½®æŸäº›é™åˆ¶ï¼Œå»ç ´åäº§ç”Ÿæ­»é”å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªæ¥é¢„é˜²æ­»é”ã€‚ é¿å…æ­»é”ã€‚åœ¨èµ„æºçš„åŠ¨æ€åˆ†é…è¿‡ç¨‹ä¸­ï¼Œç”¨æŸç§æ–¹æ³•é˜»æ­¢ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…å‘ç”Ÿæ­»é”ã€‚ æ£€æµ‹æ­»é”ã€‚è¯¥æ–¹æ³•å…è®¸è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿæ­»é”ï¼Œä½†å¯é€šè¿‡æ£€æµ‹æœºæ„åŠæ—¶åœ°æ£€æµ‹å‡ºæ­»é”çš„å‘ç”Ÿï¼Œç„¶åé‡‡å–é€‚å½“æªæ–½ï¼ŒæŠŠè¿›åŸä»æ­»é”ä¸­è§£è„±å‡ºæ¥ã€‚ è§£é™¤æ­»é”ã€‚å½“æ£€æµ‹åˆ°ç³»ç»Ÿä¸­å·²å‘ç”Ÿæ­»é”æ—¶ï¼Œå°±é‡‡å–ç›¸åº”æªæ–½ï¼Œå°†è¿›ç¨‹ä»æ­»é”çŠ¶æ€ä¸­è§£è„±å‡ºæ¥ã€‚ 6.3 é¢„é˜²æ­»é”é¢„é˜²æ­»é”æ—¶é€šè¿‡ç ´åäº§ç”Ÿæ­»é”å››ä¸ªå¿…è¦æ¡ä»¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªï¼Œä»¥é¿å…å‘ç”Ÿæ­»é”ã€‚ 6.3.1 ç ´åâ€œè¯·æ±‚å’Œä¿æŒâ€æ¡ä»¶å½“ä¸€ä¸ªè¿›ç¨‹åœ¨è¯·æ±‚èµ„æºæ—¶ï¼Œä»–ä¸èƒ½æŒæœ‰ä¸å¯æŠ¢å èµ„æºã€‚å¯é€šè¿‡ä¸€ä¸‹ä¸¤ç§ä¸åŒçš„åè®®å®ç°ï¼š 6.3.1.1 ç¬¬ä¸€ç§åè®®æ‰€æœ‰è¿›ç¨‹åœ¨å¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¿…é¡»ä¸€æ¬¡æ€§åœ°ç”³è¯·å…¶åœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„å…¨éƒ¨èµ„æºã€‚æ­¤æ—¶è‹¥ç³»ç»Ÿä¸­æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™æŸè¿›ç¨‹ï¼Œä¾¿å¯æŠŠå…¶éœ€è¦çš„æ‰€æœ‰èµ„æºåˆ†é…ç»™å®ƒã€‚è¿™æ ·ï¼Œè¯¥è¿›ç¨‹åœ¨æ•´ä¸ªè¿è¡ŒæœŸé—´ï¼Œä¾¿ä¸ä¼šå†æå‡ºèµ„æºè¦æ±‚ï¼Œä»è€Œç ´åäº†â€œè¯·æ±‚â€æ¡ä»¶ã€‚ç³»ç»Ÿåœ¨åˆ†é…èµ„æºæ—¶ï¼Œåªè¦æœ‰ä¸€ç§èµ„æºä¸èƒ½æ»¡è¶³è¿›ç¨‹çš„è¦æ±‚ï¼Œå³ä½¿å…¶æ‰€éœ€çš„å…¶ä»–èµ„æºéƒ½ç©ºé—²ä¹Ÿä¸åˆ†é…ç»™å®ƒï¼Œè€Œè®©è¯¥è¿›ç¨‹ç­‰å¾…ã€‚ç”±äºè¯¥è¿›ç¨‹åœ¨ç­‰å¾…æœŸé—´æœªå æœ‰ä»»ä½•èµ„æºï¼Œäºæ˜¯ç ´åäº†â€œä¿æŒâ€æ¡ä»¶ï¼Œä»è€Œå¯ä»¥é¢„é˜²æ­»é”çš„å‘ç”Ÿã€‚ è¿™ç§åè®®çš„ä¼˜ç‚¹æ˜¯ç®€å•ã€æ˜“è¡Œä¸”å®‰å…¨ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæå…¶æ˜æ˜¾ï¼š èµ„æºè¢«ä¸¥é‡æµªè´¹ï¼Œä¸¥é‡çš„æ¶åŒ–äº†èµ„æºçš„åˆ©ç”¨ç‡ã€‚ ä½¿è¿›ç¨‹ç»å¸¸çš„å‘ç”Ÿé¥¥é¥¿ç°è±¡ã€‚ 6.3.1.2 ç¬¬äºŒç§åè®®è¯¥åè®®æ˜¯å¯¹ç¬¬ä¸€ç§åè®®çš„æ”¹è¿›ï¼Œå®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹åªè·å¾—è¿è¡ŒåˆæœŸæ‰€éœ€çš„èµ„æºåï¼Œä¾¿å¼€å§‹è¿è¡Œã€‚è¿›ç¨‹è¿è¡Œçš„è¿‡ç¨‹ä¸­å†é€æ­¥é‡Šæ”¾å·²åˆ†é…ç»™è‡ªå·±çš„ã€ä¸”å·²ç”¨æ¯•çš„å…¨éƒ¨èµ„æºï¼Œç„¶åå†è¯·æ±‚æ–°çš„æ‰€éœ€èµ„æºã€‚ 6.3.2 ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶ä¸ºäº†èƒ½ç ´åâ€œä¸å¯æŠ¢å â€æ¡ä»¶ï¼Œåè®®ä¸­è§„å®šï¼Œå½“ä¸€ä¸ªå·²ç»ä¿æŒäº†æŸäº›ä¸å¯è¢«æŠ¢å èµ„æºçš„è¿›ç¨‹ï¼Œæå‡ºæ–°çš„èµ„æºè¯·æ±‚è€Œä¸èƒ½å¾—åˆ°æ»¡è¶³æ—¶ï¼Œä»–å¿…é¡»é‡Šæ”¾å·²ç»ä¿æŒçš„æ‰€æœ‰èµ„æºï¼Œå¾…ä»¥åéœ€è¦æ—¶å†é‡æ–°ç”³è¯·ã€‚è¿™æ„å‘³ç€è¿›ç¨‹å·²å æœ‰çš„èµ„æºä¼šè¢«æš‚æ—¶åœ°é‡Šæ”¾ï¼Œæˆ–è€…è¯´æ˜¯è¢«æŠ¢å äº†ï¼Œä»è€Œç ´åäº†â€œä¸å¯æŠ¢å â€æ¡ä»¶ã€‚ 6.3.3 ç ´åâ€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶ä¸€ä¸ªèƒ½ä¿è¯â€œå¾ªç¯ç­‰å¾…â€æ¡ä»¶ä¸æˆç«‹çš„æ–¹æ³•æ˜¯ï¼Œå¯¹ç³»ç»Ÿæ‰€æœ‰èµ„æºç±»å‹è¿›è¡Œçº¿æ€§æ’åºï¼Œå¹¶èµ‹äºˆä¸åŒçš„åºå·ã€‚æ’åºåï¼Œä¾¿å¯ä»¥é‡‡ç”¨è¿™æ ·çš„é¢„é˜²åè®®ï¼šè§„å®šæ¯ä¸ªè¿›ç¨‹å¿…é¡»æŒ‰ç…§åºå·çš„åœ°å€é¡ºåºæ¥è¯·æ±‚èµ„æºã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨å¼€å§‹æ—¶ï¼Œå¯ä»¥è¯·æ±‚èµ„æº$R_i$çš„å•å…ƒï¼Œä»¥åï¼Œå½“ä¸”ä»…å½“$F(R_j)&gt;F(R_i)$ï¼Œè¿›ç¨‹æ‰å¯ä»¥è¯·æ±‚èµ„æº$R_j$ã€‚å¦‚æœéœ€è¦å¤šä¸ªåŒç±»èµ„æºå•å…ƒï¼Œåˆ™å¿…é¡»ä¸€èµ·è¯·æ±‚ã€‚ ä¼˜ç‚¹ï¼šèµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡éƒ½æœ‰æ¯”è¾ƒæ˜æ˜¾çš„æ”¹å–„ã€‚ ç¼ºç‚¹ï¼š ç³»ç»Ÿä¸­å„ç±»èµ„æºæ‰€è§„å®šçš„åºå·å¿…é¡»ç¨³å®šï¼Œè¿™å°±é™åˆ¶äº†æ–°ç±»å‹è®¾å¤‡çš„å¢åŠ  å¯èƒ½ä¼šå‘ç”Ÿä½œä¸šä½¿ç”¨å„ç±»èµ„æºçš„é¡ºåºä¸ç³»ç»Ÿè§„å®šçš„ä¸åŒï¼Œé€ æˆèµ„æºçš„æµªè´¹ã€‚ è¿™ç§æŒ‰ç…§è§„å®šæ¬¡åºç”³è¯·èµ„æºçš„æ–¹æ³•ä¼šé™åˆ¶ç”¨æˆ·ç®€å•ï¼Œè‡ªä¸»çš„ç¼–ç¨‹ã€‚ 6.4 é¿å…æ­»é”6.4.1 ç³»ç»Ÿå®‰å…¨çŠ¶æ€åœ¨æ­»é”é¿å…æ–¹æ³•ä¸­ï¼ŒæŠŠç³»ç»Ÿçš„çŠ¶æ€åˆ†ä¸ºå®‰å…¨çŠ¶æ€å’Œä¸å®‰å…¨çŠ¶æ€ã€‚å½“ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€æ—¶ï¼Œå¯é¿å…å‘ç”Ÿæ­»é”ã€‚åä¹‹ï¼Œå½“ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€æ—¶ï¼Œåˆ™å¯èƒ½è¿›å…¥åˆ°æ­»é”çŠ¶æ€ã€‚ åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå…è®¸è¿›ç¨‹åŠ¨æ€çš„ç”³è¯·èµ„æºå—ï¼Œä½†ç³»ç»Ÿåœ¨è¿›è¡Œèµ„æºåˆ†é…ä¹‹å‰ï¼Œåº”å…ˆè®¡ç®—æ­¤æ¬¡èµ„æºåˆ†é…çš„å®‰å…¨æ€§ã€‚è‹¥æ­¤æ¬¡åˆ†é…ä¸ä¼šå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œæ‰å¯å°†èµ„æºåˆ†é…ç»™è¿›ç¨‹ï¼Œå¦åˆ™ï¼Œå¦è¿›ç¨‹ç­‰å¾…ã€‚ å®‰å…¨çŠ¶æ€æ˜¯æŒ‡ç³»ç»Ÿèƒ½æŒ‰æŸç§è¿›ç¨‹æ¨è¿›é¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…å…¶æ‰€éœ€èµ„æºï¼Œç›´è‡³æ»¡è¶³æ¯ä¸ªè¿›ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚ã€‚å¦‚æœæ— æ³•æ‰¾åˆ°è¿™æ ·ä¸€ä¸ªåºåˆ—ï¼Œåˆ™ç§°ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚ 6.4.2 åˆ©ç”¨é“¶è¡Œå®¶ç®—æ³•é¿å…æ­»é”ä¸ºå®ç°é“¶è¡Œå®¶ç®—æ³•ï¼Œæ¯ä¸€ä¸ªæ–°è¿›ç¨‹åœ¨è¿›å…¥ç³»ç»Ÿæ—¶ï¼Œä»–å¿…é¡»ç”³æ˜åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦æ¯ç§èµ„æºç±»å‹çš„æœ€å¤§å•å…ƒæ•°ç›®ï¼Œå…¶æ•°ç›®ä¸åº”è¶…è¿‡ç³»ç»Ÿæ‰€æ‹¥æœ‰çš„èµ„æºæ€»é‡ã€‚å½“è¿›ç¨‹è¯·æ±‚ä¸€ç»„èµ„æºæ—¶ï¼Œç³»ç»Ÿå¿…é¡»é¦–å…ˆç¡®å®šæ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™è¿›ç¨‹ã€‚è‹¥æœ‰ï¼Œå†è¿›ä¸€æ­¥è®¡ç®—åœ¨å°†è¿™äº›èµ„æºåˆ†é…ç»™è¿›ç¨‹åï¼Œæ˜¯å¦ä¼šä½¿ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚å¦‚æœä¸ä¼šï¼Œæ‰åˆ†é…èµ„æºã€‚ 6.4.2.1 é“¶è¡Œå®¶ç®—æ³•ä¸­çš„æ•°æ®ç»“æ„ å¯åˆ©ç”¨èµ„æºå‘é‡Availableã€‚ä»£è¡¨ç³»ç»Ÿä¸­ç›®å‰å·²æœ‰çš„å¯åˆ†é…çš„è¯¥ç§èµ„æºçš„æœ€å¤§æ•°ã€‚ æœ€å¤§éœ€æ±‚çŸ©é˜µMaxã€‚ä»£è¡¨è¯¥è¿›ç¨‹å¯¹è¯¥èµ„æºçš„æœ€å¤§éœ€æ±‚æ•°ã€‚ åˆ†é…çŸ©é˜µAllocationã€‚ä»£è¡¨ç›®å‰å·²ç»åˆ†é…ç»™è¯¥è¿›ç¨‹çš„è¯¥èµ„æºçš„æ•°ç›®ã€‚ éœ€æ±‚çŸ©é˜µNeedã€‚ä»£è¡¨è¯¥è¿›ç¨‹è¿˜éœ€è¦è¯¥èµ„æºçš„æ•°ç›®ã€‚ 6.4.2.2 é“¶è¡Œå®¶ç®—æ³•è®¾$Request_i$æ˜¯è¿›ç¨‹$P_i$çš„è¯·æ±‚å‘é‡ï¼Œå¦‚æœ$Request_i[j]=K$ï¼Œè¡¨ç¤ºè¿›ç¨‹$P_i$éœ€è¦$K$ä¸ª$R_j$ç±»å‹çš„èµ„æºã€‚å½“$P_i$å‘å‡ºèµ„æºè¯·æ±‚åï¼Œç³»ç»ŸæŒ‰ä¸‹è¿°æ­¥éª¤è¿›è¡Œæ£€æŸ¥ï¼š å¦‚æœ$Request_i[j] \le Need[i, j]$ï¼Œä¾¿è½¬å‘æ­¥éª¤2ï¼›å¦åˆ™ä»»åŠ¡å‡ºé”™ï¼Œå› ä¸ºå®ƒæ‰€éœ€è¦çš„èµ„æºæ•°å·²è¶…è¿‡å®ƒæ‰€å®£å¸ƒçš„æœ€å¤§å€¼ã€‚ å¦‚æœ$Request_i[j] \le Available[j]$ï¼Œä¾¿è½¬å‘æ­¥éª¤3ï¼›å¦åˆ™ï¼Œè¡¨ç¤ºå°šæ— è¶³å¤Ÿèµ„æºï¼Œ$P_i$éœ€ç­‰å¾…ã€‚ ç³»ç»Ÿè¯•æ¢ç€æŠŠèµ„æºåˆ†é…ç»™è¿›ç¨‹$P_i$ï¼Œå¹¶ä¿®æ”¹ä¸‹é¢æ•°æ®ç»“æ„ä¸­çš„æ•°å€¼ï¼š $Available[j] = Available[j] - Request_i[j]$ $Allocation[i,j] = Allocation[i,j] + Request_i[j]$ $Need[i,j] = Need[i,j] - Request_i[j]$ ç³»ç»Ÿæ‰§è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œæ£€æŸ¥æ­¤æ¬¡èµ„æºåˆ†é…åç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ã€‚è‹¥å®‰å…¨ï¼Œæ‰æ­£å¼å°†èµ„æºåˆ†é…ç»™è¿›ç¨‹$P_i$ï¼Œå·²å®Œæˆæœ¬æ¬¡åˆ†é…ï¼›å¦åˆ™ï¼Œå°†æœ¬æ¬¡çš„è¯•æ¢åˆ†é…ä½œåºŸï¼Œæ¢å¤åŸæ¥çš„èµ„æºåˆ†é…çŠ¶æ€ï¼Œè®©è¿›ç¨‹$P_i$ç­‰å¾…ã€‚ 6.4.2.3 å®‰å…¨æ€§ç®—æ³• è®¾ç½®ä¸¤ä¸ªå‘é‡ï¼šâ‘ å·¥ä½œå‘é‡Workï¼Œä»–è¡¨ç¤ºç³»ç»Ÿå¯æä¾›ç»™è¿›ç¨‹ç»§ç»­è¿è¡Œæ‰€éœ€çš„å„ç±»èµ„æºæ•°ç›®ï¼Œå®ƒå«æœ‰mä¸ªå…ƒç´ ï¼Œåœ¨æ‰§è¡Œå®‰å…¨ç®—æ³•å¼€å§‹æ—¶ï¼Œ$Word = Available$ï¼›â‘¡FInishï¼šä»–è¡¨ç¤ºç³»ç»Ÿæ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…ç»™è¿›ç¨‹ï¼Œä½¿ä¹‹è¿è¡Œå®Œæˆã€‚å¼€å§‹æ—¶å…ˆåš$Finish[i] = false$ï¼›å½“æœ‰è¶³å¤Ÿèµ„æºåˆ†é…ç»™è¿›ç¨‹æ—¶ï¼Œå†ä»¤$Finish[i] = true$ã€‚ ä»è¿›ç¨‹é›†åˆä¸­æ‰¾åˆ°ä¸€ä¸ªèƒ½æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„è¿›ç¨‹ï¼šâ‘ $Finish[i]=false$ï¼›â‘¡$Need[i,j] \le Work[j]$ï¼›è‹¥æ‰¾åˆ°åˆ™æ‰§è¡Œæ­¥éª¤3ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤4. è‹¥è¿›ç¨‹$P_i$è·å¾—èµ„æºåï¼Œå¯é¡ºåˆ©æ‰§è¡Œï¼Œç›´è‡³å®Œæˆï¼Œå¹¶é‡Šæ”¾å‡ºåˆ†é…ç»™ä»–çš„èµ„æºï¼Œæ•…åº”æ‰§è¡Œï¼š $Word[j] = Work[j] + Allocation[i,j];$ $Finish[i]=true;$ go to step 2; å¦‚æœæ‰€æœ‰è¿›ç¨‹çš„$Finish[i]=true$éƒ½æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼›å¦åˆ™ï¼Œç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚ 6.4.2.4 é“¶è¡Œå®¶ç®—æ³•ä¾‹å­é¢˜ç›®å‡å®šç³»ç»Ÿä¸­æœ‰äº”ä¸ªè¿›ç¨‹${P_0, P_1, P_2, P_3, P_4}$å’Œä¸‰ç±»èµ„æº${A, B, C}$ï¼Œå„ç§èµ„æºçš„æ•°é‡åˆ†åˆ«ä¸º10ã€5ã€7ï¼Œåœ¨$T_0$æ—¶åˆ»çš„èµ„æºåˆ†é…æƒ…å†µå¦‚å›¾æ‰€ç¤ºï¼š åœ¨$T_0$æ—¶åˆ»çš„å®‰å…¨æ€§åˆ©ç”¨å®‰å…¨æ€§ç®—æ³•å¯¹$T_0$æ—¶åˆ»çš„èµ„æºåˆ†é…æƒ…å†µè¿›è¡Œåˆ†æå¯çŸ¥ï¼Œåœ¨$T_0$æ—¶åˆ»å­˜åœ¨ç€ä¸€ä¸ªå®‰å…¨åºåˆ—${P_1,P_3,P_4,P_2,P_0}$ï¼Œæ•…ç³»ç»Ÿæ˜¯å®‰å…¨çš„ã€‚ $P_1$è¯·æ±‚èµ„æº$P_1$å‘å‡ºè¯·æ±‚å‘é‡$Request_1(1,0,2)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼šâ‘ $Request_1(1,0,2) \le Need_1(1,2,2)$ï¼›â‘¡$Request_1(1,0,2) \le Available_1(3,3,2)$ï¼›â‘¢ç³»ç»Ÿå…ˆå‡å®šå¯ä¸º$P_1$åˆ†é…èµ„æºï¼Œå¹¶ä¿®æ”¹$Avaliable$ï¼Œ$Allocation_1$å’Œ$Need_1$å‘é‡ï¼Œç”±æ­¤å½¢æˆçš„èµ„æºå˜åŒ–æƒ…å†µå¦‚1å›¾ä¸­çš„åœ†æ‹¬å·æ‰€ç¤ºï¼›â‘£å†åˆ©ç”¨å®‰å…¨æ€§ç®—æ³•æ£€æŸ¥æ­¤æ—¶ç³»ç»Ÿæ˜¯å¦å®‰å…¨ï¼Œå¦‚å›¾æ‰€ç¤º æœ‰æ‰€è¿›è¡Œçš„å®‰å…¨æ€§æ£€æŸ¥å¾—çŸ¥ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®‰å…¨åºåˆ—${P_1,P_3,P_4,P_2,P_0}$ã€‚å› æ­¤ï¼Œç³»ç»Ÿæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥ç«‹å³å°†$P_1$æ‰€ç”³è¯·çš„èµ„æºåˆ†é…ç»™å®ƒã€‚ $P_4$è¯·æ±‚èµ„æº$P_4$å‘å‡ºè¯·æ±‚å‘é‡$Request_4(3,3,0)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼šâ‘ $Request_4(3,3,0) \le Need_4(4,3,1)$ï¼›â‘¡$Request_4(3,3,0) \ge Available(2,3,0)$ï¼Œè®©$P_4$ç­‰å¾…ã€‚ $P_0$è¯·æ±‚èµ„æº$P_0$å‘å‡ºè¯·æ±‚å‘é‡$Request_0(0,2,0)$ï¼Œç³»ç»ŸæŒ‰é“¶è¡Œå®¶ç®—æ³•è¿›è¡Œæ£€æŸ¥ï¼šâ‘ $Request_0(0,2,0) \le Need_0(7,4,3)$ï¼›â‘¡$Request_0(0,2,0) \le Available(2,3,0)$ï¼›â‘¢ç³»ç»Ÿæš‚æ—¶å…ˆå‡å®šå¯ä¸º$P_0$åˆ†é…èµ„æºï¼Œå¹¶ä¿®æ”¹æœ‰å…³æ•°æ®ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ è¿›å…¥å®‰å…¨æ€§æ£€æŸ¥å¯ç”¨èµ„æº$Available(2,1,0)$å·²ä¸èƒ½æ»¡è¶³ä»»ä½•è¿›ç¨‹çš„éœ€è¦ï¼Œæ•…ç³»ç»Ÿè¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼Œæ­¤æ—¶ç³»ç»Ÿä¸åˆ†é…èµ„æºã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ5--å¤„ç†æœºè°ƒåº¦]]></title>
    <url>%2Fposts%2F8b4e2673.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 åœ¨å¤šé“ç¨‹åºä¸­ï¼Œè°ƒåº¦çš„å®è´¨æ˜¯ä¸€ç§èµ„æºåˆ†é…ï¼Œå¤„ç†æœºè°ƒåº¦æ˜¯å¯¹å¤„ç†æœºèµ„æºè¿›è¡Œåˆ†é…ã€‚ 5.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡å’Œè°ƒåº¦ç®—æ³•çš„ç›®æ ‡åœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªä½œä¸šä»æäº¤åˆ°è·å¾—å¤„ç†æœºæ‰§è¡Œï¼Œç›´è‡³ä½œä¸šè¿è¡Œå®Œæˆï¼Œå¯èƒ½éœ€è¦ç»å†å¤šæ¬¡å¤„ç†æœºè°ƒåº¦ã€‚ 5.1.1 å¤„ç†æœºè°ƒåº¦çš„å±‚æ¬¡ é«˜çº§è°ƒåº¦ é«˜çº§è°ƒåº¦åˆç§°ä¸ºé•¿ç¨‹è°ƒåº¦æˆ–ä½œä¸šè°ƒåº¦ï¼Œä»–çš„è°ƒåº¦å¯¹è±¡æ˜¯ä½œä¸šã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æŸç§ç®—æ³•ï¼Œå†³å®šå°†å¤–å­˜ä¸Šå¤„äºåå¤‡é˜Ÿåˆ—ä¸­çš„å“ªå‡ ä¸ªä½œä¸šè°ƒå…¥å†…å­˜ã€ä¸ºä»–ä»¬åˆ›å»ºè¿›ç¨‹ï¼Œåˆ†é…å¿…è¦çš„èµ„æºï¼Œå¹¶å°†ä»–ä»¬æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ ä½çº§è°ƒåº¦ ä½çº§è°ƒåº¦åˆç§°ä¸ºçŸ­ç¨‹è°ƒåº¦æˆ–ä½œä¸šè°ƒåº¦ï¼Œä»–çš„è°ƒåº¦å¯¹è±¡æ˜¯è¿›ç¨‹ã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æŸç§ç®—æ³•ï¼Œå†³å®šå°±ç»ªé˜Ÿåˆ—ä¸­å“ªä¸ªè¿›ç¨‹åº”è·å¾—å¤„ç†æœºï¼Œå¹¶ç”±åˆ†æ´¾ç¨‹åºå°†å¤„ç†æœºåˆ†é…ç»™è¢«é€‰ä¸­çš„è¿›ç¨‹ã€‚ ä¸­çº§è°ƒåº¦ ä¸­çº§è°ƒåº¦åˆç§°ä¸ºå†…å­˜è°ƒåº¦ã€‚ä¸»è¦åŠŸèƒ½æ˜¯å°†é‚£äº›æš‚æ—¶ä¸èƒ½è¿è¡Œçš„è¿›ç¨‹ï¼Œè°ƒè‡³å¤–å­˜ç­‰å¾…ï¼Œå½“ä»–ä»¬å…·å¤‡è¿è¡Œæ¡ä»¶ä¸”å†…å­˜åˆç¨æœ‰ç©ºé—²æ—¶å†è°ƒå…¥å†…å­˜ã€‚ 5.1.2 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„ç›®æ ‡5.1.2.1 å¤„ç†æœºè°ƒåº¦ç®—æ³•çš„å…±åŒç›®æ ‡ èµ„æºåˆ©ç”¨ç‡ ç³»ç»Ÿä¸­çš„å¤„ç†æœºå’Œå…¶å®ƒæ‰€æœ‰èµ„æºåº”å°½å¯èƒ½ä¿æŒå¿™ç¢ŒçŠ¶æ€ï¼Œå…¶ä¸­æœ€é‡è¦çš„å¤„ç†æœºåˆ©ç”¨ç‡å¯ç”¨ä»¥ä¸‹æ–¹å¼è®¡ç®—ï¼š $$ CPUçš„åˆ©ç”¨ç‡=\frac{CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´}{CPUæœ‰æ•ˆå·¥ä½œæ—¶é—´+CPUç©ºé—²ç­‰å¾…æ—¶é—´} $$ å…¬å¹³æ€§ ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„è¿›ç¨‹éƒ½åº”è¯¥è·å¾—åˆç†çš„CPUæ—¶é—´ï¼Œä¸ä¼šå‘ç”Ÿè¿›ç¨‹é¥¥é¥¿ç°è±¡ã€‚ï¼Œå¯¹åŒç±»å‹çš„è¿›ç¨‹è·å¾—ç›¸åŒçš„æœåŠ¡ï¼›ä¸åŒç±»å‹çš„è¿›ç¨‹ï¼Œç”±äºç´§æ€¥ç¨‹åº¦ä¸åŒæˆ–è€…é‡è¦æ€§ä¸åŒï¼Œåº”æä¾›ä¸åŒçš„æœåŠ¡ã€‚ å¹³è¡¡æ€§ ç³»ç»Ÿä¸­å¯èƒ½å…·æœ‰å¤šç§ç±»å‹çš„è¿›ç¨‹ï¼Œæœ‰çš„æ˜¯è®¡ç®—å‹ä½œä¸šï¼Œæœ‰çš„æ˜¯I/Oå‹ä½œä¸šã€‚ä¸ºäº†ä½¿CPUå’Œèµ„æºå°½å¯èƒ½çš„å¤„äºå¿™ç¢ŒçŠ¶æ€ï¼Œè°ƒåº¦ç®—æ³•åº”å°½å¯èƒ½çš„ä¿æŒç³»ç»Ÿèµ„æºä½¿ç”¨çš„å¹³è¡¡æ€§ã€‚ ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œ å¯¹æ‰€å®šåˆ¶çš„ç­–ç•¥ï¼Œåªè¦éœ€è¦ï¼Œå°±å¿…é¡»å‡†ç¡®çš„æ‰§è¡Œã€‚ 5.1.2.2 æ‰¹å¤„ç†ç³»ç»Ÿçš„ç›®æ ‡ å¹³å‡å‘¨è½¬æ—¶é—´æ®µ å‘¨è½¬æ—¶é—´ï¼Œæ˜¯æŒ‡ä»ä½œä¸šè¢«æäº¤ç»™ç³»ç»Ÿï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæ¯•æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ å¯¹äºæ¯ä¸ªç”¨æˆ·æ¥è¨€ï¼Œéƒ½å¸Œæœ›è‡ªå·±çš„å‘¨è½¬æ—¶é—´æœ€çŸ­ï¼›ä½†æ˜¯å¯¹äºç³»ç»Ÿæ¥è¨€ï¼Œä»–è¦æ±‚çš„æ˜¯å¹³å‡å‘¨è½¬æ—¶é—´æœ€çŸ­ï¼Œè¿™ä¸ä»…å¯ä»¥æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼Œè€Œä¸”è¿˜å¯ä½¿å¤§å¤šæ•°ç”¨æˆ·éƒ½æ„Ÿåˆ°æ»¡æ„ã€‚ å¯æŠŠå‘¨è½¬æ—¶é—´æè¿°ä¸ºï¼š $$ T=\frac{1}{n}[\sum_{i=1}^{n}{T_i}] $$ ä¸ºäº†è¿›ä¸€æ­¥ååº”è°ƒåº¦çš„æ€§èƒ½ï¼Œæ›´æ¸…æ¥šçš„æè¿°å„è¿›ç¨‹åœ¨å…¶å‘¨è½¬æ—¶é—´ä¸­ï¼Œç­‰å¾…å’Œæ‰§è¡Œæ—¶é—´çš„å…·ä½“åˆ†é…æƒ…å†µï¼Œå¾€å¾€ä½¿ç”¨å¸¦æƒå‘¨è½¬æ—¶é—´ï¼Œå³ä½œä¸šå‘¨è½¬æ—¶é—´Tä¸ç³»ç»Ÿä¸ºä»–æä¾›çš„æ—¶é—´Tsä¹‹æ¯”ï¼Œå³$ W=\frac{T}{T_s} $ï¼Œå¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´å¯è¡¨ç¤ºä¸ºï¼š $$ W = \frac{1}{n}\sum_{i=1}^{n}\frac{T_i}{T_s} $$ ç³»ç»Ÿååé‡é«˜ å¤„ç†æœºåˆ©ç”¨ç‡é«˜ 5.1.2.3 åˆ†æ—¶ç³»ç»Ÿçš„ç›®æ ‡ ç›¸åº”äº‹æ—¶é—´å¿« å“åº”æ—¶é—´æ˜¯æŒ‡ä»ç”¨æˆ·é€šè¿‡é”®ç›˜æäº¤ä¸€ä¸ªè¯·æ±‚å¼€å§‹ï¼Œç›´åˆ°å±å¹•ä¸Šæ˜¾ç¤ºå‡ºå¤„ç†ç»“æœä¸ºä¹‹çš„ä¸€æ®µæ—¶é—´é—´éš”ï¼Œå®ƒåŒ…æ‹¬ä¸‰éƒ¨åˆ†æ—¶é—´ï¼šä¸€æ˜¯è¯·æ±‚ä¿¡æ¯ä»é”®ç›˜è¾“å…¥å¼€å§‹ï¼Œç›´è‡³å°†å…¶ä¼ é€åˆ°å¤„ç†æœºçš„æ—¶é—´ï¼›äºŒæ˜¯å¤„ç†æœºå¯¹è¯·æ±‚ä¿¡æ¯è¿›è¡Œå¤„ç†çš„æ—¶é—´ï¼›ä¸‰æ˜¯å°†æ‰€å½¢æˆçš„çš„å“åº”ä¿¡æ¯å›é€åˆ°ç»ˆç«¯æ˜¾ç¤ºå™¨çš„æ—¶é—´ã€‚ å‡è¡¡æ€§ ç”¨æˆ·å¯¹å“åº”æ—¶é—´çš„è¦æ±‚å¹¶éå®Œå…¨ç›¸åŒã€‚é€šå¸¸ï¼Œç”¨æˆ·å¯¹äºå¤æ‚çš„çš„ä½œä¸šï¼Œå“åº”æ—¶é—´å…è®¸è¾ƒé•¿ï¼›å¯¹äºç®€å•çš„ä½œä¸šï¼Œå“åº”æ—¶é—´åˆ™è¦çŸ­ã€‚ 5.1.2.4 å®æ—¶ç³»ç»Ÿçš„ç›®æ ‡ æˆªæ­¢æ—¶é—´çš„ä¿è¯ æˆªæ­¢æ—¶é—´æ˜¯æŒ‡æŸä»»åŠ¡å¿…é¡»å¼€å§‹æ‰§è¡Œçš„æœ€è¿Ÿæ—¶é—´ï¼Œæˆ–è€…å¿…é¡»å®Œæˆçš„æœ€è¿Ÿæ—¶é—´ã€‚ å¯é¢„æµ‹æ€§ 5.2 ä½œä¸šä¸ä½œä¸šè°ƒåº¦æˆ‘ä»¬å‰é¢è®²åˆ°è¿‡ï¼Œåœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä½œä¸šç”±ç”¨æˆ·æäº¤ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œå†ç”±ç³»ç»Ÿæ“ä½œå‘˜æŠŠä½œä¸šè¾“å…¥ç»™ç›¸åº”çš„è¾“å…¥è®¾å¤‡ï¼Œå¹¶ä¿å­˜åœ¨ä¸€ä¸ªåå¤‡é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°±ç”±ä½œä¸šè°ƒåº¦ç¨‹åºå°†å…¶ä»å¤–å­˜è°ƒå…¥å†…å­˜å†æ¥è¿›è¡Œå¤„ç†ã€‚ 5.2.1 ä½œä¸š5.2.1.1 ä½œä¸šå’Œä½œä¸šæ­¥ ä½œä¸š ä½œä¸šä¸€èˆ¬åŒ…æ‹¬ç¨‹åºè¿˜æ•°æ®ï¼Œè¿˜åº”é…æœ‰ä¸€ä»½ä½œä¸šè¯´æ˜ä¹¦ï¼Œç³»ç»Ÿæ ¹æ®è¯¥è¯´æ˜ä¹¦æ¥å¯¹ç¨‹åºçš„è¿è¡Œè¿›è¡Œæ§åˆ¶ã€‚ ä½œä¸šæ­¥ åœ¨ä½œä¸šè¿è¡ŒæœŸé—´ï¼Œæ¯ä¸ªä½œä¸šéƒ½å¿…é¡»ç»è¿‡è‹¥å¹²ä¸ªç›¸å¯¹ç‹¬ç«‹ï¼Œåˆç›¸äº’å…³è”çš„é¡ºåºåŠ å·¥æ­¥éª¤æ‰èƒ½å¾—åˆ°ç»“æœã€‚æˆ‘ä»¬æŠŠå…¶ä¸­çš„æ¯ä¸€ä¸ªåŠ å·¥æ­¥éª¤ç§°ä¸ºä¸€ä¸ªä½œä¸šæ­¥ã€‚ 5.2.1.2 ä½œä¸šæ§åˆ¶å—JCBä¸ºäº†ç®¡ç†å’Œè°ƒåº¦ä½œä¸šï¼Œåœ¨å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œä¸ºæ¯ä¸ªä½œä¸šè®¾ç½®äº†ä¸€ä¸ªä½œä¸šæ§åˆ¶å—JCBï¼Œå¥¹æ˜¯ä½œä¸šåœ¨ç³»ç»Ÿä¸­å­˜åœ¨çš„æ ‡å¿—ï¼Œå…¶ä¸­ä¿å­˜äº†ç³»ç»Ÿå¯¹ä½œä¸šè¿›è¡Œç®¡ç†å’Œè°ƒåº¦æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚é€šå¸¸å†…å®¹æœ‰ä½œä¸šæ ‡è¯†ã€ç”¨æˆ·åç§°ã€ç”¨æˆ·è´¦å·ã€ä½œä¸šç±»å‹ã€ä½œä¸šçŠ¶æ€ã€è°ƒåº¦ä¿¡æ¯ã€èµ„æºéœ€æ±‚ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ã€‚ 5.2.1.3 ä½œä¸šè¿è¡Œçš„ä¸‰ä¸ªé˜¶æ®µå’Œä¸‰ç§çŠ¶æ€ æ”¶å®¹é˜¶æ®µ æ“ä½œå‘˜æŠŠç”¨æˆ·æäº¤çš„ä½œä¸šé€šè¿‡æŸç§è¾“å…¥æ–¹å¼æˆ–SPOOLingç³»ç»Ÿè¾“å…¥åˆ°ç¡¬ç›˜ä¸Šï¼Œå†ä¸ºæ”¹ä½œä¸šå»ºç«‹PCBï¼Œå¹¶æŠŠå®ƒæ”¾å…¥ä½œä¸šåå¤‡é˜Ÿåˆ—ä¸­ã€‚ä½œä¸šæ­¤æ—¶çš„çŠ¶æ€ä¸ºåå¤‡çŠ¶æ€ è¿è¡Œé˜¶æ®µ å½“ä½œä¸šè¢«ä½œä¸šè°ƒåº¦é€‰ä¸­åï¼Œå˜ä¸ºå®ƒåˆ†é…å¿…è¦çš„èµ„æºå’Œå»ºç«‹è¿›ç¨‹ï¼Œå¹¶å°†å®ƒæ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ä¸€ä¸ªä½œä¸šä»ç¬¬ä¸€æ¬¡è¿›å…¥å°±ç»ªçŠ¶æ€å¼€å§‹ï¼ŒçŸ¥é“ä»–è¿è¡Œç»“æŸå‰ï¼Œéƒ½å¤„äºè¿è¡ŒçŠ¶æ€ å®Œæˆé˜¶æ®µ å½“ä½œä¸šè¿è¡Œå®Œæˆï¼Œæˆ–è€…å‘ç”Ÿå¼‚å¸¸æƒ…å†µæå‰ç»“æŸæ—¶ï¼Œä½œä¸šä¾¿è¿›å…¥å®Œæˆé˜¶æ®µï¼Œç›¸åº”çš„ä½œä¸šçŠ¶æ€ä¸ºâ€œå®ŒæˆçŠ¶æ€â€ã€‚ 5.2.2 ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡ä½œä¸šè°ƒåº¦çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯æ ¹æ®JCBä¸­çš„å†…å®¹ï¼Œæ£€æŸ¥ç³»ç»Ÿä¸­çš„èµ„æºèƒ½å¦æ»¡è¶³ä½œä¸šå¯¹èµ„æºçš„éœ€æ±‚ï¼Œä»¥åŠæŒ‰ç…§ä¸€å®šçš„è°ƒåº¦ç®—æ³•ï¼Œä»å¤–å­˜çš„åå¤‡é˜Ÿåˆ—ä¸­é€‰å–æŸäº›ä½œä¸šè°ƒå…¥å†…å­˜ã€‚å¹¶ä¸ºå®ƒä»¬åˆ›å»ºè¿›ç¨‹ã€åˆ†é…å¿…è¦çš„èµ„æºã€‚ç„¶åå†å°†æ–°åˆ›å»ºçš„è¿›ç¨‹æ’åœ¨å°±ç»ªé˜Ÿåˆ—ä¸Šç­‰å¾…è°ƒåº¦ã€‚å› æ­¤ï¼Œä¹ŸæŠŠä½œä¸šè°ƒåº¦ç§°ä¸ºæ¥çº³è°ƒåº¦ã€‚åœ¨æ¯æ¬¡æ‰§è¡Œä½œä¸šè°ƒåº¦æ—¶ï¼Œéƒ½éœ€è¦åšå‡ºä»¥ä¸‹ä¸¤ä¸ªå†³å®šï¼š æ¥çº³å¤šå°‘ä¸ªä½œä¸š åœ¨æ¯ä¸€æ¬¡ä½œä¸šè°ƒåº¦æ—¶ï¼Œåº”å½“ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰å–å¤šå°‘ä½œä¸šè°ƒå…¥å†…å­˜ï¼Œå–å†³äºå¤šé“ç¨‹åºåº¦ï¼Œå³å…è®¸å¤šå°‘ä¸ªä½œä¸šåŒæ—¶åœ¨å†…å­˜ä¸­è¿è¡Œã€‚ æ¥çº³å“ªäº›ä½œä¸š é€‰æ‹©å“ªäº›ä½œä¸šå–å†³äºï¼Œä½œä¸šè°ƒåº¦é‡‡ç”¨å“ªç§ç®—æ³•ã€‚ 5.3 ä½œä¸šè°ƒåº¦ç®—æ³•5.3.1 å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰ç®—æ³•ç®—æ³•å¯¹äºè¿™ä¸ªç®—æ³•ï¼Œå…«ä¸ªå­—â€”â€”ç®€å•ç²—æš´ï¼Œæ²¡å•¥å¯è®²ã€‚ä½ æ¥çš„æ—©æˆ‘å°±å…ˆæœåŠ¡ä½ ï¼Œå…¶ä»–äººä¸ç®¡å†ç‰›é€¼ä½ æ¥æ™šäº†ä½ å°±æ˜¯å¼Ÿå¼Ÿï¼Œä½ å¾—ç­‰æˆ‘å…ˆæŠŠå‰é¢è¿™ä½æœåŠ¡å¥½äº†å†æ¥æœåŠ¡ä½ ã€‚ 5.3.2 çŸ­ä½œä¸šä¼˜å…ˆï¼ˆSJFï¼‰è°ƒåº¦ç®—æ³•å¯¹äºè¿™ä¸ªç®—æ³•ï¼Œä»–ä¹Ÿæ˜¯åŸºäºå…ˆæ¥å…ˆæœåŠ¡ï¼Œåªæ˜¯å¤šäº†ä¸ªè€ƒè™‘èŒƒå›´ï¼Œå°±æ˜¯åŸåˆ™ä¸Šè¿˜æ˜¯å…ˆåˆ°å…ˆæœåŠ¡ï¼Œä½†æ˜¯å½“æœåŠ¡å®Œä¸€ä¸ªä¹‹åå¹¶ä¸”è¿˜æœ‰å¾ˆå¤šä¸ªå†ç­‰ç€è¢«æœåŠ¡æ—¶ï¼Œå°±ä»ä¸­æ‰¾ä¸€ä¸ªéœ€è¦æœåŠ¡æ—¶é—´æœ€çŸ­çš„å…ˆæ¥æœåŠ¡ï¼ŒæœåŠ¡å®Œä»–äº†ï¼Œåœ¨ä»å‰©ä¸‹çš„æ‰¾ä¸€ä¸ªæœ€çŸ­çš„æ¥æœåŠ¡ã€‚è¿™ä¸ªç®—æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š å¿…é¡»é¢„çŸ¥ä½œä¸šçš„è¿è¡Œæ—¶é—´ å¯¹é•¿ä½œä¸šå¾ˆä¸åˆ© äººæœºæ— æ³•äº¤äº’ æ²¡æœ‰è€ƒè™‘ä½œä¸šæ‰§è¡Œçš„ç´§è¿«æ„Ÿï¼Œå¯¹æ€¥éœ€æœåŠ¡çš„ä½œä¸šä¸ç®¡ 5.3.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆPSAï¼‰åœ¨ä¼˜å…ˆçº§ç®—æ³•ä¸­ï¼ŒåŸºäºä½œä¸šçš„ç´§è¿«ç¨‹åº¦ï¼Œå¤–éƒ¨ä¼šèµ‹äºˆè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œç„¶åä¼˜å…ˆçº§ç®—æ³•å°±æ ¹æ®ç®—æ³•çš„ä¼˜å…ˆçº§ï¼Œè¿›è¡Œè°ƒåº¦ã€‚ç®—æ³•å®è´¨ä¸Šç±»ä¼¼äºçŸ­ä½œä¸šä¼˜å…ˆï¼Œä½ ç”šè‡³å¯ä»¥æŠŠçŸ­ä½œä¸šä¼˜å…ˆçº§ç®—æ³•ä¹Ÿçœ‹åšæ˜¯ä¼˜å…ˆçº§ç®—æ³•ï¼Œåªä¸è¿‡ä»–çš„ä¼˜å…ˆçº§æ˜¯ä½œä¸šé•¿çŸ­ï¼Œè€Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ä¼˜å…ˆçº§æ˜¯è¿›ç¨‹çš„ç´§è¿«ç¨‹åº¦ã€‚ 5.3.4 é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼ˆHRRNï¼‰FCFSç®—æ³•æ˜¯è€ƒè™‘äº†ä½œä¸šçš„ç­‰å¾…æ—¶é—´ï¼Œå´å¿½ç•¥çš„ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼›è€ŒSJFç®—æ³•æ˜¯åªè€ƒè™‘äº†ä½œä¸šçš„è¿è¡Œæ—¶é—´ï¼Œå´å¿½ç•¥äº†ä½œä¸šçš„ç­‰å¾…æ—¶é—´ã€‚é«˜å“åº”æ¯”ç®—æ³•æ˜¯åˆè€ƒè™‘è¿è¡Œæ—¶é—´åˆè€ƒè™‘ç­‰å¾…æ—¶é—´ï¼Œå› æ­¤æ—¢èƒ½ç…§é¡¾çŸ­ä½œä¸šï¼Œåˆä¸è‡´ä½¿é•¿ä½œä¸šçš„ç­‰å¾…æ—¶é—´è¿‡é•¿ã€‚ ä»–ä¸ºæ¯ä¸ªä½œä¸šå¼•å…¥äº†ä¸€ä¸ªåŠ¨æ€ä¼˜å…ˆçº§ï¼Œå³ä¼˜å…ˆçº§æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œå®ƒéšç€ç­‰å¾…æ—¶é—´çš„å»¶é•¿è€Œå¢åŠ ï¼Œè¿™ä½¿å¾—é•¿ä½œä¸šçš„ä¼˜å…ˆçº§åœ¨ç­‰å¾…æœŸé—´ä¸æ–­åœ°å¢åŠ ï¼Œç­‰åˆ°è¶³å¤Ÿçš„æ—¶é—´åï¼Œå¿…ç„¶æœ‰æœºä¼šè·å¾—å¤„ç†æœºã€‚è¿™ä¸ªå˜åŒ–è§„å¾‹å¯æè¿°ä¸ºï¼š$$ ä¼˜å…ˆçº§=\frac{ç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´} $$ ç”±äºç­‰å¾…æ—¶é—´ä¸æœåŠ¡æ—¶é—´ä¹‹å’Œå°±æ˜¯ç³»ç»Ÿå¯¹è¯¥ä½œä¸šçš„å“åº”æ—¶é—´ï¼Œæ•…è¯¥ä¼˜å…ˆçº§åˆç›¸å½“äºå“åº”æ¯”$R_p$ã€‚æ‰€ä»¥ï¼Œä¼˜å…ˆçº§åˆå¯è¡¨ç¤ºä¸ºï¼š$$ R_p=\frac{ç­‰å¾…æ—¶é—´+è¦æ±‚æœåŠ¡æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´}=\frac{å“åº”æ—¶é—´}{è¦æ±‚æœåŠ¡æ—¶é—´} $$ ä»ä¸Šé¢å¯ä»¥çœ‹å‡º å¦‚æœä½œä¸šçš„ç­‰å¾…æ—¶é—´ç›¸åŒï¼Œåˆ™è¦æ±‚æœåŠ¡çš„æ—¶é—´è¶ŠçŸ­ï¼Œä¼˜å…ˆçº§è¶Šé«˜ å½“è¦æ±‚æœåŠ¡æ—¶é—´ç›¸åŒæ—¶ï¼Œä½œä¸šçš„ä¼˜å…ˆçº§å†³å®šäºå…¶ç­‰å¾…æ—¶é—´ å¯¹äºé•¿ä½œä¸šçš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥éšç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæé«˜ 5.4 è¿›ç¨‹è°ƒåº¦5.4.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ã€æœºåˆ¶å’Œæ–¹å¼5.4.1.1 è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡ ä¿å­˜å¤„ç†æœºçš„ç°åœºä¿¡æ¯ åœ¨è¿›è¡Œè°ƒåº¦æ—¶é¦–å…ˆéœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹å¤„ç†æœºçš„ç°åœºä¿¡æ¯ã€‚ æŒ‰æŸç§ç®—æ³•é€‰å–è¿›ç¨‹ è°ƒåº¦ç¨‹åºæŒ‰æŸç§ç®—æ³•ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å–ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å…¶çŠ¶æ€æ”¹ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶å‡†å¤‡æŠŠå¤„ç†æœºåˆ†é…ç»™ä»–ã€‚ æŠŠå¤„ç†æœºåˆ†é…ç»™è¿›ç¨‹ ç”±åˆ†æ´¾ç¨‹åºæŠŠå¤„ç†å™¨åˆ†é…ç»™è¯¥è¿›ç¨‹ï¼Œæ­¤æ—¶éœ€è¦å°†é€‰ä¸­è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—å†…æœ‰å…³å¤„ç†æœºç°åœºçš„ä¿¡æ¯è£…å…¥å¤„ç†å™¨ç›¸åº”çš„å„ä¸ªå¯„å­˜å™¨ä¸­ï¼ŒæŠŠå¤„ç†å™¨çš„æ§åˆ¶æƒäº¤äºˆè¯¥è¿›ç¨‹ï¼Œè®©å®ƒä»ä¸Šæ¬¡çš„æ–­ç‚¹å¤„æ¢å¤è¿è¡Œã€‚ 5.4.1.2 è¿›ç¨‹è°ƒåº¦æœºåˆ¶ä¸ºäº†å®ç°è¿›ç¨‹è°ƒåº¦ï¼Œåœ¨è¿›ç¨‹è°ƒåº¦æœºåˆ¶ä¸­ï¼Œåº”å…·æœ‰å¦‚ä¸‹ä¸‰ä¸ªåŸºæœ¬éƒ¨åˆ†ï¼š æ’é˜Ÿå™¨ä¸ºäº†æé«˜è¿›ç¨‹è°ƒåº¦çš„æ•ˆç‡ï¼Œåº”äº‹å…ˆå°†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥æ’æˆä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ï¼Œä»¥ä¾¿è°ƒåº¦ç¨‹åºèƒ½æœ€å¿«çš„æ‰¾åˆ°å®ƒã€‚ åˆ†æ´¾å™¨åˆ†æ´¾å™¨ä¾æ®è¿›ç¨‹è°ƒåº¦ç¨‹åºæ‰€é€‰å®šçš„è¿›ç¨‹ï¼Œå°†å…¶ä»å°±ç»ªé˜Ÿåˆ—ä¸­å–å‡ºï¼Œç„¶åè¿›è¡Œä»åˆ†æ´¾å™¨åˆ°æ–°é€‰å‡ºè¿›ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™æ–°é€‰å‡ºçš„è¿›ç¨‹ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢å™¨åœ¨å¯¹å¤„ç†æœºè¿›è¡Œåˆ‡æ¢æ—¶ï¼Œä¼šå‘ç”Ÿä¸¤å¯¹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ“ä½œ å¯¹ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼ŒOSå°†ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œå³æŠŠå½“å‰è¿›ç¨‹çš„å¤„ç†æœºå¯„å­˜å™¨çš„å†…å®¹ä¿å­˜åˆ°è¯¥è¿›ç¨‹çš„è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ç›¸åº”å•å…ƒï¼Œå†è£…å…¥åˆ†æ´¾ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œä»¥ä¾¿åˆ†æ´¾ç¨‹åºè¿è¡Œ å¯¹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ç§»é™¤åˆ†æ´¾ç¨‹åºçš„ä¸Šä¸‹æ–‡ï¼Œè€ŒæŠŠæ–°é€‰è¿›ç¨‹çš„CPUç°åœºä¿¡æ¯è£…å…¥åˆ°å¤„ç†æœºçš„å„ä¸ªç›¸åº”å¯„å­˜å™¨ä¸­ï¼Œä»¥ä¾¿æ–°é€‰è¿›ç¨‹è¿è¡Œ 5.4.1.3 è¿›ç¨‹è°ƒåº¦æ–¹å¼ éæŠ¢å æ–¹å¼ åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œä¸€æ—¦å¤„ç†æœºåˆ†æ´¾ç»™ä¸€ä¸ªè¿›ç¨‹åï¼Œå°±ä¸€æ¬¡æ€§ä¸€ç›´å¤„ç†ä¸‹å»ï¼Œç›´åˆ°è¯¥è¿›ç¨‹è¢«å¤„ç†å®Œã€‚ æŠ¢å æ–¹å¼ è¿™ç§è°ƒåº¦æ–¹å¼å…è®¸è°ƒåº¦ç¨‹åºæ ¹æ®æŸç§åŸåˆ™ï¼Œå»æš‚åœæŸä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œå°†å·²åˆ†é…ç»™è¯¥è¿›ç¨‹çš„å¤„ç†æœºé‡æ–°åˆ†é…ç»™å¦ä¸€è¿›ç¨‹ã€‚ å®ƒéµå¾ªçš„ä¸»è¦åŸåˆ™æœ‰ï¼š ä¼˜å…ˆæƒåŸåˆ™ï¼Œä¼˜å…ˆçº§é«˜çš„æ–°åˆ°è¿›ç¨‹æŠ¢å æ­£åœ¨è¿è¡Œçš„ä¼˜å…ˆçº§ä½çš„è¿›ç¨‹ çŸ­è¿›ç¨‹ä¼˜å…ˆåŸåˆ™ï¼Œéœ€è¦è¿è¡Œæ—¶é—´æ›´çŸ­çš„æ–°åˆ°è¿›ç¨‹æŠ¢å æ­£åœ¨è¿è¡Œçš„éœ€è¦è¿è¡Œæ—¶é—´æ›´é•¿çš„è¿›ç¨‹ æ—¶é—´ç‰‡åŸåˆ™ï¼Œå„è¿›ç¨‹æŒ‰æ—¶é—´ç‰‡è½®è½¬è¿è¡Œï¼Œå½“æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹çš„ä¸€ä¸ªæ—¶é—´ç‰‡ç”¨å®Œåï¼Œä¾¿åœæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œè€Œé‡æ–°è¿›è¡Œè°ƒåº¦ 5.4.2 è½®è½¬è°ƒåº¦ç®—æ³•åœ¨åˆ†æ—¶ç³»ç»Ÿä¸­ï¼Œæœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„å°±æ˜¯åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•ã€‚è¯¥ç®—æ³•é‡‡å–äº†éå¸¸å…¬å¹³çš„å¤„ç†æœºåˆ†é…æ–¹å¼ï¼Œå³è®©å°±ç»ªé˜Ÿåˆ—ä¸Šæ¯ä¸ªè¿›ç¨‹æ¯æ¬¡ä»…è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚nä¸ªè¿›ç¨‹æ¯ä¸ªéƒ½è¿è¡Œ$\frac{1}{n}$çš„å¤„ç†æœºæ—¶é—´ã€‚ 5.4.2.1 åŸºæœ¬åŸç†åœ¨RRç®—æ³•ä¸­ï¼Œç³»ç»Ÿæ ¹æ®FCFSç­–ç•¥ï¼Œå°†æ‰€æœ‰çš„å°±ç»ªè¿›ç¨‹æ’æˆä¸€ä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶å¯è®¾ç½®æ¯éš”ä¸€å®šæ—¶é—´é—´éš”å³äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ï¼Œæ¿€æ´»ç³»ç»Ÿä¸­çš„è¿›ç¨‹è°ƒåº¦ç¨‹åºï¼Œå®Œæˆä¸€æ¬¡è°ƒåº¦ï¼Œå°†CPUåˆ†é…ç»™é˜Ÿé¦–è¿›ç¨‹ï¼Œä»¤å…¶æ‰§è¡Œã€‚ 5.4.2.2 è¿›ç¨‹åˆ‡æ¢æ—¶æœº å¦‚æœä¸€ä¸ªæ—¶é—´ç‰‡å°šæœªç”¨å®Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å·²ç»å®Œæˆï¼Œæ­¤æ—¶å¯ä»¥åˆ‡æ¢ åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç”¨å®Œï¼Œæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹è¿˜æœªæ‰§è¡Œå®Œæˆï¼Œè¿™æ—¶ä¹Ÿå¯ä»¥åˆ‡æ¢ 5.4.2.3 æ—¶é—´ç‰‡å¤§å°çš„ç¡®å®šåœ¨RRç®—æ³•ä¸­ï¼Œæ—¶é—´ç‰‡çš„å¤§å°å¯¹ç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚å¦‚æœé€‰æ‹©å¾ˆå°çš„æ—¶é—´ç‰‡ï¼Œæœ‰åˆ©äºçŸ­ä½œä¸šï¼Œå› ä¸ºä»–èƒ½åœ¨è¯¥æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä½†æ—¶é—´ç‰‡å°ï¼Œæ„å‘³ç€ä¼šé¢‘ç¹è°ƒåº¦ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚ å¦‚æœæ—¶é—´ç‰‡é€‰æ‹©å¤ªé•¿ï¼Œè¿™æ ·çš„è¯RRå¯èƒ½ä¼šé€€åŒ–æˆFCFSï¼Œæ— æ³•æ»¡è¶³çŸ­ä½œä¸šå’Œäº¤äº’å¼ç”¨æˆ·çš„éœ€æ±‚ã€‚ 5.4.3 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•åœ¨RRç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å‡è®¾äº†æ‰€æœ‰è¿›ç¨‹çš„ç´§è¿«æ€§æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ã€‚æˆ‘ä»¬ä¸ºäº†æ»¡è¶³å®é™…æƒ…å†µï¼Œåœ¨è¿›ç¨‹è°ƒåº¦ç®—æ³•ä¸­å¼•å…¥äº†ä¼˜å…ˆçº§ï¼Œè€Œå½¢æˆçš„ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚ 5.4.3.1 ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ç±»å‹ éæŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³• æŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³• è¿™å—å’Œå‰é¢è°ƒåº¦ç®—æ³•æ–¹å¼ä¸€æ ·ï¼Œåœ¨æ­¤å°±ä¸å¤šè¯´ã€‚ 5.4.3.2 ä¼˜å…ˆçº§ç±»å‹5.4.3.2.1 é™æ€ä¼˜å…ˆçº§é™æ€ä¼˜å…ˆçº§æ˜¯åœ¨åˆ›å»ºè¿›ç¨‹æ—¶ç¡®å®šçš„ï¼Œåœ¨è¿›ç¨‹çš„æ•´ä¸ªè¿è¡ŒæœŸé—´ä¿æŒä¸å˜ã€‚ä¼˜å…ˆçº§æ˜¯åˆ©ç”¨æŸä¸€èŒƒå›´å†…çš„ä¸€ä¸ªæ•´æ•°æ¥è¡¨ç¤ºçš„ã€‚ç¡®å®šè¿›ç¨‹ä¼˜å…ˆçº§å¤§å°çš„ä¾æ®æœ‰å¦‚ä¸‹ä¸‰ä¸ªï¼š è¿›ç¨‹ç±»å‹ï¼Œé€šå¸¸ç³»ç»Ÿè¿›ç¨‹çš„ä¼˜å…ˆçº§ä¸€èˆ¬é«˜äºç”¨æˆ·è¿›ç¨‹ã€‚ è¿›ç¨‹å¯¹èµ„æºçš„éœ€æ±‚ï¼Œå¯¹èµ„æºè¦æ±‚è¾ƒå°‘çš„è¿›ç¨‹åº”èµ‹äºˆè¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚ ç”¨æˆ·è¦æ±‚ï¼Œæ ¹æ®è¿›ç¨‹çš„ç´§è¿«ç¨‹åº¦åŠç”¨æˆ·æ‰€ä»˜è´¹ç”¨çš„å¤šå°‘ç¡®å®šä¼˜å…ˆçº§ã€‚ é™æ€ä¼˜å…ˆçº§æ³•ç®€å•æ˜“è¡Œï¼Œç³»ç»Ÿå¼€é”€å°ï¼Œä½†æ˜¯ä¸å¤Ÿç²¾ç¡®ï¼Œå¯èƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§ä½çš„è¿›ç¨‹é•¿æœŸæ²¡æœ‰è¢«è°ƒåº¦çš„æƒ…å†µã€‚ 5.4.3.2.2 åŠ¨æ€ä¼˜å…ˆçº§åŠ¨æ€ä¼˜å…ˆçº§æ˜¯æŒ‡è¿›ç¨‹åˆ›å»ºä¹‹åˆï¼Œå…ˆèµ‹äºˆä¸€ä¸ªä¼˜å…ˆçº§ï¼Œç„¶åæ ¹æ®è¿›ç¨‹çš„æ¨è¿›æˆ–ç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæ”¹å˜ï¼Œä»¥ä¾¿è·å¾—æ›´å¥½çš„è°ƒåº¦æ€§èƒ½ã€‚ 5.4.4 å¤šé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ä¹‹å‰æ‰€è¿°çš„å„ç§è°ƒåº¦ç®—æ³•ï¼Œåœ¨åº”ç”¨äºè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œç”±äºç³»ç»Ÿä¸­ä»…è®¾ç½®ä¸€ä¸ªè¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—ï¼Œå³ä½çº§è°ƒåº¦çš„ç®—æ³•æ˜¯å•ä¸€çš„ï¼Œå›ºå®šçš„ï¼Œæ— æ³•æ»¡è¶³ç³»ç»Ÿä¸­ä¸åŒç”¨æˆ·å¯¹è¿›ç¨‹è°ƒåº¦ç­–ç•¥çš„ä¸åŒè¦æ±‚ï¼Œåœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œè¿™ç§å•ä¸€è°ƒåº¦ç­–ç•¥å®ç°æœºåˆ¶ç¼ºç‚¹æ›´åŠ æ˜æ˜¾ã€‚å› æ­¤å¤šçº§é˜Ÿåˆ—ç®—æ³•èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥è¿™ä¸€ç¼ºç‚¹ã€‚ å¤šçº§é˜Ÿåˆ—ç®—æ³•å°†è¿›ç¨‹å°±ç»ªé˜Ÿåˆ—æ‹†åˆ†æˆè‹¥å¹²ä¸ªï¼Œä¸åŒçš„å°±ç»ªé˜Ÿåˆ—é‡‡ç”¨ä¸åŒçš„è°ƒåº¦ç®—ç®—æ³•ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå¥½çš„æ»¡è¶³ä¸åŒç”¨æˆ·å¯¹è¿›ç¨‹è°ƒåº¦ç­–ç•¥çš„ä¸åŒéœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ»¡è¶³å¤šå¤„ç†æœºç³»ç»Ÿçš„éœ€æ±‚ã€‚ 5.4.5 å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•å‰é¢çš„ç®—æ³•éƒ½æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œå¦‚æœæœªæŒ‡æ˜è¿›ç¨‹é•¿åº¦ï¼Œåˆ™çŸ­è¿›ç¨‹ä¼˜å…ˆå’ŒåŸºäºè¿›ç¨‹é•¿åº¦çš„æŠ¢å å¼è°ƒåº¦ç®—æ³•éƒ½å°†æ— æ³•ä½¿ç”¨ã€‚è€Œä¸‹è¿°çš„å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•åˆ™ä¸å¿…äº‹å…ˆçŸ¥é“å„ç§è¿›ç¨‹æ‰€éœ€çš„æ‰§è¡Œæ—¶é—´ï¼Œè¿˜å¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³å„ç§ç±»å‹è¿›ç¨‹çš„éœ€è¦ï¼Œå› è€Œä»–æ˜¯ç›®å‰å…¬è®¤çš„ä¸€ç§è¾ƒå¥½çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•ã€‚ 5.4.5.1 è°ƒåº¦æœºåˆ¶ è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ã€‚åœ¨ç³»ç»Ÿä¸­è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶æœªæ¯ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬äºŒæ¬¡ä¹‹ï¼Œå…¶ä½™é˜Ÿåˆ—çš„ä¼˜å…ˆçº§é€ä¸ªé™ä½ã€‚è¯¥ç®—æ³•ä¸ºä¸åŒé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ‰€èµ‹äºˆçš„æ‰§è¡Œæ—¶é—´ç‰‡çš„å¤§å°ä¹Ÿä¸åŒï¼Œåœ¨ä¼˜å…ˆçº§è¶Šé«˜çš„é˜Ÿåˆ—ä¸­æ—¶é—´ç‰‡è¶Šå°ã€‚ æ¯ä¸ªé˜Ÿåˆ—éƒ½é‡‡ç”¨FCFSç®—æ³•ã€‚å½“æ–°è¿›ç¨‹è¿›å…¥å†…å­˜åï¼Œé¦–å…ˆå°†å®ƒæ”¾å…¥ç¬¬ä¸€é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰FCFSåŸåˆ™ç­‰å¾…è°ƒåº¦ã€‚å½“è½®åˆ°è¯¥è¿›ç¨‹æ—¶ï¼Œå¦‚ä»–èƒ½åœ¨æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¾¿å¯æ’¤ç¦»ç³»ç»Ÿï¼Œå¦åˆ™ï¼Œä»–åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸè¿˜æœªå®Œæˆæ—¶ï¼Œè½¬å…¥ç¬¬äºŒé˜Ÿåˆ—æœ«å°¾ç­‰å¾…ï¼Œä¾æ¬¡ç±»æ¨ã€‚ æŒ‰é˜Ÿåˆ—ä¼˜å…ˆçº§è°ƒåº¦ï¼Œé¦–å…ˆè°ƒåº¦æœ€é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­çš„è¯¸è¿›ç¨‹è¿è¡Œï¼Œä»…å½“ç¬¬ä¸€é˜Ÿåˆ—ç©ºé—²æ—¶æ‰è°ƒåº¦ç¬¬äºŒé˜Ÿåˆ—ã€‚ 5.4.5.2 è°ƒåº¦ç®—æ³•çš„æ€§èƒ½åœ¨å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ä¸­ï¼Œå¦‚æœè§„å®šç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡ç•¥å¤§äºå¤šæ•°äººæœºäº¤äº’ç³»ç»Ÿæ‰€éœ€å¤„ç†æ—¶é—´æ—¶ï¼Œä¾¿èƒ½è¾ƒå¥½çš„æ»¡è¶³å„ç§ç±»å‹ç”¨æˆ·çš„éœ€è¦ã€‚ 5.4.6 åŸºäºå…¬å¹³åŸåˆ™çš„è°ƒåº¦ç®—æ³•5.4.6.1 ä¿è¯è°ƒåº¦ç®—æ³•ä¿è¯è°ƒåº¦ç®—æ³•æ˜¯å¦ä¸€ç§ç±»å‹çš„è°ƒåº¦ç®—æ³•ï¼Œå®ƒæƒ³ç”¨æˆ·æ‰€ä½œå‡ºçš„ä¿è¯å¹¶ä¸æ˜¯ä¼˜å…ˆè¿è¡Œï¼Œè€Œæ˜¯æ˜ç¡®çš„æ€§èƒ½ä¿è¯ï¼Œè¯¥ç®—æ³•å¯ä»¥åšåˆ°è°ƒåº¦çš„å…¬å¹³æ€§ã€‚ä¸€ç§æ¯”è¾ƒå®¹æ˜“çš„æ€§èƒ½ä¿è¯æ˜¯å¤„ç†æœºçš„å…¬å¹³æ€§ï¼Œå¦‚æœåœ¨ç³»ç»Ÿä¸­æœ‰nä¸ªç±»å‹ç›¸åŒçš„è¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œä¸ºäº†å…¬å¹³æœŸé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½è·å¾—ç›¸åŒçš„å¤„ç†æœºæ—¶é—´$\frac{1}{n}$ã€‚ åœ¨å®æ–½ä¿è¯è°ƒåº¦ç®—æ³•æ—¶ï¼Œç³»ç»Ÿå¿…é¡»å…·å¤‡è¿™æ ·ä¸€äº›åŠŸèƒ½ï¼š è·Ÿè¸ªè®¡ç®—æ¯ä¸ªè¿›ç¨‹è‡ªåˆ›å»ºä»¥æ¥å·²ç»æ‰§è¡Œçš„å¤„ç†æ—¶é—´ã€‚ è®¡ç®—æ¯ä¸ªè¿›ç¨‹åº”è·å¾—çš„å¤„ç†æœºæ—¶é—´ï¼Œå³è‡ªåˆ›å»ºä»¥æ¥çš„æ—¶é—´é™¤ä»¥nã€‚ è®¡ç®—è¿›ç¨‹è·å¾—å¤„ç†æœºæ—¶é—´çš„æ¯”ç‡ï¼Œå³è¿›ç¨‹å®é™…æ‰§è¡Œçš„å¤„ç†æ—¶é—´å’Œåº”è·å¾—çš„å¤„ç†æœºæ—¶é—´ä¹‹æ¯”ã€‚ æ¯”è¾ƒå„è¿›ç¨‹è·å¾—å¤„ç†æœºæ—¶é—´çš„æ¯”ç‡ã€‚å¦‚è¿›ç¨‹Açš„æ¯”ç‡æœ€ä½ï¼Œä¸º0.5ï¼Œè€Œè¿›ç¨‹Bçš„æ¯”ç‡ä¸º0.8ï¼Œè¿›ç¨‹Cçš„æ¯”ç‡ä¸º1.2ç­‰ã€‚ è°ƒåº¦ç¨‹åºåº”é€‰æ‹©æ¯”ç‡æœ€å°çš„è¿›ç¨‹å°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œå¹¶è®©è¯¥è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¶…è¿‡æœ€æ¥è¿‘å®ƒçš„è¿›ç¨‹æ¯”ç‡ä¸ºæ­¢ã€‚ 5.4.6.2 å…¬å¹³åˆ†äº«è°ƒåº¦ç®—æ³•åˆ†é…ç»™æ¯ä¸ªè¿›ç¨‹ç›¸åŒçš„å¤„ç†æœºæ—¶é—´ï¼Œæ˜¾ç„¶ï¼Œè¿™å¯¹è¯¸è¿›ç¨‹è€Œè¨€ï¼Œæ˜¯ä½“ç°äº†ä¸€å®šç¨‹åº¦çš„å…¬å¹³ï¼Œä½†å¦‚æœå„ä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰çš„è¿›ç¨‹æ•°ä¸åŒï¼Œå°±ä¼šå‘ç”Ÿå¯¹ç”¨æˆ·çš„ä¸å…¬å¹³é—®é¢˜ã€‚ åœ¨è¯¥ç®—æ³•ä¸­ï¼Œè°ƒåº¦çš„å…¬å¹³æ€§æ˜¯ä½“é’ˆå¯¹äºç”¨æˆ·è€Œè¨€ã€‚ä½¿æ‰€æœ‰çš„ç”¨æˆ·è·å¾—ç›¸åŒçš„å¤„ç†æœºæ—¶é—´ï¼Œæˆ–è¦æ±‚çš„æ—¶é—´æ¯”ä¾‹ã€‚ 5.5 å®æ—¶è°ƒåº¦5.5.1 å®ç°å®æ—¶è°ƒåº¦çš„åŸºæœ¬æ¡ä»¶ æä¾›å¿…è¦çš„ä¿¡æ¯ å°±ç»ªæ—¶é—´ï¼Œæ˜¯æŒ‡æŸä»»åŠ¡ç§°ä¸ºå°±ç»ªçŠ¶æ€çš„æ—¶é—´ï¼Œåœ¨å‘¨æœŸä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¥¹æ˜¯å®ç°é¢„çŸ¥çš„ä¸€ä¸²æ—¶é—´åºåˆ—ã€‚ å¼€å§‹æˆªæ­¢æ—¶é—´å’Œå®Œæˆæˆªæ­¢æ—¶é—´ï¼Œå¯¹äºå…¸å‹çš„å®æ—¶åº”ç”¨ï¼Œåªéœ€çŸ¥é“å¼€å§‹æˆªæ­¢æ—¶é—´æˆ–è€…å®Œæˆæˆªæ­¢æ—¶é—´ å¤„ç†æ—¶é—´ï¼Œä¸€ä¸ªä»»åŠ¡ä»å¼€å§‹æ‰§è¡Œï¼Œç›´è‡³å®Œæˆæ—¶æ‰€éœ€çš„æ—¶é—´ èµ„æºè¦æ±‚ï¼Œä»»åŠ¡æ‰§è¡Œæ—¶æ‰€éœ€è¦çš„ä¸€ç»„èµ„æº ä¼˜å…ˆçº§ï¼Œå¦‚æœæŸä»»åŠ¡çš„å¼€å§‹æˆªæ­¢æ—¶é—´é”™è¿‡ï¼ŒåŠ¿å¿…å¼•èµ·æ•…éšœï¼Œåˆ™åº”ä¸ºè¯¥ä»»åŠ¡èµ‹äºˆâ€œç»å¯¹â€ä¼˜å…ˆçº§ï¼›å¦‚æœå…¶å¼€å§‹æˆªæ­¢æ—¶é—´çš„é”™è¿‡ï¼Œå¯¹ä»»åŠ¡çš„ç»§ç»­è¿è¡Œæ— é‡å¤§å½±å“ï¼Œåˆ™å¯ä¸ºå…¶èµ‹äºˆâ€œç›¸å¯¹ä¼˜å…ˆçº§â€ï¼Œä¾›è°ƒåº¦ç¨‹åºå‚è€ƒ ç³»ç»Ÿå¤„ç†èƒ½åŠ›å¼º åœ¨å®æ—¶ç³»ç»Ÿä¸­ï¼Œè‹¥å¤„ç†æœºçš„å¤„ç†èƒ½åŠ›ä¸å¤Ÿå¼ºï¼Œåˆ™æœ‰å¯èƒ½å› å¤„ç†æœºå¿™ä¸è¿‡ï¼Œè€Œè‡´ä½¿æŸäº›å®æ—¶ä»»åŠ¡ä¸èƒ½å¾—åˆ°åŠæ—¶å¤„ç†ï¼Œä»è€Œå¯¼è‡´å‘ç”Ÿéš¾ä»¥é¢„æ–™çš„åæœã€‚ å‡å®šç³»ç»Ÿä¸­æœ‰mä¸ªå‘¨æœŸæ€§çš„ç¡¬å®æ—¶ä»»åŠ¡HRTï¼Œä»–ä»¬çš„å¤„ç†æ—¶é—´å¯è¡¨ç¤ºä¸º$C_i$ï¼Œå‘¨æœŸæ—¶é—´è¡¨ç¤ºä¸º$P_i$ï¼Œåˆ™åœ¨å•å¤„ç†æœºæƒ…å†µä¸‹ï¼Œå¿…é¡»æ»¡è¶³ä¸‹é¢çš„é™åˆ¶æ¡ä»¶ç³»ç»Ÿæ‰æ˜¯å¯è°ƒåº¦çš„ï¼š$$ \sum_{i=1}^{m}\frac{C_i}{P_i}\le1 $$ æé«˜ç³»ç»Ÿå¤„ç†èƒ½åŠ›çš„é€”å¾„æœ‰äºŒï¼šä¸€æ˜¯é‡‡ç”¨å•å¤„ç†æœºç³»ç»Ÿï¼Œä½†é¡»å¢å¼ºå…¶å¤„ç†èƒ½åŠ›ï¼Œä»¥æ˜¾è‘—åœ°å‡å°‘å¯¹æ¯ä¸€ä¸ªä»»åŠ¡çš„å¤„ç†æ—¶é—´ï¼›äºŒæ˜¯é‡‡ç”¨å¤šå¤„ç†æœºç³»ç»Ÿã€‚å‡å®šç³»ç»Ÿä¸­çš„å¤„ç†æœºæ•°ä¸ºNï¼Œåˆ™åº”å°†ä¸Šè¿°çš„é™åˆ¶æ¡ä»¶æ”¹ä¸ºï¼š$$ \sum_{i=1}^{m}\frac{C_i}{P_i}\le N $$ é‡‡ç”¨æŠ¢å å¼è°ƒåº¦æœºåˆ¶ åœ¨å«æœ‰HRTä»»åŠ¡çš„å®æ—¶ç³»ç»Ÿä¸­ï¼Œå¹¿æ³›é‡‡ç”¨æŠ¢å æœºåˆ¶ã€‚è¿™æ ·ä¾¿å¯æ»¡è¶³HRTä»»åŠ¡å¯¹æˆªæ­¢æ—¶é—´çš„è¦æ±‚ã€‚ä½†è¿™ç§è°ƒåº¦æœºåˆ¶æ¯”è¾ƒå¤æ‚ã€‚ å¯¹äºä¸€äº›å°çš„å®æ—¶ç³»ç»Ÿï¼Œå¦‚æœèƒ½å¤Ÿé¢„çŸ¥ä»»åŠ¡æ³•å¼€å§‹æˆªæ­¢æ—¶é—´ï¼Œåˆ™å¯¹äºå®æ—¶ä»»åŠ¡çš„è°ƒåº¦å¯ä»¥é‡‡ç”¨éæŠ¢å å¼è°ƒåº¦ã€‚ å…·æœ‰å¿«é€Ÿåˆ‡æ¢æœºåˆ¶ ä¸ºä¿è¯ç¡¬å®æ—¶ä»»åŠ¡èƒ½åŠæ—¶è¿è¡Œï¼Œåœ¨ç³»ç»Ÿä¸­è¿˜åº”å…·æœ‰å¿«é€Ÿåˆ‡æ¢æœºåˆ¶ï¼Œä½¿ä¹‹èƒ½è¿›è¡Œä»»åŠ¡çš„å¿«é€Ÿåˆ‡æ¢ã€‚è¯¥æœºåˆ¶åº”å…·æœ‰å¦‚ä¸‹ä¸¤æ–¹é¢çš„èƒ½åŠ›ï¼š å¯¹ä¸­æ–­çš„å¿«é€Ÿå“åº”èƒ½åŠ›ã€‚å¯¹ç´§è¿«çš„å¤–éƒ¨äº‹ä»¶è¯·æ±‚ä¸­æ–­èƒ½åŠæ—¶å“åº”ï¼Œè¦æ±‚ç³»ç»Ÿå…·æœ‰å¿«é€Ÿç¡¬ä»¶ä¸­æ–­æœºæ„ï¼Œè¿˜åº”ä½¿ç¦æ­¢ä¸­æ–­çš„æ—¶é—´é—´éš”å°½é‡çŸ­ï¼Œä»¥å…è€½è¯¯æ—¶æœº(å…¶å®ƒç´§è¿«ä»»åŠ¡)ã€‚ å¿«é€Ÿçš„ä»»åŠ¡åˆ†æ´¾èƒ½åŠ›ã€‚ä¸ºäº†æé«˜åˆ†æ´¾ç¨‹åºè¿›è¡Œä»»åŠ¡åˆ‡æ¢æ—¶çš„é€Ÿåº¦ï¼Œåº”ä½¿ç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿è¡ŒåŠŸèƒ½å•ä½é€‚å½“çš„å°ï¼Œä»¥å‡å°‘ä»»åŠ¡åˆ‡æ¢çš„æ—¶é—´å¼€é”€ã€‚ 5.5.2 å®æ—¶è°ƒåº¦ç®—æ³•çš„åˆ†ç±»5.5.2.1 éæŠ¢å å¼è°ƒåº¦ç®—æ³• éæŠ¢å å¼è½®è½¬è°ƒåº¦ç®—æ³• ç”±ä¸€å°è®¡ç®—æœºæ§åˆ¶è‹¥å¹²ä¸ªç›¸åŒçš„å¯¹è±¡ï¼Œä¸ºæ¯ä¸ªè¢«æ§å¯¹è±¡å»ºç«‹ä¸€ä¸ªå®æ—¶ä»»åŠ¡ã€‚å¹¶å°†ä»–ä»¬æ’æˆä¸€ä¸ªè½®è½¬é˜Ÿåˆ—ã€‚è°ƒåº¦ç¨‹åºæ¯æ¬¡é€‰æ‹©é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æŠ•å…¥è¿è¡Œï¼Œå½“è¯¥ä»»åŠ¡å®Œæˆåï¼Œä¾¿æŠŠå®ƒæŒ‚åœ¨è½®è½¬é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…ï¼Œè°ƒåº¦ç¨‹åºå†é€‰æ‹©ä¸‹ä¸€ä¸ªé˜Ÿé¦–ä»»åŠ¡è¿è¡Œã€‚ éæŠ¢å å¼ä¼˜å…ˆè°ƒåº¦ç®—æ³• å¦‚æœåœ¨ç³»ç»Ÿä¸­è¿˜å«æœ‰å°‘æ•°å…·æœ‰ä¸€å®šè¦æ±‚çš„å®æ—¶ä»»åŠ¡ï¼Œåˆ™å¯é‡‡ç”¨éæŠ¢å å¼ä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼Œç³»ç»Ÿä¸ºè¿™äº›ä»»åŠ¡èµ‹äºˆäº†è¾ƒé«˜çš„ä¼˜å…ˆçº§ã€‚å½“è¿™äº›å®æ—¶ä»»åŠ¡åˆ°è¾¾æ—¶ï¼ŒæŠŠå®ƒä»¬å®‰æ’åœ¨å°±ç»ªé˜Ÿåˆ—çš„é˜Ÿé¦–ï¼Œç­‰å¾…å½“å‰ä»»åŠ¡è‡ªæˆ‘ç»ˆæ­¢æˆ–è¿è¡Œå®Œæˆåï¼Œä¾¿å¯å»è°ƒåº¦æ‰§è¡Œé˜Ÿé¦–çš„é«˜ä¼˜å…ˆçº§è¿›ç¨‹ã€‚ 5.5.2.2 æŠ¢å å¼è°ƒåº¦ç®—æ³• åŸºäºæ—¶é’Ÿä¸­æ–­çš„æŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚ åœ¨æŸå®æ—¶ä»»åŠ¡åˆ°è¾¾åï¼Œå¦‚æœä»–çš„ä¼˜å…ˆçº§é«˜äºå½“å‰ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œè¿™æ˜¯å¹¶ä¸ç«‹å³æŠ¢å å½“å‰ä»»åŠ¡çš„å¤„ç†æœºï¼Œè€Œæ˜¯ç­‰åˆ°æ—¶é’Ÿä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰å‰¥å¤ºå¤§å¹´ä»»åŠ¡çš„æ‰§è¡Œï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚ ç«‹å³æŠ¢å çš„ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚ åœ¨è¿™ç§è°ƒåº¦ç­–ç•¥ä¸­ï¼Œè¦æ±‚æ“ä½œç³»ç»Ÿå…·æœ‰å¿«é€Ÿå“åº”å¤–éƒ¨äº‹ä»¶ä¸­æ–­çš„èƒ½åŠ›ï¼Œä¸€æ—¦å‡ºç°å¤–éƒ¨ä¸­æ–­ï¼Œåªè¦å½“å‰ä»»åŠ¡æœªå¤„äºä¸´ç•ŒåŒºï¼Œä¾¿èƒ½ç«‹å³å‰¥å¤ºå½“å‰ä»»åŠ¡çš„æ‰§è¡Œï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™è¯·æ±‚ä¸­æ–­çš„ç´§è¿«ä»»åŠ¡ã€‚ 5.5.3 æœ€æ—©æˆªæ­¢æ—¶é—´ä¼˜å…ˆè¯¥ç®—æ³•æ˜¯æ ¹æ®ä»»åŠ¡æˆªæ­¢æ—¶é—´ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œä»»åŠ¡çš„æˆªæ­¢æ—¶é—´è¶Šæ—©ï¼Œå…¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå…·æœ‰æœ€æ—©æˆªæ­¢æ—¶é—´çš„ä»»åŠ¡æ’åœ¨é˜Ÿé¦–ã€‚ 5.5.3.1 éæŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡ 5.5.3.2 æŠ¢å å¼è°ƒåº¦æ–¹å¼ç”¨äºéå‘¨æœŸå®æ—¶ä»»åŠ¡ 5.5.4 æœ€ä½æ¾å¼›åº¦ä¼˜å…ˆLLFç®—æ³•è¯¥ç®—æ³•åœ¨ç¡®å®šä»»åŠ¡çš„ä¼˜å…ˆçº§æ—¶ï¼Œæ ¹æ®çš„æ˜¯ä»»åŠ¡çš„ç´§æ€¥(æˆ–æ¾å¼›)ç¨‹åº¦ã€‚ä»»åŠ¡ç´§æ€¥ç¨‹åº¦æ„ˆé«˜ï¼Œèµ‹äºˆè¯¥ä»»åŠ¡çš„ä¼˜å…ˆçº§å°±æ„ˆé«˜ï¼Œä»¥ä½¿ä¹‹ä¼˜å…ˆæ‰§è¡Œã€‚ è¯¥æ–¹å¼ä¸»è¦ç”¨å¯æŠ¢å å¼è°ƒåº¦ã€‚ å‡å¦‚åœ¨ä¸€ä¸ªå®æ—¶ç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªå‘¨æœŸæ€§å®æ—¶ä»»åŠ¡Aå’ŒBï¼Œä»»åŠ¡Aè¦æ±‚æ¯20 msæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶é—´ä¸º10 msï¼Œä»»åŠ¡Bè¦æ±‚æ¯50 msæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶é—´ä¸º25 msã€‚ç”±æ­¤å¯çŸ¥ï¼Œä»»åŠ¡Aå’ŒBæ¯æ¬¡å¿…é¡»å®Œæˆçš„æ—¶é—´åˆ†åˆ«ä¸ºï¼šA1ã€A2ã€A3ã€â€¦å’ŒB1ã€B2ã€B3ã€â€¦ï¼Œå¦‚ä¸‹å›¾ åˆ©ç”¨ELLFç®—æ³•è¿›è¡Œè°ƒåº¦çš„æƒ…å†µï¼š]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚1--HttpClientä¸HttpURLConnection]]></title>
    <url>%2Fposts%2Feb898689.html</url>
    <content type="text"><![CDATA[åœ¨æ—©æœŸçš„æ—¶å€™ï¼ŒAndroidä¸Šè¿˜æ²¡æœ‰åƒVolleyã€OkHttpã€Retrofitè¿™äº›ä¼˜ç§€çš„å¼€æºåº“ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå°±åªèƒ½è‡ªå·±å°è£…HttpClientå’ŒHttpURLConnectionã€‚ç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹ä¸‹Apacheçš„è¿™ä¸¤ä¸ªç±»ã€‚ 1. HttpClient2.1 å¯¼å…¥HttpClientç”±äºä»Android 6.0 å¼€å§‹ï¼Œè°·æ­Œå°±å°†HttpClientä»Androidä¸­åˆ é™¤äº†ï¼Œæ‰€ä»¥è‹¥ç°åœ¨æƒ³ä½¿ç”¨ä»–ï¼Œè¿˜å¾—å¯¼å…¥ä¾èµ–ï¼šåœ¨é¡¹ç›®çš„build.gradleçš„Androidä»£ç å—ä¸‹åŠ å…¥ä¾èµ–ï¼Œç¤ºä¾‹ï¼š 1234android &#123; useLibrary 'org.apache.http.legacy' ...&#125; 2.2 HttpClientçš„Geté¦–å…ˆé€šè¿‡DefaultHttpClientæ¥å®ä¾‹åŒ–ä¸€ä¸ªHttpClientï¼Œå¹¶é…ç½®å¥½å‚æ•°ï¼š 123456789101112131415 //åˆ›å»ºHttpClientprivate HttpClient createHttpClient() &#123; HttpParams mDefaultHttpParams = new BasicHttpParams(); //è®¾ç½®è¿æ¥è¶…æ—¶ HttpConnectionParams.setConnectionTimeout(mDefaultHttpParams, 15000); //è®¾ç½®è¯·æ±‚è¶…æ—¶ HttpConnectionParams.setSoTimeout(mDefaultHttpParams, 15000); HttpConnectionParams.setTcpNoDelay(mDefaultHttpParams, true); HttpProtocolParams.setVersion(mDefaultHttpParams, HttpVersion.HTTP_1_1); HttpProtocolParams.setContentCharset(mDefaultHttpParams, HTTP.UTF_8); //æŒç»­æ¡æ‰‹ HttpProtocolParams.setUseExpectContinue(mDefaultHttpParams, true); HttpClient mHttpClient = new DefaultHttpClient(mDefaultHttpParams); return mHttpClient;&#125; æ¥ç€åˆ›å»ºHttpGetå’ŒHttpClientï¼Œè¯·æ±‚ç½‘ç»œå¹¶å¾—åˆ°HttpResponseï¼Œå¹¶å¯¹HttpResponseè¿›è¡Œå¤„ç†ï¼š 123456789101112131415161718private void useHttpClientGet(String url) &#123; HttpGet mHttpGet = new HttpGet(url); mHttpGet.addHeader("Connection", "Keep-Alive"); try &#123; HttpClient mHttpClient = createHttpClient(); HttpResponse mHttpResponse = mHttpClient.execute(mHttpGet); HttpEntity mHttpEntity = mHttpResponse.getEntity(); int code = mHttpResponse.getStatusLine().getStatusCode(); if (null != mHttpEntity) &#123; InputStream mInputStream = mHttpEntity.getContent(); String respose = converStreamToString(mInputStream); Log.i("wangshu", "è¯·æ±‚çŠ¶æ€ç :" + code + "\nè¯·æ±‚ç»“æœ:\n" + respose); mInputStream.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; converStreamToString()æ–¹æ³•å°†è¯·æ±‚ç»“æœè½¬æ¢æˆStringç±»å‹ï¼š 12345678910private String converStreamToString(InputStream is) throws IOException &#123; BufferedReader reader = new BufferedReader(new InputStreamReader(is)); StringBuffer sb = new StringBuffer(); String line = null; while ((line = reader.readLine()) != null) &#123; sb.append(line + "\n"); &#125; String respose = sb.toString(); return respose;&#125; æœ€åå¼€å¯çº¿ç¨‹è®¿é—®: 123456new Thread(new Runnable() &#123; @Override public void run() &#123; useHttpClientGet("http://www.baidu.com"); &#125;&#125;).start(); 1.3 HttpClientçš„POSTå’ŒGETå·®ä¸å¤šï¼Œåªéœ€è¦ä¿®æ”¹ä¼ é€’çš„å‚æ•°ï¼š 1234567891011121314151617181920212223private void useHttpClientPost(String url) &#123; HttpPost mHttpPost = new HttpPost(url); mHttpPost.addHeader("Connection", "Keep-Alive"); try &#123; HttpClient mHttpClient = createHttpClient(); List&lt;NameValuePair&gt; postParams = new ArrayList&lt;&gt;(); //è¦ä¼ é€’çš„å‚æ•° postParams.add(new BasicNameValuePair("username", "moon")); postParams.add(new BasicNameValuePair("password", "123")); mHttpPost.setEntity(new UrlEncodedFormEntity(postParams)); HttpResponse mHttpResponse = mHttpClient.execute(mHttpPost); HttpEntity mHttpEntity = mHttpResponse.getEntity(); int code = mHttpResponse.getStatusLine().getStatusCode(); if (null != mHttpEntity) &#123; InputStream mInputStream = mHttpEntity.getContent(); String respose = converStreamToString(mInputStream); Log.i("wangshu", "è¯·æ±‚çŠ¶æ€ç :" + code + "\nè¯·æ±‚ç»“æœ:\n" + respose); mInputStream.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; 2. HttpURLConnectionHttpURLConnectionè¾ƒHttpClientæ¥è¯´æ›´è½»é‡ï¼Œè€Œä¸”ä»–APIä¹Ÿæ¯”HttpClientç®€å•ã€‚ç‰¹åˆ«æ˜¯Android 6.0å°†HttpClientç§»é™¤ä¹‹åï¼Œç°åœ¨åªèƒ½ä½¿ç”¨HttpURLConnectionã€‚ 2.1 HttpURLConnectionçš„POSTè¯·æ±‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUrlConnManagerç±»ï¼Œç„¶åé‡Œé¢æä¾›getHttpURLConnection()æ–¹æ³•ç”¨äºé…ç½®é»˜è®¤çš„å‚æ•°å¹¶è¿”å›HttpURLConnectionï¼š 12345678910111213141516171819202122public static HttpURLConnection getHttpURLConnection(String url)&#123; HttpURLConnection mHttpURLConnection=null; try &#123; URL mUrl=new URL(url); mHttpURLConnection=(HttpURLConnection)mUrl.openConnection(); //è®¾ç½®é“¾æ¥è¶…æ—¶æ—¶é—´ mHttpURLConnection.setConnectTimeout(15000); //è®¾ç½®è¯»å–è¶…æ—¶æ—¶é—´ mHttpURLConnection.setReadTimeout(15000); //è®¾ç½®è¯·æ±‚å‚æ•° mHttpURLConnection.setRequestMethod("POST"); //æ·»åŠ Header mHttpURLConnection.setRequestProperty("Connection","Keep-Alive"); //æ¥æ”¶è¾“å…¥æµ mHttpURLConnection.setDoInput(true); //ä¼ é€’å‚æ•°æ—¶éœ€è¦å¼€å¯ mHttpURLConnection.setDoOutput(true); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return mHttpURLConnection ;&#125; å› ä¸ºæˆ‘ä»¬è¦å‘é€POSTè¯·æ±‚ï¼Œæ‰€ä»¥åœ¨UrlConnManagerç±»ä¸­å†å†™ä¸€ä¸ªpostParams()æ–¹æ³•ç”¨æ¥ç»„ç»‡ä¸€ä¸‹è¯·æ±‚å‚æ•°å¹¶å°†è¯·æ±‚å‚æ•°å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼š 123456789101112131415public static void postParams(OutputStream output,List&lt;NameValuePair&gt;paramsList) throws IOException&#123; StringBuilder mStringBuilder=new StringBuilder(); for (NameValuePair pair:paramsList)&#123; if(!TextUtils.isEmpty(mStringBuilder))&#123; mStringBuilder.append("&amp;"); &#125; mStringBuilder.append(URLEncoder.encode(pair.getName(),"UTF-8")); mStringBuilder.append("="); mStringBuilder.append(URLEncoder.encode(pair.getValue(),"UTF-8")); &#125; BufferedWriter writer=new BufferedWriter(new OutputStreamWriter(output,"UTF-8")); writer.write(mStringBuilder.toString()); writer.flush(); writer.close();&#125; æ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨postParams()æ–¹æ³•å°†è¯·æ±‚çš„å‚æ•°ç»„ç»‡å¥½ä¼ ç»™HttpURLConnectionçš„è¾“å‡ºæµï¼Œè¯·æ±‚è¿æ¥å¹¶å¤„ç†è¿”å›çš„ç»“æœï¼š 12345678910111213141516171819private void useHttpUrlConnectionPost(String url) &#123; InputStream mInputStream = null; HttpURLConnection mHttpURLConnection = UrlConnManager.getHttpURLConnection(url); try &#123; List&lt;NameValuePair&gt; postParams = new ArrayList&lt;&gt;(); //è¦ä¼ é€’çš„å‚æ•° postParams.add(new BasicNameValuePair("username", "moon")); postParams.add(new BasicNameValuePair("password", "123")); UrlConnManager.postParams(mHttpURLConnection.getOutputStream(), postParams); mHttpURLConnection.connect(); mInputStream = mHttpURLConnection.getInputStream(); int code = mHttpURLConnection.getResponseCode(); String respose = converStreamToString(mInputStream); Log.i("wangshu", "è¯·æ±‚çŠ¶æ€ç :" + code + "\nè¯·æ±‚ç»“æœ:\n" + respose); mInputStream.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;&#125; æœ€åå¼€å¯çº¿ç¨‹è¯·æ±‚ç½‘ç»œï¼š 12345678private void useHttpUrlConnectionGetThread() &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; useHttpUrlConnectionPost("http://www.baidu.com"); &#125; &#125;).start();&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>Volley</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ijkPlayerç¼–è¯‘-Android]]></title>
    <url>%2Fposts%2Fd61d5542.html</url>
    <content type="text"><![CDATA[1. ç®€ä»‹ijkplayeræ˜¯å“”å“©å“”å“©çš„ä¸€ä¸ªå¼€æºè§†é¢‘æ’­æ”¾æ¡†æ¶ï¼Œæ”¯æŒAndroidã€iOSã€‚åº•å±‚æ˜¯ffplayã€‚ Githubåœ°å€ï¼šbilibili/ijkplayer 2. ç¼–è¯‘æ–¹æ³•ç”±äºé€šè¿‡Gradleç¼–è¯‘èµ·æ¥å¾ˆæ…¢è€Œä¸”ä¸€æ—¦å¤±è´¥åˆå¾—é‡å¤´æ¥ï¼Œæ‰€ä»¥è¿™å—å°±ä½¿ç”¨AndroidNDKçš„æ–¹å¼æ¥ç¼–è¯‘ã€‚ 2.1 ç¼–è¯‘ä¹‹å‰é¦–å…ˆä½ å¾—é…ç½®å¥½ç­‰ä¼šç¼–è¯‘éœ€è¦çš„ä¸œè¥¿ã€‚è¿™å—æˆ‘ä»¬éƒ½ä¼šä½¿ç”¨Homebrewæ¥å®‰è£…gitå’Œyasmã€‚Homebrewç±»ä¼¼äºUbuntuçš„dpkgã€RedHatå’ŒcentOSçš„yumï¼Œä»–æ˜¯macOSä¸Šçš„ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚ä½†æ˜¯åæ¥å‡ºäº†Linuxç‰ˆã€‚ç”±äºijkplayerå®˜æ–¹è¯´ç”¨çš„å®ƒï¼Œé‚£å’±ä»¬å°±ç”¨å®ƒå§ã€‚ Ubuntu1. å…ˆæŠŠç›®å‰å·²æœ‰çš„åŒ…æ›´æ–°12345678// ä»é•œåƒç«™ä¸‹è½½è½¯ä»¶åˆ—è¡¨ï¼Œå¹¶æ£€æŸ¥æœ‰æ²¡æœ‰éœ€è¦æ›´æ–°çš„åŒ…sudo apt update// æ›´æ–°éœ€è¦æ›´æ–°çš„åŒ…sudo apt upgrade// è‡ªåŠ¨å¸è½½æ‰å½“åˆä¸ºäº†å®‰è£…å…¶ä»–è½¯ä»¶æˆ–å…¶ä»–åŸå› è€Œå®‰è£…ä½†æ˜¯ç›®å‰å·²ç»æ²¡ç”¨çš„åŒ…sudo apt autoremove 2. å®‰è£…Homebrew1234567891. é¦–å…ˆç¡®å®šæ˜¯å¦å®‰è£…ruby apt install ruby' 2. ç„¶åé€šè¿‡rubyå®‰è£…Homebrew ruby -c "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install.sh)" 3. å†é€šè¿‡Homebrewå®‰è£…gitå’Œyasm brew install git brew install yasm 3. é…ç½®Android SDKå’ŒNDK Android SDK ä½ å¯ä»¥æ‰“å¼€ä½ çš„AndroidStudioï¼Œè¿›å…¥Preferences -&gt; Appearance &amp; Behavior -&gt; System Settings -&gt; Android SDKã€‚è¿™å—å°±ä¼šæ˜¾ç¤ºä½ SDKå®‰è£…ç›®å½•ã€‚ ç„¶ååœ¨ç»ˆç«¯ä¸­è¾“å…¥vim ~/.bash_profileã€‚ç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š 123export ANDROID_SDK_HOME=AndroidSDKçš„ç›®å½•/android-sdk-linuxexport PATH=$PATH:$&#123;ANDROID_SDK_HOME&#125;/toolsexport PATH=$PATH:$&#123;ANDROID_SDK_HOME&#125;/platform-tools ä¿å­˜ï¼Œç„¶åå†åœ¨ç»ˆç«¯è¾“å…¥source ~/.bash_profileï¼Œå°±å¯ä»¥äº†ã€‚ Android NDK é¦–å…ˆä½ å¾—åˆ°å®˜ç½‘ä¸‹è½½NDKï¼šNDK å½’æ¡£ã€‚è€Œä¸”ä½ åªèƒ½ä¸‹è½½r10eç‰ˆæœ¬çš„ï¼Œä¸‹è½½å…¶å®ƒç‰ˆæœ¬ç¼–è¯‘ä¼šæŠ¥é”™ã€‚ ä¸‹è½½ä¸‹æ¥è§£å‹åï¼ŒåŒæ ·å’Œä¸Šé¢ä¸€æ ·å¾—é…ç½®ç¯å¢ƒå˜é‡ï¼š 12export ANDROID_NDK_HOME=NDKç›®å½•export PATH=$PATH:$&#123;ANDROID_SDK_HOME&#125; ä¿å­˜ï¼Œç„¶åå†åœ¨ç»ˆç«¯è¾“å…¥source ~/.bash_profileï¼Œå°±å¯ä»¥äº†ã€‚ macOSå®‰è£…Homebrewï¼Œç”±äºmacOSè‡ªå¸¦rubyï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¯ä»¥å¼€å§‹å®‰è£…Homebrewã€‚ 123ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"brew install gitbrew install yasm ç„¶åå°±æ˜¯é…ç½®ä½ çš„Android SDKå’ŒAndroid NDKï¼šå’Œä¸Šé¢Ubuntuä¸‹ä¸€æ ·ã€‚ 2.2 ç¼–è¯‘Android12345678910111213git clone https://github.com/Bilibili/ijkplayer.git ijkplayer-androidcd ijkplayer-androidgit checkout -B latest k0.8.8./init-android.shcd android/contrib./compile-ffmpeg.sh clean// è¿™æ­¥ç‰¹æ…¢ï¼Œè€—æ—¶å¾ˆé•¿./compile-ffmpeg.sh allcd .../compile-ijk.sh all ä¸Šé¢è¿™äº›æ‰§è¡Œå®Œå°±å¯ä»¥äº†ã€‚ç„¶åä½ å°±èƒ½åœ¨ä½ çš„/ijkplayer-android/android/ijkplayerè·¯å¾„ä¸‹å°±èƒ½çœ‹åˆ°ç¼–è¯‘åçš„é¡¹ç›®äº†ï¼Œå…¶ä¸­æ¯ä¸ªmoduleçš„/src/mian/libsé‡Œé¢å°±æ˜¯soæ–‡ä»¶ã€‚ 3. æœ€åä½ å¯ä»¥ç›´æ¥é€šè¿‡AndroidStudioæ‰“å¼€/ijkplayer-android/android/ijkplayerï¼Œç„¶ååœ¨é‡Œé¢çš„/ijkplayer-exampleä¸‹è°¢ä½ è‡ªå·±çš„ä»£ç å°±å¯ä»¥äº†ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>ijkplayer</tag>
        <tag>éŸ³è§†é¢‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚4--è§£æRetrofitæºç ]]></title>
    <url>%2Fposts%2Fa2a8de56.html</url>
    <content type="text"><![CDATA[1. Retrofitç®€ä»‹ Retrofit - github Retrofit - Doc Retrofitæ˜¯Squareå…¬å¸çš„åˆä¸€åŠ›ä½œï¼Œé’ˆå¯¹Androidç½‘ç»œè¯·æ±‚çš„æ¡†æ¶ï¼Œéµå¾ªRestfulè®¾è®¡é£æ ¼ï¼Œåº•å±‚åŸºäºOkHttpã€‚ ä»–å¯¹æ¯”å…¶ä»–æ¡†æ¶ æ€§èƒ½æœ€å¥½ å°è£…ç¨‹åº¦é«˜ï¼Œæ‹“å±•æ€§å·® ç®€ä»‹æ˜“ç”¨ï¼Œä»£ç ç®€å• è§£è€¦å½»åº• å¯ä»¥éå¸¸æ–¹ä¾¿çš„ä¸RxJavaè¿ç”¨ 2. Retrofitç”¨æ³•ï¼ˆå¼‚æ­¥ï¼‰2.1 æ·»åŠ ä¾èµ–å¯ä»¥åœ¨Retrofit Githubåº“é¡µé¢é‡Œé¢æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬å·ï¼Œæˆ‘å†™è¿™ç¯‡åšå®¢æ—¶æœ€æ–°ç‰ˆå¯¼å…¥æ–¹å¼ åœ¨ä½ é¡¹ç›®çš„appçš„build.gradleé‡Œé¢æ·»åŠ implementation &#39;com.squareup.retrofit2:retrofit:2.6.1&#39; åŒæ—¶ï¼Œå¦‚æœä½ éœ€è¦é…å¥—çš„æ•°æ®è½¬æ¢å™¨è¿˜éœ€è¦å¯¼å…¥ä»¥ä¸‹çš„ä¾èµ– Gson: com.squareup.retrofit2:converter-gson Jackson: com.squareup.retrofit2:converter-jackson Moshi: com.squareup.retrofit2:converter-moshi Protobuf: com.squareup.retrofit2:converter-protobuf Wire: com.squareup.retrofit2:converter-wire Simple XML: com.squareup.retrofit2:converter-simplexml Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars 2.2 æ·»åŠ ç½‘ç»œæƒé™åœ¨ä½ APPçš„AndroidManifest.xmlé‡Œæ·»åŠ &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt; 2.3 åˆ›å»º æ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ® çš„ç±»Reception.java 1234puublic class Reception &#123; // æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œæ•°æ®è§£ææ–¹å¼å®šä¹‰ ...&#125; 2.4 åˆ›å»º ç”¨äºæè¿°ç½‘ç»œè¯·æ±‚ çš„æ¥å£GetRequest_Interface.interface 123456789public interface GetRequest_Interface &#123; @GET("openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car") Call&lt;Translation&gt; getCall(); // @GETæ³¨è§£çš„ä½œç”¨:é‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚ // getCall() = æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³• // å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;ï¼Œ*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰ // å¦‚æœæƒ³ç›´æ¥è·å¾—Responsebodyä¸­çš„å†…å®¹ï¼Œå¯ä»¥å®šä¹‰ç½‘ç»œè¯·æ±‚è¿”å›å€¼ä¸ºCall&lt;ResponseBody&gt;&#125; 2.5 åˆ›å»ºRetrofitå®ä¾‹12345Retrofit retrofit = new Retrofit.Builder() .baseUrl("http://fanyi.youdao.com/") // è®¾ç½®ç½‘ç»œè¯·æ±‚çš„Urlåœ°å€ .addConverterFactory(GsonConverterFactory.create()) // è®¾ç½®æ•°æ®è§£æå™¨ .addCallAdapterFactory(RxJavaCallAdapterFactory.create()) // æ”¯æŒRxJavaå¹³å° .build(); 2.6 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£å®ä¾‹12345// åˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£ çš„å®ä¾‹GetRequest_Interface request = retrofit.create(GetRequest_Interface.class);//å¯¹ å‘é€è¯·æ±‚ è¿›è¡Œå°è£…Call&lt;Reception&gt; call = request.getCall(); 2.7 å‘é€ç½‘ç»œè¯·æ±‚123456789101112131415//å‘é€ç½‘ç»œè¯·æ±‚(å¼‚æ­¥)call.enqueue(new Callback&lt;Translation&gt;() &#123; //è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ @Override public void onResponse(Call&lt;Translation&gt; call, Response&lt;Translation&gt; response) &#123; //è¯·æ±‚å¤„ç†,è¾“å‡ºç»“æœ response.body().show(); &#125; //è¯·æ±‚å¤±è´¥æ—¶å€™çš„å›è°ƒ @Override public void onFailure(Call&lt;Translation&gt; call, Throwable throwable) &#123; System.out.println("è¿æ¥å¤±è´¥"); &#125;&#125;); 2.8 å¤„ç†è¿”å›æ•°æ®123456789101112131415//å‘é€ç½‘ç»œè¯·æ±‚(å¼‚æ­¥)call.enqueue(new Callback&lt;Translation&gt;() &#123; //è¯·æ±‚æˆåŠŸæ—¶å›è°ƒ @Override public void onResponse(Call&lt;Translation&gt; call, Response&lt;Translation&gt; response) &#123; // å¯¹è¿”å›æ•°æ®è¿›è¡Œå¤„ç† response.body().show(); &#125; //è¯·æ±‚å¤±è´¥æ—¶å€™çš„å›è°ƒ @Override public void onFailure(Call&lt;Translation&gt; call, Throwable throwable) &#123; System.out.println("è¿æ¥å¤±è´¥"); &#125;&#125;); ç”±äºæœ¬æ–‡çš„æ ¸å¿ƒä¸æ˜¯è®²ç”¨æ³•ï¼Œæ‰€ä»¥å…³äºç”¨æ³•è¿™å—ï¼Œæˆ‘å¹¶æ²¡æœ‰å¤šè®²ï¼Œå¤§å®¶è‹¥æƒ³å¤šäº†è§£ï¼Œå¯ä»¥çœ‹æ­¤åšå®¢ï¼šè¿™æ˜¯ä¸€ä»½å¾ˆè¯¦ç»†çš„ Retrofit 2.0 ä½¿ç”¨æ•™ç¨‹ï¼ˆå«å®ä¾‹è®²è§£ï¼‰ 3. Retrofitæºç 3.1 Retrofitå¯¹è±¡æ„é€ æºç åº”å¯¹ä¸€ä¸ªæ¡†æ¶çš„æºç é¦–å…ˆä»ä½¿ç”¨å®ƒçš„åœ°æ–¹å¼€å§‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹Retrofitçš„åˆ›å»ºä»£ç ï¼š 1234Retrofit retrofit = new Retrofit.Builder() .baseUrl("http://fanyi.youdao.com/") .addConverterFactory(GsonConverterFactory.create()) .build(); æˆ‘ä»¬å¯ä»¥æŠŠå®ƒåˆ†ä¸º5ä¸ªéƒ¨åˆ†æ¥åˆ†ææºç ï¼š æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç¬¬ä¸€æ­¥ 3.1.1 æ­¥éª¤1ï¼šRetrofitç±»12345678910111213141516171819202122232425262728public final class Retrofit &#123; private final Map&lt;Method, ServiceMethod&lt;?&gt;&gt; serviceMethodCache = new ConcurrentHashMap&lt;&gt;(); // ç½‘ç»œè¯·æ±‚å·¥å‚ final okhttp3.Call.Factory callFactory; // è¯·æ±‚çš„Urlåœ°å€ final HttpUrl baseUrl; // æ•°æ®è½¬æ¢å™¨å·¥å‚çš„é›†åˆ final List&lt;Converter.Factory&gt; converterFactories; // ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚çš„é›†åˆ final List&lt;CallAdapter.Factory&gt; callAdapterFactories; // å›è°ƒ final @Nullable Executor callbackExecutor; // æ˜¯å¦æå‰å¯¹ä¸šåŠ¡æ¥å£ä¸­çš„æ³¨è§£è¿›è¡ŒéªŒè¯è½¬æ¢çš„æ ‡å¿—ä½ final boolean validateEagerly; Retrofit(okhttp3.Call.Factory callFactory, HttpUrl baseUrl, List&lt;Converter.Factory&gt; converterFactories, List&lt;CallAdapter.Factory&gt; callAdapterFactories, @Nullable Executor callbackExecutor, boolean validateEagerly) &#123; this.callFactory = callFactory; this.baseUrl = baseUrl; this.converterFactories = converterFactories; // Copy+unmodifiable at call site. this.callAdapterFactories = callAdapterFactories; // Copy+unmodifiable at call site. this.callbackExecutor = callbackExecutor; this.validateEagerly = validateEagerly; &#125; ...// çœç•¥åé¢çš„ä»£ç &#125; å¯ä»¥çœ‹åˆ°ï¼ŒRetrofitçš„æ„é€ æ–¹æ³•éœ€è¦ä¸€æ¬¡æ€§æŠŠéœ€è¦çš„æ•°æ®å…¨éƒ¨å‡†å¤‡å¥½ã€‚è€Œä¸”è¿™å—æœ‰ç‰¹åˆ«å¤šçš„å·¥å‚ï¼Œä½¿ç”¨äº†å·¥å‚æ¨¡å¼ã€‚è¿™ä¸ªæˆ‘ä»¬ä¹‹åå†è®²ï¼Œæ¥ä¸‹æ¥çœ‹æ­¥éª¤2ï¼š 3.1.2 æ­¥éª¤2ï¼šBuilder()æ–¹æ³•æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹Builder()æ–¹æ³•çš„æºç ï¼š 123public Builder() &#123; this(Platform.get());&#125; è¿™é‡Œè°ƒç”¨äº†Rlatform.get()æ–¹æ³•ï¼š 123static Platform get() &#123; return PLATFORM;&#125; PLATFORMçš„å®šä¹‰å°±åœ¨ä¸Šé¢ï¼š 1private static final Platform PLATFORM = findPlatform(); æˆ‘ä»¬å†æ¥çœ‹ä¸‹findPlatform()æ–¹æ³•ï¼š 12345678910private static Platform findPlatform() &#123; try &#123; Class.forName("android.os.Build"); if (Build.VERSION.SDK_INT != 0) &#123; return new Android(); &#125; &#125; catch (ClassNotFoundException ignored) &#123; &#125; return new Platform(true);&#125; è¿™å—åˆ›å»ºäº†ä¸€ä¸ªAndroidå¯¹è±¡ï¼Œæ¥ç€è¿”å›äº†ä¼ å…¥trueåˆ›å»ºçš„Platformå¯¹è±¡ã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹Androidç±»ï¼š 12345678910111213141516171819202122static final class Android extends Platform &#123; Android() &#123; super(Build.VERSION.SDK_INT &gt;= 24); &#125; @Override public Executor defaultCallbackExecutor() &#123; // è¿”å›ä¸€ä¸ªé»˜è®¤çš„å›è°ƒæ–¹æ³•æ‰§è¡Œå™¨ // è¯¥æ‰§è¡Œå™¨ä½œç”¨ï¼šåˆ‡æ¢çº¿ç¨‹ï¼ˆå­-&gt;&gt;ä¸»çº¿ç¨‹ï¼‰ï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ï¼ˆUIçº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œå›è°ƒæ–¹æ³• return new MainThreadExecutor(); &#125; static class MainThreadExecutor implements Executor &#123; // è·å–ä¸Android ä¸»çº¿ç¨‹ç»‘å®šçš„Handler private final Handler handler = new Handler(Looper.getMainLooper()); @Override public void execute(Runnable r) &#123; // è¯¥Handleræ˜¯ä¸Šé¢è·å–çš„ä¸Android ä¸»çº¿ç¨‹ç»‘å®šçš„Handler // åœ¨UIçº¿ç¨‹è¿›è¡Œå¯¹ç½‘ç»œè¯·æ±‚è¿”å›æ•°æ®å¤„ç†ç­‰æ“ä½œã€‚ handler.post(r); &#125; &#125;&#125; 3.1.3 æ­¥éª¤3ï¼šbaseUrl()æ–¹æ³•1234public Builder baseUrl(String baseUrl) &#123; Objects.requireNonNull(baseUrl, "baseUrl == null"); return baseUrl(HttpUrl.get(baseUrl));&#125; æœ€åè¿˜æ˜¯è°ƒç”¨äº†ä¸€ä¸ªbaseUrl()æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªbaseUrl()æ–¹æ³•ï¼š 1234567891011public Builder baseUrl(HttpUrl baseUrl) &#123; Objects.requireNonNull(baseUrl, "baseUrl == null"); // æŠŠURLå‚æ•°åˆ†å‰²æˆå‡ ä¸ªè·¯å¾„ç¢ç‰‡ List&lt;String&gt; pathSegments = baseUrl.pathSegments(); // æ£€æµ‹æœ€åä¸€ä¸ªç¢ç‰‡æ¥æ£€æŸ¥URLå‚æ•°æ˜¯ä¸æ˜¯ä»¥"/"ç»“å°¾,ä¸æ˜¯å°±æŠ›å‡ºå¼‚å¸¸ if (!"".equals(pathSegments.get(pathSegments.size() - 1))) &#123; throw new IllegalArgumentException("baseUrl must end in /: " + baseUrl); &#125; this.baseUrl = baseUrl; return this;&#125; æ­¥éª¤3ç”¨äºè®¾ç½®ç½‘ç»œè¯·æ±‚çš„Url 3.1.4 æ­¥éª¤4ï¼šaddConverterFactory()æ–¹æ³•æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹GsonConverterFactory.create()æ–¹æ³•ï¼š 123public static GsonConverterFactory create() &#123; return create(new Gson());&#125; åˆè°ƒç”¨äº†å¦ä¸€ä¸ªcreate()æ–¹æ³•ï¼š 1234public static GsonConverterFactory create(Gson gson) &#123; if (gson == null) throw new NullPointerException("gson == null"); return new GsonConverterFactory(gson);&#125; å¦‚æœä¼ å…¥çš„gsonä¸ºç©ºå°±æŠ¥å¼‚å¸¸ï¼Œä¸ä¸ºç©ºå°±è°ƒç”¨GsonConverterFactoryçš„æ„é€ æ–¹æ³•ï¼š 123private GsonConverterFactory(Gson gson) &#123; this.gson = gson;&#125; æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æœ¬è´¨å°±æ˜¯è¿”å›äº†ä¸€ä¸ªgsonå¯¹è±¡ç»™äº†addConverterFactory()æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 12345/** ä¸ºå¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ·»åŠ è½¬æ¢å™¨å·¥å‚ã€‚ */public Builder addConverterFactory(Converter.Factory factory) &#123; converterFactories.add(Objects.requireNonNull(factory, "factory == null")); return this;&#125; æ­¥éª¤4åˆ›å»ºäº†ä¸€ä¸ªå«æœ‰Gsonå®ä¾‹çš„GsonConverterFactoryå¯¹è±¡ï¼Œå¹¶æ”¾å…¥äº†ConverterFactoryã€‚ 3.1.5 æ­¥éª¤5ï¼šbuild()æ–¹æ³•1234567891011121314151617181920212223242526272829303132public Retrofit build() &#123; if (baseUrl == null) &#123; throw new IllegalStateException("Base URL required."); &#125; // é…ç½®ç½‘ç»œè¯·æ±‚æ‰§è¡Œå™¨ okhttp3.Call.Factory callFactory = this.callFactory; // å¦‚æœæ²¡æœ‰æŒ‡å®šcallFactoryï¼Œåˆ™åˆ›å»ºOkHttpClient if (callFactory == null) &#123; callFactory = new OkHttpClient(); &#125; // é…ç½®å›è°ƒæ‰§è¡Œå™¨ Executor callbackExecutor = this.callbackExecutor; if (callbackExecutor == null) &#123; callbackExecutor = platform.defaultCallbackExecutor(); &#125; // é…ç½®ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚ List&lt;CallAdapter.Factory&gt; callAdapterFactories = new ArrayList&lt;&gt;(this.callAdapterFactories); callAdapterFactories.addAll(platform.defaultCallAdapterFactories(callbackExecutor)); // é…ç½®æ•°æ®è½¬æ¢å™¨å·¥å‚ List&lt;Converter.Factory&gt; converterFactories = new ArrayList&lt;&gt;( 1 + this.converterFactories.size() + platform.defaultConverterFactoriesSize()); // é¦–å…ˆæ·»åŠ å†…ç½®è½¬æ¢å™¨å·¥å‚ã€‚è¿™å¯ä»¥é˜²æ­¢é‡å†™å®ƒçš„è¡Œä¸ºï¼Œä½†ä¹Ÿå¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨ä½¿ç”¨ä½¿ç”¨æ‰€æœ‰ç±»å‹çš„è½¬æ¢å™¨æ—¶æ­£ç¡®çš„è¡Œä¸ºã€‚ converterFactories.add(new BuiltInConverters()); converterFactories.addAll(this.converterFactories); converterFactories.addAll(platform.defaultConverterFactories()); return new Retrofit(callFactory, baseUrl, unmodifiableList(converterFactories), unmodifiableList(callAdapterFactories), callbackExecutor, validateEagerly);&#125; æŒ‰å‰é¢é…ç½®çš„å˜é‡ï¼Œå°†Retrofitæ‰€æœ‰çš„å˜é‡éƒ½é…ç½®å¥½ï¼Œæœ€åå®Œæˆåˆ›å»ºRetrofitå®ä¾‹ã€‚ åˆ°è¿™Retrofitçš„åˆ›å»ºéƒ¨åˆ†å°±å®Œäº†ã€‚Retrofité€šè¿‡å»ºé€ è€…æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªRetrofitå®ä¾‹ï¼š è¯·æ±‚å·¥å‚callFactoryï¼šé»˜è®¤æ˜¯OkHttpClient æ•°æ®è½¬æ¢å™¨å·¥å‚converterFactories ç½‘ç»œè¯·æ±‚é€‚é…å™¨å·¥å‚callAdapterFactoriesï¼šé»˜è®¤æ˜¯ExecutorCallAdapterFactory å›è°ƒæ‰§è¡Œå™¨callbackExecutor 3.2 åˆ›å»ºç½‘ç»œè¯·æ±‚æ¥å£çš„å®ä¾‹å¤§è‡´åˆ›å»ºæ–¹æ³•å¦‚ä¸‹ï¼š 12345678910111213141516171819202122&lt;!-- Reception.java --&gt;puublic class Reception &#123; // æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œæ•°æ®è§£ææ–¹å¼å®šä¹‰ ...&#125;&lt;!-- GetRequest_Interface.interface --&gt;public interface GetRequest_Interface &#123; @GET("openapi.do?keyfrom=Yanzhikai&amp;key=2032414398&amp;type=data&amp;doctype=json&amp;version=1.1&amp;q=car") Call&lt;Translation&gt; getCall(); // @GETæ³¨è§£çš„ä½œç”¨:é‡‡ç”¨Getæ–¹æ³•å‘é€ç½‘ç»œè¯·æ±‚ // getCall() = æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®çš„æ–¹æ³• // å…¶ä¸­è¿”å›ç±»å‹ä¸ºCall&lt;*&gt;ï¼Œ*æ˜¯æ¥æ”¶æ•°æ®çš„ç±»ï¼ˆå³ä¸Šé¢å®šä¹‰çš„Translationç±»ï¼‰ // å¦‚æœæƒ³ç›´æ¥è·å¾—Responsebodyä¸­çš„å†…å®¹ï¼Œå¯ä»¥å®šä¹‰ç½‘ç»œè¯·æ±‚è¿”å›å€¼ä¸ºCall&lt;ResponseBody&gt;&#125;&lt;!-- MainActivity.java --&gt;// åˆ›å»º ç½‘ç»œè¯·æ±‚æ¥å£ çš„å®ä¾‹GetRequest_Interface request = retrofit.create(GetRequest_Interface.class);//å¯¹ å‘é€è¯·æ±‚ è¿›è¡Œå°è£…Call&lt;Reception&gt; call = request.getCall(); æˆ‘ä»¬å…ˆçœ‹çœ‹retrofit.create()å¹²äº†å•¥ï¼š 1234567891011121314151617181920public &lt;T&gt; T create(final Class&lt;T&gt; service) &#123; validateServiceInterface(service); return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] &#123; service &#125;, new InvocationHandler() &#123; private final Platform platform = Platform.get(); private final Object[] emptyArgs = new Object[0]; @Override public @Nullable Object invoke(Object proxy, Method method, @Nullable Object[] args) throws Throwable &#123; // å¦‚æœè¯¥æ–¹æ³•æ˜¯æ¥è‡ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™æ¨è¿Ÿåˆ°æ­£å¸¸è°ƒç”¨ã€‚ if (method.getDeclaringClass() == Object.class) &#123; return method.invoke(this, args); &#125; if (platform.isDefaultMethod(method)) &#123; return platform.invokeDefaultMethod(method, service, proxy, args); &#125; return loadServiceMethod(method).invoke(args != null ? args : emptyArgs); &#125; &#125;);&#125; é¦–å…ˆè°ƒç”¨äº†validateServiceInterface()è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435private void validateServiceInterface(Class&lt;?&gt; service) &#123; // å¦‚æœä¸æ˜¯æ¥å£å°±æŠ›å¼‚å¸¸ if (!service.isInterface()) &#123; throw new IllegalArgumentException("API declarations must be interfaces."); &#125; // æ„é€ äº†ä¸€ä¸ªå®¹é‡ä¸‹é™ä¸º1çš„ç©ºåŒå‘é˜Ÿåˆ—æ¥å­˜å‚¨æ•°æ® Deque&lt;Class&lt;?&gt;&gt; check = new ArrayDeque&lt;&gt;(1); // æ·»åŠ åˆ°é˜Ÿåˆ— check.add(service); while (!check.isEmpty()) &#123; // å°†é˜Ÿåˆ—çš„æ­£å‘ç¬¬ä¸€ä¸ªå…ƒç´ ç§»é™¤ Class&lt;?&gt; candidate = check.removeFirst(); // getTypeParameters()çš„ä½œç”¨æ˜¯å¾—åˆ°æ³›å‹ç±»å‹ï¼Œå¦‚æœæ³›å‹çš„æ•°é‡ä¸ä¸º0çš„è¯è¿›å…¥ if (candidate.getTypeParameters().length != 0) &#123; StringBuilder message = new StringBuilder("Type parameters are unsupported on ") .append(candidate.getName()); if (candidate != service) &#123; message.append(" which is an interface of ") .append(service.getName()); &#125; throw new IllegalArgumentException(message.toString()); &#125; Collections.addAll(check, candidate.getInterfaces()); &#125; if (validateEagerly) &#123; Platform platform = Platform.get(); for (Method method : service.getDeclaredMethods()) &#123; if (!platform.isDefaultMethod(method) &amp;&amp; !Modifier.isStatic(method.getModifiers())) &#123; loadServiceMethod(method); &#125; &#125; &#125;&#125; è·å–åˆ°Platformï¼ˆå¹³å°ï¼‰ï¼Œç„¶åå†éå†æ¥å£ä¸­çš„æ–¹æ³•ï¼Œè°ƒç”¨loadServiceMethod()æ–¹æ³•ï¼š 12345678910111213ServiceMethod&lt;?&gt; loadServiceMethod(Method method) &#123; ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method); if (result != null) return result; synchronized (serviceMethodCache) &#123; result = serviceMethodCache.get(method); if (result == null) &#123; result = ServiceMethod.parseAnnotations(this, method); serviceMethodCache.put(method, result); &#125; &#125; return result;&#125; è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯é€šè¿‡serviceMethodCacheæ¥å­˜å‚¨è½¬æ¢ä¸ºServiceMethodç±»å‹çš„Methodã€‚ é‚£æˆ‘ä»¬åœ¨å›è¿‡å»çœ‹InvocationHandlerçš„invoke()æ–¹æ³•ã€‚ 12345678910111213141516new InvocationHandler() &#123; private final Platform platform = Platform.get(); private final Object[] emptyArgs = new Object[0]; @Override public @Nullable Object invoke(Object proxy, Method method, @Nullable Object[] args) throws Throwable &#123; // å¦‚æœè¯¥æ–¹æ³•æ˜¯æ¥è‡ªå¯¹è±¡çš„æ–¹æ³•ï¼Œåˆ™æ¨è¿Ÿåˆ°æ­£å¸¸è°ƒç”¨ã€‚ if (method.getDeclaringClass() == Object.class) &#123; return method.invoke(this, args); &#125; if (platform.isDefaultMethod(method)) &#123; return platform.invokeDefaultMethod(method, service, proxy, args); &#125; return loadServiceMethod(method).invoke(args != null ? args : emptyArgs); &#125;&#125;); ä¸¤ä¸ªifå…ˆä¸ç®¡ï¼Œå…ˆçœ‹æœ€åçš„returnï¼Œå¯ä»¥çœ‹åˆ°ä»–è°ƒç”¨äº†ä¸€ä¸ªloadServiceMethod()æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åœ¨å‰é¢å°±è¯´è¿‡ï¼Œä¸»è¦å°±è¿”å›äº†ä¸€ä¸ªServiceMethodã€‚é‚£æˆ‘ä»¬æ¥ç€æ¥çœ‹invoke()æ–¹æ³•ï¼šæŒ‰ä½command+é¼ æ ‡å·¦é”®è¿›å…¥åï¼Œæ˜¾ç¤ºçš„æ˜¯ï¼š 123456789101112131415161718abstract class ServiceMethod&lt;T&gt; &#123; static &lt;T&gt; ServiceMethod&lt;T&gt; parseAnnotations(Retrofit retrofit, Method method) &#123; RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method); Type returnType = method.getGenericReturnType(); if (Utils.hasUnresolvableType(returnType)) &#123; throw methodError(method, "Method return type must not include a type variable or wildcard: %s", returnType); &#125; if (returnType == void.class) &#123; throw methodError(method, "Service methods cannot return void."); &#125; return HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory); &#125; abstract @Nullable T invoke(Object[] args);&#125; è¿™ä¸ªinvoke()æ ¹æœ¬å°±æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•å•Šï¼Œç„¶åæˆ‘åˆå›å»æ‰¾çœ‹çœ‹æœ‰æ²¡æœ‰è¯´æ˜¯å“ªä¸ªç»§æ‰¿è‡ªServiceMethodçš„ç±»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œç»“æœä¹Ÿæ²¡æ‰¾åˆ°ï¼Œæœ€åæƒ³åˆ°äº†AndroidStudioå¯ä»¥command+å·¦é”®æ‰¾å®ç°äº†è¿™ä¸ªç±»çš„åœ°æ–¹å•Šã€‚äºæ˜¯æˆ‘å°±ç‚¹äº†ä¸‹è¿™ä¸ªç±»ï¼Œç»“æœæˆåŠŸæ‰¾åˆ°äº†HttpServiceMethodè¿™ä¸ªç±»ï¼Œä»–æ˜¯ServiceMethodçš„å­ç±»ä¸­å”¯ä¸€ä¸€ä¸ªå®ç°äº†invoke()æ–¹æ³•çš„ï¼š 1234@Override final @Nullable ReturnT invoke(Object[] args) &#123; Call&lt;ResponseT&gt; call = new OkHttpCall&lt;&gt;(requestFactory, args, callFactory, responseConverter); return adapt(call, args);&#125; å¯ä»¥çœ‹åˆ°è¿™å—ä»–åˆ›å»ºäº†ä¸€ä¸ªOkHttpCallå¯¹è±¡ï¼Œæ­¤å¤„ä¸åšè¯¦è§£ï¼Œå¯ä»¥çœ‹æˆ‘å…³äºOkHttpçš„ä¸€ç¯‡åšå®¢ï¼šAndroidç½‘ç»œè¯·æ±‚3â€“è§£æOkHttpæºç ã€‚ç„¶åè°ƒç”¨äº†adaptæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•: 1protected abstract @Nullable ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args); è¿™åˆæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚åªä¸è¿‡å¥½çš„æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¸‹é¢æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä»–çš„å®ç°ï¼š 1234567891011121314static final class CallAdapted&lt;ResponseT, ReturnT&gt; extends HttpServiceMethod&lt;ResponseT, ReturnT&gt; &#123; private final CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter; CallAdapted(RequestFactory requestFactory, okhttp3.Call.Factory callFactory, Converter&lt;ResponseBody, ResponseT&gt; responseConverter, CallAdapter&lt;ResponseT, ReturnT&gt; callAdapter) &#123; super(requestFactory, callFactory, responseConverter); this.callAdapter = callAdapter; &#125; @Override protected ReturnT adapt(Call&lt;ResponseT&gt; call, Object[] args) &#123; return callAdapter.adapt(call); &#125;&#125; å¯æ˜¯ä»–åˆè¿”å›ç»™äº†ä¸€ä¸ªCallAdapteræ¥å£çš„å®ç°ç±»çš„adapt()æ–¹æ³•ã€‚ã€‚ã€‚ã€‚è‰¹ æ‰€ä»¥ï¼Œè¿™å—æˆ‘å°±ä¸æ‡‚äº†ï¼Œæˆ‘ä¸çŸ¥é“ä»–åˆ°åº•å’‹å®ç°è¿™ä¸ªçš„è¿™ä¸ªæ–¹æ³•çš„ï¼Œæˆ‘çœ‹äº†ã€ŠAndroidè¿›é˜¶ä¹‹å…‰ã€‹å’Œå…¶å®ƒå¾ˆå¤šåšå®¢ï¼Œä»–ä»¬éƒ½æ˜¯è€ç‰ˆæœ¬çš„Retrofitï¼Œcreate()æ–¹æ³•ä¸åŒï¼Œè€Œä¸”è°ƒç”¨çš„adapt()æ–¹æ³•ä¹Ÿä¸åŒã€‚ã€‚ã€‚ 3.3 ç½‘ç»œè¯·æ±‚ç½‘ç»œè¯·æ±‚è¿™å—Retrofitå®é™…ä¸Šå°±æ˜¯ç”¨OkHttpå®ç°çš„ï¼Œæ‰€ä»¥è¿™å—æˆ‘å°±ä¸åœ¨è¿™å¤šè¯´äº†ï¼Œå¤§å®¶è¦äº†è§£çš„å¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„åšå®¢ï¼šAndroidç½‘ç»œè¯·æ±‚3â€“è§£æOkHttpæºç ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>æºç </tag>
        <tag>OkHttp</tag>
        <tag>Retrofit</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ4--è¿›ç¨‹çš„é€šä¿¡å’Œçº¿ç¨‹]]></title>
    <url>%2Fposts%2F30b7e738.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 4.1 è¿›ç¨‹é€šä¿¡è¿›ç¨‹é€šä¿¡å°±æ˜¯æŒ‡è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚ æ—©æœŸçš„æ—¶å€™ï¼Œç”±äºæŠ€æœ¯ä¸å‘è¾¾ï¼Œä»¥åŠç”±äºè¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥éœ€è¦åœ¨è¿›ç¨‹é—´äº¤æ¢ä¸€å®šçš„æ•°æ®ï¼Œæ‰€ä»¥ä¸å°‘äººä¹Ÿå°†ä»–ä»¬ç§°ä¸ºè¿›ç¨‹é€šä¿¡ï¼Œä½†æ˜¯å®è´¨ä¸Šä»–ä»¬åªèƒ½è¢«æˆä¸ºä½çº§çš„è¿›ç¨‹é€šä¿¡ã€‚ä»¥ä¿¡å·é‡ä¸ºä¾‹ï¼Œä»– æ•ˆç‡ä½ ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…æ¯æ¬¡åªèƒ½å‘ç¼“å†²åŒºæŠ•æ”¾ä¸€ä¸ªäº§å“æˆ–è€…å–å‡ºä¸€ä¸ªäº§å“ã€‚ é€šä¿¡å¯¹ç”¨æˆ·ä¸é€æ˜ è€Œå…³äºè¿›ç¨‹é—´é€šä¿¡æ‰€éœ€çš„æ•°æ®ç»“æ„çš„è®¾ç½®å’Œæ•°æ®çš„ä¼ é€ã€è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ï¼Œéƒ½éœ€è¦ç¨‹åºå‘˜å»å®Œæˆï¼Œæ˜¾ç„¶æ˜¯éå¸¸ä¸æ–¹ä¾¿çš„ã€‚ æ‰€ä»¥é«˜çº§è¿›ç¨‹é€šä¿¡å¿…é¡»æ»¡è¶³å¦‚ä¸‹ç‰¹ç‚¹ï¼š ä½¿ç”¨æ–¹ä¾¿ã€‚ OSéšè—äº†å®ç°è¿›ç¨‹é€šä¿¡çš„å…·ä½“ç»†èŠ‚ï¼Œå‘ç”¨æˆ·æä¾›äº†ä¸€ç»„ç”¨äºå®ç°é«˜çº§é€šä¿¡çš„å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ç›´æ¥åˆ©ç”¨å®ƒå®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ é«˜æ•ˆçš„ä¼ é€æ•°æ®ã€‚ ç”¨æˆ·å¯ä»¥ç›´æ¥åˆ©ç”¨é«˜çº§é€šä¿¡å‘½ä»¤é«˜æ•ˆçš„ä¼ é€å¤§é‡çš„æ•°æ®ã€‚ è¿›ç¨‹é€šä¿¡ä¸»è¦æœ‰å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿã€ç®¡é“é€šä¿¡ç³»ç»Ÿã€æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿä»¥åŠå®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿã€‚ 4.1.1 å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿå…±äº«å­˜å‚¨å™¨ç³»ç»Ÿåˆåˆ†ä¸ºäº†ä¸¤ç§ï¼š åŸºäºå…±äº«æ•°æ®ç»“æ„çš„é€šä¿¡æ–¹å¼ åœ¨è¿™ç§é€šä¿¡æ–¹å¼ä¸‹ï¼Œè¦æ±‚è¿›ç¨‹å…¬ç”¨æŸäº›æ•°æ®ç»“æ„ï¼Œå€Ÿä»¥å®ç°è¯¸è¿›ç¨‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚è¿™ç§æ–¹å¼ä»…é€‚ç”¨äºä¼ é€’ç›¸å¯¹å°‘é‡çš„æ•°æ®ï¼Œé€šä¿¡æ•ˆç‡ä½ä¸‹ï¼Œå±äºä½çº§é€šä¿¡ã€‚ åŸºäºå…±äº«å­˜å‚¨åŒºçš„é€šä¿¡æ–¹å¼ ä¸ºäº†ä¼ è¾“å¤§é‡æ•°æ®ï¼Œå°±åœ¨å†…å­˜ä¸­åˆ’å‡ºäº†ä¸€å—å…±äº«å­˜å‚¨åŒºåŸŸï¼Œè¯¸è¿›ç¨‹å¯é€šè¿‡å¯¹è¯¥å…±äº«åŒºçš„è¯»æˆ–å†™äº¤æ¢æ•°æ®ï¼Œå®ç°é€šä¿¡ï¼Œæ•°æ®çš„å½¢å¼å’Œä½ç½®ç”šè‡³è®¿é—®æ§åˆ¶éƒ½æ˜¯ç”±è¿›ç¨‹è´Ÿè´£ï¼Œè€Œä¸æ˜¯OSã€‚ 4.1.2 ç®¡é“é€šä¿¡ç³»ç»Ÿæ‰€è°“ç®¡é“ï¼Œæ˜¯æŒ‡ç”¨äºè¿æ¥ä¸€ä¸ªè¯»è¿›ç¨‹å’Œä¸€ä¸ªå†™è¿›ç¨‹ä»¥å®ç°ä»–ä»¬ä¹‹é—´é€šä¿¡çš„ä¸€å—å…±äº«å­˜å‚¨æ–‡ä»¶ï¼Œåˆå«pipeæ–‡ä»¶ã€‚å‘ç®¡é“æä¾›è¾“å…¥çš„å‘é€è¿›ç¨‹ä»¥å­—ç¬¦æµå½¢å¼å°†è¾¾é‡çš„æ•°æ®é€å…¥ç®¡é“ï¼Œè€Œæ¥æ”¶ç®¡é“è¾“å‡ºçš„æ¥æ”¶è¿›ç¨‹åˆ™ä»ç®¡é“ä¸­æ¥æ”¶æ•°æ®ã€‚è¿™ç§æ–¹å¼æ˜¯UNIXç³»ç»ŸIPCæœ€å¤è€çš„å½¢å¼ã€‚ ä¸ºäº†åè°ƒåŒæ–¹çš„é€šä¿¡ï¼Œä»–å¿…é¡»æä¾›ä¸€ä¸‹ä¸‰ä¸ªåŠŸèƒ½çš„åè°ƒèƒ½åŠ›ï¼š äº’æ–¥ åŒæ­¥ ç¡®å®šå¯¹æ–¹æ˜¯å¦å­˜åœ¨ 4.1.3 æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œé›†æˆä¸å†å€ŸåŠ©ä»»ä½•å…±äº«å­˜å‚¨åŒºæˆ–æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä»¥æ ¼å¼åŒ–çš„æ¶ˆæ¯(Message)ä¸ºå•ä½ï¼Œå°†é€šä¿¡çš„æ•°æ®å°è£…åœ¨æ¶ˆæ¯ä¸­ï¼Œå¹¶åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç»„é€šä¿¡å‘½ä»¤ï¼Œåœ¨è¿›ç¨‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œå®Œæˆè¿›ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚ è¯¥æ–¹å¼éšè—äº†é€šä¿¡å®ç°ç»†èŠ‚ï¼Œä½¿é€šä¿¡è¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜åŒ–ï¼Œé™ä½äº†é€šä¿¡ç¨‹åºè®¾è®¡çš„å¤æ‚æ€§å’Œé”™è¯¯ç‡ï¼Œæˆä¸ºå½“å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç±»è¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶. 4.1.4 å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿå‰é¢çš„å‡ ç§é€šä¿¡ç³»ç»Ÿï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç”¨äºå®ç°ä¸åŒè®¡ç®—æœºé—´è¿›ç¨‹çš„åŒå‘é€šä¿¡ï¼Œä½†æ˜¯å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿçš„é€šä¿¡æœºåˆ¶ï¼Œåœ¨ç½‘ç»œç¯å¢ƒçš„å„ç§åº”ç”¨é¢†åŸŸå·²æˆä¸ºå½“å‰ä¸»æµçš„é€šä¿¡å®ç°æœºåˆ¶ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šå¥—æ¥å­—ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚åœ¨è¿™å°±ä¸å¤šèµ˜è¿°äº†ã€‚ 4.2 çº¿ç¨‹4.2.1 ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿›ç¨‹æœ‰ä¸¤ä¸ªåŸºæœ¬å±æ€§ï¼šâ‘ è¿›ç¨‹æ˜¯ä¸€ä¸ªå¯æ‹¥æœ‰èµ„æºçš„ç‹¬ç«‹å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹è¦èƒ½ç‹¬ç«‹è¿è¡Œï¼Œä»–å¿…é¡»æ‹¥æœ‰ä¸€å®šçš„æ•°æ®ç»“æ„ã€‚â‘¡è¿›ç¨‹åŒæ—¶åˆæ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚ ä¸ºäº†ç¨‹åºèƒ½å¹¶å‘æ‰§è¡Œï¼Œç³»ç»Ÿå¿…é¡»èƒ½è¿›è¡Œåˆ›å»ºè¿›ç¨‹ã€æ’¤é”€è¿›ç¨‹å’Œåˆ‡æ¢è¿›ç¨‹æ“ä½œã€‚ä½†æ˜¯ç”±äºè¿›ç¨‹æ˜¯èµ„æºçš„æ‹¥æœ‰è€…ï¼Œæ‰€ä»¥åœ¨ä¸Šè¿°è¿™äº›æ“ä½œä¸­ï¼Œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹ä»˜å‡ºè¾ƒå¤§çš„æ—¶ç©ºå¼€é”€ã€‚è¿™å°±é™åˆ¶äº†ç³»ç»Ÿä¸­æ‰€è®¾ç½®è¿›ç¨‹çš„æ•°ç›®ï¼Œè€Œä¸”è¿›ç¨‹åˆ‡æ¢ä¹Ÿä¸å®œè¿‡äºé¢‘ç¹ï¼Œä»è€Œé™åˆ¶äº†å¹¶å‘ç¨‹åº¦çš„è¿›ä¸€æ­¥æé«˜ã€‚ 4.2.2 çº¿ç¨‹çš„æ¦‚å¿µåœ¨ä¸Šè¿°åŸå› ä¸‹ï¼Œå¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µã€‚å­¦è€…ä»¬å°†è¿›ç¨‹çš„ä¸¤ä¸ªå±æ€§åˆ†å¼€ï¼Œè®©ä½œä¸ºè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ä¸æ‹¥æœ‰èµ„æºï¼Œè®©æ‹¥æœ‰èµ„æºçš„åŸºæœ¬å•å€ä¸è¢«é¢‘ç¹çš„è°ƒåº¦ã€‚è¿™æ ·çš„è¯ï¼Œå°±å½¢æˆäº†çº¿ç¨‹çš„æ¦‚å¿µã€‚ ä¸‹é¢æˆ‘ä»¬ä»6ä¸ªæ–¹é¢æ¥æ¯”è¾ƒä¸‹è¿›å’Œçº¿ç¨‹ï¼š è°ƒåº¦çš„åŸºæœ¬å•ä½ ä¼ ç»ŸOSä¸­ï¼Œè¿›ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼Œéƒ½éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€å¤§ã€‚åœ¨å¼•å…¥äº†çº¿ç¨‹çš„OSä¸­ï¼Œçº¿ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€è¦ä¿å­˜å’Œè®¾ç½®å°‘é‡çš„å¯„å­˜å™¨å†…å®¹ï¼Œåˆ‡æ¢ä»£ä»·è¿œå°äºè¿›ç¨‹ã€‚ å¹¶å‘æ€§ åœ¨å¼•å…¥çº¿ç¨‹çš„OSä¸­ï¼Œä¸ä»…è¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸”åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´äº¦å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œç”šè‡³è¿˜å…è®¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½å¹¶å‘æ‰§è¡Œã€‚ æ‹¥æœ‰èµ„æº è¿›ç¨‹å¯ä»¥æ‹¥æœ‰èµ„æºï¼Œè€Œä¸”è¿˜æ˜¯ç³»ç»Ÿä¸­æ‹¥æœ‰èµ„æºçš„ä¸€ä¸ªåŸºæœ¬å•ä½ã€‚ä½†æ˜¯çº¿ç¨‹æœ¬èº«å¹¶ä¸æ‹¥æœ‰èµ„æºï¼Œè€Œæ˜¯ä»…æœ‰ä¸€ç‚¹å¿…ä¸å¯å°‘çš„ã€èƒ½ä¿è¯ç‹¬ç«‹è¿è¡Œçš„èµ„æºã€‚ ç‹¬ç«‹æ€§ åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§æ¯”ä¸åŒè¿›ç¨‹é—´çš„ç‹¬ç«‹æ€§ä½å¾—å¤šã€‚ ç³»ç»Ÿå¼€é”€ è¿›ç¨‹åˆ‡æ¢éœ€è¦å¤§é‡çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œçº¿ç¨‹é—´åˆ™éœ€è¦çš„å¾ˆå°‘ æ”¯æŒå¤šå¤„ç†æœºç³»ç»Ÿ åœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œå¯¹äºä¼ ç»Ÿè¿›ç¨‹ï¼Œä¸ç®¡æœ‰å¤šå°‘å¤„ç†æœºï¼Œè¯¥è¿›ç¨‹åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†æœºä¸Šã€‚ä½†æ˜¯å¯¹äºå¤šçº¿ç¨‹è¿›ç¨‹ï¼Œå¯ä»¥å°†ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹åˆ†é…åˆ°å¤šä¸ªå¤„ç†æœºä¸Šã€‚ 4.2.3 çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—ä¸è¿›ç¨‹ä¸€æ ·ï¼Œçº¿ç¨‹ä¹Ÿæ‹¥æœ‰ä¸‰ä¸ªçŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—ã€‚ 4.2.3.1 çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€çº¿ç¨‹çš„ä¸‰ä¸ªçŠ¶æ€å’Œè¿›ç¨‹ç±»ä¼¼ã€‚ è¿è¡ŒçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²è·å¾—å¤„ç†æœºè€Œæ­£åœ¨è¿è¡Œã€‚ å°±ç»ªçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²å…·å¤‡å„ç§æ‰§è¡Œæ¡ä»¶ï¼Œåªé¡»å†è·å¾—CPUä¾¿å¯ç«‹å³æ‰§è¡Œã€‚ é˜»å¡çŠ¶æ€ï¼Œåªçº¿ç¨‹åœ¨æ‰§è¡Œä¸­å› æŸäº‹ä»¶å—é˜»è€Œå¤„äºæš‚åœçŠ¶æ€ã€‚ 4.2.3.2 çº¿ç¨‹æ§åˆ¶å—TCBçº¿ç¨‹æ§åˆ¶å—ç”¨æ¥çºªå½•ç”¨äºæ§åˆ¶å’Œç®¡ç†çº¿ç¨‹çš„ä¿¡æ¯ã€‚çº¿ç¨‹æ§åˆ¶å—ä¸­é€šå¸¸ç”±è¿™å‡ é¡¹ï¼š çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹è®¾ç½®å”¯ä¸€åœ°æ ‡è¯†ç¬¦ã€‚ ä¸€ç»„å¯„å­˜å™¨ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨PCã€çŠ¶æ€å¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨çš„å†…å®¹ã€‚ çº¿ç¨‹è¿è¡ŒçŠ¶æ€ï¼Œç”¨äºæè¿°çº¿ç¨‹æ­£å¤„äºä½•ç§è¿è¡ŒçŠ¶æ€ã€‚ ä¼˜å…ˆçº§ï¼Œæè¿°çº¿ç¨‹æ‰§è¡Œçš„ä¼˜å…ˆç¨‹åº¦ã€‚ çº¿ç¨‹ä¸“æœ‰å­˜å‚¨åŒºï¼Œç”¨äºçº¿ç¨‹åˆ‡æ¢æ—¶å­˜æ”¾ç°åœºä¿æŠ¤ä¿¡æ¯ï¼Œå’Œä¸è¯¥çº¿ç¨‹ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚ ä¿¡å·å±è”½ï¼Œå³å¯¹æŸäº›ä¿¡å·åŠ ä»¥å±è”½ã€‚ å †æ ˆæŒ‡é’ˆã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[uCropæ¡†æ¶ç”¨æ³•å’Œæºç è§£æ]]></title>
    <url>%2Fposts%2F4e4b8b52.html</url>
    <content type="text"><![CDATA[æœ¬äººèƒ½åŠ›ä¸è¶³ï¼Œåœ¨çœ‹åˆ°æºç æœ€åä¸€éƒ¨åˆ†çš„æ—¶å€™å¤§é‡æŠ„è¢­å¯èƒ½æ˜¯æœ€è¯¦ç»†çš„UCropæºç è§£æ 1. uCropç®€ä»‹uCropæ˜¯ç›®å‰è¾ƒç«çš„å›¾ç‰‡è£å‰ªæ¡†æ¶ï¼Œå¼€å‘è€…å®£ç§°ä»–ä¼šæ¯”ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„å›¾ç‰‡è£å‰ªæ–¹æ¡ˆéƒ½è¦æ›´æµç•…ã€‚å¤–åŠ ä»–å°è£…ç¨‹åº¦è¾ƒé«˜ï¼Œå¯è‡ªå®šä¹‰ï¼Œè€Œä¸”é¢œå€¼å¾ˆé«˜ï¼ˆä¼¼ä¹è¿™ä¸ªæ‰æ˜¯é‡ç‚¹ï¼‰ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šAPPé€‰æ‹©ä½¿ç”¨å®ƒã€‚github 2. ä½¿ç”¨æ–¹æ³•å¾—ç›ŠäºuCropä¼˜ç§€çš„å°è£…ï¼ŒuCropçš„ä½¿ç”¨æ–¹æ³•ç‰¹ç®€å•ã€‚ 2.1 å¯¼å…¥ä¾èµ– å…ˆåœ¨é¡¹ç›®çš„build.gradleä¸­æ·»åŠ  123456allprojects &#123; repositories &#123; jcenter() maven &#123; url "https://jitpack.io" &#125; &#125;&#125; å¹¶åœ¨moduleçš„build.gradleä¸­æ·»åŠ  implementation &#39;com.github.yalantis:ucrop:2.2.3&#39; - è½»é‡çº§æ¡†æ¶ implementation &#39;com.github.yalantis:ucrop:2.2.3-native&#39; - è·å¾—æ¡†æ¶å…¨éƒ¨å¼ºå¤§çš„åŠŸèƒ½ä»¥åŠå›¾ç‰‡çš„é«˜è´¨é‡(æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´apkçš„å¤§å°å¢åŠ 1.5MBä»¥ä¸Š) ç”±äºæ¡†æ¶çš„æœ¬è´¨æ˜¯è°ƒç”¨åˆ°å¦ä¸€ä¸ªActivityå»å¤„ç†å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­å°†UCropActivityæ·»åŠ è¿›å» 1234&lt;activity android:name="com.yalantis.ucrop.UCropActivity" android:screenOrientation="portrait" android:theme="@style/Theme.AppCompat.Light.NoActionBar"/&gt; åˆ°è¿™ä½ å°±èƒ½æŠŠcUropå…¨éƒ¨å¯¼å…¥åˆ°ä½ çš„é¡¹ç›®é‡Œé¢äº†ï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±æ‹‰å°†å¦‚ä½•è°ƒç”¨ 2.2 å¼€å§‹åŸºæœ¬çš„è°ƒç”¨è°ƒç”¨èµ·æ¥å¾ˆç®€å•ï¼š 12UCrop.of(sourceUri, destinationUri) .start(context); å…¶ä¸­sourceUriæ˜¯è¾“å…¥å›¾ç‰‡çš„Uriï¼ŒdestinationUriæ˜¯è¾“å‡ºå›¾ç‰‡çš„Uriã€‚ç„¶åä»–å°±ä¼šç”±Intentçš„è°ƒåŠ¨è·³åˆ°UCropActivityï¼Œç”¨æˆ·å°±åœ¨UCropActivityé‡Œé¢è¿›è¡Œå›¾ç‰‡è£å‰ªæ“ä½œï¼Œç„¶åæœ€åç”±UCropActivityå‘èµ·ä¸€ä¸ªIntentå›åˆ°ä½ çš„Activityã€‚ 2.3 å¤„ç†å›æ¥çš„æ•°æ®ç”±äºæ˜¯ä»UCropAcitivityä¼ å›æ•°æ®ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨ä½ çš„Activityé‡Œé¢çš„onActivityResultæ–¹æ³•å¤„ç†uCropè¿”å›çš„ä¿¡æ¯ï¼š 12345678@Overridepublic void onActivityResult(int requestCode, int resultCode, Intent data) &#123; if (resultCode == RESULT_OK &amp;&amp; requestCode == UCrop.REQUEST_CROP) &#123; final Uri resultUri = UCrop.getOutput(data); &#125; else if (resultCode == UCrop.RESULT_ERROR) &#123; final Throwable cropError = UCrop.getError(data); &#125;&#125; åˆ°è¿™ï¼ŒåŸºæœ¬ç”¨æ³•å°±å®Œäº†ï¼Œä½ å°±å¯ä»¥å°½æƒ…çš„ä½¿ç”¨uCropã€‚ä½†æ˜¯æˆ‘å‰é¢è¯´è¿‡ï¼ŒuCropå°è£…ç¨‹åº¦å¥½ï¼Œè¿™ç‚¹å¾ˆå¤šå›¾ç‰‡å¤„ç†æ¡†æ¶éƒ½å¯ä»¥åšåˆ°ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŠŠéœ€è¦çš„æ•°æ®ä¼ åˆ°è‡ªå·±çš„Activityä¹‹åç”±è‡ªå·±çš„Activityå¤„ç†ï¼Œæ‰€ä»¥å¾ˆå¤šæ¡†æ¶çœ‹èµ·æ¥éƒ½æœ‰ä¼˜ç§€çš„å°è£…ï¼Œé‚£uCropç›¸æ¯”å…¶ä»–åˆæœ‰å•¥å¥½å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯è‡ªå®šä¹‰çµæ´»ï¼š 2.4 uCropé«˜é˜¶ç”¨æ³•2.4.1 é…ç½®uCrop12345678910111213141516171819202122232425262728293031323334353637383940414243/** * å¯åŠ¨è£å‰ª * @param activity ä¸Šä¸‹æ–‡ * @param sourceFilePath éœ€è¦è£å‰ªå›¾ç‰‡çš„ç»å¯¹è·¯å¾„ * @param requestCode æ¯”å¦‚ï¼šUCrop.REQUEST_CROP * @param aspectRatioX è£å‰ªå›¾ç‰‡å®½é«˜æ¯” * @param aspectRatioY è£å‰ªå›¾ç‰‡å®½é«˜æ¯” * @return */public static String startUCrop(Activity activity, String sourceFilePath, int requestCode, float aspectRatioX, float aspectRatioY) &#123; Uri sourceUri = Uri.fromFile(new File(sourceFilePath)); File outDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES); if (!outDir.exists()) &#123; outDir.mkdirs(); &#125; File outFile = new File(outDir, System.currentTimeMillis() + ".jpg"); //è£å‰ªåå›¾ç‰‡çš„ç»å¯¹è·¯å¾„ String cameraScalePath = outFile.getAbsolutePath(); Uri destinationUri = Uri.fromFile(outFile); //åˆå§‹åŒ–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šéœ€è¦è£å‰ªçš„å›¾ç‰‡ï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šè£å‰ªåå›¾ç‰‡ UCrop uCrop = UCrop.of(sourceUri, destinationUri); //åˆå§‹åŒ–UCropé…ç½® UCrop.Options options = new UCrop.Options(); //è®¾ç½®è£å‰ªå›¾ç‰‡å¯æ“ä½œçš„æ‰‹åŠ¿ options.setAllowedGestures(UCropActivity.SCALE, UCropActivity.ROTATE, UCropActivity.ALL); //æ˜¯å¦éšè—åº•éƒ¨å®¹å™¨ï¼Œé»˜è®¤æ˜¾ç¤º options.setHideBottomControls(true); //è®¾ç½®toolbaré¢œè‰² options.setToolbarColor(ActivityCompat.getColor(activity, R.color.colorPrimary)); //è®¾ç½®çŠ¶æ€æ é¢œè‰² options.setStatusBarColor(ActivityCompat.getColor(activity, R.color.colorPrimary)); //æ˜¯å¦èƒ½è°ƒæ•´è£å‰ªæ¡† options.setFreeStyleCropEnabled(true); //UCropé…ç½® uCrop.withOptions(options); //è®¾ç½®è£å‰ªå›¾ç‰‡çš„å®½é«˜æ¯”ï¼Œæ¯”å¦‚16ï¼š9 uCrop.withAspectRatio(aspectRatioX, aspectRatioY); //uCrop.useSourceImageAspectRatio(); //è·³è½¬è£å‰ªé¡µé¢ uCrop.start(activity, requestCode); return cameraScalePath;&#125; 2.4.2 å…¶ä»–é…ç½®1234567891011121314151617181920212223242526//è®¾ç½®Toolbaræ ‡é¢˜void setToolbarTitle(@Nullable String text)//è®¾ç½®è£å‰ªçš„å›¾ç‰‡æ ¼å¼void setCompressionFormat(@NonNull Bitmap.CompressFormat format)//è®¾ç½®è£å‰ªçš„å›¾ç‰‡è´¨é‡ï¼Œå–å€¼0-100void setCompressionQuality(@IntRange(from = 0) int compressQuality)//è®¾ç½®æœ€å¤šç¼©æ”¾çš„æ¯”ä¾‹å°ºvoid setMaxScaleMultiplier(@FloatRange(from = 1.0, fromInclusive = false) float maxScaleMultiplier)//åŠ¨ç”»æ—¶é—´void setImageToCropBoundsAnimDuration(@IntRange(from = 100) int durationMillis)//è®¾ç½®å›¾ç‰‡å‹ç¼©æœ€å¤§å€¼void setMaxBitmapSize(@IntRange(from = 100) int maxBitmapSize)//æ˜¯å¦æ˜¾ç¤ºæ¤­åœ†è£å‰ªæ¡†é˜´å½±void setOvalDimmedLayer(boolean isOval) //è®¾ç½®æ¤­åœ†è£å‰ªæ¡†é˜´å½±é¢œè‰²void setDimmedLayerColor(@ColorInt int color)//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†void setShowCropFrame(boolean show)//è®¾ç½®è£å‰ªæ¡†è¾¹çš„å®½åº¦void setCropFrameStrokeWidth(@IntRange(from = 0) int width)//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†ç½‘æ ¼void setShowCropGrid(boolean show) //è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼é¢œè‰²void setCropGridColor(@ColorInt int color)//è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼å®½void setCropGridStrokeWidth(@IntRange(from = 0) int width) 3. æºç è§£æ åœ¨æˆ‘å¼€å§‹è¯´æºç ä¹‹å‰ï¼Œæˆ‘å»ºè®®å¤§å®¶å¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ä¸‹é¢çš„è¿æ¥ï¼Œå› ä¸ºæœ¬æ¡†æ¶çš„ä½œè€…çœŸçš„æ˜¯ä¸ªå¥½äººï¼Œä»–ä¸ä»…ä¸ºæˆ‘ä»¬è´¡çŒ®äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªæ¡†æ¶ï¼Œè¿˜æŠŠè‡ªå·±å†™è¿™ä¸ªæ¡†æ¶çš„æ€è·¯éƒ½å†™äº†å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹è‹±æ–‡åŸç‰ˆå›½å†…ç½‘å‹ç¿»è¯‘ç‰ˆç™¾åº¦ç½‘é¡µç¿»è¯‘æœºç¿»ç‰ˆå…¶å®æˆ‘ä¸ªäººæ„Ÿè§‰ç™¾åº¦æœºç¿»æ²¡æœ‰è°·æ­Œç¿»è¯‘çš„å¥½ï¼Œå¤§å®¶æœ‰æ¡ä»¶çš„å¯ä»¥ä½¿ç”¨è°·æ­Œç¿»è¯‘æµè§ˆå™¨æ’ä»¶ç¿»è¯‘æ•´ä¸ªç½‘é¡µï¼ˆè°·æ­Œç¿»è¯‘å¥½åƒå›½å†…å¯ä»¥ç›´æ¥è®¿é—®ï¼‰ ä»£ç ç»“æ„å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†: 3.1 ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰ä»–çš„åŠŸèƒ½å°±æ˜¯é¡¹ç›®ä¸»è¦çš„ç•Œé¢ï¼Œä»¥åŠå®ç°ä¸€äº›åŸºæœ¬çš„åˆå§‹åŒ–ã€‚ä½ è·³è½¬åˆ°uCropçœ‹åˆ°çš„é‚£ä¸ªæ“ä½œå›¾ç‰‡çš„ç•Œé¢å°±æ˜¯å®ƒã€‚ è¿™å—çœ‹æºç çš„æ—¶å€™ä»£ç å±…å¤šï¼Œä½†æ˜¯ï¼Œè¯´å®è¯ï¼Œå°±åƒåˆšåˆšè¯´çš„ä¸€æ ·ï¼Œä»–é™¤äº†åˆå§‹åŒ–è¿˜æ˜¯åˆå§‹åŒ–ã€‚åˆå§‹åŒ–å®ŒToolbaræ¥ç€åˆå§‹åŒ–ViewGroupï¼Œåˆå§‹åŒ–å®ŒViewGroupæ¥ç€åˆå§‹åŒ–Imageæ•°æ®ç­‰ç­‰ã€‚æ‰€ä»¥è¿™å—æˆ‘å°±æ²¡å’‹ç»†çœ‹ï¼ˆå…¶å®æ˜¯å› ä¸ºä»£ç å¤ªé•¿äº†ï¼Œé€ƒï¼‰ 3.2 ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰è¿™ä¸€å—ä¸»è¦å°±æ˜¯æ¥ç”»ä½ æ‰€çœ‹åˆ°çš„å›¾ç‰‡ä¸­çš„è£å‰ªçš„è¾…åŠ©çº¿ã€‚ åœ¨æ„é€ æ–¹æ³•é‡Œé¢å°±è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯init()ï¼Œè€Œinit()æ–¹æ³•ä¹Ÿå°±å¹²äº†ä¸€ä»¶äº‹â€”â€”åˆ¤æ–­ã€‚å½“ç³»ç»Ÿå°äºJELLY_BEA_MR2ä¹Ÿå°±æ˜¯Android4.3æ—¶ï¼Œå¯åŠ¨äº†ç¡¬ä»¶åŠ é€Ÿï¼Œè‡³äºä¸ºä»€ä¹ˆsetLayerType(LAYER_TYPE_SOFTWARE, null);è¿™ä¸ªçœ‹ç€å°±åƒå¯åŠ¨ç¡¬ä»¶åŠ é€Ÿçš„æ–¹æ³•ï¼Œç”šè‡³å‚æ•°é‡Œé¢è¿˜æœ‰è½¯ä»¶è¿™ä¸ªå•è¯çš„æ–¹æ³•èƒ½å¯åŠ¨ç¡¬ä»¶åŠ é€Ÿï¼Œè¯·å¤§å®¶ç§»æ­¥HenCoder Android è‡ªå®šä¹‰ View 1-8 ç¡¬ä»¶åŠ é€Ÿï¼ˆè¿›å»ç›´æ¥æœç´¢è¿™ä¸ªæ–¹æ³•å³å¯ï¼Œå°±èƒ½æ‰¾åˆ°è§£é‡Šçš„åœ°æ–¹ï¼‰ï¼Œæˆ‘å†æ¬¡ä¸åšè§£é‡Šã€‚ è¿™ä¸ªç±»ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³• drawDimmedLayer()ç»˜åˆ¶è£å‰ªæ¡†ä¹‹å¤–çš„ç°è‰²éƒ¨åˆ† drawCropGrid()ç»˜åˆ¶è£å‰ªæ¡† é‚£æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š 3.2.1 drawDimmedLayer()123456789101112131415161718192021protected void drawDimmedLayer(@NonNull Canvas canvas) &#123; //å…ˆä¿å­˜å½“å‰å½“å‰ç”»å¸ƒ canvas.save(); //åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåœ†æ¡† if (mCircleDimmedLayer) &#123; //æŒ‰Pathè·¯å¾„è£å‰ª canvas.clipPath(mCircularPath, Region.Op.DIFFERENCE); &#125; else &#123; //è£å‰ªçŸ©å½¢ canvas.clipRect(mCropViewRect, Region.Op.DIFFERENCE); &#125; //ç€è‰² canvas.drawColor(mDimmedColor); //æ¢å¤ä¹‹å‰ä¿å­˜çš„Canvasçš„çŠ¶æ€ canvas.restore(); if (mCircleDimmedLayer) &#123; // ç»˜åˆ¶1pxç¬”åˆ’ä»¥ä¿®å¤åé”¯é½¿ canvas.drawCircle(mCropViewRect.centerX(), mCropViewRect.centerY(), Math.min(mCropViewRect.width(), mCropViewRect.height()) / 2.f, mDimmedStrokePaint); &#125;&#125; é¦–å…ˆå°±æ˜¯ä¸€ä¸ªmCircleDimmedLayerï¼Œè¿™ä¸ªæˆ‘çœŸçš„å¾ˆè¿·ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“å¥¹æ˜¯å’‹æ¥çš„ï¼Œäºæ˜¯æˆ‘å°±çœ‹OverlayViewæœ‰æ²¡æœ‰å¯¹è¿™ä¸ªå˜é‡çš„èµ‹å€¼ï¼Œäºæ˜¯æ•´ä¸ªç±»æˆ‘å°±æ‰¾åˆ°äº†ä¸€ä¸ªsetCircleDimmedLayer()æ–¹æ³•ï¼Œäºæ˜¯æˆ‘çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å“ªè¢«è°ƒç”¨äº†çš„ï¼Œç„¶åæˆ‘å°±æ‰¾åˆ°ä»–åˆ†åˆ«è¢«UCropActivityå’ŒUCropFragmentä¸¤ä¸ªç±»è°ƒç”¨åˆ°ï¼Œè€Œä¸”ä¸€ä¸ªæ˜¯intent.getBooleanExtra()æ–¹æ³•ä¸€ä¸ªæ˜¯bundle.getBoolean()æ–¹æ³•ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æœ‰ç‚¹æ•°äº†ï¼Œè¿™æ˜æ˜¾å°±æ˜¯å…¶ä»–ç±»ä¼ è¿‡æ¥çš„å•Šï¼Œæˆ‘å‘ç°ä»–ä¸¤çš„keyçš„å€¼éƒ½æ˜¯UCrop.Options.EXTRA_CIRCLE_DIMMED_LAYERï¼Œé‚£æˆ‘å°±æ‡‚äº†ï¼Œæ‰¾æ•´ä¸ªæ¡†æ¶é‡Œé¢å“ªå„¿æåˆ°è¿‡è¿™ä¸ªå€¼ä¸å°±å¾—äº†ï¼Œäºæ˜¯æˆ‘å°±å‘ç°é™¤äº†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ä»¥åŠä»–çš„åˆå§‹åŒ–ä»¥å¤–ï¼Œæˆ‘å‘ç°äº†ç¬¬4ä¸ªè°ƒç”¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªè°ƒç”¨çš„åœ°æ–¹â€”â€”Ucrop.setCircleDimmedLayer()ï¼š 1234567/** * @param isCircle - set it to true if you want dimmed layer to have an circle inside * iscircle-å¦‚æœå¸Œæœ›æš—æ˜¾å±‚ä¸­æœ‰ä¸€ä¸ªåœ†ï¼Œè¯·å°†å…¶è®¾ç½®ä¸ºtrueã€‚ */public void setCircleDimmedLayer(boolean isCircle) &#123; mOptionBundle.putBoolean(EXTRA_CIRCLE_DIMMED_LAYER, isCircle);&#125; æ³¨é‡Šä¸Šé¢æ˜¯åŸè¯ï¼Œä¸‹é¢æ˜¯æˆ‘ç™¾åº¦æœºç¿»çš„ç¿»è¯‘ã€‚çœ‹äº†å°±æ‡‚äº†å§ï¼Œåæ­£æˆ‘æ²¡æ‡‚ï¼Œæˆ‘ä¹Ÿå®Œå…¨æ²¡æœ‰è§åˆ°å“ªè°ƒç”¨è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘æ›´ä¸æ‡‚å•¥å«å¸Œæœ›æš—æ˜¾å±‚æœ‰ä¸ªåœ†ï¼Œå•¥ç©æ„ï¼Ÿå……æ»¡çº¿æ¡çš„é»‘ï¼Ÿï¼Ÿï¼Ÿç›´åˆ°æˆ‘å°†UCropçš„è°ƒç”¨æ–¹æ³•ä¿®æ”¹äº†å¹¶è¿è¡Œä¹‹åæˆ‘æ‰æ‡‚äº†ï¼š 12345val options = UCrop.Options()options.setCircleDimmedLayer(true)UCrop.of(uri, destinationUri) .withOptions(options) .start(this) ç»“æœæ˜¯ï¼š ç„¶åå°±æ‡‚äº†ï¼Œåº”è¯¥æ˜¯èƒ½æˆªä¸€ä¸ªåœ†å½¢çš„å›¾æ¡ˆå§ï¼Œç„¶åæˆ‘ç‚¹ä¸‹äº†âœ”ï¸ï¼Œç„¶åâ€¦â€¦ æ— è¯å¯è¯´ï¼Œä½œè€…ç‰›é€¼ï¼ï¼ï¼ å›å»å›å»ï¼Œåˆšåˆšè¯´åˆ°drawDimmedLayer()ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœmCircleDimmedLayerä¸ºtrueå°±è°ƒç”¨clipPath()è·Ÿç€è·¯å¾„è£åˆ‡ä¸€ä¸ªçŸ©å½¢åŠ åŸï¼Œä¸ç„¶çš„è¯å°±è°ƒç”¨clipRect()è£åˆ‡ä¸€ä¸ªçŸ©å½¢ã€‚ç„¶ååŠ å…¥é¢œè‰²ï¼Œç„¶åå®Œäº† 3.2.2 drawCropGrid()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950protected void drawCropGrid(@NonNull Canvas canvas) &#123; // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå‰ªè£æ¡† if (mShowCropGrid) &#123; // åˆ¤æ–­çŸ©å½¢æ•°æ®æ˜¯å¦ä¸ºç©ºï¼ŒmGridPoints å¦‚æœç­‰äºç©ºçš„è¯è¿›å…¥å¡«å……æ•°æ® if (mGridPoints == null &amp;&amp; !mCropViewRect.isEmpty()) &#123; // è¯¥æ•°ç»„ä¸º canvas.drawLines çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°è¦æ±‚å…¶å…ƒç´ ä¸ªæ•°ä¸º 4 çš„å€æ•° mGridPoints = new float[(mCropGridRowCount) * 4 + (mCropGridColumnCount) * 4]; int index = 0; // ç»„è£…æ•°æ®ï¼Œæ•°æ®ä¸ºæ¯ä¸€ç»„çº¿æ®µçš„åæ ‡ç‚¹ for (int i = 0; i &lt; mCropGridRowCount; i++) &#123; mGridPoints[index++] = mCropViewRect.left; mGridPoints[index++] = (mCropViewRect.height() * (((float) i + 1.0f) / (float) (mCropGridRowCount + 1))) + mCropViewRect.top; mGridPoints[index++] = mCropViewRect.right; mGridPoints[index++] = (mCropViewRect.height() * (((float) i + 1.0f) / (float) (mCropGridRowCount + 1))) + mCropViewRect.top; &#125; for (int i = 0; i &lt; mCropGridColumnCount; i++) &#123; mGridPoints[index++] = (mCropViewRect.width() * (((float) i + 1.0f) / (float) (mCropGridColumnCount + 1))) + mCropViewRect.left; mGridPoints[index++] = mCropViewRect.top; mGridPoints[index++] = (mCropViewRect.width() * (((float) i + 1.0f) / (float) (mCropGridColumnCount + 1))) + mCropViewRect.left; mGridPoints[index++] = mCropViewRect.bottom; &#125; &#125; //ç»˜åˆ¶çº¿æ®µ if (mGridPoints != null) &#123; canvas.drawLines(mGridPoints, mCropGridPaint); &#125; &#125; //ç»˜åˆ¶çŸ©å½¢åŒ…è£¹çº¿æ®µ if (mShowCropFrame) &#123; canvas.drawRect(mCropViewRect, mCropFramePaint); &#125; //ç»˜åˆ¶è¾¹è§’åŒ…è£¹,mFreestyleCropModeæ­¤å‚æ•°å¦‚æœç­‰äº1çš„è¯ å‰ªè£æ¡†ä¸ºå¯ç§»åŠ¨çŠ¶æ€ï¼Œä¸€èˆ¬ä¸ç”¨ if (mFreestyleCropMode != FREESTYLE_CROP_MODE_DISABLE) &#123; canvas.save(); mTempRect.set(mCropViewRect); mTempRect.inset(mCropRectCornerTouchAreaLineLength, -mCropRectCornerTouchAreaLineLength); canvas.clipRect(mTempRect, Region.Op.DIFFERENCE); mTempRect.set(mCropViewRect); mTempRect.inset(-mCropRectCornerTouchAreaLineLength, mCropRectCornerTouchAreaLineLength); canvas.clipRect(mTempRect, Region.Op.DIFFERENCE); canvas.drawRect(mCropViewRect, mCropFrameCornersPaint); canvas.restore(); &#125;&#125; ä¸€å¼€å¤´åˆæ˜¯ä¸€ä¸ªå’Œä¸Šé¢ç±»ä¼¼çš„å˜é‡mShowCropGridï¼Œè¿™ä¸‹æˆ‘å°±ä¸è¯´æˆ‘æ‰¾çš„å…·ä½“æ­¥éª¤ï¼Œä»–çš„åŠŸèƒ½å°±æ˜¯å¦‚æœä»–æ˜¯trueå°±ä¼šåœ¨è£å‰ªæ¡†ä¸­æ˜¾ç¤º9å®«æ ¼çº¿ï¼Œä¸ºfalseå°±æ²¡æœ‰ã€‚æ¥ç€å°±æ˜¯ç”»çº¿éƒ¨åˆ†ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæˆ‘ä¸ç”¨è®²å•¥ï¼Œä¹Ÿæ²¡å•¥è®²çš„ï¼Œå”¯ä¸€å°±æ˜¯ä¸ºä»€ä¹ˆmGridPointsè¿™ä¸ªæ•°ç»„çš„å¤§å°æ˜¯4çš„å€æ•°ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹è¿™ä¸ªåšå®¢Android Canvas DrawLinesä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„è§£é‡Š 3.3 ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰è¿™ä¸ªæ˜¯æ•´ä¸ªé¡¹ç›®æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚å‰é¢çš„ä¸¤éƒ¨åˆ†éƒ½æ˜¯UIçš„ï¼Œè€Œè¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æˆ‘æœ€æƒ³çŸ¥é“äº†è§£çš„éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†ä½œè€…ä¹Ÿåœ¨ä»–çš„åšå®¢é‡Œé¢è¯´çš„æœ€å¤šæœ€æ¸…æ¥šã€‚ä½œè€…æŠŠè¿™éƒ¨åˆ†çš„é€»è¾‘åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ† TransformImageView extends ImageView ä»–å¤„ç†äº† ä»æºæ‹¿åˆ°å›¾ç‰‡ å°†å›¾ç‰‡è¿›å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰ï¼Œå¹¶åº”ç”¨åˆ°å½“å‰å›¾ç‰‡ä¸Š CropImageView extends TransformImageView ä»–å¤„ç†äº† ç»˜åˆ¶è£å‰ªè¾¹æ¡†å’Œç½‘æ ¼ ä¸ºè£å‰ªåŒºåŸŸè®¾ç½®ä¸€å¼ å›¾ç‰‡ï¼ˆå¦‚æœç”¨æˆ·å¯¹å›¾ç‰‡æ“ä½œå¯¼è‡´è£å‰ªåŒºåŸŸå‡ºç°äº†ç©ºç™½ï¼Œé‚£ä¹ˆå›¾ç‰‡åº”è‡ªåŠ¨ç§»åŠ¨åˆ°è¾¹ç•Œå¡«å……ç©ºç™½åŒºåŸŸï¼‰ ç»§æ‰¿çˆ¶ç±»æ–¹æ³•ï¼Œä½¿ç”¨æ›´ç²¾å‡†çš„è§„åˆ™æ¥æ“ä½œçŸ©é˜µï¼ˆé™åˆ¶æœ€å¤§å’Œæœ€å°ç¼©æ”¾æ¯”ï¼‰ æ·»åŠ æ–¹æ³•å’Œç¼©å°çš„æ–¹æ³• è£å‰ªå›¾ç‰‡ GestureCropImageView extends CropImageView ä»–å¤„ç†äº† ç›‘å¬ç”¨æˆ·æ‰‹åŠ¿ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„æ­£ç¡®çš„æ–¹æ³• 3.3.1 TransformImageViewä½œè€…è¯´è¿™æ˜¯æœ€å®¹æ˜“çš„éƒ¨åˆ†ã€‚åœ¨çœ‹è¿™ä¸ªç±»ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹BitmapLoadTaskç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€åˆ‡å›¾åƒå¤„ç†çš„åŸºç¡€ï¼Œè¿™ä¸ªç±»è´Ÿè´£äº†Uriè§£ç bitmapï¼Œå¹¶å¤„ç†åˆ†è¾¨ç‡ï¼šé¦–å…ˆæ ¹æ®æ‹¿åˆ°çš„Uriè§£æä½å›¾ï¼š 12345678910111213final ParcelFileDescriptor parcelFileDescriptor;try &#123; parcelFileDescriptor = mContext.getContentResolver().openFileDescriptor(mInputUri, "r");&#125; catch (FileNotFoundException e) &#123; return new BitmapWorkerResult(e);&#125;final FileDescriptor fileDescriptor;if (parcelFileDescriptor != null) &#123; fileDescriptor = parcelFileDescriptor.getFileDescriptor();&#125; else &#123; return new BitmapWorkerResult(new NullPointerException("ParcelFileDescriptor was null for given Uri: [" + mInputUri + "]"));&#125; ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨BitmapFactoryæ–¹æ³•è§£ç FileDescriptorã€‚ ä½†åœ¨è§£ç ä½å›¾ä¹‹å‰ï¼Œæœ‰å¿…è¦çŸ¥é“å®ƒçš„å¤§å°ï¼Œå› ä¸ºå¦‚æœåˆ†è¾¨ç‡å¤ªé«˜ï¼Œä½å›¾å°†è¢«äºŒæ¬¡é‡‡æ ·ã€‚ 123456789101112131415161718192021222324252627282930313233final BitmapFactory.Options options = new BitmapFactory.Options();options.inJustDecodeBounds = true;BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);options.inSampleSize = calculateInSampleSize(options, requiredWidth, requiredHeight);options.inJustDecodeBounds = false;Bitmap decodeSampledBitmap = BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);close(parcelFileDescriptor);ExifInterface exif = getExif(uri);if (exif != null) &#123; int exifOrientation = exif.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL); return rotateBitmap(decodeSampledBitmap, exifToDegrees(exifOrientation));&#125; else &#123; return decodeSampledBitmap;&#125; è¿™æ ·å°±æ‹¿åˆ°äº†bitmapå®ä¾‹äº†ï¼Œå°±å¯ä»¥å»TansformImageViewå»å¯¹å›¾ç‰‡è¿›è¡Œè°ƒæ•´äº†ã€‚å…¶å®è¿™ä¸ªç±»æˆ‘ä¹Ÿä¸çŸ¥é“è¯´å•¥ğŸ˜‚ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç±»ä¹Ÿå°±æ˜¯æŠŠMatrixçš„postTranslate()ã€postRotate()å’ŒpostScale()æ–¹æ³•ç»™å°è£…äº†ä¸‹ã€‚å…³äºMatrixçš„çŸ¥è¯†å¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼šå®‰å“è‡ªå®šä¹‰Viewè¿›é˜¶-MatrixåŸç† 3.3.2 CropImageViewè¿™ä¸€å±‚æ˜¯æœ€å¤æ‚çš„ä¸€å±‚ï¼Œä½œè€…çš„æ“ä½œå¤§è‡´å¯ä»¥åˆ†ä¸º3æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—ã€å›¾ç‰‡å½’ä¸ºåŠ¨ç”»å¤„ç†ã€è£å‰ªå›¾ç‰‡ ç¬¬ä¸€æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—å½“ç”¨æˆ·æ‰‹æŒ‡ç§»å¼€æ—¶ï¼Œè¦ç¡®ä¿å›¾ç‰‡å¤„äºè£å‰ªåŒºåŸŸä¸­ï¼Œå¦‚æœä¸å¤„äºï¼Œéœ€è¦é€šè¿‡å¹³ç§»æŠŠå®ƒç§»è¿‡æ¥ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public void setImageToWrapCropBounds(boolean animate) &#123; //å¦‚æœå›¾ç‰‡åŠ è½½å®Œæ¯•å¹¶ä¸”å›¾ç‰‡ä¸å¤„äºå‰ªè£åŒºåŸŸ if (mBitmapLaidOut &amp;&amp; !isImageWrapCropBounds()) &#123; //è·å–ä¸­å¿ƒç‚¹X,Yåæ ‡ float currentX = mCurrentImageCenter[0]; float currentY = mCurrentImageCenter[1]; //è·å–ç¼©æ”¾æ¯”ä¾‹ float currentScale = getCurrentScale(); //è·å–åç§»è·ç¦» float deltaX = mCropRect.centerX() - currentX; float deltaY = mCropRect.centerY() - currentY; float deltaScale = 0; mTempMatrix.reset(); mTempMatrix.setTranslate(deltaX, deltaY); final float[] tempCurrentImageCorners = Arrays.copyOf(mCurrentImageCorners, mCurrentImageCorners.length); mTempMatrix.mapPoints(tempCurrentImageCorners); //åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŒ…å«åœ¨å‰ªè£åŒºåŸŸ boolean willImageWrapCropBoundsAfterTranslate = isImageWrapCropBounds(tempCurrentImageCorners); //å¦‚æœåŒ…å«åœ¨å‰ªè£åŒºåŸŸ if (willImageWrapCropBoundsAfterTranslate) &#123; //è·å–åç§»çš„è·ç¦» final float[] imageIndents = calculateImageIndents(); //åç§»çš„è·ç¦»ï¼Œæ¨ªåæ ‡åŠ æ¨ªåæ ‡ çºµåæ ‡åŠ çºµåæ ‡ deltaX = -(imageIndents[0] + imageIndents[2]); deltaY = -(imageIndents[1] + imageIndents[3]); &#125; else &#123; //å¦‚æœä¸åŒ…å«åœ¨å‰ªè£åŒºåŸŸï¼Œåˆ›å»ºä¸´æ—¶çŸ©å½¢ RectF tempCropRect = new RectF(mCropRect); mTempMatrix.reset(); //è®¾ç½®åç§»è§’åº¦ mTempMatrix.setRotate(getCurrentAngle()); mTempMatrix.mapRect(tempCropRect); //è·å¾—çŸ©å½¢çš„è¾¹é•¿åæ ‡ final float[] currentImageSides = RectUtils.getRectSidesFromCorners(mCurrentImageCorners); //è·å–æ”¾å¤§æ¯”ä¾‹ deltaScale = Math.max(tempCropRect.width() / currentImageSides[0], tempCropRect.height() / currentImageSides[1]); deltaScale = deltaScale * currentScale - currentScale; &#125; //å¦‚æœéœ€è¦åŠ¨ç”» if (animate) &#123; post(mWrapCropBoundsRunnable = new WrapCropBoundsRunnable( CropImageView.this, mImageToWrapCropBoundsAnimDuration, currentX, currentY, deltaX, deltaY, currentScale, deltaScale, willImageWrapCropBoundsAfterTranslate)); &#125; else &#123; //ä¸éœ€è¦åŠ¨ç”»ï¼Œç›´æ¥ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½® postTranslate(deltaX, deltaY); if (!willImageWrapCropBoundsAfterTranslate) &#123; zoomInImage(currentScale + deltaScale, mCropRect.centerX(), mCropRect.centerY()); &#125; &#125; &#125;&#125; ç¬¬äºŒæ­¥ï¼šå¤„ç†å¹³ç§»é€šè¿‡ä¸€ä¸ªRunnableçº¿ç¨‹æ¥å¤„ç†å¹³ç§»ï¼Œå¹¶ä¸”é€šè¿‡æ—¶é—´å·®å€¼çš„è®¡ç®—æ¥ç§»åŠ¨åŠ¨ç”»ï¼Œä½¿åŠ¨ç”»çœ‹èµ·æ¥æ›´çœŸå®ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * æ­¤å¯è¿è¡Œæ–‡ä»¶ç”¨äºåŠ¨ç”»å›¾åƒï¼Œä½¿å…¶å®Œå…¨å¡«å……è£å‰ªè¾¹ç•Œã€‚ * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚ * runnableå¯ä»¥ç»ˆæ­¢äºvie&#123;@link #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;@link WrapCropBoundsRunnable#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚ */private static class WrapCropBoundsRunnable implements Runnable &#123; private final WeakReference&lt;CropImageView&gt; mCropImageView; private final long mDurationMs, mStartTime; private final float mOldX, mOldY; private final float mCenterDiffX, mCenterDiffY; private final float mOldScale; private final float mDeltaScale; private final boolean mWillBeImageInBoundsAfterTranslate; public WrapCropBoundsRunnable(CropImageView cropImageView, long durationMs, float oldX, float oldY, float centerDiffX, float centerDiffY, float oldScale, float deltaScale, boolean willBeImageInBoundsAfterTranslate) &#123; mCropImageView = new WeakReference&lt;&gt;(cropImageView); mDurationMs = durationMs; mStartTime = System.currentTimeMillis(); mOldX = oldX; mOldY = oldY; mCenterDiffX = centerDiffX; mCenterDiffY = centerDiffY; mOldScale = oldScale; mDeltaScale = deltaScale; mWillBeImageInBoundsAfterTranslate = willBeImageInBoundsAfterTranslate; &#125; @Override public void run() &#123; CropImageView cropImageView = mCropImageView.get(); if (cropImageView == null) &#123; return; &#125; long now = System.currentTimeMillis(); float currentMs = Math.min(mDurationMs, now - mStartTime); float newX = CubicEasing.easeOut(currentMs, 0, mCenterDiffX, mDurationMs); float newY = CubicEasing.easeOut(currentMs, 0, mCenterDiffY, mDurationMs); float newScale = CubicEasing.easeInOut(currentMs, 0, mDeltaScale, mDurationMs); if (currentMs &lt; mDurationMs) &#123; cropImageView.postTranslate(newX - (cropImageView.mCurrentImageCenter[0] - mOldX), newY - (cropImageView.mCurrentImageCenter[1] - mOldY)); if (!mWillBeImageInBoundsAfterTranslate) &#123; cropImageView.zoomInImage(mOldScale + newScale, cropImageView.mCropRect.centerX(), cropImageView.mCropRect.centerY()); &#125; if (!cropImageView.isImageWrapCropBounds()) &#123; cropImageView.post(this); &#125; &#125; &#125;&#125; ä¸‹é¢è¿˜æœ‰å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºåŒå‡»æ”¾å¤§: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * æ­¤å¯è¿è¡Œé¡¹ç”¨äºè®¾ç½®å›¾åƒç¼©æ”¾çš„åŠ¨ç”»ã€‚ * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚ * runnableå¯ä»¥ç»ˆæ­¢vie &#123;@link #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;@link ZoomImageToPosition#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚ */private static class ZoomImageToPosition implements Runnable &#123; private final WeakReference&lt;CropImageView&gt; mCropImageView; private final long mDurationMs, mStartTime; private final float mOldScale; private final float mDeltaScale; private final float mDestX; private final float mDestY; public ZoomImageToPosition(CropImageView cropImageView, long durationMs, float oldScale, float deltaScale, float destX, float destY) &#123; mCropImageView = new WeakReference&lt;&gt;(cropImageView); mStartTime = System.currentTimeMillis(); mDurationMs = durationMs; mOldScale = oldScale; mDeltaScale = deltaScale; mDestX = destX; mDestY = destY; &#125; @Override public void run() &#123; CropImageView cropImageView = mCropImageView.get(); if (cropImageView == null) &#123; return; &#125; long now = System.currentTimeMillis(); float currentMs = Math.min(mDurationMs, now - mStartTime); float newScale = CubicEasing.easeInOut(currentMs, 0, mDeltaScale, mDurationMs); if (currentMs &lt; mDurationMs) &#123; cropImageView.zoomInImage(mOldScale + newScale, mDestX, mDestY); cropImageView.post(this); &#125; else &#123; cropImageView.setImageToWrapCropBounds(); &#125; &#125;&#125; ç¬¬ä¸‰æ­¥ï¼šè£å‰ªå›¾ç‰‡ 12345678910111213141516171819202122232425/** * å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»å¹¶è®¾ç½®å›¾åƒä»¥å¡«å……è£å‰ªåŒºåŸŸï¼ˆä¸å¸¦åŠ¨ç”»ï¼‰ã€‚ * ç„¶åç”¨é€‚å½“çš„å‚æ•°åˆ›å»ºå¹¶æ‰§è¡Œ&#123;@link BitmapCropTask&#125;ã€‚ */public void cropAndSaveImage(@NonNull Bitmap.CompressFormat compressFormat, int compressQuality, @Nullable BitmapCropCallback cropCallback) &#123; //ç»“æŸå­çº¿ç¨‹ cancelAllAnimations(); //è®¾ç½®è¦å‰ªè£çš„å›¾ç‰‡ï¼Œä¸éœ€è¦ä½ç§»åŠ¨ç”» setImageToWrapCropBounds(false); //å­˜å‚¨å›¾ç‰‡ä¿¡æ¯ï¼Œå››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šmCropRectè¦å‰ªè£çš„å›¾ç‰‡çŸ©é˜µï¼Œå½“å‰å›¾ç‰‡è¦å‰ªè£çš„çŸ©é˜µï¼Œå½“å‰æ”¾å¤§çš„å€¼ï¼Œå½“å‰æ—‹è½¬çš„è§’åº¦ final ImageState imageState = new ImageState( mCropRect, RectUtils.trapToRect(mCurrentImageCorners), getCurrentScale(), getCurrentAngle()); //å‰ªè£å‚æ•°ï¼ŒmMaxResultImageSizeXï¼ŒmMaxResultImageSizeYï¼šå‰ªè£å›¾ç‰‡çš„æœ€å¤§å®½åº¦ã€é«˜åº¦ã€‚ final CropParameters cropParameters = new CropParameters( mMaxResultImageSizeX, mMaxResultImageSizeY, compressFormat, compressQuality, getImageInputPath(), getImageOutputPath(), getExifInfo()); //å‰ªè£æ“ä½œæ”¾åˆ°AsyncTaskä¸­æ‰§è¡Œ new BitmapCropTask(getViewBitmap(), imageState, cropParameters, cropCallback).execute();&#125; è¿™å—æ ¸å¿ƒæ–¹æ³•è¿˜æ˜¯åœ¨BitmapCropTaskä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162//è°ƒæ•´å‰ªè£å¤§å°ï¼Œå¦‚æœæœ‰è®¾ç½®æœ€å¤§å‰ªè£å¤§å°ä¹Ÿä¼šåœ¨è¿™é‡Œåšè°ƒæ•´åˆ°è®¾ç½®èŒƒå›´private float resize() &#123; final BitmapFactory.Options options = new BitmapFactory.Options(); options.inJustDecodeBounds = true; BitmapFactory.decodeFile(mImageInputPath, options); boolean swapSides = mExifInfo.getExifDegrees() == 90 || mExifInfo.getExifDegrees() == 270; float scaleX = (swapSides ? options.outHeight : options.outWidth) / (float) mViewBitmap.getWidth(); float scaleY = (swapSides ? options.outWidth : options.outHeight) / (float) mViewBitmap.getHeight(); float resizeScale = Math.min(scaleX, scaleY); mCurrentScale /= resizeScale; resizeScale = 1; if (mMaxResultImageSizeX &gt; 0 &amp;&amp; mMaxResultImageSizeY &gt; 0) &#123; float cropWidth = mCropRect.width() / mCurrentScale; float cropHeight = mCropRect.height() / mCurrentScale; if (cropWidth &gt; mMaxResultImageSizeX || cropHeight &gt; mMaxResultImageSizeY) &#123; scaleX = mMaxResultImageSizeX / cropWidth; scaleY = mMaxResultImageSizeY / cropHeight; resizeScale = Math.min(scaleX, scaleY); mCurrentScale /= resizeScale; &#125; &#125; return resizeScale;&#125;// å‰ªè£å›¾ç‰‡private boolean crop(float resizeScale) throws IOException &#123; ExifInterface originalExif = new ExifInterface(mImageInputPath); //å››èˆäº”å…¥å–æ•´ cropOffsetX = Math.round((mCropRect.left - mCurrentImageRect.left) / mCurrentScale); cropOffsetY = Math.round((mCropRect.top - mCurrentImageRect.top) / mCurrentScale); mCroppedImageWidth = Math.round(mCropRect.width() / mCurrentScale); mCroppedImageHeight = Math.round(mCropRect.height() / mCurrentScale); //è®¡ç®—å‡ºå›¾ç‰‡æ˜¯å¦éœ€è¦è¢«å‰ªè£ boolean shouldCrop = shouldCrop(mCroppedImageWidth, mCroppedImageHeight); Log.i(TAG, "Should crop: " + shouldCrop); if (shouldCrop) &#123; //è°ƒç”¨C++æ–¹æ³•å‰ªè£ boolean cropped = cropCImg(mImageInputPath, mImageOutputPath, cropOffsetX, cropOffsetY, mCroppedImageWidth, mCroppedImageHeight, mCurrentAngle, resizeScale, mCompressFormat.ordinal(), mCompressQuality, mExifInfo.getExifDegrees(), mExifInfo.getExifTranslation()); //å‰ªè£æˆåŠŸå¤åˆ¶å›¾ç‰‡EXIFä¿¡æ¯ if (cropped &amp;&amp; mCompressFormat.equals(Bitmap.CompressFormat.JPEG)) &#123; ImageHeaderParser.copyExif(originalExif, mCroppedImageWidth, mCroppedImageHeight, mImageOutputPath); &#125; return cropped; &#125; else &#123; //ç›´æ¥å¤åˆ¶å›¾ç‰‡åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ FileUtils.copyFile(mImageInputPath, mImageOutputPath); return false; &#125;&#125; 3.3.3 GestureCropImageViewè¿™ä¸ªç±»ä¸»è¦å°±æ˜¯å¯¹æ‰‹åŠ¿çš„ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•ç²—æš´ï¼Œç›´æ¥æ‰¾ä»–çš„onTouchEventæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536/** * å¦‚æœæ˜¯ACTION_DOWN eventï¼Œç”¨æˆ·è§¦æ‘¸å±å¹•ï¼Œå¿…é¡»å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»ã€‚ * å¦‚æœæ˜¯ACTION_UP eventï¼Œç”¨æˆ·ä»å±å¹•ä¸Šå–ä¸‹æ‰€æœ‰æ‰‹æŒ‡ï¼Œå¿…é¡»çº æ­£å½“å‰å›¾åƒä½ç½®ã€‚ * å¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ‰‹æŒ‡-æ›´æ–°ç„¦ç‚¹åæ ‡ã€‚ * å¦‚æœå·²å¯ç”¨ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™æ‰‹åŠ¿æ£€æµ‹å™¨ã€‚ */@Overridepublic boolean onTouchEvent(MotionEvent event) &#123; if ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_DOWN) &#123; cancelAllAnimations(); &#125; if (event.getPointerCount() &gt; 1) &#123; mMidPntX = (event.getX(0) + event.getX(1)) / 2; mMidPntY = (event.getY(0) + event.getY(1)) / 2; &#125; //åŒå‡»ç›‘å¬å’Œæ‹–åŠ¨ç›‘å¬ mGestureDetector.onTouchEvent(event); //ä¸¤æŒ‡ç¼©æ”¾ç›‘å¬ if (mIsScaleEnabled) &#123; mScaleDetector.onTouchEvent(event); &#125; //æ—‹è½¬ç›‘å¬ if (mIsRotateEnabled) &#123; mRotateDetector.onTouchEvent(event); &#125; if ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_UP) &#123; //æœ€åä¸€æŒ‡æŠ¬èµ·æ—¶åˆ¤æ–­å›¾ç‰‡æ˜¯å¦å¡«å……å‰ªè£æ¡† setImageToWrapCropBounds(); &#125; return true;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç </tag>
        <tag>uCrop</tag>
        <tag>å›¾ç‰‡å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Aria2macOSå®‰è£…]]></title>
    <url>%2Fposts%2F4f46fdbb.html</url>
    <content type="text"><![CDATA[å¯¹ä¸èµ·å¤§å®¶ï¼Œåœ¨æˆ‘é…ç½®å¥½è¿™ä¸ªè½¯ä»¶ä¹‹åï¼Œæˆ‘å…´å†²å†²çš„æ‰“å¼€äº†githubæƒ³ä¸‹è½½ä¸‹ssr4.0forWindowsï¼Œè¿«ä¸åŠå¾…æƒ³æ„Ÿå—ä¸‹aria2çš„å¿«æ„Ÿï¼Œç»“æœå‘ç°æˆ‘é”™äº†ã€‚ä¸‹è½½é€Ÿåº¦å°±æ‰å‡ åk/sï¼Œé‚£ä¸€ç¬é—´ï¼Œæˆ‘æ„Ÿè§¦å¾ˆå¤šï¼Œæˆ‘çªç„¶æƒ³åˆ°æˆ‘æ˜¨æ™šçš„è¿…é›·ä¸‹è½½åŒæ ·çš„èµ„æºåŒæ ·çš„ç½‘åŒæ ·çš„vpnä¸‹å¤§å‡ ç™¾k/s çš„é€Ÿåº¦ï¼Œç„¶ååˆçœ‹åˆ°äº†æ­¤æ—¶æˆ‘ç»™äºˆå¸Œæœ›çš„ariaï¼Œæˆ‘é™·å…¥äº†æ²‰æ€ï¼Œæˆ–è®¸è¿™å°±æ˜¯äººç”Ÿå§ã€‚çªç„¶è§‰å¾—macOSè¿…é›·ï¼Œä¹Ÿè¿˜æŒºå¥½çœ‹çš„ï¼Œä¹ŸæŒºå¥½ç”¨çš„ï¼Œå®Œå…¨æ²¡æœ‰å¹¿å‘Šï¼Œè¦ä¸‹è½½æ‰“å¼€ï¼Œä¸‹è½½å®Œäº†å°±é€€å‡ºï¼Œå”¯ä¸€é—®é¢˜å°±æ˜¯Chromeçš„è¿…é›·æ‹“å±•ä¼¼ä¹å¤ªçµæ•äº†ç‚¹ï¼Œæˆ‘å•¥éƒ½æ²¡ç‚¹å°±è«åå…¶å¦™å¼¹å‡ºä¸‹è½½é¡µé¢ï¼Œé™¤äº†è¿™ä¸ªï¼Œä¼¼ä¹éå¸¸å®Œç¾ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘é…ç½®å¥½aria2å¹¶å†™ä¸‹è¿™ç¯‡åšå®¢åçš„ä¸åˆ°1ä¸ªå°æ—¶æ—¶é—´ï¼Œæˆ‘å¸è½½äº†aira2ï¼Œå¹¶é‡æ–°ç”¨ä¸Šäº†è¿…é›·ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ€ååªæƒ³è¯´ä¸€å¥ï¼Œè´¢å¤§nbï¼è´¢å¤§nbï¼è´¢å¤§nbï¼å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†ï¼Œé‡æ¥ï¼ŒIDMç‰›é€¼ï¼IDMç‰›é€¼ï¼IDMç‰›é€¼ï¼å¦‚æœå“ªä½ç‰›é€¼çš„å¤§å“¥çœ‹åˆ°äº†è¿™ç¯‡åšå®¢ï¼Œè®°å¾—å¸®æˆ‘ç»™IDMè¯´å£°ï¼Œä¸€ä¸ªWindowsçš„IDMæ­£ç‰ˆç”¨æˆ·æ€¥éœ€IDM macOSç‰ˆï¼ï¼ï¼ ä¸‹è½½Aira2é€šè¿‡githubå®‰è£… æ‰“å¼€githubä¸»é¡µ aria2/aria2-Release æ‰¾åˆ°å¯¹åº”çš„ç³»ç»Ÿä¸‹è½½å®‰è£…å³å¯ é€šè¿‡Homebrewå®‰è£…ç»ˆç«¯è¾“å…¥å‘½ä»¤brew install aria2å®‰è£…å³å¯ã€‚æ²¡æœ‰å®‰è£…Homebrewçš„åŒå­¦å¯ä»¥æœç´¢å®‰è£…Homebrewå³å¯ã€‚ è¿™ä¸ªè½¯ä»¶æ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢çš„ï¼Œæ‰€ä»¥å®‰è£…å¥½ä¹‹ååœ¨å¯åŠ¨å°é‡Œé¢æ˜¯æ‰¾ä¸åˆ°Aria2çš„å›¾æ ‡çš„ é…ç½®Aira2å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶Aria2æä¾›äº†ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š ç›´æ¥å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è½½ ä¸å¤ªæ¨èè¿™ç§ï¼Œå› ä¸ºå‘½ä»¤è¡Œä¸‹ä¸‹è½½æ¯”è¾ƒç¹çï¼Œè€Œä¸”ä¹Ÿä¸å¤ªå¥½æ“ä½œ RPCæ¨¡å¼ åœ¨è¿™ç§æ–¹å¼ï¼ŒAria2å¯åŠ¨ä¹‹åå°±ä¼šä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œä½ å°±å¯ä»¥é€šè¿‡WebUIæˆ–è€…å®‰è£…å®¢æˆ·ç«¯çš„æ–¹å¼æ¥ä½¿ç”¨å›¾å½¢ç•Œé¢æ§åˆ¶Aria2.ä½†æ˜¯è¿™ç§æ–¹å¼ä¸‹éœ€è¦é…ç½®æ–‡ä»¶ï¼Œç°åœ¨å°±å‘Šè¯‰å¤§å®¶å¦‚ä½•é…ç½®ï¼šé¦–å…ˆåˆ›å»ºæ–‡ä»¶ 1234cd ~mkdir /.aria2cd /.aria2touch aria2.conf ç„¶åæ‰“å¼€Finderï¼Œä½¿ç”¨å¿«æ·é”®Shift+Cmd+Gå¼¹å‡ºè·¯å¾„è¾“å…¥æ¡†ï¼Œæ¥ç€å¤åˆ¶ç²˜è´´~/.aria2/å›è½¦å°±è¿›å…¥äº†.aria2æ–‡ä»¶å¤¹ï¼Œä½ å°±ä¼šçœ‹åˆ°é‡Œé¢çš„aria2.confæ–‡ä»¶ï¼Œæ¥ç€ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹å†…å®¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#ç”¨æˆ·å#rpc-user=user#å¯†ç #rpc-passwd=passwd#ä¸Šé¢çš„è®¤è¯æ–¹å¼ä¸å»ºè®®ä½¿ç”¨,å»ºè®®ä½¿ç”¨ä¸‹é¢çš„tokenæ–¹å¼#è®¾ç½®åŠ å¯†çš„å¯†é’¥#rpc-secret=token#å…è®¸rpcenable-rpc=true#å…è®¸æ‰€æœ‰æ¥æº, webç•Œé¢è·¨åŸŸæƒé™éœ€è¦rpc-allow-origin-all=true#å…è®¸å¤–éƒ¨è®¿é—®ï¼Œfalseçš„è¯åªç›‘å¬æœ¬åœ°ç«¯å£rpc-listen-all=true#RPCç«¯å£, ä»…å½“é»˜è®¤ç«¯å£è¢«å ç”¨æ—¶ä¿®æ”¹#rpc-listen-port=6800#æœ€å¤§åŒæ—¶ä¸‹è½½æ•°(ä»»åŠ¡æ•°), è·¯ç”±å»ºè®®å€¼: 3max-concurrent-downloads=5#æ–­ç‚¹ç»­ä¼ continue=true#åŒæœåŠ¡å™¨è¿æ¥æ•°max-connection-per-server=5#æœ€å°æ–‡ä»¶åˆ†ç‰‡å¤§å°, ä¸‹è½½çº¿ç¨‹æ•°ä¸Šé™å–å†³äºèƒ½åˆ†å‡ºå¤šå°‘ç‰‡, å¯¹äºå°æ–‡ä»¶é‡è¦min-split-size=10M#å•æ–‡ä»¶æœ€å¤§çº¿ç¨‹æ•°, è·¯ç”±å»ºè®®å€¼: 5split=10#ä¸‹è½½é€Ÿåº¦é™åˆ¶max-overall-download-limit=0#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶max-download-limit=0#ä¸Šä¼ é€Ÿåº¦é™åˆ¶max-overall-upload-limit=0#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶max-upload-limit=0#æ–­å¼€é€Ÿåº¦è¿‡æ…¢çš„è¿æ¥#lowest-speed-limit=0#éªŒè¯ç”¨ï¼Œéœ€è¦1.16.1ä¹‹åçš„releaseç‰ˆæœ¬#referer=*#æ–‡ä»¶ä¿å­˜è·¯å¾„, é»˜è®¤ä¸ºå½“å‰å¯åŠ¨ä½ç½®dir=/Users/xxx/Downloads#æ–‡ä»¶ç¼“å­˜, ä½¿ç”¨å†…ç½®çš„æ–‡ä»¶ç¼“å­˜, å¦‚æœä½ ä¸ç›¸ä¿¡Linuxå†…æ ¸æ–‡ä»¶ç¼“å­˜å’Œç£ç›˜å†…ç½®ç¼“å­˜æ—¶ä½¿ç”¨, éœ€è¦1.16åŠä»¥ä¸Šç‰ˆæœ¬#disk-cache=0#å¦ä¸€ç§Linuxæ–‡ä»¶ç¼“å­˜æ–¹å¼, ä½¿ç”¨å‰ç¡®ä¿æ‚¨ä½¿ç”¨çš„å†…æ ¸æ”¯æŒæ­¤é€‰é¡¹, éœ€è¦1.15åŠä»¥ä¸Šç‰ˆæœ¬(?)#enable-mmap=true#æ–‡ä»¶é¢„åˆ†é…, èƒ½æœ‰æ•ˆé™ä½æ–‡ä»¶ç¢ç‰‡, æé«˜ç£ç›˜æ€§èƒ½. ç¼ºç‚¹æ˜¯é¢„åˆ†é…æ—¶é—´è¾ƒé•¿#æ‰€éœ€æ—¶é—´ none &lt; falloc ? trunc Â« prealloc, fallocå’Œtruncéœ€è¦æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸æ”¯æŒfile-allocation=prealloc#å¼€å¯BTä¸‹è½½enable-dht=truebt-enable-lpd=trueenable-peer-exchange=true# bt-tracker æ›´æ–°ï¼Œè§£å†³Aria2 BTä¸‹è½½é€Ÿåº¦æ…¢æ²¡é€Ÿåº¦çš„é—®é¢˜udp://tracker.coppersurfer.tk:6969/announce,http://tracker.internetwarriors.net:1337/announce,udp://tracker.opentrackr.org:1337/announce,udp://9.rarbg.to:2710/announce,udp://9.rarbg.me:2710/announce,udp://tracker.openbittorrent.com:80/announce,http://tracker3.itzmx.com:6961/announce,http://tracker1.itzmx.com:8080/announce,udp://exodus.desync.com:6969/announce,udp://retracker.lanta-net.ru:2710/announce,udp://tracker.torrent.eu.org:451/announce,udp://tracker.tiny-vps.com:6969/announce,udp://bt.xxx-tracker.com:2710/announce,udp://tracker2.itzmx.com:6961/announce,udp://tracker.cyberia.is:6969/announce,udp://open.demonii.si:1337/announce,udp://explodie.org:6969/announce,udp://denis.stalker.upeer.me:6969/announce,udp://open.stealth.si:80/announce,http://tracker4.itzmx.com:2710/announce ä¸ç”¨æ›´æ”¹å•¥ï¼Œä¹Ÿä¸å»ºè®®æ›´æ”¹å•¥ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„é…ç½®å†…å®¹ï¼Œè‡³å°‘è®°å¾—æ¯ä¸€é¡¹å¤§è‡´æ˜¯ä¸ªå•¥ï¼Œå› ä¸ºç­‰ä¼šé…ç½®å›¾å½¢ç•Œé¢éœ€è¦è¿™äº›ä¿¡æ¯ã€‚ æœ€åé¢çš„BTä¸‹è½½çš„bt-trackerå¤§å®¶é…ç½®è®°å¾—åˆ°è¿™ä¸ªé¡µé¢æ›´æ–°ï¼šhttps://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt ç„¶åå†æŠŠå†…å®¹å¤åˆ¶ç²˜è´´è¿‡å»ã€‚ ä¸‹è½½è·¯å¾„ä½ å¯ä»¥è‡ªå·±é€‰æ‹©ï¼Œå¯ä»¥å°±æŠŠ/Users/xxx/Downloadsä¸­çš„xxxæ¢æˆä½ è‡ªå·±çš„macOSç”¨æˆ·åå³å¯ã€‚ å¯åŠ¨Aria2 RPCæ¨¡å¼ç»ˆç«¯è¾“å…¥aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -Då°±å¯ä»¥å¯åŠ¨äº†ã€‚ä¸€æ ·çš„ï¼Œxxxæ˜¯ä½ çš„ç”¨æˆ·åã€‚ è¿›å…¥å›¾å½¢ç•Œé¢Aria2æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å›¾å½¢ç•Œé¢ï¼Œå®¢æˆ·ç«¯æœ‰ï¼Œä½†æ˜¯æˆ‘æ²¡ç”¨è¿‡æ‰€ä»¥æˆ‘ä¸åšä»‹ç»ï¼Œåœ¨è¿™ä¸»è¦ä»‹ç»WebUIã€‚ YAAWæ’ä»¶ åœ¨chromeçš„æ‹“å±•ä¸­å¿ƒæœç´¢YAAWï¼Œç„¶åå®‰è£…å³å¯ï¼Œæ¥ç€å°±ä¼šå‡ºç°YAAMçš„æ’ä»¶ ç‚¹å‡»æ‰“å¼€å®ƒï¼Œå°±ä¼šè¿›å…¥YAAWçš„WebUIã€‚ ç‚¹å‡»å³ä¸Šè§’çš„ğŸ”§å›¾æ ‡ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢ å¦‚æœä½ ä¸Šé¢çš„aria2.confæ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚æ‰¾åˆ°éœ€è¦ä¸‹è½½çš„èµ„æºå³é”®ç„¶åé€‰æ‹©YAAWå°±ä¼šè‡ªåŠ¨å¼€å§‹ä¸‹è½½ã€‚ AriaNg WebUIè¿™ä¸ªæ¯”ä¸Šé¢é‚£ä¸ªå¥½çœ‹ç‚¹ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰æ’ä»¶ï¼Œä½ åªèƒ½å¤åˆ¶ä¸‹è½½é“¾æ¥æ‰‹åŠ¨æ–°å»ºä¸‹è½½ä»»åŠ¡ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€ http://ariang.mayswind.net/latest/#!/downloading ç‚¹å‡»AriaNgè®¾ç½® ä¸€æ ·ï¼Œå¦‚æœä½ ä¸Šé¢çš„aria2.confæ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚ ä½ å¯ä»¥ç‚¹å‡»Aria2çŠ¶æ€ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å·²è¿æ¥ï¼Œå¦‚æœä¸æ˜¯å°±çœ‹çœ‹æœ‰æ²¡æœ‰å“ªå„¿å’Œaria2.confè®¾ç½®çš„ä¸ä¸€æ ·ã€‚ å…³é—­Aria2è¿™ä¸ªå¥½åƒå®˜æ–¹æ²¡æœ‰æ–¹æ³•å…³é—­ï¼Œäºæ˜¯æˆ‘ä»¬å°±ç”¨æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ã€‚ ç»ˆç«¯è¾“å…¥ps aux|grep aria2å¾—åˆ°Aria2çš„è¿›ç¨‹å· ç„¶åè¾“å…¥kill numberè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ç›´æ¥æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œnumberæ”¹ä¸ºä¸Šé¢çš„åˆ°çš„è¿›ç¨‹å·å³å¯ã€‚ é…ç½®è‡ªå¯åŠ¨åˆ›å»ºshæ–‡ä»¶è¿›å…¥åˆ°å¸Œæœ›ä¿å­˜çš„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶aria2.shï¼š 1touch aria2.sh ç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç å¹¶ä¿å­˜ï¼š 12345#!/bin/bashecho &quot;start aria2 server&quot;aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -Decho &quot;exiting&quot;exit ä¿®æ”¹æ–‡ä»¶æƒé™ ç»™aria2.shæ–‡ä»¶æ‰§è¡Œæƒé™ï¼šchmod +x aria2.sh è®©aria2.shé»˜è®¤ç”¨è‡ªå·±å¸¸ç”¨çš„terminalå·¥å…·æ‰“å¼€ã€‚å³é”®æ–‡ä»¶ ï¼&gt; æ˜¾ç¤ºç®€ä»‹ï¼šè®¾ç½®â€œæ‰“å¼€æ–¹å¼-&gt;æ‰€æœ‰åº”ç”¨ç¨‹åºâ€ä¸ºè‡ªå·±çš„terminalå³å¯ã€‚ æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹ åœ¨Macæ¡Œé¢é¡¶éƒ¨èœå•ä¸­ï¼Œç‚¹å‡»è‹¹æœå›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„èœå•ä¸­ï¼Œç‚¹å‡»è¿›å…¥ç³»ç»Ÿåå¥½è®¾ç½®ã€‚ åœ¨æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®åï¼Œç„¶åç‚¹å‡»è¿›å…¥ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®é€‰é¡¹ã€‚ ç„¶ååœ¨ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®ç•Œé¢ï¼Œå…ˆåœ¨å·¦ä¾§é€‰æ‹©ç™»é™†ç”¨æˆ·-å½“å‰ç”¨æˆ·ï¼Œç„¶ååœ¨å³ä¾§åˆ‡æ¢åˆ°ç™»å½•é¡¹ ç„¶åç‚¹ä¸‹é¢çš„+è¿›è¡Œæ·»åŠ ï¼Œé€‰æ‹©åˆšæ‰æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶aria2.shï¼Œå¹¶å‹¾é€‰éšè—ã€‚è¿™æ · aria2 å°±å¯ä»¥åœ¨æ¯æ¬¡å¼€æœºçš„æ—¶å€™è‡ªå¯åŠ¨äº†ã€‚ æœ€åï¼ŒAria2å¸è½½æ–¹å¼ç»ˆç«¯ä¸‹æ‰§è¡Œsudo pkgutil --forget aria2ä»¥åŠsudo pkgutil --forget aria2.pathï¼Œç„¶åä¸Šé¢åˆ›å»ºçš„.aria2æ–‡ä»¶å¤¹]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Aria2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ3--è¿›ç¨‹çš„åŒæ­¥]]></title>
    <url>%2Fposts%2F362e394f.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 3.1 è¿›ç¨‹åŒæ­¥3.1.1 åŒæ­¥æ¦‚å¿µ3.1.1.1 è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µè¿›ç¨‹åŒæ­¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å¯¹å¤šä¸ªç›¸å…³è¿›ç¨‹åœ¨æ‰§è¡Œæ¬¡åºä¸Šè¿›è¡Œåè°ƒï¼Œä½¿å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ä¹‹é—´èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å…±äº«ç³»ç»Ÿèµ„æºï¼Œå¹¶èƒ½å¾ˆå¥½çš„é…åˆå·¥ä½œï¼Œä»è€Œä½¿ç¨‹åºçš„æ‰§è¡Œå…·æœ‰å¯å†ç°æ€§ã€‚ 3.1.1.2 åˆ¶çº¦å…³ç³»å¯¹äºå¤„äºåŒä¸€ä¸ªç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ï¼Œç”±äºä»–ä»¬å…±äº«ç€ç³»ç»Ÿçš„èµ„æºï¼Œæˆ–è€…ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªä»»åŠ¡è€Œç›¸äº’åˆä½œï¼Œæ‰€ä»¥ä»–ä»¬ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸¤ç§åˆ¶çº¦å…³ç³»ï¼š é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³» ç³»ç»Ÿä¸­çš„è¿›ç¨‹éš¾å…ä¼šè°ƒç”¨åƒæ‰“å°æœºã€CPUç­‰è¿™æ ·çš„ä¸´ç•Œèµ„æºã€‚å¦‚æœæƒ³è¿™äº›èµ„æºæ­£å¸¸è°ƒç”¨ï¼Œå¿…é¡»ä¿è¯å¤šä¸ªè¿›ç¨‹ä¹‹é—´äº’æ–¥åœ°è®¿é—®è¿™äº›èµ„æºï¼Œè¿›è€Œå°±åœ¨è¿™äº›è¿›ç¨‹é—´å½¢æˆäº†é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³»ã€‚ ä¸ºäº†ä¿è¯è¿™äº›è¿›ç¨‹èƒ½æœ‰åºçš„è¿›è¡Œï¼Œå¯¹äºç³»ç»Ÿä¸­çš„è¿™ç±»èµ„æºï¼Œå¿…é¡»ç”±ç³»ç»Ÿå®æ–½ç»Ÿä¸€åˆ†é…ï¼Œå³ç”¨æˆ·åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆæå‡ºç”³è¯·ï¼Œç»ä¸å…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨ã€‚ ç›´æ¥ç›¸äº’åˆ¶çº¦å…³ç³» åœ¨ç³»ç»Ÿä¸­ä¹Ÿä¼šå­˜åœ¨ä¸€äº›è¿›ç¨‹ï¼Œä»–ä»¬ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªç›®æ ‡è€Œç›¸äº’é…åˆåˆä½œå·¥ä½œï¼Œè¿™ç§å°±æ˜¯ç›´æ¥äº’ç›¸åˆ¶çº¦å…³ç³»ã€‚ è¿›ç¨‹é—´çš„ç›´æ¥åˆ¶çº¦å…³ç³»å°±æ˜¯æºäºä»–ä»¬ä¹‹é—´çš„ç›¸äº’åˆä½œã€‚ 3.1.1.3 ä¸´ç•Œèµ„æºè™½ç„¶å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ç³»ç»Ÿä¸­çš„å„ç§èµ„æºï¼Œä½†å…¶ä¸­è®¸å¤šèµ„æºä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œæˆ‘ä»¬æŠŠä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºã€‚è®¸å¤šç‰©ç†è®¾å¤‡éƒ½å±äºä¸´ç•Œèµ„æºï¼Œå¦‚æ‰“å°æœºç­‰ã€‚æ­¤å¤–ï¼Œå¦‚æœå˜é‡ã€æ•°æ®ç­‰éƒ½å¯ä»¥è¢«è‹¥å¹²è¿›ç¨‹å…±äº«ï¼Œä¹Ÿå±äºä¸´ç•Œèµ„æºã€‚ 3.1.1.4 ä¸´ç•ŒåŒºäººä»¬æŠŠåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­è®¿é—®ä¸´ç•Œèµ„æºçš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚è‹¥èƒ½ä¿è¯è¯¸è¿›ç¨‹äº’æ–¥åœ°è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä¾¿å¯å®ç°è¯¸è¿›ç¨‹å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—®ã€‚ä¸ºæ­¤ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œåº”å…ˆå¯¹è¦è®¿é—®çš„ä¸´ç•ŒåŒºè¿›ç¨‹æ£€æŸ¥ï¼šå¦‚æœä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®ï¼Œåˆ™è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼›å¦‚æœä¸´ç•ŒåŒºæ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£è¿›ç¨‹å°±å¯è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¹¶å°†ä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®çš„æ ‡å¿—ç½®ä¸ºæ­£è¢«è®¿é—®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¿é—®ä¸´ç•Œèµ„æºçš„çº¿ç¨‹çš„å¾ªç¯ä»£ç åˆ†ä¸ºå¦‚ä¸‹éƒ¨åˆ†ï¼š è®¿é—®ä¸´ç•ŒåŒºä¹‹å‰ç”¨äºä¸Šè¿°åˆ¤æ–­çš„ä»£ç åŒºç§°ä¸ºè¿›å…¥åŒº åœ¨è®¿é—®å®Œä¸´ç•ŒåŒºä¹‹åç”¨äºå°†ä¸´ç•ŒåŒºæ­£è¢«è®¿é—®çš„æ ‡å¿—æ¢å¤ä¸ºæœªè¢«è®¿é—®çš„æ ‡å¿—çš„ä»£ç åŒºç§°ä¸ºé€€å‡ºåŒº é™¤äº†è¿›å…¥å»ã€ä¸´ç•ŒåŒºã€é€€å‡ºåŒºä»£ç ä¹‹å¤–çš„å…¶å®ƒä»£ç ç§°ä¸ºå‰©ä½™åŒº 123456while (true) &#123; è¿›å…¥åŒº ä¸´ç•ŒåŒº é€€å‡ºåŒº å‰©ä½™åŒº&#125; 3.1.1.5 åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™ ç©ºé—²è®©è¿›ï¼šå½“æ— è¿›ç¨‹å¤„äºä¸´ç•ŒåŒºæ—¶ï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºå¤„äºç©ºé—²çŠ¶æ€ï¼Œåº”å…è®¸ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ç«‹å³è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥æœ‰æ•ˆçš„åˆ©ç”¨ä¸´ç•Œèµ„æº å¿™åˆ™ç­‰å¾…ï¼šå½“å·²æœ‰è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºæ­£åœ¨è¢«è®¿é—®ï¼Œå› è€Œå…¶å®ƒè§†å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä»¥ä¿è¯å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—® æœ‰é™ç­‰å¾…ï¼šå¯¹è¦æ±‚è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹ï¼Œåº”ä¿è¯åœ¨æœ‰é™çš„æ—¶é—´å†…èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥å…é™·å…¥â€œæ­»ç­‰â€çŠ¶æ€ è®©æƒç­‰å¾…ï¼šå½“è¿›ç¨‹ä¸èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºæ—¶ï¼Œåº”ç«‹å³é‡Šæ”¾å¤„ç†æœºï¼Œä»¥å…è¿›ç¨‹é™·å…¥â€œå¿™ç­‰â€çŠ¶æ€ 3.1.2 åŒæ­¥æœºåˆ¶3.2.2.1 ä¿¡å·é‡æœºåˆ¶1. ä»€ä¹ˆæ˜¯ä¿¡å·é‡ä¿¡å·é‡çš„æ•°æ®ç»“æ„ä¸ºä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ç­‰å¾…è¯¥ä¿¡å·é‡çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå€¼åˆ™ä¸ç›¸åº”çš„èµ„æºçš„ä½¿ç”¨æƒ…å†µæœ‰å…³ï¼š å½“ä»–çš„å€¼å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¯ç”¨èµ„æºçš„æ•°é‡ å½“ä»–çš„å€¼å°äº0æ—¶ï¼Œå…¶ç»å¯¹å€¼è¡¨ç¤ºç­‰å¾…ä½¿ç”¨è¯¥èµ„æºçš„è¿›ç¨‹ä¸ªæ•° 2. ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶ä¿¡å·é‡æœºåˆ¶å³åˆ©ç”¨pvæ“ä½œå¯¹ä¿¡å·é‡è¿›è¡Œå¤„ç†ã€‚è€Œä¸”ä¿¡å·é‡åªèƒ½ç”±pvæ“ä½œè¿›ç¨‹å¤„ç†ã€‚å½“S&gt;0æ—¶ï¼ŒSè¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚æ‰§è¡Œä¸€æ¬¡Pæ“ä½œæ„å‘³ç€åˆ†é…ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Så€¼å‡1ï¼›å½“S&lt;0æ—¶ï¼Œè¡¨ç¤ºå·²ç»æ²¡æœ‰å¯ç”¨èµ„æºï¼Œè¯·æ±‚è€…å¿…é¡»ç­‰å¾…åˆ«çš„è¿›ç¨‹é‡Šæ”¾è¯¥ç±»èµ„æºï¼Œä»–æ‰èƒ½è¿è¡Œä¸‹å»ã€‚è€Œæ‰§è¡Œä¸€ä¸ªVæ“ä½œä»¥ä¸ºç€é‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Sçš„å€¼åŠ 1ï¼›å½“S&gt;0ï¼Œè¡¨ç¤ºæœ‰æŸäº›èµ„æºæ­£åœ¨ç­‰å¾…è¯¥èµ„æºï¼Œå› æ­¤è¦å”¤é†’ä¸€ä¸ªç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹ï¼Œä½¿ä¹‹è¿è¡Œä¸‹å»ã€‚ 3.2.2.2 PVæ“ä½œ1. Pæ“ä½œç”³è¯·ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒº 1234wait (S) &#123; while (s &lt;= 0) ;// å¦‚æœæ²¡æœ‰èµ„æºåˆ™å¾ªç¯ç­‰å¾… S--;&#125; å°†ä¿¡å·é‡Sçš„å€¼å‡1ï¼Œå³S=S-1ï¼› å¦‚æœS&lt;=0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™è¯¥è¿›ç¨‹ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼Œæ’å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ 2. Væ“ä½œé‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹ä»ä¸´ç•ŒåŒºå‡ºæ¥ 123signal (S) &#123; S++;&#125; å°†ä¿¡å·é‡Sçš„å€¼åŠ 1ï¼Œå³S=S+1ï¼› å¦‚æœS&gt;0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™é‡Šæ”¾é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ã€‚ 3. PVæ“ä½œçš„æ„ä¹‰ç”¨PVæ“ä½œæ¥å®ç°è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ 3.2.3 ç®¡ç¨‹æœºåˆ¶å°½ç®¡ä¿¡å·é‡æœºåˆ¶å¾ˆæ–¹åˆé«˜æ•ˆï¼Œä½†æ˜¯æ¯ä¸ªè¦è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹éƒ½å¿…é¡»å¿…å¤‡åŒæ­¥æ“ä½œï¼Œè¿™å°±ä½¿å¾—å¤§é‡çš„åŒæ­¥æ“ä½œåˆ†æ•£åœ¨å„ä¸ªè¿›ç¨‹ä¸­ã€‚è¿™ä¸ä»…ç»™ç³»ç»Ÿçš„ç®¡ç†å¸¦æ¥éº»çƒ¦ï¼Œè¿˜ä¼šå› åŒæ­¥æ“ä½œä¸å½“è€Œäº§ç”Ÿæ­»é”ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå˜äº§ç”Ÿäº†ä¸€ç§æ–°çš„åŒæ­¥å·¥å…·â€”â€”ç®¡ç¨‹ã€‚ 1. ç®¡ç¨‹çš„å®šä¹‰ç³»ç»Ÿä¸­å„ç§ç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æºå‡å¯ç”¨æ•°æ®ç»“æ„æŠ½è±¡åœ°æè¿°å…¶èµ„æºç‰¹å¾ï¼Œå³ç”¨å°‘é‡ä¿¡æ¯å’Œå¯¹è¯¥èµ„æºæ‰€æ‰§è¡Œçš„æ“ä½œæ¥è¡¨å¾è¯¥èµ„æºã€‚æ‰€ä»¥å°±å‡ºç°äº†ç®¡ç¨‹ã€‚ç®¡ç¨‹å¯ä»¥çœ‹æˆä¸€ä¸ªè½¯ä»¶æ¨¡å—ï¼Œå®ƒæ˜¯å°†å…±äº«çš„å˜é‡å’Œå¯¹äºè¿™äº›å…±äº«å˜é‡çš„æ“ä½œå°è£…èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå…·æœ‰ä¸€å®šæ¥å£çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿›ç¨‹å¯ä»¥è°ƒç”¨ç®¡ç¨‹æ¥å®ç°è¿›ç¨‹çº§åˆ«çš„å¹¶å‘æ§åˆ¶ã€‚åœ¨ç®¡ç¨‹å…¥å£å¤„çš„ç­‰å¾…é˜Ÿåˆ—ç§°ä¸ºå…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œç”±äºè¿›ç¨‹ä¼šæ‰§è¡Œå”¤é†’æ“ä½œï¼Œå› æ­¤å¯èƒ½æœ‰å¤šä¸ªç­‰å¾…ä½¿ç”¨ç®¡ç¨‹çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºç´§æ€¥é˜Ÿåˆ—ï¼Œå®ƒçš„ä¼˜å…ˆçº§é«˜äºç­‰å¾…é˜Ÿåˆ—ã€‚ 2. ç®¡ç¨‹çš„ç‰¹å¾ æ¨¡å—åŒ– ç®¡ç¨‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è½¯ä»¶æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ç¼–è¯‘ æŠ½è±¡æ•°æ®ç±»å‹ ç®¡ç¨‹ä¸­å°è£…äº†æ•°æ®åŠå¯¹äºæ•°æ®çš„æ“ä½œ ä¿¡æ¯éšè— ç®¡ç¨‹å¤–çš„è¿›ç¨‹æˆ–å…¶ä»–è½¯ä»¶æ¨¡å—åªèƒ½é€šè¿‡ç®¡ç¨‹å¯¹å¤–çš„æ¥å£æ¥è®¿é—®ç®¡ç¨‹æä¾›çš„æ“ä½œï¼Œç®¡ç¨‹å†…éƒ¨çš„å®ç°ç»†èŠ‚å¯¹å¤–ç•Œæ˜¯é€æ˜çš„ ä½¿ç”¨çš„äº’æ–¥æ€§ ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œç®¡ç¨‹åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚è¿›å…¥ç®¡ç¨‹æ—¶çš„äº’æ–¥ç”±ç¼–è¯‘å™¨è´Ÿè´£å®Œæˆ 3. æ¡ä»¶å˜é‡ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡æˆ–æŒ‚èµ·çš„æ¡ä»¶ï¼ˆåŸå› ï¼‰æœ‰å¤šä¸ªï¼Œå› æ­¤åœ¨ç®¡ç¨‹ä¸­è®¾ç½®äº†å¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¯¹è¿™äº›æ¡ä»¶å˜é‡çš„è®¿é—®åªèƒ½åœ¨ç®¡ç¨‹ä¸­è¿›è¡Œã€‚ç®¡ç¨‹ä¸­æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½éœ€äºˆä»¥è¯´æ˜ï¼Œå½¢å¼ä¸ºï¼šcondition xã€‚å¯¹å…¶çš„æ“ä½œåªæœ‰waitå’Œsignalï¼Œå…¶å«ä¹‰æ˜¯ï¼š x.waitï¼šæ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å› xæ¡ä»¶éœ€è¦è¢«é˜»å¡æˆ–æŒ‚èµ·ï¼Œåˆ™è°ƒç”¨x.waitå°†è‡ªå·±æ’å…¥åˆ°xæ¡ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œå¹¶é‡Šæ”¾ç®¡ç¨‹ï¼ŒçŸ¥é“xæ¡ä»¶å‘ç”Ÿå˜åŒ–ã€‚æ­¤æ—¶å…¶å®ƒè¿›ç¨‹å¯ä»¥ä½¿ç”¨è¯¥ç®¡ç¨‹ã€‚ x.signalï¼š æ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å‘ç°xæ¡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è°ƒç”¨x.signalï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªå› xæ¡ä»¶è€Œé˜»å¡æˆ–æŒ‚èµ·çš„è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿™æ ·çš„è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰ï¼Œç»§ç»­æ‰§è¡ŒåŸè¿›ç¨‹ï¼Œä¸äº§ç”Ÿä»»ä½•ç»“æœã€‚ï¼ˆä¸ä¿¡å·é‡çš„signalä¸åŒï¼Œæ²¡æœ‰s=s+1çš„æ“ä½œï¼‰ 3.2 è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜3.2.1 ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜1. é—®é¢˜æè¿°æœ‰ä¸€ç¾¤ç”Ÿäº§è€…è¿›ç¨‹åœ¨ç”Ÿäº§äº§å“ï¼Œå¹¶å°†è¿™äº›äº§å“æä¾›ç»™æ¶ˆè´¹è€…è¿›ç¨‹å»æ¶ˆè´¹ã€‚ä¸ºä½¿ç”Ÿäº§è€…è¿›ç¨‹ä¸æ¶ˆè´¹è€…è¿›ç¨‹èƒ½å¹¶å‘æ‰§è¡Œï¼Œåœ¨ä¸¤è€…ä¹‹é—´è®¾ç½®äº†ä¸€ä¸ªå¤§å°ä¸ºnçš„ç¼“å†²åŒºï¼Œç”Ÿäº§è€…è¿›ç¨‹å°†å…¶æ‰€äº§ç”Ÿçš„äº§å“æ”¾å…¥ç¼“å†²åŒºä¸­ï¼›æ¶ˆè´¹è€…å¯ä»ç¼“å†²åŒºä¸­å–èµ°äº§å“å»æ¶ˆè´¹ã€‚ä»–ä»¬ä¹‹é—´å¿…é¡»ä¿æŒåŒæ­¥ï¼Œä¹Ÿå°±æ˜¯æ—¢ä¸å…è®¸æ¶ˆè´¹è€…è¿›ç¨‹åˆ°ä¸€ä¸ªç©ºç¼“å†²åŒºå»å–äº§å“ï¼Œä¹Ÿä¸å…è®¸ç”Ÿäº§è€…è¿›ç¨‹å‘ä¸€ä¸ªå·²è£…æ»¡äº§å“ä¸”å°šæœªè¢«å–èµ°çš„ç¼“å†²åŒºä¸­æŠ•æ”¾äº§å“ã€‚ 2. é—®é¢˜åˆ†æéœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š åœ¨ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¸èƒ½å†è¿›è¡Œæ¶ˆè´¹ åœ¨ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¸èƒ½å†è¿›è¡Œç”Ÿäº§ å½“ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹æ—¶ï¼Œå…¶ä½™çº¿ç¨‹ä¸èƒ½å†è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹ 3. ä¼ªä»£ç 12345678910111213141516171819202122232425262728293031var items = 0, space = 10, mutex = 1;var in = 0, out = 0;item buf[10] = &#123; NULL &#125;;producer &#123; while( true ) &#123; wait( space ); // ç­‰å¾…ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½®ï¼Œ åœ¨ä½¿ç”¨PVæ“ä½œæ—¶ï¼Œæ¡ä»¶å˜é‡éœ€è¦åœ¨äº’æ–¥é”ä¹‹å‰ wait( mutex ); // ä¿è¯åœ¨productæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº // product buf.push( item, in ); // å°†æ–°èµ„æºæ”¾åˆ°buf[in]ä½ç½® in = ( in + 1 ) % 10; signal( mutex ); // å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ signal( items ); // é€šçŸ¥consumerç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥å–èµ° &#125;&#125;consumer &#123; while( true ) &#123; wait( items ); // ç­‰å¾…ç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥ä½¿ç”¨ wait( mutex ); // ä¿è¯åœ¨consumeæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº // consume buf.pop( out ); // å°†buf[out]ä½ç½®çš„çš„èµ„æºå–èµ° out = ( out + 1 ) % 10; signal( mutex ); // å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ signal( space ); // é€šçŸ¥ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½® &#125;&#125; ä¸èƒ½å°†çº¿ç¨‹é‡Œä¸¤ä¸ªwaitçš„é¡ºåºè°ƒæ¢å¦åˆ™ä¼šå‡ºç°æ­»é”ã€‚ä¾‹å¦‚(è°ƒæ¢å)ï¼Œå°†consumerçš„ä¸¤ä¸ªwaitè°ƒæ¢ï¼Œåœ¨producerå‘å‡ºsignalä¿¡å·åï¼Œå¦‚æœproducerçº¿ç¨‹æ­¤æ—¶å†æ¬¡è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œå®Œäº†wait(space)ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ªconsumerçº¿ç¨‹è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œäº†wait(mutex)ï¼Œå¦‚æœæ­¤æ—¶ç¼“å†²åŒºä¸ºç©ºï¼Œé‚£ä¹ˆconsumerå°†ä¼šé˜»å¡åœ¨wait(items)ï¼Œè€Œproducerä¹Ÿä¼šå› ä¸ºæ— æ³•è·å¾—é”çš„æ‰€æœ‰æƒæ‰€ä»¥é˜»å¡åœ¨wait(mutex)ï¼Œè¿™æ ·ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨é˜»å¡ï¼Œä¹Ÿå°±é€ æˆäº†æ­»é”ã€‚ 3.2.2 å“²å­¦å®¶è¿›é¤é—®é¢˜1. é—®é¢˜æè¿°æœ‰äº”ä½å“²å­¦å®¶å…±ç”¨ä¸€å¼ åœ†æ¡Œï¼Œåˆ†åˆ«ååœ¨å‘¨å›´çš„äº”å¼ æ¤…å­ä¸Šï¼Œåœ¨åœ†æ¡Œä¸Šæœ‰äº”ä¸ªç¢—å’Œäº”æ”¯ç­·å­ã€‚ä»–ä»¬çš„ç”Ÿæ´»çš„æ–¹å¼æ˜¯äº¤æ›¿çš„è¿›è¡Œæ€è€ƒå’Œè¿›é¤ï¼šå¹³æ—¶ï¼Œä¸€ä¸ªå“²å­¦å®¶è¿›è¡Œæ€è€ƒï¼Œé¥¥é¥¿æ—¶ä¾¿è§†å›¾å–å…¶å·¦å³ç¦»ä»–æœ€è¿‘çš„ç­·å­ï¼Œåªæœ‰åœ¨ä»–æ‹¿åˆ°ä¸¤åªç­·å­æ—¶æ‰èƒ½è¿›é¤ï¼Œè¿›é¤å®Œæ¯•ï¼Œæ”¾ä¸‹ç­·å­ç»§ç»­æ€è€ƒã€‚ 2. é—®é¢˜åˆ†æ åªæœ‰æ‹¿åˆ°ä¸¤åªç­·å­æ—¶ï¼Œå“²å­¦å®¶æ‰èƒ½åƒé¥­ã€‚ å¦‚æœç­·å­å·²è¢«åˆ«äººæ‹¿èµ°ï¼Œåˆ™å¿…é¡»ç­‰åˆ«äººåƒå®Œä¹‹åæ‰èƒ½æ‹¿åˆ°ç­·å­ã€‚ ä»»ä¸€å“²å­¦å®¶åœ¨è‡ªå·±æœªæ‹¿åˆ°ä¸¤åªç­·å­åƒå®Œé¥­å‰ï¼Œä¸ä¼šæ”¾ä¸‹æ‰‹ä¸­å·²ç»æ‹¿åˆ°çš„ç­·å­ 3. ä¼ªä»£ç è‡³å¤šåªå…è®¸å››ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œä»¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶èƒ½å¤Ÿè¿›é¤ï¼Œæœ€ç»ˆæ€»ä¼šé‡Šæ”¾å‡ºä»–æ‰€ä½¿ç”¨è¿‡çš„ä¸¤æ”¯ç­·å­ï¼Œä»è€Œå¯ä½¿æ›´å¤šçš„å“²å­¦å®¶è¿›é¤ã€‚å®šä¹‰ä¿¡å·é‡countï¼Œåªå…è®¸4ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶å¯ä»¥å°±é¤ã€‚ 12345678910111213141516semaphore chopstick[5]=&#123;1,1,1,1,1&#125;;semaphore count=4; // è®¾ç½®ä¸€ä¸ªcountï¼Œæœ€å¤šæœ‰å››ä¸ªå“²å­¦å®¶å¯ä»¥è¿›æ¥void philosopher(int i)&#123; while(true) &#123; think(); wait(count); //è¯·æ±‚è¿›å…¥æˆ¿é—´è¿›é¤ å½“countä¸º0æ—¶ ä¸èƒ½å…è®¸å“²å­¦å®¶å†è¿›æ¥äº† wait(chopstick[i]); //è¯·æ±‚å·¦æ‰‹è¾¹çš„ç­·å­ wait(chopstick[(i+1)%5]); //è¯·æ±‚å³æ‰‹è¾¹çš„ç­·å­ eat(); signal(chopstick[i]); //é‡Šæ”¾å·¦æ‰‹è¾¹çš„ç­·å­ signal(chopstick[(i+1)%5]); //é‡Šæ”¾å³æ‰‹è¾¹çš„ç­·å­ signal(count); //ç¦»å¼€é¥­æ¡Œé‡Šæ”¾ä¿¡å·é‡ &#125;&#125; 3.2.3 è¯»è€…-å†™è€…é—®é¢˜1. é—®é¢˜æè¿°ä¸€ä¸ªæ•°æ®æ–‡ä»¶æˆ–è®°å½•å¯è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œæˆ‘ä»¬æŠŠåªè¦æ±‚è¯»è¯¥æ–‡ä»¶çš„è¿›ç¨‹ç§°ä¸ºâ€œReaderè¿›ç¨‹â€ï¼Œå…¶å®ƒè¿›ç¨‹åˆ™ç§°ä¸ºâ€œWriterè¿›ç¨‹â€ã€‚å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»ä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œå› ä¸ºè¯»æ“ä½œä¸ä¼šä½¿æ•°æ®æ–‡ä»¶æ··ä¹±ã€‚ä½†ä¸å…è®¸ä¸€ä¸ªWriterè¿›ç¨‹å’Œå…¶å®ƒReaderè¿›ç¨‹æˆ–Writerè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«å¯¹è±¡ï¼Œè¿™æ ·å¾ˆæœ‰å¯èƒ½é€ æˆå…±äº«æ•°æ®æ··ä¹±ã€‚ 2. é—®é¢˜åˆ†æ å…è®¸å¤šä¸ªReaderè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡ ä¸å…è®¸Writerè¿›ç¨‹å’Œå…¶å®ƒè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡ 3. ä¼ªä»£ç 12345678910111213141516171819202122232425semaphore rmutex = 1,wmutex = 1;int readcount = 0;void reader()&#123; do&#123; wait(rmutex); if(readcount==0) wait(wmutex); readcount++; signal(rmutex); Â·Â·Â· perform read operation; Â·Â·Â· waitï¼ˆrmutexï¼‰ï¼› if(readcount==0) signal(wmutex); readcount--; signal(rmutex); &#125;while(TRUE);&#125;void writer()&#123; do&#123; wait(wmutex); perfrom write operation; signal(wmutex); &#125;while(TRUE);&#125;]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚3--è§£æOkHttpæºç ]]></title>
    <url>%2Fposts%2F151ac78a.html</url>
    <content type="text"><![CDATA[1. OkHttpç®€ä»‹okhttpæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“ï¼Œç”¨äºandroidä¸­è¯·æ±‚ç½‘ç»œã€‚ è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®,æ˜¯å®‰å“ç«¯æœ€ç«çƒ­çš„è½»é‡çº§æ¡†æ¶,ç”±ç§»åŠ¨æ”¯ä»˜Squareå…¬å¸è´¡çŒ®ã€‚ç”¨äºæ›¿ä»£å› ç§»é™¤äº†HttpClientè€Œå¯¼è‡´æ²¡ç”¨çš„Volleyã€‚ ç›®å‰æ›´å¤šäººé€‰æ‹©äº†Retrofitã€‚ 2. æºç è§£æ æœ¬æ–‡å¯¹OkHttpçš„æ¢è®¨å…¨éƒ¨åŸºäºç›®å‰çš„æœ€æ–°ç‰ˆOkHttp:4.0.1ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬ä½œè€…å·²ç»ä½¿ç”¨kotlinå¯¹æºç è¿›è¡Œäº†é‡å†™ï¼Œæ‰€ä»¥æœ‰äº›å°ä¼™ä¼´å¯èƒ½é˜…è¯»ç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯åˆ«æ‹…å¿ƒï¼Œæœ¬æ–‡ä¸­æ‰€æ¶‰åŠçš„æºç é˜…è¯»èµ·æ¥åŸºæœ¬ä¸Šå’ŒJavaä¸€æ ·ï¼Œæ‰€ä»¥è¯·ä¸ä¼škotlinçš„å°ä¼™ä¼´è¿˜æ˜¯è€å¿ƒçœ‹ä¸‹å»ï¼Œä¸å¤ªæ‡‚çš„è¯­æ³•å°±ç™¾åº¦ä¸‹ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¼šå¯¹æŸäº›è¯­æ³•ä½œæ³¨é‡Š 2.1 OkHttpè¯·æ±‚æµç¨‹2.1.1 ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†ææˆ‘ä»¬æ— è®ºåœ¨ä½¿ç”¨OkHttpè¿›è¡Œä»€ä¹ˆè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºOkHttpClientå¯¹è±¡å¹¶è°ƒç”¨ä»–çš„newCall()æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±ä»è¿™ä¸ªæ–¹æ³•çœ‹èµ·ï¼š 123override fun newCall(request: Request): Call &#123;return RealCall.newRealCall(this, request, forWebSocket = false)&#125; å¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªRealCallå¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨OkHttpClientå¯¹è±¡è°ƒç”¨çš„execute()æ“ä½œå®é™…ä¸Šæ˜¯RealCallçš„execute()æ“ä½œï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹RealCallçš„execute()æ–¹æ³•ï¼š 123456789101112131415161718192021override fun execute(): Response &#123; // æ·»åŠ åŒæ­¥é” synchronized(this) &#123; // check()æ˜¯kotlinç‰¹æœ‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªifï¼Œ // ä½†æ˜¯å½“ä»–çš„åˆ¤æ–­è¯­å¥æ˜¯falseçš„è¯ï¼Œ // ä»–å°±ä¼šæŠ›å‡ºä¸€ä¸ªIllegalStateExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸çš„å†…å®¹å°±æ˜¯åé¢çš„è¯­å¥ check(!executed) &#123; "Already Executed" &#125; executed = true // executedæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»–çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡äº†ï¼Œ // å¦‚æœæ‰§è¡Œè¿‡äº†è¿˜æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•çš„è¯å°±æŠ›å¼‚å¸¸ &#125; // transmitterç”¨äºè¿æ¥OKHTTPçš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ï¼Œä¸ç”¨å¤šç®¡ transmitter.timeoutEnter() transmitter.callStart() try &#123; client.dispatcher.executed(this) return getResponseWithInterceptorChain() &#125; finally &#123; client.dispatcher.finished(this) &#125;&#125; è¿™å—åˆè°ƒç”¨äº†client.dispatcherï¼Œç„¶åæ‰¾å›å»æ‰¾åˆ°OkHttpClientçš„dispatcherå¯¹è±¡ï¼Œå‘ç°ä»–å°±æ˜¯Dispatcherç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹Dispatcherç±»ã€‚ 2.1.2 Dispatcherä»»åŠ¡è°ƒåº¦è¿›å…¥Dispatcherç±»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æˆå‘˜å˜é‡å®šä¹‰: æ³¨ï¼škotlinä¸­ä¸€ä¸ªæˆå‘˜å˜é‡çš„@getå’Œ@setåˆ†åˆ«å¯¹åº”äº†Javaä¸­getå’Œsetæ–¹æ³•ï¼Œæ‰€ä»¥è¿™å—æˆ‘æ²¡æœ‰å®Œå®Œå…¨å…¨å¤åˆ¶ç²˜è´´åˆ°è¿™ï¼Œæˆ‘åªå–äº†å®šä¹‰éƒ¨åˆ† 123456789101112// æœ€å¤§å¹¶å‘è¯·æ±‚æ•°var maxRequests = 64// æ¯ä¸ªä¸»æœºçš„æœ€å¤§è¯·æ±‚æ•°var maxRequestsPerHost = 5// æ¶ˆè´¹è€…çº¿ç¨‹val executorService: ExecutorService// å°†è¦è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿåˆ—private val readyAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()// æ­£åœ¨è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿé˜Ÿåˆ—private val runningAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()// æ­£åœ¨è¿è¡Œçš„åŒæ­¥è¯·æ±‚é˜Ÿåˆ—private val runningSyncCalls = ArrayDeque&lt;RealCall&gt;() æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Dispatcherçš„æ„é€ æ–¹æ³• 123456// ä¸»æ„é€ æ–¹æ³•ï¼Œæ²¡å†™å…·ä½“å®ç°class Dispatcher constructor() &#123;&#125; constructor(executorService: ExecutorService) : this() &#123; this.executorServiceOrNull = executorService&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–å°†ä¼ è¿›æ¥çš„executorServiceä¼ ç»™äº†executorServiceOrNullï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹executorServiceOrNullçš„å®šä¹‰ï¼š 123456789101112// executorServiceOrNullè¿™ä¸ªåº”è¯¥æ˜¯å› ä¸ºkotlinçš„ç©ºå®‰å…¨æ£€æŸ¥ç‰¹æ€§è€Œå®šä¹‰çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯executorServiceprivate var executorServiceOrNull: ExecutorService? = null@get:Synchronized@get:JvmName("executorService") val executorService: ExecutorService get() &#123; if (executorServiceOrNull == null) &#123; executorServiceOrNull = ThreadPoolExecutor(0, Int.MAX_VALUE, 60, TimeUnit.SECONDS, SynchronousQueue(), threadFactory("OkHttp Dispatcher", false)) &#125; return executorServiceOrNull!! &#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°executorServiceçš„setæ–¹æ³•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚å†ç»“åˆä»–æœ‰ä¸¤ä¸ªæ„é€ å™¨å°±çŸ¥é“ï¼šå¦‚æœæ²¡æœ‰ç»™Dispatcherä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± ä»–å°±ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± é€‚åˆæ‰§è¡Œå¤§é‡ä¸”è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡ã€‚ æ„é€ å™¨æˆ‘ä»¬çœ‹å®Œäº†ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä»–çš„enqueue()æ–¹æ³•ï¼š 12345678910111213internal fun enqueue(call: AsyncCall) &#123; synchronized(this) &#123; readyAsyncCalls.add(call) // Mutate the AsyncCall so that it shares the AtomicInteger of an existing running call to // the same host. if (!call.get().forWebSocket) &#123; val existingCall = findExistingCallWithHost(call.host()) if (existingCall != null)call.reuseCallsPerHostFrom(existingCall) &#125; &#125; promoteAndExecute()&#125; æ¥ä¸€ä¸ªè¯·æ±‚å°±æŠŠä»–æ·»åŠ åˆ°å°±ç»ªè¯·æ±‚é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå°±æ¥åˆ¤æ–­forWebSocketè¿™ä¸ªå±æ€§ã€‚çœ‹åˆ°è¿™ä¸ªå±æ€§æˆ‘è¿˜è¿·äº†ä¸‹ï¼Œæœ‰ç‚¹æä¸æ‡‚å¥¹æ˜¯å¹²å˜›çš„ï¼Œç„¶åç»è¿‡æˆ‘çš„ä¸€ç•ªæœç´¢åï¼Œå‘ç°åŸæ¥OkHttpè¿˜å¯ä»¥è¿›è¡ŒWebSocketé€šä¿¡ï¼Œè€Œè¿™ä¸ªå±æ€§å°±æ˜¯ä¸ºWebSocketé€šä¿¡å‡†å¤‡çš„ã€‚äºæ˜¯æˆ‘å°±åˆ°RealCallé‡Œé¢æ‰¾åœ¨å“ªå„¿å®šä¹‰äº†è¿™ä¸ªå±æ€§äº†ï¼Œç„¶åæˆ‘å°±å‘ç°äº†åœ¨RealCallçš„newRealCall()æ–¹æ³•è¿™å—ï¼Œè¿™ä¸ªæ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸­æœ‰ä¸€ä¸ªBooleanå€¼åå­—å°±å«forWebSocketã€‚ 123456789101112companion object &#123; fun newRealCall( client: OkHttpClient, originalRequest: Request, forWebSocket: Boolean ): RealCall &#123; // Safely publish the Call instance to the EventListener. return RealCall(client, originalRequest, forWebSocket).apply &#123; transmitter = Transmitter(client, this) &#125; &#125;&#125; ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å°è±¡ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡ï¼Œæ‰§è¡ŒOkHttpClient.newCall()æ–¹æ³•å®é™…ä¸Šæ˜¯è¿”å›äº†ä¸€ä¸ªRealCallå¯¹è±¡ï¼Œäºæ˜¯åœ¨é‚£æ‰¾åˆ°äº†è¿™ä¸ªçš„ç­”æ¡ˆï¼ŒforWebSocket=falseæ‰€ä»¥è¯´è¿™ä¸ªifå’±ä»¬ä¸ç”¨ç®¡ï¼Œç›´æ¥çœ‹promoteAndExecute()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031private fun promoteAndExecute(): Boolean &#123; // ä¸çŸ¥é“å¤§å®¶è¿˜è®°ä¸è®°å¾—å’±ä»¬ä¹‹å‰è¯´çš„kotliné‡Œé¢çš„check()è¯­æ³•ï¼Œ // è¿™ä¸ªå’Œcheckä¹Ÿä¸€æ ·ï¼Œåªä¸è¿‡æŠ›å‡ºçš„æ˜¯AssertionErrorå¼‚å¸¸ assert(!Thread.holdsLock(this)) // mutableListOfæ˜¯kotliné‡Œé¢çš„å¯å˜listé›†åˆ val executableCalls = mutableListOf&lt;AsyncCall&gt;() val isRunning: Boolean synchronized(this) &#123; val i = readyAsyncCalls.iterator() while (i.hasNext()) &#123; val asyncCall = i.next() if (runningAsyncCalls.size &gt;= this.maxRequests) break // æœ€å¤§å®¹é‡ if (asyncCall.callsPerHost().get() &gt;= this.maxRequestsPerHost) continue // ä¸»æœºæœ€å¤§å®¹é‡ i.remove() asyncCall.callsPerHost().incrementAndGet() executableCalls.add(asyncCall) runningAsyncCalls.add(asyncCall) &#125; isRunning = runningCallsCount() &gt; 0 &#125; for (i in 0 until executableCalls.size) &#123; val asyncCall = executableCalls[i] asyncCall.executeOn(executorService) &#125; return isRunning&#125; é¦–å…ˆå°†å·²å°±ç»ªé˜Ÿåˆ—éå†ä¸€éï¼Œåˆ¤æ–­æ­£åœ¨è¿è¡Œçš„æ•°é‡æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºçš„è¯ç›´æ¥é€€å‡ºå¾ªç¯ï¼›å¦‚æœä¸å¤§äºåˆ™åœ¨åˆ¤æ–­è¿™ä¸ªè¯·æ±‚çš„ä¸»æœºè¯·æ±‚æ•°æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æ¯ä¸ªä¸»æœºæœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºå°±è·³è¿‡è¿™ä¸ªè¯·æ±‚æ¢ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼›ä¸å¤§äºå°±æŠŠå®ƒè°ƒå…¥æ­£åœ¨è¿è¡Œçš„è¯·æ±‚é˜Ÿåˆ—é‡Œé¢ï¼Œç›´åˆ°éå†å®Œæˆã€‚ç„¶ååˆ¤æ–­è¿˜æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚ï¼Œå¦‚æœæœ‰å°±isRunningç½®trueã€‚æ¥ç€å†å–å‡ºexecutableCallsé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæ‰§è¡ŒexecutteOn()æ–¹æ³•ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹AsyncCallçš„executeOn()æ–¹æ³•ï¼š 1234567891011121314151617fun executeOn(executorService: ExecutorService) &#123; assert(!Thread.holdsLock(client.dispatcher)) var success = false try &#123; executorService.execute(this) success = true &#125; catch (e: RejectedExecutionException) &#123; val ioException = InterruptedIOException("executor rejected") ioException.initCause(e) transmitter.noMoreExchanges(ioException) responseCallback.onFailure(this@RealCall, ioException) &#125; finally &#123; if (!success) &#123; client.dispatcher.finished(this) // This call is no longer running! &#125; &#125;&#125; è¿™æ®µä»£ç å°±æ˜¯åœ¨æ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œå°±å°†successç½®trueï¼Œå¦‚æœä¸æˆåŠŸï¼Œåˆ™æŠ›å¼‚å¸¸å¹¶è¿”å›ç»™responseCallbackçš„onFailure()æ–¹æ³•ã€‚å¹¶ä¸”å¦‚æœæ²¡æœ‰æˆåŠŸæ‰§è¡Œä¹Ÿå°±æ˜¯successä¸ºfalseï¼Œé‚£ä¹ˆåœ¨finallyä¸­å°±ä¼šæ‰§è¡Œclient.dispatcher.finished()æ–¹æ³•: 1234internal fun finished(call: AsyncCall) &#123; call.callsPerHost().decrementAndGet() finished(runningAsyncCalls, call) &#125; è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„AsyncCallçš„callsPerHostç»™å‡1ï¼Œç„¶åå†è°ƒç”¨äº†finished()æ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªfinished()æ–¹æ³•ï¼š 12345678910111213private fun &lt;T&gt; finished(calls: Deque&lt;T&gt;, call: T) &#123; val idleCallback: Runnable? synchronized(this) &#123; if (!calls.remove(call)) throw AssertionError("Call wasn't in-flight!") idleCallback = this.idleCallback &#125; val isRunning = promoteAndExecute() if (!isRunning &amp;&amp; idleCallback != null) &#123; idleCallback.run() &#125;&#125; ä»–è®²æ­¤æ¬¡è¯·æ±‚ä»runningAsyncCallsä¸­ç§»é™¤ï¼Œç„¶åæ‰§è¡Œäº†promoteAndExecute()æ–¹æ³•ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä»–çš„è¿”å›å€¼å°±æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ªè¿è¡Œé˜Ÿåˆ—ä¸­è¿˜æœ‰æ²¡æœ‰è¯·æ±‚ï¼Œå¦‚æœè¿˜æœ‰å°±è¿”å›trueï¼Œæ²¡æœ‰å°±falseã€‚æ¥ç€ä¸€ä¸ªifï¼Œåˆ¤æ–­isRunningå’ŒidleCallbackçš„ï¼Œé‚£ä¹ˆå¦‚æœå½“å‰è¿™ä¸ªè¯·æ±‚è¿˜æ²¡æœ‰æ‰§è¡Œçš„è¯ï¼Œå°±è°ƒç”¨run()æ–¹æ³•æ‰§è¡Œå½“å‰è¯·æ±‚ã€‚è¿™æ ·æ¯ä¸ªè¯·æ±‚éƒ½æ‰§è¡Œå®Œæ¯•äº†ã€‚é‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ä»–çš„run()æ–¹æ³•ï¼š 1234567891011121314151617181920override fun run() &#123; threadName("OkHttp $&#123;redactedUrl()&#125;") &#123; var signalledCallback = false transmitter.timeoutEnter() try &#123; val response = getResponseWithInterceptorChain() signalledCallback = true responseCallback.onResponse(this@RealCall, response) &#125; catch (e: IOException) &#123; if (signalledCallback) &#123; // Do not signal the callback twice! Platform.get().log(INFO, "Callback failure for $&#123;toLoggableString()&#125;", e) &#125; else &#123; responseCallback.onFailure(this@RealCall, e) &#125; &#125; finally &#123; client.dispatcher.finished(this) &#125; &#125;&#125; è¿™å—è°ƒç”¨äº†ä¸€ä¸ªgetResponseWithInterceptorChain()æ–¹æ³•ï¼Œå¹¶è¿”å›äº†responseï¼Œå¹¶å°†å®ƒè¿”å›ç»™äº†responseCallback.onResponse()æ–¹æ³•ã€‚å¦‚æœå¤±è´¥äº†å°±å°†ç»“æœè¿”å›ç»™responseCallback.onFailure()æ–¹æ³•ã€‚æœ€åè°ƒç”¨client.dispatcher.finished()æ–¹æ³•ã€‚ 2.1.3 Interceptoræ‹¦æˆªå™¨2.1.3.1 getResponseWithInterceptorChain()æ–¹æ³•é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹getResponseWithInterceptorChain()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334@Throws(IOException::class)fun getResponseWithInterceptorChain(): Response &#123; // Build a full stack of interceptors. val interceptors = mutableListOf&lt;Interceptor&gt;() interceptors += client.interceptors interceptors += RetryAndFollowUpInterceptor(client) interceptors += BridgeInterceptor(client.cookieJar) interceptors += CacheInterceptor(client.cache) interceptors += ConnectInterceptor if (!forWebSocket) &#123; interceptors += client.networkInterceptors &#125; interceptors += CallServerInterceptor(forWebSocket) val chain = RealInterceptorChain(interceptors, transmitter, null, 0, originalRequest, this, client.connectTimeoutMillis, client.readTimeoutMillis, client.writeTimeoutMillis) var calledNoMoreExchanges = false try &#123; val response = chain.proceed(originalRequest) if (transmitter.isCanceled) &#123; response.closeQuietly() throw IOException("Canceled") &#125; return response &#125; catch (e: IOException) &#123; calledNoMoreExchanges = true throw transmitter.noMoreExchanges(e) as Throwable &#125; finally &#123; if (!calledNoMoreExchanges) &#123; transmitter.noMoreExchanges(null) &#125; &#125;&#125; é¦–å…ˆå°±åˆ›å»ºäº†ä¸€å¤§å †çš„è¿æ¥å™¨å¹¶æ·»åŠ åˆ°interceptorsé›†åˆä¸­ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªRealInterceptorChainå¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†ä»–çš„proceed()æ–¹æ³•ï¼Œæ¥ç€ä¸»è¦ç›®çš„å°±æ˜¯è®²proceed()è¿”å›çš„responseç»™è¿”å›å»ã€‚é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹RealInterceptorChainçš„proceed()æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738override fun proceed(request: Request): Response &#123; return proceed(request, transmitter, exchange)&#125; @Throws(IOException::class)fun proceed(request: Request, transmitter: Transmitter, exchange: Exchange?): Response &#123; if (index &gt;= interceptors.size) throw AssertionError() calls++ // If we already have a stream, confirm that the incoming request will use it. check(this.exchange == null || this.exchange.connection()!!.supportsUrl(request.url)) &#123; "network interceptor $&#123;interceptors[index - 1]&#125; must retain the same host and port" &#125; // If we already have a stream, confirm that this is the only call to chain.proceed(). check(this.exchange == null || calls &lt;= 1) &#123; "network interceptor $&#123;interceptors[index - 1]&#125; must call proceed() exactly once" &#125; // Call the next interceptor in the chain. val next = RealInterceptorChain(interceptors, transmitter, exchange, index + 1, request, call, connectTimeout, readTimeout, writeTimeout) val interceptor = interceptors[index] @Suppress("USELESS_ELVIS") val response = interceptor.intercept(next) ?: throw NullPointerException( "interceptor $interceptor returned null") // Confirm that the next interceptor made its required call to chain.proceed(). check(exchange == null || index + 1 &gt;= interceptors.size || next.calls == 1) &#123; "network interceptor $interceptor must call proceed() exactly once" &#125; check(response.body != null) &#123; "interceptor $interceptor returned a response with no body" &#125; return response &#125; é¦–å…ˆå°±æ˜¯ä¸€ä¸ªindexï¼Œindexæ˜¯RealInterceptorChainæ„é€ å™¨ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œå¥¹æ˜¯ç¬¬å››ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹getResponseWithInterceptorChain()æ–¹æ³•ä¸­åˆ›å»ºRealInterceptorChainå¯¹è±¡æ—¶æ„é€ å™¨çš„ç¬¬å››ä¸ªä¼ å…¥çš„å€¼ä¸º0ã€‚ç„¶ååˆ¤æ–­indexçš„å€¼æ˜¯ä¸æ˜¯å¤§äºinterceptorsçš„å¤§å°ï¼Œå¦‚æœå¤§äºå°±æŠ›å¼‚å¸¸ï¼Œå¦åˆ™å°±ç»§ç»­ä¸€é¡¿æ£€æŸ¥ï¼ï¼ï¼ç„¶åå†åˆ›å»ºRealInterceptorChainå¯¹è±¡ï¼Œæ­¤æ—¶åˆ›å»ºçš„å¯¹è±¡ä¼ å…¥çš„indexä¸ºæ­¤æ—¶çš„index+1ï¼Œç„¶åå†è°ƒç”¨interceptorçš„intercept()æ–¹æ³•ï¼Œå¹¶è¿”å›responseã€‚ interceptorçš„intercept()ä½œç”¨æ˜¯å½“å­˜åœ¨å¤šä¸ªæ‹¦æˆªå™¨æ—¶éƒ½ä¼šåœ¨ä¸Šé¢ä»£ç æ³¨é‡Š1å¤„é˜»å¡ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨çš„è°ƒç”¨è¿”å›ã€‚ 2.1.3.2 Interceptoræºç é‚£ç°åœ¨æˆ‘ä»¬å†æ¥è®²å‡ ä¸ªé‡è¦çš„æ‹¦æˆªå™¨å§ã€‚OkHttpä¸­Interceptorçš„å®ç°ç±»æœ‰ï¼š ConnectInterceptorï¼šè¿æ¥æ‹¦æˆªå™¨ã€‚ CallServerInterceptorï¼šè¯·æ±‚æœåŠ¡å™¨æ‹¦æˆªå™¨ CacheInterceptorï¼šç¼“å­˜æ‹¦æˆªå™¨ BridgeInterceptorï¼šæ¡¥æ¢æ‹¦æˆªå™¨ã€‚ å…¶ä¸­è¾ƒä¸ºé‡è¦çš„å°±æ˜¯ConnectInterceptorå’ŒCallServerInterceptorï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªã€‚ 2.1.3.2.1 ConnectInterceptorè¿™ä¸ªç±»ä¸»è¦ç”¨æ¥å®ç°ç½‘ç»œè¯·æ±‚è¿æ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„interceptæ–¹æ³•ï¼š 123456789101112@Throws(IOException::class)override fun intercept(chain: Interceptor.Chain): Response &#123; val realChain = chain as RealInterceptorChain val request = realChain.request() val transmitter = realChain.transmitter() // We need the network to satisfy this request. Possibly for validating a conditional GET. val doExtensiveHealthChecks = request.method != "GET" val exchange = transmitter.newExchange(chain, doExtensiveHealthChecks) return realChain.proceed(request, transmitter, exchange)&#125; è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„chainå¯¹è±¡é€ å‹æˆäº†RealInterceptorChainçš„å¯¹è±¡ï¼Œè¿™ä¸ªç±»æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°è¿‡ï¼Œç„¶åè°ƒç”¨ä»–çš„response()å’Œtransmitter()æ–¹æ³•ï¼Œåˆ†åˆ«å¾—åˆ°å½“å‰chainçš„responseå’Œtransmitterã€‚ç„¶åæ‰§è¡Œäº†requestçš„method()æ–¹æ³•ï¼Œåˆ¤æ–­requestçš„ç±»å‹æ˜¯ä¸æ˜¯GETï¼Œå¦‚æœæ˜¯doExtensiveHealthCheckså°±ä¸ºfalseï¼Œå¦åˆ™ä¸ºtrueï¼Œæ¥ç€æŠŠdoExtensiveHealthChecksä¼ å…¥transmitterçš„newExchange()æ–¹æ³•ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ç­‰ä¼šå†è¯´ï¼Œç„¶åå†è°ƒç”¨äº†proceed()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åœ¨ä¸Šé¢è¯´è¿‡ã€‚ 2.1.3.2.2 CallServerInterceptorè¿™ä¸ªç±»æ˜¯ç½‘ç»œè¯·æ±‚çš„æœ¬è´¨ã€‚å®ƒçš„interceptæ–¹æ³•æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103@Throws(IOException::class) override fun intercept(chain: Interceptor.Chain): Response &#123; val realChain = chain as RealInterceptorChain val exchange = realChain.exchange() val request = realChain.request() val requestBody = request.body val sentRequestMillis = System.currentTimeMillis() // å†™å…¥è¯·æ±‚å¤´ exchange.writeRequestHeaders(request) var responseHeadersStarted = false var responseBuilder: Response.Builder? = null // å†™å…¥è¯·æ±‚ä½“ä¿¡æ¯ if (HttpMethod.permitsRequestBody(request.method) &amp;&amp; requestBody != null) &#123; // å¦‚æœè¯·æ±‚ä¸Šæœ‰â€œexpect:100 continueâ€å¤´ // è¯·ç­‰å¾…â€œhttp/1.1 100 continueâ€å“åº”ï¼Œç„¶åå†ä¼ è¾“è¯·æ±‚ä¸»ä½“. // å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¾—åˆ°ï¼Œè¿”å›æˆ‘ä»¬å¾—åˆ°çš„ï¼ˆä¾‹å¦‚4xxå“åº”ï¼‰ï¼Œè€Œä¸ä¼ è¾“è¯·æ±‚ä½“ã€‚ if ("100-continue".equals(request.header("Expect"), ignoreCase = true)) &#123; exchange.flushRequest() responseHeadersStarted = true exchange.responseHeadersStart() responseBuilder = exchange.readResponseHeaders(true) &#125; if (responseBuilder == null) &#123; if (requestBody.isDuplex()) &#123; // å‡†å¤‡ä¸€ä¸ªåŒå·¥ä¸»ä½“ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºç¨åå¯ä»¥å‘é€è¯·æ±‚ä¸»ä½“ã€‚ exchange.flushRequest() val bufferedRequestBody = exchange.createRequestBody(request, true).buffer() requestBody.writeTo(bufferedRequestBody) &#125; else &#123; // å¦‚æœæ»¡è¶³â€œexpect:100 continueâ€é¢„æœŸï¼Œåˆ™ç¼–å†™è¯·æ±‚æ­£æ–‡ã€‚ val bufferedRequestBody = exchange.createRequestBody(request, false).buffer() requestBody.writeTo(bufferedRequestBody) bufferedRequestBody.close() &#125; &#125; else &#123; exchange.noRequestBody() if (!exchange.connection()!!.isMultiplexed) &#123; // å¦‚æœä¸æ»¡è¶³â€œexpect:100 continueâ€çš„è¦æ±‚ï¼Œè¯·é˜²æ­¢é‡ç”¨HTTP/1è¿æ¥ã€‚ // å¦åˆ™ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¹‰åŠ¡ä¼ è¾“è¯·æ±‚ä¸»ä½“ä»¥ä½¿è¿æ¥ä¿æŒä¸€è‡´çŠ¶æ€ã€‚ exchange.noNewExchangesOnConnection() &#125; &#125; &#125; else &#123; exchange.noRequestBody() &#125; // ç»“æŸè¯·æ±‚ if (requestBody == null || !requestBody.isDuplex()) &#123; exchange.finishRequest() &#125; if (!responseHeadersStarted) &#123; exchange.responseHeadersStart() &#125; if (responseBuilder == null) &#123; responseBuilder = exchange.readResponseHeaders(false)!! &#125; // è¯»å–å“åº”å¤´ä¿¡æ¯ var response = responseBuilder .request(request) .handshake(exchange.connection()!!.handshake()) .sentRequestAtMillis(sentRequestMillis) .receivedResponseAtMillis(System.currentTimeMillis()) .build() var code = response.code if (code == 100) &#123; // æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ª100ç»§ç»­ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¯·æ±‚ã€‚ // å†æ¬¡å°è¯•è¯»å–å®é™…å“åº” response = exchange.readResponseHeaders(false)!! .request(request) .handshake(exchange.connection()!!.handshake()) .sentRequestAtMillis(sentRequestMillis) .receivedResponseAtMillis(System.currentTimeMillis()) .build() code = response.code &#125; exchange.responseHeadersEnd(response) // openResponseBody è·å–å“åº”ä½“ä¿¡æ¯ response = if (forWebSocket &amp;&amp; code == 101) &#123; // è¿æ¥æ­£åœ¨å‡çº§ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿æ‹¦æˆªå™¨çœ‹åˆ°éç©ºçš„å“åº”ä¸»ä½“ã€‚ response.newBuilder() .body(EMPTY_RESPONSE) .build() &#125; else &#123; response.newBuilder() .body(exchange.openResponseBody(response)) .build() &#125; if ("close".equals(response.request.header("Connection"), ignoreCase = true) || "close".equals(response.header("Connection"), ignoreCase = true)) &#123; exchange.noNewExchangesOnConnection() &#125; if ((code == 204 || code == 205) &amp;&amp; response.body?.contentLength() ?: -1L &gt; 0L) &#123; throw ProtocolException( "HTTP $code had non-zero Content-Length: $&#123;response.body?.contentLength()&#125;") &#125; //è¿”å›ä¸€ä¸ªå“åº” return response&#125; å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå®ƒä¸»è¦æ˜¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®å’Œæ¥å—æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚ 2.1.4 TransmiterTransmitterç±»æ˜¯OkHttpçš„åº”ç”¨å±‚å’Œç½‘ç»œå±‚çš„ä¸€ä¸ªæ¡¥æ¢ç±»ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¯¥ç±»çš„åˆå§‹åŒ–ï¼š 12345678910111213class Transmitter( private val client: OkHttpClient, private val call: Call) &#123; private val connectionPool: RealConnectionPool = client.connectionPool.delegate private val eventListener: EventListener = client.eventListenerFactory.create(call) private val timeout = object : AsyncTimeout() &#123; override fun timedOut() &#123; cancel() &#125; &#125;.apply &#123; timeout(client.callTimeoutMillis.toLong(), MILLISECONDS) &#125; Transmitterä¸»è¦çš„ä¸€äº›æˆå‘˜å˜é‡å°±è¿™äº›ï¼Œé¦–å…ˆæ„é€ å™¨ä¸­ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªOkHttpClientï¼Œä¸€ä¸ªCallã€‚ç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ªè¿æ¥æ± connectionPoolï¼Œè¿˜æœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•è¿™ä¸ªç±»æ¥ç›‘å¬ç¨‹åºçš„HTTPçš„è°ƒç”¨æ•°é‡ã€å¤§å°å’ŒæŒç»­æ—¶é—´ã€‚ 2.1.5 RealConnectionæˆ‘ä»¬å…ˆçœ‹çœ‹ä»–çš„ä¸€äº›å±æ€§ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class RealConnection( val connectionPool: RealConnectionPool, private val route: Route) : Http2Connection.Listener(), Connection &#123; // ä»¥ä¸‹å­—æ®µç”±connectï¼ˆï¼‰åˆå§‹åŒ–ï¼Œä»ä¸é‡æ–°åˆ†é…ã€‚ // åº•å±‚socket private var rawSocket: Socket? = null /** * åº”ç”¨å±‚å¥—æ¥å­—ã€‚å¦‚æœæ­¤è¿æ¥ä¸ä½¿ç”¨SSLï¼Œåˆ™å¯ä»¥æ˜¯[sslsocket]åˆ†å±‚åœ¨[rawsocket]ä¸Šï¼Œä¹Ÿå¯ä»¥æ˜¯[rawsocket]æœ¬èº«ã€‚ */ // åº”ç”¨å±‚socket private var socket: Socket? = null // æ¡æ‰‹ private var handshake: Handshake? = null // åè®® private var protocol: Protocol? = null // http2çš„è¿æ¥ private var http2Connection: Http2Connection? = null // ä¸æœåŠ¡å™¨äº¤äº’çš„è¾“å…¥è¾“å‡ºæµ private var source: BufferedSource? = null private var sink: BufferedSink? = null // è·Ÿè¸ªè¿æ¥çŠ¶æ€ä¸‹çš„å­—æ®µç”±è¿æ¥æ± ä¿æŠ¤ã€‚ /** * å¦‚æœä¸ºtrueï¼Œåˆ™ä¸èƒ½åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°çš„äº¤æ¢ã€‚ä¸€æ—¦æ˜¯trueçš„ï¼Œè¿™æ€»æ˜¯trueçš„ã€‚ * ç”±[ConnectionPool]ç›‘è§†ã€‚ */ var noNewExchanges = false /** * å»ºç«‹å¯èƒ½ç”±äºæ‰€é€‰è·¯ç”±è€Œå¯¼è‡´çš„æµæ—¶å‡ºç°é—®é¢˜çš„æ¬¡æ•°ã€‚ç”±[ConnectionPool]ä¿æŠ¤ã€‚ */ internal var routeFailureCount = 0 internal var successCount = 0 private var refusedStreamCount = 0 /** * æ­¤è¿æ¥å¯ä»¥æ‰¿è½½çš„æœ€å¤§å¹¶å‘æµæ•°ã€‚ * å¦‚æœâ€œallocations.sizeï¼ˆï¼‰&lt;allocationlimitâ€ï¼Œåˆ™å¯ä»¥åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°æµã€‚ */ private var allocationLimit = 1 æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä»–çš„connect()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788fun connect( connectTimeout: Int, readTimeout: Int, writeTimeout: Int, pingIntervalMillis: Int, connectionRetryEnabled: Boolean, call: Call, eventListener: EventListener) &#123; check(protocol == null) &#123; "already connected" &#125; // çº¿è·¯çš„é€‰æ‹© var routeException: RouteException? = null val connectionSpecs = route.address.connectionSpecs val connectionSpecSelector = ConnectionSpecSelector(connectionSpecs) if (route.address.sslSocketFactory == null) &#123; if (ConnectionSpec.CLEARTEXT !in connectionSpecs) &#123; throw RouteException(UnknownServiceException( "CLEARTEXT communication not enabled for client")) &#125; val host = route.address.url.host if (!Platform.get().isCleartextTrafficPermitted(host)) &#123; throw RouteException(UnknownServiceException( "CLEARTEXT communication to $host not permitted by network security policy")) &#125; &#125; else &#123; if (Protocol.H2_PRIOR_KNOWLEDGE in route.address.protocols) &#123; throw RouteException(UnknownServiceException( "H2_PRIOR_KNOWLEDGE cannot be used with HTTPS")) &#125; &#125; // è¿æ¥å¼€å§‹ while (true) &#123; try &#123; // å¦‚æœè¦æ±‚éš§é“æ¨¡å¼ï¼Œå»ºç«‹é€šé“è¿æ¥ï¼Œé€šå¸¸ä¸æ˜¯è¿™ç§ if (route.requiresTunnel()) &#123; connectTunnel(connectTimeout, readTimeout, writeTimeout, call, eventListener) if (rawSocket == null) &#123; // æˆ‘ä»¬æ— æ³•è¿æ¥éš§é“ï¼Œä½†é€‚å½“å…³é—­äº†æˆ‘ä»¬çš„èµ„æºã€‚ break &#125; &#125; else &#123; // ä¸€èˆ¬éƒ½èµ°è¿™æ¡é€»è¾‘äº†ï¼Œå®é™…ä¸Šå¾ˆç®€å•å°±æ˜¯socketçš„è¿æ¥ connectSocket(connectTimeout, readTimeout, call, eventListener) &#125; // httpsçš„å»ºç«‹ establishProtocol(connectionSpecSelector, pingIntervalMillis, call, eventListener) eventListener.connectEnd(call, route.socketAddress, route.proxy, protocol) break &#125; catch (e: IOException) &#123; socket?.closeQuietly() rawSocket?.closeQuietly() socket = null rawSocket = null source = null sink = null handshake = null protocol = null http2Connection = null eventListener.connectFailed(call, route.socketAddress, route.proxy, null, e) if (routeException == null) &#123; routeException = RouteException(e) &#125; else &#123; routeException.addConnectException(e) &#125; if (!connectionRetryEnabled || !connectionSpecSelector.connectionFailed(e)) &#123; throw routeException &#125; &#125; &#125; if (route.requiresTunnel() &amp;&amp; rawSocket == null) &#123; throw RouteException(ProtocolException( "Too many tunnel connections attempted: $MAX_TUNNEL_ATTEMPTS")) &#125; val http2Connection = this.http2Connection if (http2Connection != null) &#123; synchronized(connectionPool) &#123; allocationLimit = http2Connection.maxConcurrentStreams() &#125; &#125;&#125; é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»å»ºç«‹è¿æ¥ï¼Œå¦‚æœå·²ç»å»ºç«‹å°±æŠ›å¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯å°±ç»§ç»­ã€‚æ¥ç€å°±å¾—åˆ°äº†ConnectionSpecsï¼Œç„¶åæ ¹æ®ä»–å»ºç«‹äº†ä¸€ä¸ªconnectionSpecSelectoré›†åˆã€‚æ¥ç€åˆ¤æ–­æ˜¯ä¸æ˜¯å®‰å…¨è¿æ¥ï¼Œä¹Ÿå°±æ˜¯sslè¿æ¥ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±åˆ¤æ–­äº†ä¸€äº›å±æ€§ï¼Œå…ˆç¡®å®šæ˜¯ä¸æ˜¯æ˜æ–‡ç„¶åå†ç¡®å®šä¸»æœºèƒ½ä¸èƒ½æ¥å—æ˜æ–‡æ“ä½œã€‚æ¥ç€å°±å¼€å§‹è¿æ¥ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è¦è¿›è¡Œéš§é“é€šä¿¡ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨connectTunnel()å»ºç«‹éš§é“é€šä¿¡ï¼Œå¦‚æœä¸æ˜¯å°±è°ƒç”¨connectSocket()å»ºç«‹æ™®é€šçš„é€šä¿¡ã€‚ç„¶åé€šè¿‡establishProtocol()å»ºç«‹åè®®ã€‚å¦‚æœæ˜¯HTTP/2å°±è®¾ç½®ç›¸å…³å±æ€§ã€‚ ç„¶åæˆ‘ä»¬å°±æ¥çœ‹çœ‹ä»–å…·ä½“å¦‚ä½•å®ç°çš„ï¼Œå…ˆçœ‹çœ‹connectSocket()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243@Throws(IOException::class)private fun connectSocket( connectTimeout: Int, readTimeout: Int, call: Call, eventListener: EventListener) &#123; val proxy = route.proxy val address = route.address // æ ¹æ®ä»£ç†ç±»å‹é€‰æ‹©socketç±»å‹æ˜¯ä»£ç†è¿˜æ˜¯ç›´è¿ val rawSocket = when (proxy.type()) &#123; Proxy.Type.DIRECT, Proxy.Type.HTTP -&gt; address.socketFactory.createSocket()!! else -&gt; Socket(proxy) &#125; this.rawSocket = rawSocket eventListener.connectStart(call, route.socketAddress, proxy) rawSocket.soTimeout = readTimeout try &#123; // è¿æ¥socketï¼Œä¹‹æ‰€ä»¥è¿™æ ·å†™æ˜¯å› ä¸ºæ”¯æŒä¸åŒçš„å¹³å° // é‡Œé¢å®é™…ä¸Šæ˜¯ socket.connect(address, connectTimeout); Platform.get().connectSocket(rawSocket, route.socketAddress, connectTimeout) &#125; catch (e: ConnectException) &#123; throw ConnectException("Failed to connect to $&#123;route.socketAddress&#125;").apply &#123; initCause(e) &#125; &#125; // ä¸‹é¢çš„Try/Catchå—æ˜¯ä¸€ç§é¿å…Android 7.0å´©æºƒçš„ä¼ªé»‘å®¢æ–¹æ³• // More details: // https://github.com/square/okhttp/issues/3245 // https://android-review.googlesource.com/#/c/271775/ try &#123; // å¾—åˆ°è¾“å…¥ï¼è¾“å‡ºæµ source = rawSocket.source().buffer() sink = rawSocket.sink().buffer() &#125; catch (npe: NullPointerException) &#123; if (npe.message == NPE_THROW_WITH_NULL) &#123; throw IOException(npe) &#125; &#125;&#125; é¦–å…ˆå…ˆåˆ¤æ–­è¿æ¥ç±»å‹ï¼Œå¦‚æœæ˜¯ç›´è¿æˆ–è€…HTTPè¿æ¥å°±ç›´è¿ï¼Œå¦åˆ™çš„è¯èµ°Socketä»£ç†ï¼Œç„¶åé€šè¿‡eventListener.connectStart()æ–¹æ³•åˆ›å»ºè¿æ¥ï¼Œå†è®¾å®šè¶…æ—¶-&gt;å®Œæˆè¿æ¥-&gt;åˆ›å»ºç”¨äºI/Oçš„sourceå’Œsinkã€‚ æˆ‘ä»¬æ¥ç€å†æ¥çœ‹connectTunnel()æ–¹æ³•ï¼š 123456789101112131415161718192021222324@Throws(IOException::class)private fun connectTunnel( connectTimeout: Int, readTimeout: Int, writeTimeout: Int, call: Call, eventListener: EventListener) &#123; var tunnelRequest: Request = createTunnelRequest() val url = tunnelRequest.url for (i in 0 until MAX_TUNNEL_ATTEMPTS) &#123; connectSocket(connectTimeout, readTimeout, call, eventListener) tunnelRequest = createTunnel(readTimeout, writeTimeout, tunnelRequest, url) ?: break // å·²æˆåŠŸåˆ›å»ºéš§é“ã€‚ // ä»£ç†å†³å®šåœ¨èº«ä»½éªŒè¯è´¨è¯¢åå…³é—­è¿æ¥ã€‚ // æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œä½†è¿™æ¬¡éœ€è¦ä½¿ç”¨èº«ä»½éªŒè¯å‡­æ®ã€‚ rawSocket?.closeQuietly() rawSocket = null sink = null source = null eventListener.connectEnd(call, route.socketAddress, route.proxy, null) &#125;&#125; å¤§ä½“å°±æ˜¯å…ˆåˆ›å»ºéš§é“è¯·æ±‚ï¼Œç„¶åå»ºç«‹socketè¿æ¥ï¼Œå†å‘é€è¯·æ±‚å»ºç«‹éš§é“ã€‚ 3. è¯·æ±‚æµç¨‹å›¾é‚£æˆ‘ä»¬æœ€åæ¥æ€»ç»“ä¸‹ 3.1 åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ 3.2 å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>æºç </tag>
        <tag>OkHttp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚2--è§£æVolleyæºç ]]></title>
    <url>%2Fposts%2Fdf8fd75e.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡å¤§ç¯‡å¹…å‚è€ƒæ­¤ç¯‡æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸¤ç¯‡æ–‡ç« çœ‹ä¸€ä¸‹ 1. Volleyç®€ä»‹åœ¨å¾ˆæ—©ä»¥å‰ï¼Œå¦‚æœAndroidå¼€å‘è€…æƒ³ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå¿…é¡»è‡ªå·±é€šè¿‡HttpClientæˆ–è€…HttpURLConnectionç¼–å†™ä»£ç æ¥è®¿é—®ã€‚ä½†æ˜¯ä»–ä¸¤çš„ç”¨æ³•è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œå¦‚æœä¸é€‚å½“çš„å°è£…çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤šä½™ä»£ç ç”šè‡³æ•ˆç‡é™ä½ã€‚æ‰€ä»¥å½“æ—¶å‡ºç°äº†å¾ˆå¤šç¬¬ä¸‰æ–¹ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œä½†æ˜¯éƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ï¼Œè€Œè°·æ­Œå®˜æ–¹ä¸€ç›´æ²¡æœ‰ä½œä¸ºã€‚æœ€ç»ˆåœ¨2013å¹´ï¼Œè°·æ­Œç»ˆäºæ„è¯†åˆ°äº†é—®é¢˜ï¼Œäºæ˜¯ä»–ä»¬æ¨å‡ºäº†ä¸€ä¸ªå®˜æ–¹çš„å…¨æ–°çš„ç½‘ç»œæ¡†æ¶â€”â€”Volleyã€‚Volleyå®ƒåˆèƒ½éå¸¸ç®€å•çš„è¿›è¡ŒHTTPé€šä¿¡ï¼Œåˆèƒ½è½»æ¾åŠ è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚ä»–çš„è®¾è®¡ç›®çš„å°±æ˜¯åº”å¯¹æ•°æ®é‡ä¸å¤§ä½†æ˜¯é¢‘å‘çš„ç½‘ç»œæ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸‹è½½ç­‰éœ€è¦å¤§æ•°æ®é‡çš„ç½‘ç»œæ“ä½œï¼Œä»–å°±ä¸å¤ªé€‚åˆã€‚ 2. æºç è§£æ2.1 ä»RequestQueueå…¥æ‰‹å¦‚æœä½ ä½¿ç”¨Volleyçš„è¯ï¼Œå°±ä¼šå‘ç°Volleyä¸ç®¡è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œé¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯å…ˆåˆ›å»ºRequestQueueå¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä»–ä¸ºVolleyçš„å…¥å£ã€‚åˆ›å»ºRequestQueueçš„æ–¹æ³•æ˜¯RequestQueue mQueue = Volley.newRequestQueue(getApplicationContext());,æˆ‘ä»¬å°±çœ‹çœ‹newRequestQueueå¹²äº†ä»€ä¹ˆï¼š 1234567891011121314151617181920212223242526272829public static RequestQueue newRequestQueue(Context context, BaseHttpStack stack) &#123; BasicNetwork network; if (stack == null) &#123; if (Build.VERSION.SDK_INT &gt;= 9) &#123; network = new BasicNetwork(new HurlStack()); &#125; else &#123; // åœ¨Android 2.3ä¹‹å‰ï¼ŒHttpURLConnectionæ˜¯ä¸å¯é çš„ã€‚ // è¯·å‚é˜…ï¼šhttp://android-developers.blogspot.com/2011/09/androids-http-clients.html // åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°†æŠŠminsdkversionç§»åˆ°Android 2.2ä¹‹ä¸Šï¼Œ // å¹¶å¯ä»¥åˆ é™¤è¿™ä¸ªå›é€€ï¼ˆè¿åŒæ‰€æœ‰ApacheHTTPä»£ç ï¼‰ã€‚ String userAgent = "volley/0"; try &#123; String packageName = context.getPackageName(); PackageInfo info = context.getPackageManager().getPackageInfo(packageName, /* flags= */ 0); userAgent = packageName + "/" + info.versionCode; &#125; catch (NameNotFoundException e) &#123; &#125; network = new BasicNetwork( new HttpClientStack(AndroidHttpClient.newInstance(userAgent))); &#125; &#125; else &#123; network = new BasicNetwork(stack); &#125; return newRequestQueue(context, network);&#125; è°ƒç”¨æ–¹æ³•åï¼Œå…ˆæŸ¥çœ‹Androidç‰ˆæœ¬æ˜¯å¦å¤§äºç­‰äº2.3ï¼Œå¦‚æœå¤§äºåˆ™è°ƒç”¨åŸºäºHttpURLConnectionçš„HurlStackï¼Œå¦åˆ™è°ƒç”¨åŸºäºHttpClientçš„HttpClientStackã€‚æ¥ä¸‹æ¥åˆ›å»ºBasicNetworkå¹¶è°ƒç”¨newRequestQueue(context, network)æ–¹ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªnewRequestQueue()æ–¹æ³•ï¼š 1234567891011121314151617181920private static RequestQueue newRequestQueue(Context context, Network network) &#123; final Context appContext = context.getApplicationContext(); // å¯¹ç¼“å­˜ç›®å½•ä½¿ç”¨æƒ°æ€§ä¾›åº”å•†ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨newRequestQueueï¼ˆï¼‰ï¼Œ // è€Œä¸ä¼šå¯¼è‡´ä¸¥æ ¼çš„æ¨¡å¼å†²çªã€‚ DiskBasedCache.FileSupplier cacheSupplier = new DiskBasedCache.FileSupplier() &#123; private File cacheDir = null; @Override public File get() &#123; if (cacheDir == null) &#123; cacheDir = new File(appContext.getCacheDir(), DEFAULT_CACHE_DIR); &#125; return cacheDir; &#125; &#125;; RequestQueue queue = new RequestQueue(new DiskBasedCache(cacheSupplier), network); queue.start(); return queue;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ä¸ºVolleyåˆ›å»ºäº†ä¸€ä¸ªç¡¬ç›˜ç¼“å­˜DiskBasedCacheï¼Œç„¶åé€šè¿‡è¿™ä¸ªç£ç›˜ç¼“å­˜å’ŒNetworkåˆ›å»ºäº†ä¸€ä¸ªRequestQueueå¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†start()æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹start()æ–¹æ³•: 123456789101112131415public void start() &#123; stop(); // ç¡®ä¿å½“å‰è¿è¡Œçš„æ‰€æœ‰è°ƒåº¦ç¨‹åºéƒ½å·²åœæ­¢ã€‚ // åˆ›å»ºç¼“å­˜è°ƒåº¦å™¨å¹¶å¼€å§‹å®ƒã€‚ mCacheDispatcher = new CacheDispatcher(mCacheQueue, mNetworkQueue, mCache, mDelivery); mCacheDispatcher.start(); // åˆ›å»ºè¾¾åˆ°æ± å¤§å°çš„ç½‘ç»œè°ƒåº¦ç¨‹åºï¼ˆå’Œç›¸åº”çš„çº¿ç¨‹ï¼‰ã€‚ for (int i = 0; i &lt; mDispatchers.length; i++) &#123; NetworkDispatcher networkDispatcher = new NetworkDispatcher(mNetworkQueue, mNetwork, mCache, mDelivery); mDispatchers[i] = networkDispatcher; networkDispatcher.start(); &#125;&#125; CacheDispatcheræ˜¯ä¸€ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œå¹¶è°ƒç”¨äº†start()æ–¹æ³•ã€‚åœ¨å¾ªç¯ä¸­è°ƒç”¨NetworkDispatcherçš„start()æ–¹æ³•ã€‚NetworkDispatcheræ˜¯ç½‘ç»œè°ƒåº¦çº¿ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹mDispatchers.lengthä¸º4ï¼Œé»˜è®¤å¼€å¯äº†4ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œå¤–åŠ 1ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œæ€»å…±5ä¸ªçº¿ç¨‹ã€‚æ¥ä¸‹æ¥Volleyä¼šåˆ›å»ºå„ç§Requestï¼Œå¹¶è°ƒç”¨RequestQueueçš„add()æ–¹æ³•ï¼š 123456789101112131415161718192021public &lt;T&gt; Request&lt;T&gt; add(Request&lt;T&gt; request) &#123; // å°†è¯·æ±‚æ ‡è®°ä¸ºå±äºæ­¤é˜Ÿåˆ—ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰è¯·æ±‚é›†ã€‚ request.setRequestQueue(this); synchronized (mCurrentRequests) &#123; //mCurrentRequestsæ˜¯ä¸€ä¸ªHashSet mCurrentRequests.add(request); &#125; // æŒ‰æ·»åŠ çš„é¡ºåºå¤„ç†è¯·æ±‚ã€‚ request.setSequence(getSequenceNumber()); request.addMarker("add-to-queue"); sendRequestEvent(request, RequestEvent.REQUEST_QUEUED); // å¦‚æœè¯·æ±‚æ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œè·³è¿‡ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åç›´æ¥è¿›å…¥ç½‘ç»œã€‚ if (!request.shouldCache()) &#123; mNetworkQueue.add(request); return request; &#125; mCacheQueue.add(request); return request;&#125; è¿™å—åœ°æ–¹çš„ä»£ç å°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯æ ¹æ®requestçš„shouldCache()æ–¹æ³•æ¥è¿”å›requestçš„mShouldCacheå±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ç¼“å­˜ï¼Œé»˜è®¤æ˜¯å¯ä»¥çš„ã€‚å¦‚æœèƒ½ç¼“å­˜ï¼Œå°†æ­¤è¯·æ±‚åŠ å…¥mCacheQueueé˜Ÿåˆ—ï¼Œä¸å†é‡å¤è¯·æ±‚ï¼›ä¸å¯ä»¥çš„è¯å°±å°†è¯·æ±‚åŠ å…¥ç½‘ç»œè¯·æ±‚é˜Ÿåˆ—mNetworkQueueã€‚ 2.2 CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹RequestQueueçš„add()æ–¹æ³•å¹¶æ²¡æœ‰è¯·æ±‚ç½‘ç»œæˆ–è€…å¯¹ç¼“å­˜è¿›è¡Œæ“ä½œã€‚å½“å°†è¯·æ±‚æ·»åŠ åˆ°ç½‘ç»œè¯·æ±‚é˜Ÿ åˆ—æˆ–è€…ç¼“å­˜é˜Ÿåˆ—æ—¶ï¼Œåœ¨åå°çš„ç½‘ç»œè°ƒåº¦çº¿ç¨‹å’Œç¼“å­˜è°ƒåº¦çº¿ç¨‹è½®è¯¢å„è‡ªçš„è¯·æ±‚é˜Ÿåˆ—ï¼Œè‹¥å‘ç°æœ‰è¯·æ±‚ä»»åŠ¡åˆ™å¼€ å§‹æ‰§è¡Œã€‚ä¸‹é¢å…ˆçœ‹çœ‹ç¼“å­˜è°ƒåº¦çº¿ç¨‹ã€‚ é¦–å…ˆå…ˆæ¥çœ‹çœ‹CacheDispatcherçš„add()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627@Overridepublic void run() &#123; if (DEBUG) VolleyLog.v("start new dispatcher"); Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); // Process.THREAD_PRIORITY_BACKGROUNDé»˜è®¤å€¼ä¸º10 // è¿›è¡Œé˜»å¡è°ƒç”¨ä»¥åˆå§‹åŒ–ç¼“å­˜ã€‚ mCache.initialize(); while (true) &#123; try &#123; processRequest(); &#125; catch (InterruptedException e) &#123; // å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™è¦é€€å‡ºäº†ã€‚ if (mQuit) &#123; Thread.currentThread().interrupt(); return; &#125; VolleyLog.e( "Ignoring spurious interrupt of CacheDispatcher thread; " + "use quit() to terminate it"); // å¿½ç•¥cachedispatcherçº¿ç¨‹çš„å‡ä¸­æ–­ï¼› // ä½¿ç”¨quitï¼ˆï¼‰ç»ˆæ­¢å®ƒ &#125; &#125;&#125; è¿™å—å¯ä»¥çœ‹å‡ºä¸»è¦å°±æ˜¯åˆå§‹åŒ–äº†ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åå¼€äº†ä¸ªæ­»å¾ªç¯ï¼Œä¸€ç›´è°ƒç”¨processRequest()ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182private void processRequest() throws InterruptedException &#123; // ä»CacheQueueä¸­å–å‡ºä¸€ä¸ªå¯ç”¨çš„request final Request&lt;?&gt; request = mCacheQueue.take(); processRequest(request);&#125;@VisibleForTestingvoid processRequest(final Request&lt;?&gt; request) throws InterruptedException &#123; request.addMarker("cache-queue-take"); request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_STARTED); try &#123; //requestå¦‚æœè¢«å–æ¶ˆäº†ï¼Œå°±ç›´æ¥è¿”å› if (request.isCanceled()) &#123; request.finish("cache-discard-canceled"); return; &#125; Cache.Entry entry = mCache.get(request.getCacheKey()); // æ²¡æœ‰ç¼“å­˜å°±æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­ if (entry == null) &#123; request.addMarker("cache-miss"); // æ²¡æœ‰ç¼“å­˜ï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰æ­¤requestï¼Œé‚£ä¹ˆå°±ç›´æ¥åŠ å…¥åˆ°NetworkQueueä¸­ if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; mNetworkQueue.put(request); &#125; return; &#125; // å¦‚æœç¼“å­˜è¿‡æœŸäº†ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­ if (entry.isExpired()) &#123; request.addMarker("cache-hit-expired"); request.setCacheEntry(entry); if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; mNetworkQueue.put(request); &#125; return; &#125; // æœ‰ç¼“å­˜å¹¶ä¸”æ²¡æœ‰è¿‡æœŸ request.addMarker("cache-hit"); // æ ¹æ®ç¼“å­˜çš„å†…å®¹è§£æ Response&lt;?&gt; response = request.parseNetworkResponse( new NetworkResponse(entry.data, entry.responseHeaders)); request.addMarker("cache-hit-parsed"); // æ˜¯å¦éœ€è¦æ›´æ–° if (!entry.refreshNeeded()) &#123; // ä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); &#125; else &#123; request.addMarker("cache-hit-refresh-needed"); request.setCacheEntry(entry); response.intermediate = true; // åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒç¼“å­˜é”®çš„ä»»åŠ¡åœ¨æ‰§è¡Œ if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; // éœ€è¦æ›´æ–°ç»“æœï¼Œå…ˆå°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åæ‰§è¡Œnew runnable()&#123;&#125; // runnableä¸­å°±æ˜¯å°†requestæ·»åŠ åˆ°NetworkQueueä¸­ï¼Œæ›´æ–°ä¸€ä¸‹å†…å®¹ mDelivery.postResponse( request, response, new Runnable() &#123; @Override public void run() &#123; try &#123; mNetworkQueue.put(request); &#125; catch (InterruptedException e) &#123; // Restore the interrupted status Thread.currentThread().interrupt(); &#125; &#125; &#125;); &#125; else &#123; // requestå·²ç»åŠ å…¥åˆ°mWaitingRequestsä¸­ // ç›´æ¥æŠŠç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); &#125; &#125; &#125; finally &#123; request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_FINISHED); &#125;&#125; æˆ‘ä»¬åœ¨processRequestä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ–¹æ³•ç»å¸¸å‡ºç°ï¼Œé‚£å°±æ˜¯mWaitingRequestManager.maybeAddToWaitingRequests(request)ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ªrequestæ˜¯å¦æœ‰å­˜åœ¨ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªrequeståŠ å…¥åˆ°ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å®Œæˆã€‚ æ€»ç»“ä¸€ä¸‹CacheDispatcherä¸»è¦æ­¥éª¤ï¼š ä»CacheQueueä¸­å¾ªç¯å–å‡ºrequestï¼› å¦‚æœç¼“å­˜ä¸¢å¤±ï¼ŒåŠ å…¥åˆ°NetworkQueueä¸­ï¼› å¦‚æœç¼“å­˜è¿‡æœŸï¼ŒåŠ å…¥åˆ°NetworkQueueä¸­ï¼› å°†ç¼“å­˜ä¸­çš„æ•°æ®è§£ææˆResponseå¯¹è±¡ï¼› å¦‚æœä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œå›è°ƒæ“ä½œç­‰ä»‹ç»å®ŒNetworkDispatcherä¹‹åä¸€èµ·æ·±å…¥å‰–æï¼› å¦‚æœéœ€è¦æ›´æ–°ï¼Œå…ˆå°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åå†å°†requeståŠ å…¥åˆ°NetworkQueueä¸­ã€‚ ä¸‹é¢æ¥çœ‹çœ‹ç½‘ç»œè°ƒåº¦çº¿ç¨‹ã€‚ 2.3 NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹NetworkDispatcherçš„runæ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤º: 123456789101112131415161718@Overridepublic void run() &#123; Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); while (true) &#123; try &#123; processRequest(); &#125; catch (InterruptedException e) &#123; // æˆ‘ä»¬å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™é€€å‡ºäº†ã€‚ if (mQuit) &#123; Thread.currentThread().interrupt(); return; &#125; VolleyLog.e( "Ignoring spurious interrupt of NetworkDispatcher thread; " + "use quit() to terminate it"); &#125; &#125;&#125; ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒNetWordDispatchå’ŒCacheDispatchéå¸¸ç±»ä¼¼ã€‚ä»–çš„run()æ–¹æ³•å’ŒCacheDispatchçš„æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿™å°±ä¸å¤šåšä»‹ç»ï¼Œä¸‹é¢æ¥çœ‹çœ‹ä»–çš„processRequest()æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263private void processRequest() throws InterruptedException &#123; // ä»NetworkQueueä¸­å–å‡ºrequest Request&lt;?&gt; request = mQueue.take(); processRequest(request);&#125;@VisibleForTestingvoid processRequest(Request&lt;?&gt; request) &#123; long startTimeMs = SystemClock.elapsedRealtime(); request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_STARTED); try &#123; request.addMarker("network-queue-take"); // å¦‚æœrequestè¢«å–æ¶ˆäº†ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œæ­¤request if (request.isCanceled()) &#123; request.finish("network-discard-cancelled"); request.notifyListenerResponseNotUsable(); return; &#125; addTrafficStatsTag(request); // è¿˜è®°å¾—è¿™ä¸ªmNetworkä¹ˆï¼Œå®ƒå°±æ˜¯Volley.newRequestQueue()æ–¹æ³•é‡Œçš„BasicNetworkå¯¹è±¡ï¼Œä¸€ä¼šæˆ‘ä»¬æ¥çœ‹çœ‹mNetwork.performRequest()æ–¹æ³•æ˜¯å¦‚ä½•å¾—åˆ°NetworkResponseçš„ NetworkResponse networkResponse = mNetwork.performRequest(request); request.addMarker("network-http-complete"); // notModifiedæ˜¯æœåŠ¡ç«¯è¿”å›304ï¼ŒhasHadResponseDelivered()æ˜¯requestå·²ç»å›è°ƒè¿‡äº† if (networkResponse.notModified &amp;&amp; request.hasHadResponseDelivered()) &#123; request.finish("not-modified"); request.notifyListenerResponseNotUsable(); return; &#125; // å°†NetworkResponseè§£ææˆResponseå¯¹è±¡ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ Response&lt;?&gt; response = request.parseNetworkResponse(networkResponse); request.addMarker("network-parse-complete"); // å°†requestå†™å…¥ç¼“å­˜ if (request.shouldCache() &amp;&amp; response.cacheEntry != null) &#123; mCache.put(request.getCacheKey(), response.cacheEntry); request.addMarker("network-cache-written"); &#125; request.markDelivered(); // å›è°ƒç»“æœè‡³ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); request.notifyListenerResponseReceived(response); &#125; // ä»¥ä¸‹éƒ½æ˜¯å¤„ç†å¼‚å¸¸é”™è¯¯ï¼Œç„¶åä¹Ÿéœ€è¦å›è°ƒè‡³ä¸»çº¿ç¨‹ catch (VolleyError volleyError) &#123; volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs); parseAndDeliverNetworkError(request, volleyError); request.notifyListenerResponseNotUsable(); &#125; catch (Exception e) &#123; VolleyLog.e(e, "Unhandled exception %s", e.toString()); VolleyError volleyError = new VolleyError(e); volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs); mDelivery.postError(request, volleyError); request.notifyListenerResponseNotUsable(); &#125; finally &#123; request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_FINISHED); &#125;&#125; é€šè¿‡NetworkDispatcher.processRequest()æ–¹æ³•å¯ä»¥å‘ç°ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š é€šè¿‡BasicNetwork.performRequest(request)å¾—åˆ°NetworkResponseå¯¹è±¡ï¼› é€šè¿‡request.parseNetworkResponse(networkResponse)è§£æå¾—åˆ°Responseå¯¹è±¡ï¼› é€šè¿‡mDeliveryå°†æˆåŠŸç»“æœæˆ–è€…å¤±è´¥ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ã€‚ ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ¥åˆ†æè¿™ä¸‰æ­¥ï¼š è¯·æ±‚ç½‘ç»œï¼Œå¾—åˆ°NetworkResponse æˆ‘ä»¬çœ‹çœ‹BasicNetworkçš„performRequest()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627@Overridepublic NetworkResponse performRequest(Request&lt;?&gt; request) throws VolleyError &#123; long requestStart = SystemClock.elapsedRealtime(); while (true) &#123; HttpResponse httpResponse = null; byte[] responseContents = null; List&lt;Header&gt; responseHeaders = Collections.emptyList(); try &#123; // Gather headers. Map&lt;String, String&gt; additionalRequestHeaders = getCacheHeaders(request.getCacheEntry()); httpResponse = mBaseHttpStack.executeRequest(request, additionalRequestHeaders); int statusCode = httpResponse.getStatusCode(); responseHeaders = httpResponse.getHeaders(); // Handle cache validation. if (statusCode == HttpURLConnection.HTTP_NOT_MODIFIED) &#123; Entry entry = request.getCacheEntry(); if (entry == null) &#123; return new NetworkResponse( HttpURLConnection.HTTP_NOT_MODIFIED, /* data= */ null, /* notModified= */ true, SystemClock.elapsedRealtime() - requestStart, responseHeaders); &#125; â€¦â€¦â€¦â€¦çœç•¥ é€šè¿‡ä¸Šé¢æºç å¯ä»¥çœ‹å‡ºï¼ŒBasicNetworkå°±æ˜¯å°è£…äº†ä¸€ä¸‹NetworkResponseï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥åˆ°BaseHttpStack.executeRequest(request, additionalRequestHeaders)æºç ä¸­ã€‚ 123public abstract HttpResponse executeRequest( Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders) throws IOException, AuthFailureError; è¿™æ—¶å‘ç°è¿™ä¸ªBaseHttpStackå°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œè¿™ä¸ªexecuteRequest()ä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚æˆ‘å½“æ—¶å°±å¡åœ¨è¿™äº†ï¼Œè°ƒç”¨äº†ä¸€ä¸ªæŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿™å’‹æ“ä½œå˜›ã€‚ç„¶åæˆ‘å°±å¥½å¥½å†çœ‹äº†ä¸€éï¼Œæ‰¾åˆ°BasicNetworkçš„æ„é€ å‡½æ•°ä¸­å¯¹mBaseHttpStckå®šä¹‰çš„åœ°æ–¹ï¼Œå‘ç°è¿™ä¸ªæ˜¯æ„é€ å‡½æ•°ä¼ è¿›æ¥çš„ï¼Œç„¶åå°±æƒ³åˆ°äº†åœ¨è°ƒç”¨Volley.newRequestQueue()æ—¶ï¼Œæ˜¯æ ¹æ®Androidç‰ˆæœ¬ä¼ å…¥äº†ä¸åŒçš„Stackï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹HurlStack.executeRequest()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@Overridepublic HttpResponse executeRequest(Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders) throws IOException, AuthFailureError &#123; String url = request.getUrl(); HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.putAll(additionalHeaders); // request.getheadersï¼ˆï¼‰ä¼˜å…ˆäºç»™å®šçš„é™„åŠ ï¼ˆç¼“å­˜ï¼‰å¤´. map.putAll(request.getHeaders()); if (mUrlRewriter != null) &#123; String rewritten = mUrlRewriter.rewriteUrl(url); if (rewritten == null) &#123; throw new IOException("URL blocked by rewriter: " + url); &#125; url = rewritten; &#125; URL parsedUrl = new URL(url); HttpURLConnection connection = openConnection(parsedUrl, request); boolean keepConnectionOpen = false; try &#123; for (String headerName : map.keySet()) &#123; connection.setRequestProperty(headerName, map.get(headerName)); &#125; setConnectionParametersForRequest(connection, request); // ä½¿ç”¨æ¥è‡ªhttpurlConnectionçš„æ•°æ®åˆå§‹åŒ–httpResponseã€‚ int responseCode = connection.getResponseCode(); if (responseCode == -1) &#123; // å¦‚æœæ— æ³•æ£€ç´¢å“åº”ä»£ç ï¼ŒgetResponseCodeï¼ˆï¼‰å°†è¿”å›-1ã€‚ // å‘å‘¼å«è€…å‘å‡ºä¿¡å·ï¼Œè¯´æ˜è¿æ¥æœ‰é—®é¢˜ã€‚ throw new IOException("Could not retrieve response code from HttpUrlConnection."); &#125; if (!hasResponseBody(request.getMethod(), responseCode)) &#123; return new HttpResponse(responseCode, convertHeaders(connection.getHeaderFields())); &#125; // éœ€è¦ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°è°ƒç”¨æ–¹ä½¿ç”¨æµã€‚åŒ…è£…æµï¼Œä»¥ä¾¿closeï¼ˆï¼‰å°†æ–­å¼€è¿æ¥ã€‚ keepConnectionOpen = true; return new HttpResponse( responseCode, convertHeaders(connection.getHeaderFields()), connection.getContentLength(), new UrlConnectionInputStream(connection)); &#125; finally &#123; if (!keepConnectionOpen) &#123; connection.disconnect(); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦å°±æ˜¯å€ŸåŠ©äº†HttpURLConnectionå¯¹è±¡æ¥è¯·æ±‚ç½‘ç»œï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¡ä»¶è¿”å›ä¸åŒçš„HttpResponseå¯¹è±¡ã€‚ è§£æNetworkResponse, å¾—åˆ°Responseï¼š è§£æè¿‡ç¨‹æ˜¯å®šä¹‰åœ¨Requestç±»ä¸­ï¼Œä½†æ˜¯ä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸åŒçš„Requestéƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œæˆ‘ä»¬ç°åœ¨å°±ä»¥JsonRequestä¸ºä¾‹çœ‹çœ‹ï¼šç„¶åå‘ç°ä»–åˆæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹JsonRequestå…¶ä¸­ä¸€ä¸ªå®ç°ç±»JsonObjectRequestçš„parseNetworkResponse()æ–¹æ³•ï¼š 123456789101112131415@Overrideprotected Response&lt;JSONObject&gt; parseNetworkResponse(NetworkResponse response) &#123; try &#123; String jsonString = new String( response.data, HttpHeaderParser.parseCharset(response.headers, PROTOCOL_CHARSET)); return Response.success( new JSONObject(jsonString), HttpHeaderParser.parseCacheHeaders(response)); &#125; catch (UnsupportedEncodingException e) &#123; return Response.error(new ParseError(e)); &#125; catch (JSONException je) &#123; return Response.error(new ParseError(je)); &#125;&#125; è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ï¼Œæ ¹æ®è¿”å›æ¥çš„responseå»ºäº†ä¸€ä¸ªStringç„¶åæŠŠè¿™ä¸ªStringæ”¾åˆ°Responseé‡Œé¢å»ç„¶åå†è¿”å›å»ã€‚ å›è°ƒä¸»çº¿ç¨‹å›è°ƒä¸»è¦æ˜¯é€šè¿‡Deliveryçš„postResponse()æ–¹æ³•å®ç°çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•,æ‰¾è¿‡å»åˆæ‰¾åˆ°äº†ä¸€ä¸ªResponseDeliveryæŠ½è±¡ç±»ï¼Œç„¶ååˆå¾—æ‰¾ä»–çš„å®ç°ç±»ï¼Œè¿™æ—¶å¤§å®¶åº”è¯¥è®°å¾—RequestQueue()çš„æ—¶å€™åˆå§‹åŒ–äº†ä¸€ä¸ªDeliveryï¼š 1234567public RequestQueue(Cache cache, Network network, int threadPoolSize) &#123; this( cache, network, threadPoolSize, new ExecutorDelivery(new Handler(Looper.getMainLooper())));&#125; ä»–è¿”å›äº†ä¸€ä¸ªExecutorDeliveryï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œç„¶åå°±æƒŠå–œçš„å‘ç°ï¼Œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿äº†ï¼š 123456789101112131415/** * Creates a new response delivery interface. * * @param handler &#123;@link Handler&#125; to post responses on */public ExecutorDelivery(final Handler handler) &#123; // Make an Executor that just wraps the handler. mResponsePoster = new Executor() &#123; @Override public void execute(Runnable command) &#123; handler.post(command); &#125; &#125;;&#125; çŸ¥é“äº†å®ƒçš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°å›è°ƒçš„ï¼š Volleyä¸­å›è°ƒæ˜¯é€šè¿‡postResponse()æ–¹æ³•çš„ : 12345678910public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response) &#123; postResponse(request, response, null);&#125;@Overridepublic void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response, Runnable runnable) &#123; request.markDelivered(); request.addMarker("post-response"); mResponsePoster.execute(new ResponseDeliveryRunnable(request, response, runnable));&#125; postResponse()æœ€ç»ˆä¼šè°ƒç”¨mResponsePosterå¯¹è±¡çš„execute()æ–¹æ³•ï¼Œä¼ å…¥äº†ä¸€ä¸ªResponseDeliveryRunnableå¯¹è±¡ï¼Œå®ƒå®ç°äº†Runnableæ¥å£ï¼Œexecute()æ–¹æ³•ä¼šé€šè¿‡Handler.post(runnable)å°†ResponseDeliveryRunnableæ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªResponseDeliveryRunnableçš„run()æ–¹æ³•åœ¨ä¸»çº¿ç¨‹ä¸­åšäº†ä»€ä¹ˆæ“ä½œï¼š 12345678910111213141516171819202122232425262728293031@SuppressWarnings("unchecked")@Overridepublic void run() &#123; // If this request has canceled, finish it and don't deliver. if (mRequest.isCanceled()) &#123; mRequest.finish("canceled-at-delivery"); return; &#125; if (mResponse.isSuccess()) &#123; // æ‰§è¡ŒæˆåŠŸçš„å›è°ƒï¼Œåœ¨å…·ä½“çš„Requestå®ç°ç±»ä¸­ï¼Œæ¯”å¦‚StringRequestå°±ä¼šè°ƒç”¨listener.onResponse(string)å›è°ƒ mRequest.deliverResponse(mResponse.result); &#125; else &#123; // æ‰§è¡Œå¤±è´¥çš„å›è°ƒï¼Œåœ¨requestä¸­ï¼Œç›´æ¥å›è°ƒäº†listener.onErrorResponse(error) mRequest.deliverError(mResponse.error); &#125; // intermediateé»˜è®¤ä¸ºfalseï¼Œä½†æ˜¯åœ¨CacheDispatcherçš„run()ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°ç¼“å­˜ï¼Œé‚£ä¹ˆå°±ä¼šç½®ä¸ºtrue if (mResponse.intermediate) &#123; mRequest.addMarker("intermediate-response"); &#125; else &#123; mRequest.finish("done"); &#125; // å¦‚æœä¼ å…¥äº†runnableä¸ä¸ºç©ºï¼Œé‚£å°±å°±æ‰§è¡Œrunnable.run()æ–¹æ³• // å›å¿†ä¸‹åœ¨CacheDispatcherçš„run()æ–¹æ³•ä¸­ï¼Œå¦‚æœrequestæœ‰ç¼“å­˜ï¼Œä½†æ˜¯éœ€è¦æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼ŒmDeliveryæ˜¯ä¸æ˜¯è°ƒç”¨çš„å¸¦runnableçš„æ–¹æ³• if (mRunnable != null) &#123; mRunnable.run(); &#125;&#125; 3 è¯·æ±‚æµç¨‹å›¾æœ€åé™„ä¸ŠVolleyçš„è¯·æ±‚æµç¨‹å›¾]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>Volley</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ2--è¿›ç¨‹çš„æè¿°å’Œæ§åˆ¶]]></title>
    <url>%2Fposts%2F2e847144.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 [TOC] 2.1 è¿›ç¨‹çš„æè¿°2.1.1 è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾2.1.1.1 è¿›ç¨‹çš„å®šä¹‰ä¸ºäº†èƒ½å¤Ÿä½¿ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥å¯¹å¹¶å‘æ‰§è¡Œçš„ç¨‹åºåŠ ä»¥æè¿°å’Œæ§åˆ¶ï¼Œäººä»¬å¼•å…¥äº†â€œè¿›ç¨‹â€çš„æ¦‚å¿µã€‚ä¸ºäº†ä½¿å‚ä¸å¹¶å‘æ‰§è¡Œçš„æ¯ä¸ªç¨‹åºéƒ½èƒ½ç‹¬ç«‹åœ°è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹é…ç½®ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„ï¼Œç§°ä¸ºè¿›ç¨‹æ•°æ®å—ï¼ˆPCBï¼‰ã€‚ä»–ç”¨æ¥çºªå½•è¿›ç¨‹çš„å„ç§å±æ€§ï¼Œæè¿°è¿›ç¨‹çš„åŠ¨æ€å˜åŒ–è¿‡ç¨‹ã€‚ä¸»è¦åŒ…å«æœ‰è¿›ç¨‹çš„æè¿°ä¿¡æ¯ï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹åï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹ç»„å…³ç³»ç­‰ï¼‰ã€è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ï¼ˆå½“å‰çŠ¶æ€ï¼Œä¼˜å…ˆçº§ï¼Œä»£ç æ‰§è¡Œå…¥å£åœ°å€ï¼Œä¿å­˜çš„ç£ç›˜åœ°å€ç­‰ç­‰ï¼‰ã€æ‰€æ‹¥æœ‰çš„èµ„æºå’Œä½¿ç”¨æƒ…å†µï¼ˆè™šæ‹Ÿåœ°å€ç©ºé—´çš„çŠ¶æ€ï¼Œæ–‡ä»¶æ‰“å¼€åˆ—è¡¨ç­‰ï¼‰å’ŒCPUç°åœºä¿¡æ¯ç­‰å†…å®¹ã€‚PCBæ˜¯ç³»ç»Ÿæ„ŸçŸ¥è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å®ä½“å°±ç®€ç§°ä¸ºè¿›ç¨‹ï¼Œåˆ›å»ºè¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯åˆ›å»ºè¿›ç¨‹å®ä½“ä¸­çš„PCBï¼›æ’¤é”€è¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯æ’¤é”€è¿›ç¨‹çš„PCBã€‚å¯¹äºè¿›ç¨‹çš„å®šä¹‰ï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰ï¼š è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºåŠå…¶æ•°æ®åœ¨å¤„ç†æœºä¸Šé¡ºåºæ‰§è¡Œæ—¶æ‰€å‘ç”Ÿçš„æ´»åŠ¨ è¿›ç¨‹æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šè¿è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ 2.1.1.2 è¿›ç¨‹çš„ç‰¹å¾ ç»“æ„æ€§è¿›ç¨‹å®ä½“æ˜¯ç”±ç¨‹åºæ®µã€æ•°æ®æ®µåŠè¿›ç¨‹æ§åˆ¶å¿«ä¸‰éƒ¨åˆ†ç»„æˆã€‚ åŠ¨æ€æ€§è¿›ç¨‹çš„å®è´¨æ˜¯è¿›ç¨‹å®ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä¸”è¿›ç¨‹â€œç”±åˆ›å»ºè€Œäº§ç”Ÿï¼Œç”±è°ƒåº¦è€Œæ‰§è¡Œï¼Œç”±æ’¤é”€è€Œæ¶ˆäº¡â€ã€‚ å¹¶å‘æ€§å¤šä¸ªè¿›ç¨‹å®ä½“åŒå­˜äºå†…å­˜ä¸­ï¼Œä¸”èƒ½åœ¨ä¸€æ®µæ—¶é—´å†…åŒæ—¶è¿è¡Œã€‚ ç‹¬ç«‹æ€§è¿›ç¨‹å®ä½“æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹è·å¾—èµ„æºå’Œç‹¬ç«‹æ¥æ”¶è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚ å¼‚æ­¥æ€§è¿›ç¨‹æ˜¯æŒ‰å¼‚æ­¥æ–¹å¼è¿è¡Œçš„ã€‚ 2.1.2 è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢2.1.2.1 è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€è¿›ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š è¿è¡Œæ€æŒ‡è¿›ç¨‹å·²ç»è·å¾—äº†CPUï¼Œä»–æ­£åœ¨CPUä¸Šæ‰§è¡Œã€‚ å°±ç»ªæ€æŒ‡è¿›ç¨‹å·²ç»å‡†å¤‡å°±ç»ªï¼Œå‡†å¤‡å¥½äº†è¢«CPUæ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœç³»ç»Ÿä¸­æœ‰å¾ˆå¤šå¤„äºå°±ç»ªæ€çš„è¿›ç¨‹ï¼Œé€šå¸¸æŠŠä»–ä»¬æŒ‰ä¸€å®šçš„ç­–ç•¥æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ç§°ä¸ºå°±ç»ªé˜Ÿåˆ—ã€‚ ç­‰å¾…æ€æŒ‡æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ç”±äºå‘ç”ŸæŸäº‹ä»¶ï¼ˆå¦‚I/Oè¯·æ±‚ã€ç”³è¯·ç¼“å†²åŒºå¤±è´¥ç­‰é—®é¢˜ï¼‰æš‚æ—¶æ— æ³•ç»§ç»­æ‰§è¡Œæ—¶çš„çŠ¶æ€ã€‚æ­¤æ—¶å¼•èµ·è¿›ç¨‹è°ƒåº¦ï¼ŒOSæŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªä¸­çš„è¿›ç¨‹ï¼Œè®©å—é˜»çš„è¿›ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚ 2.1.2.2 ä¸‰ç§çŠ¶æ€çš„è½¬æ¢ 2.1.2.3 åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ä¸ºäº†æ»¡è¶³è¿›ç¨‹æ§åˆ¶å—å¯¹æ•°æ®åŠæ“ä½œçš„å®Œæ•´æ€§è¦æ±‚ä»¥åŠå¢å¼ºç®¡ç†çš„çµæ´»æ€§ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿä¸­åˆä¸ºè¿›ç¨‹å¼•å…¥äº†ä¸¤ç§å¸¸è§çš„çŠ¶æ€ï¼šåˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ã€‚ 2.1.3 è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„åœ¨æœ€å¼€å§‹æˆ‘å·²ç»ç»æåˆ°äº†è¿›ç¨‹æ§åˆ¶å—PCBè¿™ä¸ªä¸œè¥¿ï¼Œç°åœ¨æˆ‘ä»¬å°±è¿›ä¸€æ­¥æ¥äº†è§£ä»–ã€‚ 2.1.3.1 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨PCBçš„ä½œç”¨ä¸»è¦å°±æ˜¯ä½¿ä¸€ä¸ªåœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ä¸èƒ½ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºç§°ä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªèƒ½ä¸å…¶å®ƒè¿›ç¨‹å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ã€‚ ä½œä¸ºç‹¬ç«‹è¿è¡ŒåŸºæœ¬å•ä½çš„æ ‡å¿—ã€‚ å½“ä¸€ä¸ªç¨‹åºé…ç½®äº†PCBä¹‹åï¼Œå°±è¡¨ç¤ºä»–å·²æ˜¯ä¸€ä¸ªèƒ½åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ç‹¬ç«‹è¿è¡Œçš„ã€åˆæ³•çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±å…·æœ‰å–å¾—OSæœåŠ¡çš„æƒåˆ©ã€‚å½“ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå°±ä¸ºä»–åˆ›å»ºäº†ä¸€ä¸ªPCBï¼Œè¿›ç¨‹ç»“æŸåæ”¶å›PCBã€‚ èƒ½å®ç°é—´æ–­æ€§è¿è¡Œæ–¹å¼ã€‚ åœ¨å¤šé“ç¨‹åºè¿è¡Œç¯å¢ƒä¸‹ï¼Œç”±äºå­˜åœ¨æ—¶é—´ç‰‡æˆ–è€…æœ‰ç­‰å¾…I/Oè¯·æ±‚çš„æƒ…å†µï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èˆ¬éƒ½æ˜¯å‡ºäºèµ°èµ°åœåœçš„çŠ¶æ€ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡çš„æ—¶å€™ï¼Œä»–åº”è¯¥æœ‰ä¸€ç§èƒ½ä¿å­˜å½“å‰è¿è¡ŒçŠ¶æ€çš„èƒ½åŠ›ä¹Ÿå°±æ˜¯ä¿æŠ¤ç°åœºæœºåˆ¶ï¼Œæ–¹ä¾¿åœ¨æ­¤è¢«è°ƒåº¦æ‰§è¡Œæ—¶æ¢å¤é˜»å¡å‰çš„çŠ¶æ€ã€‚æ‰€ä»¥å°±éœ€è¦åœ¨PCBé‡Œé¢æä¾›ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ä¿å­˜è¯¥è¿›ç¨‹è¢«ä¸­æ–­æ—¶çš„ä¸€äº›ä¿¡æ¯ã€‚ æä¾›è¿›ç¨‹ç®¡ç†æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´å§ã€‚ æä¾›è¿›ç¨‹è°ƒåº¦æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ åªæœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œï¼Œè€Œåœ¨PCBä¸­å°±æä¾›äº†è¿›ç¨‹å¤„äºä½•ç§çŠ¶æ€çš„ä¿¡æ¯ã€‚ å®ç°ä¸å…¶å®ƒè¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡ã€‚ 2.1.3.2 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯æ ¹æ®ä¸Šé¢è¿›ç¨‹æ§åˆ¶å—ä½œç”¨çš„æè¿°ï¼Œå¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ä¸­å°±éœ€è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ã€‚ è¿›ç¨‹æ ‡è¯†ç¬¦ è¿›ç¨‹æ ‡è¯†ç¬¦ç”¨äºå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹é€šå¸¸å…·æœ‰ä¸¤ç§æ ‡è¯†ç¬¦ï¼š å¤–éƒ¨æ ‡è¯†ç¬¦ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰å¯¹è¿›ç¨‹çš„è®¿é—®ï¼Œè¿›ç¨‹éœ€è¦æä¾›ä¸€ä¸ªç”¨äºç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰è®¿é—®çš„æ ‡è¯†ç¬¦ã€‚ å†…éƒ¨æ ‡è¯†ç¬¦ ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿå¯¹è¿›ç¨‹çš„ä½¿ç”¨ï¼Œåœ¨OSä¸­åˆä¸ºè¿›ç¨‹è®¾ç½®äº†å†…éƒ¨æ ‡è¯†ç¬¦ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„åºå·ã€‚ å¤„ç†æœºçŠ¶æ€ å¤„ç†æœºçŠ¶æ€ä¿¡æ¯ä¹Ÿç§°ä¸ºå¤„ç†æœºçš„ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯ç”±å¤„ç†æœºçš„å„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹ç»„æˆçš„ã€‚è¿™äº›å¯„å­˜å™¨ä¿¡æ¯åŒ…æ‹¬é€šç”¨å¯„å­˜å™¨ã€æŒ‡ä»¤å¯„å­˜å™¨ã€ç¨‹åºçŠ¶æ€å­—PSWå’Œç”¨æˆ·æ ˆæŒ‡é’ˆã€‚ è¿›ç¨‹è°ƒåº¦ä¿¡æ¯ åœ¨OSè¿›è¡Œè°ƒåº¦çš„æ—¶å€™ï¼Œå¿…é¡»äº†è§£è¿›ç¨‹çš„çŠ¶æ€åŠæœ‰å…³è¿›ç¨‹è°ƒåº¦çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼šè¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹è°ƒåº¦æ‰€éœ€å…¶ä»–ä¿¡æ¯ï¼ˆä¸æ‰€é‡‡ç”¨çš„çš„è°ƒåº¦ç®—æ³•æœ‰å…³ï¼‰å’Œäº‹ä»¶ï¼ˆé˜»å¡åŸå› ï¼‰ã€‚ è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ ç”¨äºè¿›ç¨‹æ§åˆ¶æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç¨‹åºå’Œæ•°æ®çš„åœ°å€ã€è¿›ç¨‹åŒæ­¥å’Œé€šä¿¡æœºåˆ¶ã€èµ„æºæ¸…å•å’Œé“¾æ¥æŒ‡é’ˆã€‚ 2.1.3.3 è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼ä¸€ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šä¸ªPCBï¼Œä¸ºäº†å¯¹ä»–ä»¬è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ï¼Œåº”è¯¥ç”¨é€‚å½“çš„æ–¹å¼å°†è¿™äº›PCBç»„ç»‡èµ·æ¥ï¼Œå¸¸ç”¨çš„ç»„ç»‡æ–¹å¼æœ‰ä¸‰ç§ çº¿æ€§æ–¹å¼ç›´æ¥å°†æ‰€æœ‰PCBæ”¾åœ¨ä¸€å¼ çº¿æ€§è¡¨ä¸­ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ï¼Œå¼€é”€å°ï¼Œä½†æ˜¯æ¯æ¬¡æŸ¥æ‰¾èµ·æ¥å¾ˆéº»çƒ¦ã€‚ é“¾æ¥æ–¹å¼æŠŠå…·æœ‰ç›¸åŒçŠ¶æ€çš„PCBåˆ†åˆ«é€šè¿‡PCBä¸­çš„é“¾æ¥å­—é“¾æ¥æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ ç´¢å¼•æ–¹å¼æ ¹æ®æ‰€æœ‰è¿›ç¨‹çŠ¶æ€çš„ä¸åŒå»ºç«‹å‡ å¼ ç´¢å¼•è¡¨ï¼Œå¹¶æŠŠä¸ªç´¢å¼•è¡¨åœ¨å†…å­˜çš„é¦–åœ°å€çºªå½•åœ¨å†…å­˜çš„ä¸€äº›ä¸“ç”¨å•å…ƒä¸­ã€‚ 2.2 è¿›ç¨‹æ§åˆ¶2.2.1 è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„åœ¨OSä¸­ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šå¸¸æŠŠåˆ›å»ºè¿›ç¨‹çš„è¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œè¢«åˆ›å»ºçš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚ç„¶åå­è¿›ç¨‹å¯ä»¥ä½œä¸ºçˆ¶è¿›ç¨‹ç»§ç»­å»åˆ›å»ºå­è¿›ç¨‹ï¼Œè¿›è€Œå½¢æˆä¸€ä¸ªè¿›ç¨‹å®¶æ—ã€‚ 2.2.2 è¿›ç¨‹çš„åˆ›å»ºæ¯å½“å‡ºç°äº†åˆ›å»ºæ–°è¿›ç¨‹çš„è¯·æ±‚åï¼ŒOSä¾¿è°ƒç”¨è¿›ç¨‹åˆ›å»ºåŸè¯­CreatæŒ‰ä¸‹è¿°æ­¥éª¤åˆ›å»ºæ–°è¿›ç¨‹ï¼š ç”³è¯·ç©ºç™½PCBï¼Œä¸ºæ–°è¿›ç¨‹ç”³è¯·è·å¾—å”¯ä¸€çš„æ•°å­—æ ‡è¯†ç¬¦ï¼Œå¹¶ä»PCBé›†åˆä¸­ç´¢å–ä¸€ä¸ªç©ºç™½PCBã€‚ ä¸ºæ–°è¿›ç¨‹åˆ†é…å…¶è¿è¡Œæ‰€éœ€çš„èµ„æºï¼ŒåŒ…æ‹¬å„ç§ç‰©ç†å’Œé€»è¾‘èµ„æºã€‚ åˆå§‹åŒ–è¿›ç¨‹æ§åˆ¶å—PCBã€‚ å¦‚æœè¿›ç¨‹å°±ç»ªé˜Ÿåˆ—èƒ½å¤Ÿæ¥çº³æ–°è¿›ç¨‹ï¼Œä¾¿å°†æ–°è¿›ç¨‹æ’å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ 2.2.3 è¿›ç¨‹çš„ç»ˆæ­¢ æ ¹æ®è¢«ç»ˆæ­¢è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œä»PCBé›†åˆä¸­æ£€ç´¢å‡ºè¿›ç¨‹çš„PCBï¼Œä»ä¸­è¯»å‡ºè¯¥è¿›ç¨‹çš„çŠ¶æ€ã€‚ è‹¥è¢«ç»ˆæ­¢è¿›ç¨‹æ­£å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåº”ç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶ç½®è°ƒåº¦æ ‡å¿—ä½çœŸï¼Œç”¨äºæŒ‡ç¤ºè¯¥è¿›ç¨‹è¢«ç»ˆæ­¢ååº”é‡æ–°è¿›è¡Œè°ƒåº¦ã€‚ è‹¥è¯¥è¿›ç¨‹è¿˜æœ‰å­å­™è¿›ç¨‹ï¼Œè¿˜åº”å°†å…¶æ‰€æœ‰å­å­™è¿›ç¨‹ä¹Ÿéƒ½äºˆä»¥ç»ˆæ­¢ï¼Œä»¥é˜²å®ƒä»¬ç§°ä¸ºä¸å¯æ§çš„è¿›ç¨‹ã€‚ å°†è¢«ç»ˆæ­¢è¿›ç¨‹æ‰€æ‹¥æœ‰çš„çš„å…¨éƒ¨èµ„æºæˆ–è€…å½’è¿˜ç»™å…¶çˆ¶è¿›ç¨‹ï¼Œæˆ–è€…å½’è¿˜ç»™ç³»ç»Ÿã€‚ å°†è¢«ç»ˆæ­¢è¿›ç¨‹ï¼ˆPCBï¼‰ä»æ‰€åœ¨é˜Ÿåˆ—ï¼ˆæˆ–é“¾è¡¨ï¼‰ä¸­ç§»å‡ºï¼Œç­‰å¾…å…¶ä»–ç¨‹åºæ¥æœé›†ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ1--æ“ä½œç³»ç»Ÿæ¦‚è¿°]]></title>
    <url>%2Fposts%2F62248b34.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ1.1.1 PC1.1.1.1 WindowsMicrosoft Windowsæ˜¯å¾®è½¯å…¬å¸æ¨å‡ºçš„ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿã€‚å…¶é—®ä¸–æ—¶é—´ä¸º1985å¹´ï¼Œèµ·åˆä¸ºè¿è¡ŒäºMS-DOSä¹‹ä¸‹çš„æ¡Œé¢ç¯å¢ƒï¼Œå…¶åç»­ç‰ˆæœ¬é€æ¸å‘å±•æˆä¸ºä¸»è¦ä¸ºä¸ªäººè®¡ç®—æœºå’ŒæœåŠ¡å™¨ç”¨æˆ·è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆè·å¾—äº†ä¸–ç•Œä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„å„æ–­åœ°ä½ã€‚æ­¤æ“ä½œç³»ç»Ÿå¯ä»¥åœ¨å‡ ç§ä¸åŒç±»å‹çš„å¹³å°ä¸Šè¿è¡Œï¼Œå¦‚ä¸ªäººè®¡ç®—æœºã€ç§»åŠ¨è®¾å¤‡ã€æœåŠ¡å™¨å’ŒåµŒå…¥å¼ç³»ç»Ÿç­‰ç­‰ï¼Œå…¶ä¸­åœ¨ä¸ªäººè®¡ç®—æœºçš„é¢†åŸŸåº”ç”¨å†…æœ€ä¸ºæ™®éã€‚Windowsæ“ä½œç³»ç»Ÿå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯äº2015å¹´7æœˆ29æ—¥å‘å¸ƒçš„ Windows 10ã€‚Windows Serverå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´10æœˆ2æ—¥å‘å¸ƒçš„Windows Server 2019ã€‚Windows Phoneå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯Windows10 Mobileï¼Œä½†æ˜¯å·²åœæ­¢å¼€å‘æ–°ç‰ˆæœ¬ï¼Œä»…å¯¹ç°æœ‰ç‰ˆæœ¬è¿›è¡Œå®‰å…¨è¡¥ä¸å’Œç»´æŠ¤ï¼Œç›´åˆ°2019å¹´12æœˆã€‚ 1.1.1.2 macOSmacOSï¼ˆ2011å¹´åŠä¹‹å‰ç§°Mac OS Xï¼Œ2012å¹´è‡³2015å¹´ç§°OS Xï¼‰æ˜¯è‹¹æœå…¬å¸æ¨å‡ºçš„åŸºäºå›¾å½¢ç”¨æˆ·ç•Œé¢æ“ä½œç³»ç»Ÿï¼Œä¸ºéº¦é‡‘å¡”ï¼ˆMacintoshï¼‰çš„ä¸»æ“ä½œç³»ç»Ÿã€‚StatCounteråœ¨2018å¹´8æœˆçš„æ•°æ®è¡¨ç¤ºï¼Œåœ¨æ¡Œé¢æ“ä½œç³»ç»Ÿä¸­ï¼ŒmacOSçš„ä½¿ç”¨ä»½é¢ä¸º12.65%ï¼Œæ¬¡äºWindowsçš„82.51%ä½å±…ç¬¬äºŒã€‚macOSå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´9æœˆ25æ—¥å‘å¸ƒçš„macOS 10.14 Mojaveï¼Œ2019å¹´6æœˆ4æ—¥æ¨å‡ºmacOS 10.15 Catalinaçš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç‰ˆæœ¬ã€‚ 1.1.1.3 LinuxLinuxæ˜¯ä¸€ç§è‡ªç”±å’Œå¼€æ”¾æºç çš„ç±»UNIX æ“ä½œç³»ç»Ÿã€‚è¯¥æ“ä½œç³»ç»Ÿçš„å†…æ ¸ç”±æ—çº³æ–¯Â·æ‰˜ç“¦å…¹åœ¨1991å¹´10æœˆ5æ—¥é¦–æ¬¡å‘å¸ƒï¼Œåœ¨åŠ ä¸Šç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºä¹‹åï¼Œæˆä¸º Linux æ“ä½œç³»ç»Ÿã€‚Linuxä¹Ÿæ˜¯è‡ªç”±è½¯ä»¶å’Œå¼€æ”¾æºä»£ç è½¯ä»¶å‘å±•ä¸­æœ€è‘—åçš„ä¾‹å­ã€‚åªè¦éµå¾ª GNU é€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGPLï¼‰ï¼Œä»»ä½•ä¸ªäººå’Œæœºæ„éƒ½å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ Linux çš„æ‰€æœ‰åº•å±‚æºä»£ç ï¼Œä¹Ÿå¯ä»¥è‡ªç”±åœ°ä¿®æ”¹å’Œå†å‘å¸ƒã€‚å¤§å¤šæ•° Linux ç³»ç»Ÿè¿˜åŒ…æ‹¬åƒæä¾› GUI çš„ X Window ä¹‹ç±»çš„ç¨‹åºã€‚é™¤äº†ä¸€éƒ¨åˆ†ä¸“å®¶ä¹‹å¤–ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ç›´æ¥ä½¿ç”¨ Linux å‘è¡Œç‰ˆï¼Œè€Œä¸æ˜¯è‡ªå·±é€‰æ‹©æ¯ä¸€æ ·ç»„ä»¶æˆ–è‡ªè¡Œè®¾ç½®ã€‚ 1.1.1.4 UnixUNIXæ“ä½œç³»ç»Ÿï¼ˆå°¤å°¼æ–¯ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼ŒæŒ‰ç…§æ“ä½œç³»ç»Ÿçš„åˆ†ç±»ï¼Œå±äºåˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œæœ€æ—©ç”±KenThompsonã€Dennis Ritchieå’ŒDouglas McIlroyäº1969å¹´åœ¨AT&amp;Tçš„è´å°”å®éªŒå®¤å¼€å‘ã€‚å®ƒçš„å•†æ ‡æƒç”±å›½é™…å¼€æ”¾æ ‡å‡†ç»„ç»‡æ‰€æ‹¥æœ‰ï¼Œåªæœ‰ç¬¦åˆå•ä¸€UNIXè§„èŒƒçš„UNIXç³»ç»Ÿæ‰èƒ½ä½¿ç”¨UNIXè¿™ä¸ªåç§°ï¼Œå¦åˆ™åªèƒ½ç§°ä¸ºç±»UNIXï¼ˆUNIX-likeï¼‰ã€‚ 1.1.2 ç§»åŠ¨ç«¯1.1.2.1 AndroidAndroidï¼Œå¸¸è§çš„éå®˜æ–¹ä¸­æ–‡åç§°ä¸ºå®‰å“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºLinuxå†…æ ¸çš„å¼€æ”¾æºä»£ç ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œç”±Googleæˆç«‹çš„Open Handset AllianceæŒç»­é¢†å¯¼ä¸å¼€å‘ï¼Œä¸»è¦è®¾è®¡ç”¨äºè§¦æ‘¸å±ç§»åŠ¨è®¾å¤‡å¦‚æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘ä¸å…¶ä»–ä¾¿æºå¼è®¾å¤‡ã€‚Android Inc.äº2003å¹´10æœˆç”±å®‰è¿ªÂ·é²å®¾ã€åˆ©å¥‡Â·ç±³çº³å°”ã€å°¼å…‹Â·å¸­å°”æ–¯ã€å…‹é‡Œæ–¯Â·æ€€ç‰¹åœ¨åŠ å·å¸•ç½—å¥¥å›¾åˆ›å»ºã€‚Androidæœ€åˆç”±å®‰è¿ªÂ·é²å®¾ç­‰äººå¼€å‘åˆ¶ä½œï¼Œæœ€åˆå¼€å‘è¿™ä¸ªç³»ç»Ÿçš„æ—©æœŸæ–¹å‘æ˜¯åˆ›å»ºä¸€ä¸ªæ•°å­—ç›¸æœºçš„å…ˆè¿›æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯åæ¥å‘ç°å¸‚åœºéœ€æ±‚ä¸å¤Ÿå¤§ï¼ŒåŠ ä¸Šæ™ºèƒ½æ‰‹æœºå¸‚åœºå¿«é€Ÿæˆé•¿ï¼Œäºæ˜¯Androidæˆä¸ºä¸€æ¬¾é¢å‘æ™ºèƒ½æ‰‹æœºçš„æ“ä½œç³»ç»Ÿã€‚äº2005å¹´7æœˆ11æ—¥Android Inc.è¢«ç¾å›½ç§‘æŠ€ä¼ä¸šGoogleæ”¶è´­ã€‚2017å¹´3æœˆï¼ŒAndroidå…¨çƒç½‘ç»œæµé‡å’Œè®¾å¤‡è¶…è¶ŠMicrosoft Windowsï¼Œæ­£å¼æˆä¸ºå…¨çƒç¬¬ä¸€å¤§æ“ä½œç³»ç»Ÿã€‚ 1.1.2.2 iOSiOSï¼ˆåŸåä¸ºiPhone OSï¼‰æ˜¯è‹¹æœå…¬å¸ä¸ºå…¶ç§»åŠ¨è®¾å¤‡æ‰€å¼€å‘çš„ä¸“æœ‰ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œä¸ºå…¶å…¬å¸çš„è®¸å¤šç§»åŠ¨è®¾å¤‡æä¾›æ“ä½œç•Œé¢ï¼Œæ”¯æŒè®¾å¤‡åŒ…æ‹¬iPhoneã€iPadå’ŒiPod touchã€‚iPhone OSè‡ªiOS 4èµ·ä¾¿æ”¹åä¸ºiOSï¼Œå®ƒæ˜¯ç»§Androidåå…¨çƒç¬¬äºŒå¤§æœ€å—æ¬¢è¿çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå¸‚å ç‡å·²ä¸Šå‡è‡³çº¦24.5% ï¼Œä½†ä»è¿œä½äºGoogleå¼€å‘çš„Androidç³»ç»Ÿçš„72.2%ã€‚ 1.2 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨1.2.1 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹æ“ä½œç³»ç»Ÿæ˜¯é…ç½®åœ¨è®¡ç®—æœºç¡¬ä»¶ä¸Šçš„ç¬¬ä¸€å±‚è½¯ä»¶ï¼Œæ˜¯å¯¹ç¡¬ä»¶ç³»ç»Ÿçš„é¦–æ¬¡æ‰©å……ã€‚ä¸»è¦ä½œç”¨æ˜¯å¯¹ç®¡ç†å¥½è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ï¼Œæé«˜ä»–ä»¬çš„åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„ååé‡ï¼Œå¹¶ä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªç®€å•æ¥å£ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ã€‚ 1.2.2 æ“ä½œç³»ç»Ÿçš„ç›®çš„ æ–¹ä¾¿æ€§ å¦‚æœä¸€ä¸ªè®¡ç®—æœºæ²¡æœ‰OSï¼Œé‚£ä¹ˆä»–ä¼šéå¸¸éš¾ç”¨ã€‚ç”¨æˆ·ä¸ç®¡è¿›è¡Œå•¥æ“ä½œéƒ½å¾—é€šè¿‡æœºå™¨è¯­è¨€ç¼–å†™ç¨‹åºç„¶åè¿è¡Œï¼Œè€Œå¦‚æœæœ‰OSçš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨å„ç§å„æ ·çš„è¯­è¨€ç¼–å†™ç¨‹åºï¼Œç„¶åé€šè¿‡ç¼–è¯‘å°†é«˜çº§è¯­è¨€ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œæ–¹ä¾¿äº†ç”¨æˆ·ã€‚ æœ‰æ•ˆæ€§ æœ‰æ•ˆæ€§åˆ†ä¸¤å±‚å«ä¹‰â€”â€”æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚æ—©æœŸæ²¡æœ‰OSçš„è®¡ç®—æœºä¸­ï¼Œå¤„ç†æœºå’ŒI/Oè®¾å¤‡ç­‰ç»å¸¸å¤„äºç©ºé—²çŠ¶æ€ï¼Œå„ç§èµ„æºä¸èƒ½å¾—åˆ°åˆç†åˆ©ç”¨ï¼Œæ‰€ä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡æ˜¯æ¨åŠ¨OSå‘å±•çš„ä¸»è¦åŠ¨åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼ŒOSå¯ä»¥é€šè¿‡åˆç†ç»„ç»‡è®¡ç®—æœºçš„å·¥ä½œæµç¨‹ï¼ŒåŠ é€Ÿç¨‹åºçš„è¿è¡Œï¼Œç¼©çŸ­ç¨‹åºçš„è¿è¡Œå‘¨æœŸï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚ å¯æ‰©å……æ€§ ä¸ºäº†é€‚åº”ç°åœ¨è¶Šæ¥è¶Šå¤šçš„è®¡ç®—æœºç¡¬ä»¶ä»¥åŠä½“ç³»ç»“æ„ï¼ŒOSå¿…ä¿®æœ‰è‰¯å¥½çš„å¯æ‰©å……æ€§ã€‚ å¼€æ”¾æ€§ OSéœ€è¦éµå¾ªä¸–ç•Œæ ‡å‡†è§„èŒƒï¼Œå‡¡éµå¾ªå›½é™…æ ‡å‡†æ‰€å¼€å‘çš„ç¡¬ä»¶å’Œè½¯ä»¶éƒ½èƒ½å½¼æ­¤å…¼å®¹ï¼Œæ–¹ä¾¿åœ°å®ç°äº’è”ã€‚ 1.2.3 æ“ä½œç³»ç»Ÿçš„ä½œç”¨ OSä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£ OSå¤„äºç”¨æˆ·å’Œç¡¬ä»¶ä¹‹é—´ï¼Œæ–¹ä¾¿ç”¨æˆ·é€šè¿‡OSä½¿ç”¨ç¡¬ä»¶ã€‚æˆ–è€…è¯´ï¼Œç”¨æˆ·åœ¨OSçš„å¸®åŠ©ä¸‹èƒ½å¤Ÿæ–¹ä¾¿ã€å¿«æ·ã€å¯é åœ°æ“çºµè®¡ç®—æœºç¡¬ä»¶å’Œè¿è¡Œè‡ªå·±çš„ç¨‹åºã€‚ OSä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€… è®¡ç®—æœºç³»ç»Ÿèµ„æºä¸»è¦å¯åˆ†ä¸ºå¤„ç†æœºã€å­˜å‚¨å™¨ã€I/Oè®¾å¤‡ä»¥åŠæ–‡ä»¶ã€‚OSä¸»è¦åŠŸèƒ½ä¹Ÿå°±æ˜¯å¯¹è¿™å››ç±»èµ„æºè¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ã€‚å¤„ç†æœºç®¡ç†æ˜¯ç”¨äºåˆ†é…å’Œæ§åˆ¶å¤„ç†æœºï¼›å­˜å‚¨å™¨ç®¡ç†ä¸»è¦è´Ÿè´£å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼›I/Oè®¾å¤‡ç®¡ç†æ˜¯è´Ÿè´£I/Oè®¾å¤‡çš„åˆ†é…ä¸æ“çºµï¼›æ–‡ä»¶ç®¡ç†æ˜¯ç”¨äºå®ç°å¯¹æ–‡ä»¶çš„å­˜å–ã€å…±äº«å’Œä¿æŠ¤ã€‚ OSå®ç°äº†å¯¹è®¡ç®—æœºèµ„æºçš„æŠ½è±¡ åœ¨è£¸æœºä¸­ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦å¯¹è®¡ç®—å™¨è¿›è¡Œæ“ä½œï¼Œå¿…é¡»å¯¹ç‰©ç†æ¥å£çš„å®ç°ç»†èŠ‚æœ‰å……åˆ†çš„äº†è§£ã€‚ä½†åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„ç‰©ç†ï¼Œè€Œç”±æ“ä½œç³»ç»Ÿæ¥å®ç°å…·ä½“çš„æ“ä½œç»†èŠ‚ï¼Œå¹¶å‘ä¸Šè®²æ“ä½œè®¾å¤‡æŠ½è±¡ä¸ºä¸€ç»„æ•°æ®ç»“æ„ä»¥åŠä¸€ç»„æ“ä½œå‘½ä»¤ã€‚æ­¤æ—¶åœ¨ç”¨æˆ·çœ¼é‡Œï¼Œçœ‹åˆ°çš„æ˜¯ä¸€å°æ¯”è£¸æœºåŠŸèƒ½æ›´å¼ºï¼Œä½¿ç”¨æ›´æ–¹ä¾¿çš„æœºå™¨ã€‚ 1.2.4 æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ› ä¸æ–­æé«˜è®¡ç®—æœºèµ„æºåˆ©ç”¨ç‡ æ–¹ä¾¿ç”¨æˆ· å™¨ä»¶çš„ä¸æ–­æ›´æ–°æ¢ä»£ è®¡ç®—æœºä½“ç³»ç»“æ„çš„ä¸æ–­å‘å±• ä¸æ–­æå‡ºæ–°çš„åº”ç”¨éœ€æ±‚ 1.3 æ“ä½œç³»ç»Ÿçš„å‘å±•1.3.1 å•é“æ‰¹å¤„ç†ç³»ç»Ÿåœ¨è¯´å•é“æ‰¹å¤„ç†ä¹‹å‰ç°è¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µâ€”â€”ä½œä¸šã€‚ä½œä¸šåŒ…æ‹¬ç”¨æˆ·ç¨‹åºã€æ•°æ®ã€ä½œä¸šè¯´æ˜ä¹¦ã€‚è¿™æ ·æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡éƒ½æ˜¯ä½œä¸šã€‚ 1. å¤„ç†è¿‡ç¨‹æ¯ä¸ªå•é“æ‰¹å¤„ç†ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿæ“ä½œå‘˜ã€‚ç”¨æˆ·å…ˆå°†ä½œä¸šäº¤ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ“ä½œå‘˜å°±å°†ä¸€ä¸ªä¸ªä½œä¸šç»„æˆä¸€æ‰¹ä½œä¸šï¼Œè¾“å…¥åˆ°è®¡ç®—æœºä¸­ï¼Œåœ¨ç³»ç»Ÿä¸­å½¢æˆä¸€ä¸ªè‡ªåŠ¨è½¬æ¥çš„ä½œä¸šæµï¼Œç„¶åå¯åŠ¨æ“ä½œç³»ç»Ÿå¯¹ä½œä¸šè‡ªåŠ¨ã€ä¾æ¬¡çš„å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†å°†å¤„ç†ç»“æœè¿”å›ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œæ“ä½œå‘˜åœ¨è¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå•é“æ‰¹å¤„ç†è¿‡ç¨‹ã€‚ 2. ç¼ºç‚¹ç³»ç»Ÿèµ„æºå¾—ä¸åˆ°å……åˆ†åˆ©ç”¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ä»…æœ‰ä¸€é“ç¨‹åºï¼Œæ¯é€¢ç¨‹åºåœ¨è¿è¡Œä¸­å‘å‡ºI/Oè¯·æ±‚åï¼ŒCPUä¾¿å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¿…é¡»åœ¨I/Oå®Œæˆåæ‰ç»§ç»­è¿è¡Œã€‚ 1.3.2 å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ1. å¤„ç†è¿‡ç¨‹åœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ‰€æäº¤çš„ä½œä¸šå…ˆæ”¾åœ¨å¤–å­˜ä¸­ï¼Œå¹¶æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç§°ä¸ºâ€œåå¤‡é˜Ÿåˆ—â€œã€‚ç„¶åç”±ä½œä¸šè°ƒåº¦ç¨‹åºæŒ‰ä¸€å®šçš„ç®—æ³•ï¼Œä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©è‹¥å¹²ä½œä¸šè°ƒå…¥å†…å­˜ã€‚ç”±äºåŒæ—¶åœ¨å†…å­˜ä¸­è£…æœ‰è‹¥å¹²é“ç¨‹åºï¼Œè¿™æ ·ä¾¿å¯ä»¥åœ¨è¿è¡Œç¨‹åºAæ—¶ï¼Œåˆ©ç”¨å…¶I/Oæ“ä½œæš‚åœæ‰§è¡Œæ—¶çš„CPUç©ºæ¡£æœŸï¼Œå†è°ƒåº¦å¦ä¸€é“ç¨‹åºBè¿è¡Œã€‚ 2. ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ èµ„æºåˆ©ç”¨ç‡é«˜ ç³»ç»Ÿååé‡å¤§ ç¼ºç‚¹ å¹³å‡å‘¨è½¬æ—¶é—´é•¿ æ— äº¤äº’èƒ½åŠ› 1.3.3 åˆ†æ—¶ç³»ç»Ÿ1. è¿è¡Œæ–¹å¼ ä½œä¸šç›´æ¥è¿›å…¥å†…å­˜ã€‚å› ä¸ºä½œä¸šåœ¨ç£ç›˜ä¸Šä¸å¯è¿è¡Œï¼Œæ‰€ä»¥ä½œä¸šåº”ç›´æ¥è¿›å…¥å†…å­˜ é‡‡ç”¨è½®è½¬è¿è¡Œæ–¹å¼ã€‚å¦‚æœä¸€ä¸ªä½œä¸šç‹¬å CPUè¿ç»­è¿è¡Œï¼Œé‚£ä¹ˆå…¶ä»–ä½œä¸šæ²¡æ³•è¿è¡Œã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¼•å…¥äº†æ—¶é—´ç‰‡æ¦‚å¿µã€‚ä¸€ä¸ªæ—¶é—´ç‰‡æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´ï¼Œç³»ç»Ÿè§„å®šäº†æ¯ä¸ªä½œä¸šæ¯æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç„¶åå°±æš‚åœè¯¥ä½œä¸šçš„è¿è¡Œï¼Œå¹¶ç«‹å³è°ƒåº¦ä¸‹ä¸€ä¸ªä½œä¸šè¿è¡Œã€‚å¦‚æœåœ¨ä¸é•¿çš„æ—¶é—´å†…èƒ½ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶é—´ï¼Œä¾¿å¯ä»¥ä½¿æ¯ä¸ªç”¨æˆ·éƒ½èƒ½åŠæ—¶åœ°ä¸è‡ªå·±çš„ä½œä¸šè¿›è¡Œäº¤äº’ï¼Œä»è€Œä½¿ç”¨æˆ·çš„è¯·æ±‚çš„åˆ°åŠæ—¶å“åº”ã€‚ 2. ç‰¹å¾ å¤šè·¯æ€§ ç‹¬ç«‹æ€§ åŠæ—¶æ€§ äº¤äº’æ€§ 1.3.4 å®æ—¶ç³»ç»Ÿå®æ—¶ç³»ç»Ÿæ˜¯æŒ‡ç³»ç»Ÿèƒ½åŠæ—¶å“åº”å¤–éƒ¨äº‹ä»¶çš„è¯·æ±‚ï¼Œåœ¨è§„å®šæ—¶é—´å†…å®Œæˆå¯¹è¯¥äº‹ä»¶çš„å¤„ç†ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰å®æ—¶ä»»åŠ¡åè°ƒä¸€è‡´åœ°è¿è¡Œã€‚å®æ—¶ç³»ç»Ÿä¸»è¦åº”ç”¨äºï¼š å·¥ä¸šï¼ˆæ­¦å™¨ï¼‰æ§åˆ¶ç³»ç»Ÿ ä¿¡æ¯æŸ¥è¯¢ç³»ç»Ÿ å¤šåª’ä½“ç³»ç»Ÿ åµŒå…¥å¼ç³»ç»Ÿ 1.4 æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾1.4.1 å¹¶å‘æ­£æ˜¯ç³»ç»Ÿä¸­æœ‰è¿™ä¸€ç‰¹å¾ï¼Œæ‰ä½¿å¾—OSèƒ½æœ‰æ•ˆåœ°æé«˜ç³»ç»Ÿä¸­çš„èµ„æºåˆ©ç”¨ç‡ï¼Œå¢åŠ ç³»ç»Ÿçš„ååé‡ã€‚ å¹¶å‘ä¸å¹¶è¡Œå¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼Œå¾®è§‚ä¸Šæ˜¯åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åœ¨CPUä¸Šè¿è¡Œã€‚å¹¶å‘æ˜¯æŒ‡å®è§‚ä¸Šä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿï¼Œå¾®è§‚ä¸Šç¼ºæ˜¯æŸä¸€æ—¶åˆ»CPUä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹ã€‚ 1.4.2 å…±äº«èµ„æºå…±äº«ï¼Œå³æ“ä½œç³»ç»Ÿä¸­çš„èµ„æºå¯ä¾›å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å…±åŒä½¿ç”¨ï¼Œç”±äºèµ„æºå±æ€§ä¸åŒï¼Œå¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„å…±äº«æ–¹å¼ä¹Ÿä¸åŒã€‚å¯åˆ†ä¸ºï¼šäº’æ–¥å…±äº«æ–¹å¼å’ŒåŒæ—¶è®¿é—®æ–¹å¼ã€‚ 1. äº’æ–¥å…±äº«æ–¹å¼ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œå¦‚ç£å¸¦æœº,æ‰“å°æœºç­‰ã€‚è™½ç„¶å¯ä»¥ä¾›å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä½†æ˜¯ä¸ºäº†æ‰“å°æˆ–è®°å½•ç»“æœä¸é€ æˆæ··æ·†ï¼Œåº”è§„å®šä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºã€‚ 2. åŒæ—¶è®¿é—®æ–¹å¼æŸäº›èµ„æºï¼Œä¸€æ®µæ—¶é—´å†…æ˜¯å¯ä»¥å…è®¸å¤šä¸ªè¿›ç¨‹â€œåŒæ—¶â€åŒæ—¶å¯¹ä»–ä»¬è¿›è¡Œè®¿é—®ï¼Œè¿™ä¸ªåŒæ—¶æ˜¯å®è§‚ä¸Šçš„ï¼Œåœ¨å¾®è§‚ä¸Šå¯èƒ½æ˜¯åˆ†æ—¶å…±äº«ã€‚ 1.4.3 è™šæ‹Ÿåœ¨OSä¸­ï¼ŒæŠŠé€šè¿‡æŸç§æŠ€æœ¯å°†ä¸€ä¸ªç‰©ç†å®ä½“å˜ä¸ºè‹¥å¹²ä¸ªé€»è¾‘ä¸Šçš„å¯¹åº”ç‰©çš„åŠŸèƒ½ç§°ä¸ºâ€è™šæ‹Ÿâ€œã€‚ 1.4.4 å¼‚æ­¥åœ¨å¤šé“ç¯å¢ƒä¸‹ï¼Œå…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ä½†ç”±äºèµ„æºæœ‰é™ï¼Œè¿›ç¨‹çš„æ‰§è¡Œä¸æ˜¯ä¸€è´¯åˆ°åº•ã€‚è€Œæ˜¯èµ°èµ°åœåœï¼Œä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ï¼Œè¿™å°±æ˜¯è¿›ç¨‹çš„å¼‚æ­¥ã€‚ 1.5 æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½åº”åˆ†ä¸ºå¤„ç†æœºç®¡ç†ã€å­˜å‚¨å™¨ç®¡ç†ã€è®¾å¤‡ç®¡ç†å’Œæ–‡ä»¶ç®¡ç†ã€‚æ­¤å¤–ï¼Œè¿˜åº”å‘ç”¨æˆ·æä¾›æ–¹ä¾¿çš„ç”¨æˆ·æ¥å£ã€‚ 1.5.1 å¤„ç†æœºç®¡ç†åŠŸèƒ½1. è¿›ç¨‹æ§åˆ¶åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸­ï¼Œä¸ºäº†ä½¿ä½œä¸šèƒ½å¹¶å‘æ‰§è¡Œï¼Œå¿…é¡»ä¸ºæ¯é“ä½œä¸šåˆ›å»ºä¸€ä¸ªæˆ–å‡ ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºä¹‹åˆ†é…å¿…è¦çš„èµ„æºã€‚å½“è¿›ç¨‹è¿è¡Œç»“æŸæ—¶ï¼Œåº”ç«‹å³æ’¤é”€è¯¥è¿›ç¨‹ï¼Œä»¥ä¾¿èƒ½åŠæ—¶å›æ”¶è¯¥è¿›ç¨‹æ‰€å ç”¨çš„å„ç§èµ„æºï¼Œä¾›å…¶å®ƒè¿›ç¨‹ä½¿ç”¨ã€‚ 2. è¿›ç¨‹åŒæ­¥ä¸ºäº†ä½¿å¤šä¸ªè¿›ç¨‹èƒ½æœ‰æ¡ä¸ç´Šçš„è¿è¡Œï¼Œç³»ç»Ÿä¸­å¿…é¡»è®¾ç½®ç›¸åº”çš„è¿›ç¨‹åŒæ­¥æœºåˆ¶ã€‚è¯¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¸ºå¤šä¸ªè¿›ç¨‹çš„è¿è¡Œè¿›è¡Œåè°ƒã€‚ 3. è¿›ç¨‹é€šä¿¡å¦‚æœä¸€ç»„ç›¸äº’åˆä½œçš„è¿›ç¨‹å»å®Œæˆä¸€ä¸ªå…±åŒçš„ä»»åŠ¡æ—¶ï¼Œåœ¨ä»–ä»¬ä¹‹é—´å¾€å¾€éœ€è¦äº¤æ¢ä¿¡æ¯ã€‚ 4. è°ƒåº¦åœ¨ä¼ ç»ŸOSä¸­ï¼Œè°ƒåº¦åŒ…æ‹¬ä½œä¸šè°ƒåº¦å’Œè¿›ç¨‹è°ƒåº¦ã€‚ ä½œä¸šè°ƒåº¦ ä½œä¸šè°ƒåº¦çš„åŸºæœ¬ä»»åŠ¡å°±æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰æ‹©å‡ºè‹¥å¹²ä¸ªä½œä¸šï¼Œä¸ºä»–ä»¬åˆ†é…æ‰€éœ€èµ„æºï¼Œåœ¨è¿™äº›ä½œä¸šè°ƒå…¥å†…å­˜åï¼Œåˆ†åˆ«ä¸ºä»–ä»¬åˆ›å»ºè¿›ç¨‹ï¼Œæ˜¯ä»–ä»¬éƒ½ç§°ä¸ºå¯èƒ½è·å¾—å¤„ç†æœºçš„å°±ç»ªè¿›ç¨‹ï¼Œå¹¶å°†ä»–ä»¬æ’å…¥å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚ è¿›ç¨‹è°ƒåº¦ è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡æ˜¯ä»è¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™ä»–ï¼Œå¹¶ä¸ºä»–è®¾ç½®è¿è¡Œçº¿ç¨‹ï¼Œä½¿å…¶æŠ•å…¥æ‰§è¡Œã€‚ 1.5.2 å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½å­˜å‚¨å™¨ç®¡ç†è§†ä¸ºå¤šé“ç¨‹åºçš„è¿è¡Œæä¾›è‰¯å¥½çš„ç¯å¢ƒï¼Œæé«˜å­˜å‚¨å™¨åˆ©ç”¨ç‡ï¼Œå¹¶èƒ½ä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜ã€‚ä¸ºæ­¤ï¼Œå­˜å‚¨å™¨ç®¡ç†åº”å…·æœ‰å†…å­˜åˆ†é…å’Œå›æ”¶ã€å†…å­˜ä¿æŠ¤ã€åœ°å€æ˜ å°„å’Œå†…å­˜æ‰©å……ç­‰åŠŸèƒ½ã€‚ 1. å†…å­˜åˆ†é…å†…å­˜åˆ†é…ä¸»è¦ä»»åŠ¡æ˜¯ï¼š ä¸ºæ¯é“ç¨‹åºåˆ†é…å†…å­˜ç©ºé—´ æé«˜å­˜å‚¨å™¨çš„åˆ©ç”¨ç‡ï¼Œå°½é‡å‡å°‘ä¸å¯ç”¨çš„å†…å­˜ç©ºé—´ å…è®¸æ­£åœ¨è¿è¡Œçš„ç¨‹åºç”³è¯·é™„åŠ çš„å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®åŠ¨æ€å¢é•¿çš„éœ€è¦ã€‚ OSåœ¨å®ç°å†…å­˜åˆ†é…æ—¶ï¼Œå¯é‡‡å–é™æ€å’ŒåŠ¨æ€ä¸¤ç§æ–¹å¼ï¼š é™æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šçš„å†…å­˜ç©ºé—´åœ¨ä½œä¸šè£…å…¥æ—¶ç¡®å®šï¼Œç¡®å®šåä¸å†æ”¹å˜ã€‚ åŠ¨æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šæ‰€è¦æ±‚çš„çš„åŸºæœ¬å†…å­˜ç©ºé—´è™½ç„¶ä¹Ÿæ˜¯åœ¨è£…å…¥æ—¶ç¡®å®šçš„ï¼Œä½†å…è®¸ä½œä¸šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»§ç»­ç”³è¯·æ–°çš„é™„åŠ å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®çš„åŠ¨æ€å¢é•¿ã€‚ 2. å†…å­˜ä¿æŠ¤ç¡®ä¿æ¯é“ç”¨æˆ·ç¨‹åºéƒ½åœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´å†…è¿è¡Œï¼Œå½¼æ­¤äº’ä¸å¹²æ‰°ã€‚å†³ä¸å…è®¸ç”¨æˆ·ç¨‹åºè®¿é—®æ“ä½œç³»ç»Ÿçš„ç¨‹åºå’Œæ•°æ®ï¼Œä¹Ÿä¸å…è®¸ç”¨æˆ·ç¨‹åºè½¬ç§»åˆ°éå…±äº«çš„å…¶ä»–ç”¨æˆ·ç¨‹åºä¸­å»æ‰§è¡Œã€‚ 3. åœ°å€æ˜ å°„æ¯é“ç¨‹åºç»ç¼–è¯‘è¿æ¥åæ‰€å½¢æˆçš„çš„å¯è£…å…¥ç¨‹åºå…¶åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯ä¸å¯èƒ½å°†ä»–ä»¬ä»â€œ0â€åœ°å€å¼€å§‹è£…å…¥å†…å­˜ï¼Œæ‰€ä»¥ç‰©ç†åœ°å€å’Œé€»è¾‘åœ°å€å¹¶ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ°å€æ˜ å°„æ¥è®©ç¨‹åºèƒ½æ­£å¸¸è¿è¡Œã€‚ 4. å†…å­˜æ‰©å……å€ŸåŠ©è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯æ¥å®ç°å†…å­˜æ‰©å……ï¼Œä¸»è¦è§£å†³ï¼š å†…å­˜å’ŒI/Oä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³çš„é—®é¢˜ 1.5.3 è®¾å¤‡ç®¡ç†åŠŸèƒ½ä¸»è¦ä»»åŠ¡ï¼š å®Œæˆç”¨æˆ·è¿›ç¨‹æå‡ºçš„I/Oè¯·æ±‚ï¼Œä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…æ‰€éœ€çš„I/Oè®¾å¤‡ï¼Œå¹¶å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œ æé«˜CPUä¸I/Oè®¾å¤‡çš„åˆ©ç”¨ç‡ï¼Œæé«˜I/Oé€Ÿåº¦ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨I/O ä¸ºäº†å®ç°ä»¥ä¸ŠåŠŸèƒ½ï¼Œåº”å…·æœ‰ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…å’Œè®¾å¤‡å¤„ç†ä»¥åŠè™šæ‹Ÿè®¾å¤‡ç­‰åŠŸèƒ½ã€‚ 1. ç¼“å†²ç®¡ç†ä¸ºäº†æœ‰æ•ˆçš„ç¼“å’ŒCPUä¸I/Oè®¾å¤‡é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œæé«˜CPUåˆ©ç”¨ç‡ï¼Œäºæ˜¯å¼•å…¥äº†ç¼“å†²ç®¡ç†ã€‚ 2. è®¾å¤‡åˆ†é…è®¾å¤‡åˆ†é…çš„åŸºæœ¬ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·è¿›ç¨‹çš„I/Oè¯·æ±‚ã€ç³»ç»Ÿç°æœ‰èµ„æºæƒ…å†µä»¥åŠæŒ‰ç…§æŸç§è®¾å¤‡åˆ†é…ç­–ç•¥ï¼Œä¸ºä¹‹åˆ†é…å…¶æ‰€éœ€çš„è®¾å¤‡ã€‚ 3. è®¾å¤‡å¤„ç†å®ç°CPUå’Œè®¾å¤‡æ§åˆ¶å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå³ç”±CPUå‘è®¾å¤‡æ§åˆ¶å™¨å‘å‡ºI/Oå‘½ä»¤ï¼Œè¦æ±‚ä»–å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œï¼›åä¹‹ï¼Œç”±CPUæ§åˆ¶ä»æ¥æ”¶å™¨å‘æ¥çš„ä¸­æ–­è¯·æ±‚ï¼Œå¹¶ç»™äºˆè¿…é€Ÿçš„å“åº”å’Œç›¸åº”çš„å¤„ç†ã€‚ 1.5.4 æ–‡ä»¶ç®¡ç†åŠŸèƒ½ä¸»è¦æ˜¯å¯¹ç”¨æˆ·æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç®¡ç†ä»¥æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§ã€‚ä¸ºæ­¤ï¼Œæ–‡ä»¶ç®¡ç†åº”å…·æœ‰å¯¹æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†ã€ç›®å½•ç®¡ç†ã€æ–‡ä»¶çš„è¯»/å†™ç®¡ç†ä»¥åŠæ–‡ä»¶çš„å…±äº«ä¸ä¿æŠ¤ç­‰åŠŸèƒ½ã€‚ 1. æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…å¿…è¦çš„å¤–å­˜ç©ºé—´ï¼Œæé«˜æˆ‘æ‘åˆ©ç”¨ç‡ï¼Œè¿›è€Œæé«˜æ–‡ä»¶ç³»ç»Ÿçš„å­˜ã€å–é€Ÿåº¦ã€‚ 2. ç›®å½•ç®¡ç†ä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ï¼Œç›®å½•é¡¹åŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶å±æ€§ã€æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ç‰©ç†ä½ç½®ç­‰ï¼Œå¹¶å¯¹ä¼—å¤šçš„ç›®å½•é¡¹åŠ ä»¥æœ‰æ•ˆçš„ç»„ç»‡ï¼Œä»¥å®ç°æ–¹ä¾¿çš„æŒ‰åå­—å­˜å–ã€‚ 3. æ–‡ä»¶çš„è¯»/å†™ç®¡ç†å’Œä¿æŠ¤æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚ï¼Œä»å¤–å­˜ä¸­è¯»å–æ•°æ®æˆ–å°†æ•°æ®å†™å…¥å¤–å­˜ã€‚å¹¶ä¸”ä¿æŠ¤æ–‡ä»¶é˜²æ­¢å…¶è¢«éæ³•ç›—å–å’Œç ´åã€‚ 1.5.5 æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£æ¥å£ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç”¨æˆ·æ¥å£å’Œç¨‹åºæ¥å£ã€‚ç”¨æˆ·æ¥å£æ˜¯ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥æˆ–é—´æ¥æ§åˆ¶è‡ªå·±çš„ä½œä¸šã€‚ç¨‹åºæ¥å£æ˜¯ä¸ºç”¨æˆ·ç¨‹åºåœ¨æ‰§è¡Œä¸­è®¿é—®ç³»ç»Ÿèµ„æºè€Œè®¾å®šçš„ï¼Œæ˜¯ç”¨æˆ·å–å¾—æ“ä½œç³»ç»ŸæœåŠ¡çš„å”¯ä¸€é€”å¾„ã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¤šçº¿ç¨‹2--Javaä¸­çš„çº¿ç¨‹æ± ]]></title>
    <url>%2Fposts%2Fb39fd0ab.html</url>
    <content type="text"><![CDATA[ç®€ä»‹æˆ‘ä»¬åœ¨å†™é¡¹ç›®ç»å¸¸è¦ç”¨åˆ°å¤šçº¿ç¨‹ã€‚ä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯éƒ½æ˜¯è¾ƒæ¶ˆè€—èµ„æºå’Œæ€§èƒ½çš„ï¼Œå¦‚æœä½ æ¯éœ€è¦ä¸€ä¸ªä»»åŠ¡å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å¯èƒ½ä¼šåœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯ä¸Šæµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚é‚£å¦‚æœæˆ‘ä»¬è®©çº¿ç¨‹æ‰§è¡Œä»»åŠ¡åä¸æ‘§æ¯ï¼Œæ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±èƒ½é¿å…è¿™ç§æƒ…å†µäº†ã€‚Java1.5ä¸­æä¾›äº†Executoræ¡†æ¶ç”¨äºæŠŠä»»åŠ¡çš„æäº¤å’Œæ‰§è¡Œè§£è€¦ï¼Œä»»åŠ¡çš„æ‰§è¡Œå°±äº¤ç»™Runnableæˆ–è€…Callableï¼Œè€ŒExecutoræ¡†æ¶ç”¨äºå¤„ç†ä»»åŠ¡ã€‚Executorä¸­æœ€æ ¸å¿ƒçš„æˆå‘˜å°±æ˜¯ThreadPoolExecutorï¼Œä»–å°±æ˜¯çº¿ç¨‹æ± æ ¸å¿ƒå®ç°ç±»ã€‚ ThreadPoolExecutoræˆ‘ä»¬ç°åœ¨å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚æ„é€ å™¨ï¼š 123456789101112131415161718192021public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize,markdownlint long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™äº›å‚æ•°ï¼š corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± åˆšåˆ›å»ºçš„æ—¶å€™ï¼Œçº¿ç¨‹æ•°é‡ä¸º0ï¼Œåªæœ‰ä»»åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼›å¦‚æœç­‰äºæˆ–è€…å¤§äºï¼Œåˆ™ä¸å†åˆ›å»ºã€‚ maximumPoolSizeï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“workQueueæ»¡äº†è€Œä¸”çº¿ç¨‹æ•°å°äºmaximumPoolSizeæ—¶ï¼Œçº¿ç¨‹æ± ä»ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ä½†æ˜¯å¦‚æœè¶…è¿‡äº†maximumPoolSizeæ—¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®çš„è¶…è¿‡æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤§äºworkQueueï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¤§äºkeepAliveTimeï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«å›æ”¶ã€‚å¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡ çš„æ‰§è¡Œäº‹ä»¶å¾ˆçŸ­ï¼Œåˆ™å¯ä»¥è°ƒå¤§keepAliveTimeæ¥æé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚å¦å¤–ï¼Œå¦‚æœè®¾ç½® allowCoreThreadTimeOutå±æ€§ä¸ºtrueæ—¶ï¼ŒkeepAliveTimeä¹Ÿä¼šåº”ç”¨åˆ°æ ¸å¿ƒçº¿ç¨‹ä¸Šã€‚ timeUnitï¼škeepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ã€‚å¯é€‰çš„å•ä½æœ‰å¤©(DAYS)ã€å°æ—¶(HOURS)ã€åˆ†é’Ÿ(MINUTES)ã€ç§’(SECONDS)ã€æ¯«ç§’(MILLISECONDS)ç­‰ã€‚ workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°æ­¤ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è¯¥ä»»åŠ¡ é˜Ÿåˆ—æ˜¯BlockingQueueç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚ threadFactoryï¼šçº¿ç¨‹å·¥å‚ã€‚å¯ä»¥ç”¨çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®åå­—ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ— é¡»è®¾ç½®è¯¥å‚æ•°ã€‚ RejectedExecutionHandlerï¼šé¥±å’Œç­–ç•¥ã€‚è¿™æ˜¯å½“ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†æ—¶æ‰€é‡‡å–çš„åº”å¯¹ç­–ç•¥ï¼Œé»˜è®¤æ˜¯AbordPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡ï¼Œå¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚æ­¤å¤–è¿˜æœ‰3ç§ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«å¦‚ä¸‹: CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤ç­–ç•¥æä¾›ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œèƒ½å¤Ÿå‡ç¼“æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚ DiscardPolicyï¼šä¸èƒ½æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°†è¯¥ä»»åŠ¡åˆ é™¤ã€‚ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€è¿‘çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰çš„ä»»åŠ¡ã€‚ çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹çº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†ä¸»è¦åˆ†ä¸º3ä¸ªæ­¥éª¤ æäº¤ä»»åŠ¡åï¼Œçº¿ç¨‹æ± å…ˆåˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeã€‚å¦‚æœæœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ æ¥ç€çº¿ç¨‹æ± åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ æ¥ç€å› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œçº¿ç¨‹æ± å°±åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæœªè¾¾åˆ°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œé¥±å’Œç­–ç•¥ï¼Œé»˜è®¤ä¼šæŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°å¤§äºæˆ–è€…ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹ä¼šä¸æ–­åœ°ä» ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚ å¦‚æœä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™æ‰§è¡Œé¥±å’Œç­–ç•¥ã€‚ çº¿ç¨‹æ± çš„ç§ç±»CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ±  çº¿ç¨‹æ•°æ— é™åˆ¶ æœ‰ç©ºé—²çº¿ç¨‹åˆ™å¤ç”¨ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— ç©ºé—²çº¿ç¨‹åˆ™æ–°å»ºçº¿ç¨‹ ä¸€å®šç¨‹åºå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ åˆ›å»ºæºç ï¼š 12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; CachedThreadPoolçš„corePoolSizeä¸º0ï¼ŒmaximumPoolSizeè®¾ç½®ä¸ºInteger.MAX_VALUEï¼Œè¿™æ„å‘³ç€CachedThreadPoolæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹æ˜¯æ— ç•Œçš„ã€‚keepAliveTimeè®¾ç½®ä¸º60Lï¼Œåˆ™ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡ çš„æœ€é•¿æ—¶é—´ä¸º60sã€‚åœ¨æ­¤ç”¨äº†é˜»å¡é˜Ÿåˆ—SynchronousQueueï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç§»é™¤æ“ä½œï¼ŒåŒæ ·ä»»ä½•ä¸€ä¸ªç§»é™¤æ“ä½œéƒ½ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ’å…¥æ“ä½œã€‚ FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ±  å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼ˆåŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼‰ è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… åˆ›å»ºæºç ï¼š 12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125; FixedThreadPoolçš„corePoolSizeå’ŒmaximumPoolSizeéƒ½è®¾ç½®ä¸ºåˆ›å»ºFixedThreadPoolæŒ‡å®šçš„å‚æ•°nThreadsï¼Œä¹Ÿå°±æ„å‘³ç€FixedThreadPoolåªæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œå¹¶ä¸”æ•°é‡æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ã€‚keepAliveTimeè®¾ç½®ä¸º0Læ„å‘³ç€å¤šä½™çš„çº¿ç¨‹ä¼šè¢«ç«‹å³ç»ˆæ­¢ã€‚å› ä¸ºä¸ä¼šäº§ç”Ÿå¤šä½™çš„çº¿ç¨‹ï¼Œæ‰€ä»¥keepAliveTimeæ˜¯æ— æ•ˆçš„å‚æ•°ã€‚å¦å¤–ï¼Œä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨äº†æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueã€‚ ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ åˆ›å»ºæºç ï¼š 1234public static ScheduledExecutorService newScheduledThreadPool( int corePoolSize, ThreadFactory threadFactory) &#123; return new ScheduledThreadPoolExecutor(corePoolSize, threadFactory);&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºæºç ä¸­ä»–è·³è½¬åˆ°äº†ScheduledThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹è¿›å»ï¼š 123456public ScheduledThreadPoolExecutor(int corePoolSize, ThreadFactory threadFactory) &#123; super(corePoolSize, Integer.MAX_VALUE, DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS, new DelayedWorkQueue(), threadFactory);&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒScheduledThreadPoolExecutorçš„æ„é€ æ–¹æ³•æœ€ç»ˆè°ƒç”¨çš„æ˜¯ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ã€‚corePoolSizeæ˜¯ä¼ è¿›æ¥çš„å›ºå®šæ•°å€¼ï¼ŒmaximumPoolSizeçš„å€¼æ˜¯Integer.MAX_VALUEã€‚å› ä¸ºé‡‡ç”¨çš„DelayedWorkQueueæ˜¯æ— ç•Œçš„ï¼Œæ‰€ä»¥maximumPoolSizeè¿™ä¸ªå‚æ•°æ˜¯æ— æ•ˆçš„ã€‚ SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ±  æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œå³éµå¾ªé˜Ÿåˆ—çš„å…¥é˜Ÿå‡ºé˜Ÿè§„åˆ™ åˆ›å»ºæºç ï¼š 123456public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));&#125; corePoolSizeå’ŒmaximumPoolSizeéƒ½ä¸º1ï¼Œæ„å‘³ç€SingleThreadExecutoråªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå…¶ä»–çš„å‚æ•°éƒ½å’ŒFixedThreadPoolä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nexté…ç½®å¤‡ä»½]]></title>
    <url>%2Fposts%2F5b6e53a4.html</url>
    <content type="text"><![CDATA[Hexoé…ç½®å¤‡ä»½ è¯„è®ºç³»ç»Ÿ æ¥å¿…åŠ› - https://www.livere.com/ valine(åœ¨ç”¨) - https://valine.js.org/ é˜…è¯»é‡æ˜¾ç¤º leancloud - https://leancloud.cn/ valine(åœ¨ç”¨) - https://valine.js.org/]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¤šçº¿ç¨‹1--Javaä¸­çš„é˜»å¡é˜Ÿåˆ—]]></title>
    <url>%2Fposts%2F63ab42b7.html</url>
    <content type="text"><![CDATA[é˜»å¡é˜Ÿåˆ—å‰è¨€åœ¨è°ˆè®ºé˜»å¡é˜Ÿåˆ—ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æ“ä½œç³»ç»Ÿå¤šçº¿ç¨‹éƒ¨åˆ†ä¸€ä¸ªç»å…¸çš„ä¾‹å­â€”â€”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼š ç°åœ¨æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹ç¼“å†²åŒºã€‚ç”Ÿäº§è€…ä¸»è¦ä½œç”¨å°±æ˜¯å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®ï¼Œæ¶ˆè´¹è€…å°±æ˜¯ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ç¡®ä¿ç”Ÿäº§è€…ä¸ä¼šåœ¨ç¼“å†²åŒºæ»¡äº†çš„æ—¶å€™è¿˜å¾€å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œæ¶ˆè´¹è€…ä¸ä¼šåœ¨ç¼“å†²åŒºç©ºäº†çš„æ—¶å€™è¿˜è¦æ±‚å–å‡ºæ•°æ®ã€‚ å…³äºè¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æˆ‘ä»¬ä»¥åå†è¯´ï¼Œæˆ‘ä»¬ç°åœ¨ä¸»è¦è®¨è®ºçº¿ç¨‹ç¼“å†²åŒºâ€”â€”é˜»å¡é˜Ÿåˆ—ã€‚ é˜»å¡é˜Ÿåˆ—ç®€ä»‹é˜»å¡é˜Ÿåˆ—å°±æ˜¯é˜Ÿåˆ—ï¼Œåªæ˜¯åœ¨ä¸€èˆ¬çš„é˜Ÿåˆ—ä¸Šæ·»åŠ äº†ä¸¤ä¸ªæ¡ä»¶ï¼š å½“é˜Ÿåˆ—æ»¡äº†çš„æ—¶å€™ä¸å…è®¸å†æ·»åŠ æ•°æ® å½“é˜Ÿåˆ—ç©ºäº†çš„æ—¶å€™ä¸å…è®¸ä»ä¸­å–æ•°æ® åœ¨Javaä¸­ï¼Œé˜»å¡é˜Ÿåˆ—æ˜¯é€šè¿‡BlockingQueueæ¥å®ç°çš„ï¼ŒBlockingQueueæ˜¯Java.util.concurrentåŒ…ä¸‹ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ã€‚ BlockingQueueçš„æ“ä½œæ–¹æ³• æ–¹æ³• æŠ›å¼‚å¸¸ è¿”å›ç‰¹å®šå€¼ é˜»å¡ è¶…æ—¶ æ’å…¥ add(E e) offer(E e) put(E e) offer(E e, long timeout, TimeUnit unit) ç§»é™¤ remove() poll() take() poll(time, unit) æ£€æŸ¥ element() peek() ä¸å¯ç”¨ ä¸å¯ç”¨ è§£é‡Šï¼š æŠ›å¼‚å¸¸ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ ç‰¹å®šå€¼ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼ é˜»å¡ï¼š å¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œ è¶…æ—¶ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œæˆ–è€…è¶…è¿‡é™å®šçš„æ—¶é—´ã€‚è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸ(å…¸å‹çš„æ˜¯true / false)ã€‚ Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—JavaåŸºäºBlockingQueueç»™å¼€å‘è€…æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š ArrayBlockingQueueï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æœ‰ç•Œå°±æ„å‘³ç€ä»–æœ‰ä¸€ä¸ªæœ€å¤§é™åº¦ï¼Œæ‰€å­˜å‚¨çš„çº¿ç¨‹çš„æ•°é‡ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™å®šå€¼ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å¯¹å…¶åˆå§‹åŒ–çš„æ—¶å€™ç»™å®šè¿™ä¸ªé™å®šå€¼ã€‚ä½†æ˜¯ç”±äºå®ƒæ˜¯åŸºäºæ•°ç»„æ‰€ä»¥ä»–å’Œæ•°ç»„ä¸€æ ·ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™é™å®šäº†è¿™ä¸ªå¤§å°ä»¥åå°±ä¸èƒ½æ”¹å˜ã€‚ LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ã€‚å®ƒå†…éƒ¨ä»¥ä¸€ä¸ªé“¾å¼ç»“æ„(é“¾æ¥èŠ‚ç‚¹)å¯¹å…¶å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œè¿™ä¸€é“¾å¼ç»“æ„å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸Šé™ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ä¸Šé™ï¼Œå°†ä½¿ç”¨Integer.MAX_VALUEä½œä¸ºä¸Šé™ã€‚LinkedBlockingQueueå†…éƒ¨ä»¥FIFO(å…ˆè¿›å…ˆå‡º)çš„é¡ºåºå¯¹å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ åœ¨æ‰€æœ‰å…ƒç´ ä¹‹ä¸­æ˜¯æ”¾å…¥æ—¶é—´æœ€ä¹…çš„é‚£ä¸ªï¼Œè€Œå°¾å…ƒç´ åˆ™æ˜¯æœ€çŸ­çš„é‚£ä¸ªã€‚ç”±äºé»˜è®¤æ˜¯æ— ä¸Šé™çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä»–çš„æ—¶å€™ï¼Œå¦‚æœç”Ÿäº§è€…çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…çš„é€Ÿåº¦ï¼Œç³»ç»Ÿå†…å­˜å¯èƒ½ä¼šè¢«è€—å°½ã€‚æ‰€ä»¥ä½¿ç”¨ä»–ä¸€å®šè¦è®¾ç½®åˆå€¼ã€‚ PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µæŒ‰ç…§è‡ªç„¶é¡ºåºç”Ÿåºæ’åˆ—ï¼Œä½ å¯ä»¥é‡å†™compateTo()æ–¹æ³•æ¥åˆ¶å®šå…ƒç´ æŒ‰è§„å®šæ’åºã€‚ DelayQueueï¼šæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ã€‚ SynchromousQueueï¼šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ã€‚ä»–ä¸èƒ½å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œä»–çš„æ¯ä¸€æ¬¡æ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ LinkedTransferQueueï¼šåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜Ÿåˆ—ï¼Œä»–å¤šäº†transfer(E e)ã€tryTransfer(E e) å’Œ tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ã€‚ LinkedBlockingDequeï¼šæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚å¯åœ¨ä¸¤ç«¯å…¥é˜Ÿå‡ºå¯¹ã€‚æ‰€ä»¥å½“å¤šçº¿ç¨‹å…¥é˜Ÿæ—¶ï¼Œå‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ é˜»å¡é˜Ÿåˆ—å®ç°åŸç†ä¸‹é¢æˆ‘ä»¬ä»¥ArrayBlockingQueueæºç ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹é˜»å¡é˜Ÿåˆ—å®ç°åŸç†ï¼š å®šä¹‰é¦–å…ˆå°±æ˜¯ä¸€å †å˜é‡çš„å®šä¹‰ï¼š 123456789101112131415161718192021222324252627/** The queued items */final Object[] items;/** items index for next take, poll, peek or remove */int takeIndex;/** items index for next put, offer, or add */int putIndex;/** Number of elements in the queue */int count;/* * Concurrency control uses the classic two-condition algorithm * found in any textbook. *//** Main lock guarding all access */final ReentrantLock lock;/** Condition for waiting takes */privatefinal Condition notEmpty;/** Condition for waiting puts */privatefinal Condition notFull; itemsæ˜¯å­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„æ•°ç»„ï¼ŒtakeIndexå’ŒputIndexåˆ†åˆ«æ˜¯å–æ•°æ®å’Œå­˜æ•°æ®çš„ç´¢å¼•ï¼Œcountæ˜¯é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ï¼Œlockä¸ºçœ‹ä¸€ä¸ªå¯é‡å…¥é”ï¼ŒnotEmptyå’ŒnotFullå‡ä¸ºç­‰å¾…æ¡ä»¶ï¼Œç”±lockåˆ›å»ºã€‚ æ„é€ å™¨æ¥ä¸‹æ¥çœ‹ä¸‹å®ƒçš„æ„é€ å™¨ 12345678public ArrayBlockingQueue(int capacity) &#123;&#125;public ArrayBlockingQueue(int capacity, boolean fair) &#123; &#125;public ArrayBlockingQueue(int capacity, boolean fair, Collection&lt;? extends E&gt; c) &#123;&#125; æ„é€ å™¨æœ‰ä¸‰ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªæ„é€ å™¨åªæœ‰ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå®¹é‡ï¼Œç¬¬äºŒä¸ªæ„é€ å™¨å¤šäº†ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šè®¿é—®ç­–ç•¥ï¼Œç¬¬ä¸‰ä¸ªæ„é€ å™¨åˆå¤šäº†ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šç”¨å¦å¤–ä¸€ä¸ªé›†åˆè¿›è¡Œåˆå§‹åŒ–ã€‚ æ•°æ®çš„æ·»åŠ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹BlockingQueueçš„ä¸‰ä¸ªæ’å…¥çš„æ–¹æ³•ï¼šput()ã€add()å’Œoffer()ï¼š put() æ–¹æ³•ï¼šé˜Ÿåˆ—æ»¡ï¼Œä¼šé˜»å¡è°ƒç”¨å­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ 1234567891011121314151617public void put(E e) throws InterruptedException &#123; // å…ˆæ£€æŸ¥eæ˜¯ä¸æ˜¯ç©ºï¼Œå¦‚æœç©ºåˆ™æŠ›å¼‚å¸¸ Objects.requireNonNull(e); // è·å–ä¸€ä¸ªé‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é”ï¼Œä¿è¯è°ƒç”¨putæ–¹æ³•çš„æ—¶å€™åªæœ‰1ä¸ªçº¿ç¨‹ lock.lockInterruptibly(); try &#123; // å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´  while (count == items.length) notFull.await(); enqueue(e); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; add()æ–¹æ³•ï¼šå®é™…ä¸Šè°ƒç”¨äº†offer()æ–¹æ³• 123456public boolean add(E e) &#123; if (offer(e)) return true; else throw new IllegalStateException("Queue full");&#125; offer()æ–¹æ³•ï¼šæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false 1234567891011121314151617181920public boolean offer(E e) &#123; // æ£€æŸ¥eæ˜¯å¦ä¸ºç©º Objects.requireNonNull(e); // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒè¿”å›falseï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´ å¹¶è¿”å›true if (count == items.length) return false; else &#123; enqueue(e); return true; &#125; &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†enqueue()æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415/** * Inserts element at current put position, advances, and signals. * Call only when holding lock. */private void enqueue(E e) &#123; // assert lock.isHeldByCurrentThread(); // assert lock.getHoldCount() == 1; // assert items[putIndex] == null; final Object[] items = this.items; items[putIndex] = e; if (++putIndex == items.length) putIndex = 0; count++; notEmpty.signal();&#125; å…ˆè·å–å…ƒç´ æ•°ç»„itemsï¼Œç„¶åæ·»åŠ putIndexä¸Šï¼Œå¦‚æœ++putIndexç­‰äºitemsçš„é•¿åº¦ï¼Œåˆ™è¯æ˜å½“å‰è¿™ä¸ªitemsæ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ è¿›äº†ï¼Œå°±è®©putIndexç­‰äº0.ç„¶åè°ƒç”¨notEmpty.signal()æ–¹æ³•å”¤é†’æ­£åœ¨è·å–å…ƒç´ çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬ä»é˜Ÿåˆ—ä¸­å–æ•°æ®ã€‚ æ•°æ®çš„å–å‡ºArrayBlockingQueueçš„å–æ•°æ®æ–¹æ³•æ€»å…±ä¹Ÿæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼špoll()ã€take()å’Œremove() poll()æ–¹æ³•ï¼šè·å–å…ƒç´ ï¼Œå­˜åœ¨è¿”å›å…ƒç´ e,ä¸å­˜åœ¨è¿”å›null 12345678910111213public E poll() &#123; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå…ƒç´ æ•°é‡ç­‰äº0å°±è¿”å›nullï¼Œå¦åˆ™è°ƒç”¨dequeue()æ–¹æ³• return (count == 0) ? null : dequeue(); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; take()æ–¹æ³•ï¼šå–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©º,åˆ™ä¼šé˜»å¡è°ƒç”¨è·å–å…ƒç´ çš„çº¿ç¨‹ 123456789101112131415public E take() throws InterruptedException &#123; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lockInterruptibly(); try &#123; // å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™dequeueæ–¹æ³•åˆ é™¤å…ƒç´  while (count == 0) notEmpty.await(); return dequeue(); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; remove()æ–¹æ³•ï¼šå–å…ƒç´ ï¼Œå®ƒæ˜¯å–ç‰¹å®šçš„é‚£ä¸ªå…ƒç´  1234567891011121314151617181920212223242526public boolean remove(Object o) &#123; // åˆ¤æ–­oæ˜¯å¦ä¸ºç©º if (o == null) return false; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå…ƒç´ æ•°é‡å¤§äº0ï¼Œåˆ™è·å–itemsï¼Œç„¶åä¾¿åˆ©å…ƒç´ ï¼Œåˆ¤æ–­oæ˜¯å…¶ä¸­çš„å“ªä¸ªï¼Œç„¶ååˆ é™¤é‚£ä¸ª if (count &gt; 0) &#123; final Object[] items = this.items; for (int i = takeIndex, end = putIndex, to = (i &lt; end) ? end : items.length; ; i = 0, to = end) &#123; for (; i &lt; to; i++) if (o.equals(items[i])) &#123; removeAt(i); return true; &#125; if (to == end) break; &#125; &#125; return false; &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; poll()å’Œtake()ä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†dequeue()æ–¹æ³•ï¼Œæˆ‘ä»¬å°±çœ‹ä¸‹dequeue()æ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼š 12345678910111213141516171819/** * Extracts element at current take position, advances, and signals. * Call only when holding lock. */private E dequeue() &#123; // assert lock.isHeldByCurrentThread(); // assert lock.getHoldCount() == 1; // assert items[takeIndex] != null; final Object[] items = this.items; @SuppressWarnings("unchecked") E e = (E) items[takeIndex]; items[takeIndex] = null; if (++takeIndex == items.length) takeIndex = 0; count--; if (itrs != null) itrs.elementDequeued(); notFull.signal(); return e;&#125; å’Œä¸Šé¢çš„enqueue()æ–¹æ³•ç±»ä¼¼ï¼Œå†æ¬¡å°±ä¸å†èµ˜è¿°ã€‚ é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨å‰é¢æˆ‘è¯´è¿‡ï¼Œé˜»å¡é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œé‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªç®€å•çš„å°demo è¿™æ®µä»£ç æ¥è‡ªåˆ˜æœ›èˆ’æ‰€è‘—ã€ŠAndroidè¿›é˜¶ä¹‹å…‰ã€‹ å¦‚æœä¸ç”¨é˜»å¡é˜Ÿåˆ—ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import java.util.PriorityQueue;public class Test &#123; private int queueSize = 10; private PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;&gt;(queueSize); public static void main(String[] args) &#123; Test test = new Test(); Producer producer = test.new Producer(); Consumer consumer = test.new Consumer(); producer.start(); consumer.start(); &#125; class Consumer extends Thread &#123; @Override public void run() &#123; while (true) &#123; synchronized (queue) &#123; while (queue.size() == 0) &#123; try &#123; System.out.println("é˜Ÿåˆ—ç©ºï¼Œç­‰å¾…æ•°æ®"); queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); queue.notify(); &#125; &#125; // æ¯æ¬¡ç§»èµ°é˜Ÿé¦–å…ƒç´  queue.poll(); queue.notify(); &#125; &#125; &#125; &#125; private class Producer extends Thread &#123; @Override public void run() &#123; while (true) &#123; synchronized (queue) &#123; try &#123; System.out.println("é˜Ÿåˆ—æ»¡ï¼Œç­‰å¾…æœ‰ç©ºä½™ç©ºé—´"); queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); queue.notify(); &#125; &#125; // æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´  queue.offer(1); queue.notify(); &#125; &#125; &#125;&#125; ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ArrayBlockingQueueï¼š 12345678910111213141516171819202122232425262728293031323334353637383940import java.util.concurrent.ArrayBlockingQueue;public class BlockingQueueTest &#123; private int queueSize = 10; private ArrayBlockingQueue&lt;Integer&gt; queue = new ArrayBlockingQueue&lt;&gt;(queueSize); public static void main(String[] args) &#123; BlockingQueueTest test = new BlockingQueueTest(); BlockingQueueTest.Producer producer = test.new Producer(); BlockingQueueTest.Consumer consumer = test.new Consumer(); producer.start(); consumer.start(); &#125; class Consumer extends Thread &#123; @Override public void run() &#123; while (true) &#123; try &#123; queue.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; private class Producer extends Thread &#123; @Override public void run() &#123; while (true) &#123; try &#123; queue.put(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kotlinå…¥é—¨1:Kotlinå’ŒJavaåŒºåˆ«åŸºç¡€ç¯‡]]></title>
    <url>%2Fposts%2F343b01ae.html</url>
    <content type="text"><![CDATA[Koltinå…¥é—¨Kotlinç®€ä»‹ ç§‘ç‰¹æ—å²›(ĞšĞ¾Ñ‚Ğ»Ğ¸Ğ½)æ˜¯ä¸€åº§ä¿„ç½—æ–¯çš„å²›å±¿,ä½äºåœ£å½¼å¾—å ¡ä»¥è¥¿çº¦30å…¬é‡Œå¤„,å½¢çŠ¶ç‹­é•¿,ä¸œè¥¿é•¿åº¦çº¦14å…¬é‡Œ,å—åŒ—å®½åº¦çº¦2å…¬é‡Œ,é¢ç§¯æœ‰16å¹³æ–¹å…¬é‡Œ,æ‰¼å®ˆä¿„å›½è¿›å…¥èŠ¬å…°æ¹¾çš„æ°´é“ã€‚ç§‘ç‰¹æ—å²›ä¸Šå»ºæœ‰å–€ç…æ–½å¡”å¾—å¸‚,ä¸ºåœ£å½¼å¾—å ¡ä¸‹è¾–çš„åŸå¸‚ã€‚ è€Œæˆ‘ä»¬è™½è¯´çš„kotlinï¼Œå°±æ˜¯ä¸€é—¨æ ¹æ®å®ƒå‘½åçš„ä¸€ç§ç°ä»£ç¨‹åºè®¾è®¡è¯­è¨€ã€‚Kotlin æ˜¯ä¸€ä¸ªç”¨äºç°ä»£å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€ï¼Œç”± JetBrains å¼€å‘ã€‚Kotlinå¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘JavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚Kotlinå·²æ­£å¼æˆä¸ºAndroidå®˜æ–¹æ”¯æŒå¼€å‘è¯­è¨€ã€‚ å˜é‡kotlinå’ŒJavaçš„æœ€åŸºæœ¬çš„åŒºåˆ«å°±æ˜¯kotlinä¸­ä¸‡ç‰©çš†å¯¹è±¡ï¼ŒJavaä¸­è¿˜å­˜åœ¨ç€intã€floatç­‰åŸºæœ¬ç±»å‹ï¼Œä½†æ˜¯åœ¨kotlinä¸­ï¼Œå®ƒæŠŠè¿™äº›éƒ½å®šä¹‰æˆäº†å¯¹è±¡ï¼Œç±»ä¼¼äºJavaä¸­çš„å°è£…ç±» å˜é‡çš„å£°æ˜ä¸Šé¢è¯´äº†ï¼Œkotlinä¸‡ç‰©çš†å¯¹è±¡ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å˜é‡ä¹Ÿéƒ½æ˜¯å¯¹è±¡ã€‚åœ¨kotlinå®šä¹‰å¯¹è±¡å’ŒJavaæœ‰ç‚¹å°åŒºåˆ«ã€‚kotlinå®šä¹‰å¯¹è±¡çš„æ ¼å¼ä¸º å£°æ˜ç±»å‹ å˜é‡åï¼š å˜é‡ç±»å‹ å…¶ä¸­ï¼š å£°æ˜ç±»å‹åˆ†ä¸ºvalå’Œvarã€‚valæ˜¯ä¸å¯å˜ç±»å‹ï¼Œç±»ä¼¼äºconstï¼Œå®šä¹‰æ—¶å¿…é¡»èµ‹å€¼ï¼Œèµ‹å€¼åä¸èƒ½è¢«ä¿®æ”¹ã€‚varæ˜¯å¯å˜ç±»å‹ã€‚ å˜é‡åå°±æ˜¯ä½ å®šä¹‰çš„è¿™ä¸ªå˜é‡çš„åç§°ã€‚ å˜é‡ç±»å‹å°±æ˜¯ä½ è¿™ä¸ªå˜é‡å¯¹åº”çš„ç±»çš„åå­—ã€‚ ç±»å‹æ¨æ–­çœå»å˜é‡ç±»å‹kotliné‡Œé¢ç±»ä¼¼c++çš„autoç±»å‹ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ï¼Œä½ å¯ä»¥ä¸å†™å˜é‡ç±»å‹ï¼Œkotlinä¼šè‡ªåŠ¨å¸®ä½ åˆ¤æ–­ã€‚ 1234567891011var a = 5println(a is Int)var b = â€œ123println(b is String)var c = 1.3println(c is Float)var d = trueprintln(d is Boolean) iså…³é”®å­—isé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªå˜é‡æ˜¯ä¸æ˜¯è¿™ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¾‹å­è§ä¸Šã€‚ æ•°å­—ç±»å‹ ç±»å‹ å®½åº¦(bit) Byte 8 Short 16 Int 32 Long 64 Float 32 Double 64 è¿™äº›ç±»å‹éƒ½ç»§æ‰¿è‡ªNumberå’ŒComparableç±»ã€‚ å­—é¢å¸¸é‡å€¼ åè¿›åˆ¶ï¼š123 åå…­è¿›åˆ¶ï¼š0x0f äºŒè¿›åˆ¶ï¼š0b0010 Longç±»å‹ï¼š123L doubleç±»å‹ï¼š123.4 Floatç±»å‹ï¼š123.4fæˆ–è€…123.4F æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿_æ¥æ–¹ä¾¿æˆ‘ä»¬é˜…è¯» 121_000_000 // 10000000xFF_EC // 0xFFEC æ˜¾ç¤ºè½¬æ¢kotlinä¸­ä¸å¯éšå¼è½¬æ¢æ¯”å¦‚Java ä¸­ 12int a = 2;long b = a; ä½†æ˜¯åœ¨kotlinä¸­ 123var a : Int? = 2var b : Long? = a; // errorvar b : Long? = a.toLong() Charç±»å‹kotlinä¸­çš„Charè¡¨ç¤ºå­—ç¬¦ã€‚ä½†æ˜¯å’ŒJavaä¸åŒï¼Œä»–ä¸èƒ½ç›´æ¥å½“ASCIIç å€¼ã€‚ 12345fun check(c : Char) &#123; if (c == 1) &#123; // error &#125;&#125; Booleanç±»å‹kotlinä¸­çš„å¸ƒå°”ç±»å‹ç”¨Booleanæ¥è¡¨ç¤ºï¼Œä»–æœ‰ä¸¤ä¸ªå€¼trueå’Œfalseã€‚ç”¨æ³•å’ŒJavaä¸€æ ·ã€‚ Stringç±»å‹å’ŒJavaä¸€æ ·ï¼Œkotlinä¸­çš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯Stringã€‚ä½†æ˜¯kotlinä¸­Stringæ˜¯ä¸å¯å˜çš„ã€‚æ‰€ä»¥kotlinä¸­Stringå¿…é¡»æ˜¯valç±»å‹ã€‚åŒæ—¶ï¼ŒStringæ˜¯finalä¸å¯ç»§æ‰¿çš„ã€‚ Arrayç±»å‹kotlinä¸­æ•°ç»„å¿…é¡»ä½¿ç”¨Arrayè¡¨ç¤ºã€‚åŸºæœ¬å†™æ³• val array: Array&lt;ç±»å‹&gt; = arrayOf(..) ä¾‹å¦‚ 12345678910111213141516171819202122232425262728293031/**æ•´å‹Intçš„æ•°ç»„*/val arrayOfInt: IntArray = intArrayOf(1,3,5,7,9)/**å­—ç¬¦Charç±»å‹çš„æ•°ç»„*/val arrayOfChar: CharArray = charArrayOf('H','e','l','l','o','W','o','r','l','d')/**å­—ç¬¦ä¸²Stringæ•°ç»„*/val arrayOfString: Array&lt;String&gt; = arrayOf("Hello","World")fun main(args: Array&lt;String&gt;) &#123; //æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªå…ƒç´  println(arrayOfInt.size) //éå†æ•°ç»„ for (char in arrayOfChar)&#123; println(char) &#125; //æ ¹æ®æ‰€å¼•è·å–æ•°æ®,æ•°ç»„æ˜¯ä»0å¼€å§‹çš„ï¼Œç°åœ¨è·å–ç¬¬äºŒä¸ªä¸œäº¬å¤§å­¦ println(arrayOfUniversity[1]) //é‡æ–°ç»™æ•°ç»„èµ‹å€¼ï¼Œæ—©ç¨»ç”°å¤§å­¦ arrayOfUniversity[1] = University("æ—©ç¨»ç”°å¤§å­¦") println(arrayOfUniversity[1]) //å°†charè¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²,é»˜è®¤æ˜¯è‡ªåŠ¨ç”±é€—å·","åˆ†å‰²çš„ï¼Œè¾“å‡ºH, e, l, l, o, W, o, r, l, d println(arrayOfChar.joinToString()) //å¦‚æœæƒ³è¦è¿æˆHelloWorld println(arrayOfChar.joinToString ("")) //æ•°ç»„çš„åˆ‡ç‰‡,è¾“å‡º3ï¼Œ5,ç»“å°¾éœ€è¦arrayOfInt-1ï¼Œä¸ç„¶ä¼šæŠ¥ç´¢å¼•è¶Šç•Œå¼‚å¸¸ println(arrayOfInt.slice(1..2)) println(arrayOfInt.size)&#125;]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
        <tag>è¯­è¨€åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kotlin Ankoå…¥é—¨]]></title>
    <url>%2Fposts%2F62bb1dd7.html</url>
    <content type="text"><![CDATA[Kotlin Ankoå…¥é—¨ç®€ä»‹Ankoçš„å®˜ç½‘å°±æ˜¯ä»–çš„GitHubåœ°å€ https://github.com/Kotlin/anko å®˜æ–¹å¯¹Ankoçš„è§£é‡Šæ˜¯ Ankoæ˜¯ä¸€ä¸ª Kotlin åº“ï¼Œå®ƒä½¿Androidåº”ç”¨ç¨‹åºå¼€å‘æ›´å¿«æ›´å®¹æ˜“ã€‚å®ƒä½¿æ‚¨çš„ä»£ç æ¸…æ™°æ˜“è¯»ï¼Œè®©æ‚¨å¿˜è®°Android SDK for Javaçš„ç²—ç³™è¾¹ç¼˜ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿæ¯”æ–¹è¯´å¦‚æœä½ å†™Androidï¼Œä½ åœ¨xmlä¸­å®šä¹‰äº†ä¸€ä¸ªButtonï¼Œä»–çš„IDæ˜¯button_loginã€‚ å¦‚æœæ˜¯Javaï¼š 12setContentView(R.layout.activity_words_detail);Button button = findViewById(R.Id.button_login); è€Œå¦‚æœä½ ä½¿ç”¨kotlinçš„è¯ï¼Œä½ å¯ä»¥å°±æŒ‰å¦‚ä¸‹ä»£ç å†™ 123import kotlinx.android.synthetic.main.activity_kotlin_main.*...button_login.setText("Kotlin Android Extensions æˆ‘ä¸å¤ªå–œæ¬¢"); è¿™æ ·ç¡®å®æ¯”Javaæ–¹ä¾¿å¤šäº†ï¼Œä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªç»„ä»¶éƒ½å®šä¹‰å†findViewByIdï¼Œå¯ä»¥å°±ç›´æ¥è¾“å…¥ç»„ä»¶çš„idç„¶åå°±èƒ½ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å°±ç›´æ¥åœ¨ä»£ç ä¸­å†™å…¥å„ä¸ªç»„ä»¶å‘¢ï¼Œäºæ˜¯ï¼ŒAnkoæ¥äº†ã€‚ å¯¼å…¥AnkoAnkoç”±å‡ éƒ¨åˆ†ç»„æˆï¼š Anko Commonsï¼šä¸€ä¸ªè½»é‡çº§çš„åº“ï¼ŒåŒ…å«ç”¨äºLayoutsï¼ŒIntentï¼ŒLogç­‰çš„å¸®åŠ©ç¨‹åº; Anko Layoutsï¼šä¸€ç§å¿«é€Ÿä¸”ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥ç¼–å†™åŠ¨æ€Androidå¸ƒå±€; Anko SQLiteï¼šAndroid SQLiteçš„æŸ¥è¯¢DSLå’Œè§£æå™¨é›†åˆ; Anko Coroutinesï¼šåŸºäºkotlinx.coroutinesåº“çš„å®ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥åœ¨appçš„build.gradleä¸­æ·»åŠ  12345678dependencies &#123; // Anko Layouts implementation "org.jetbrains.anko:anko-sdk25:$anko_version" // sdk15, sdk19, sdk21, sdk23 are also available implementation "org.jetbrains.anko:anko-appcompat-v7:$anko_version" // Coroutine listeners for Anko Layouts implementation "org.jetbrains.anko:anko-sdk25-coroutines:$anko_version" implementation "org.jetbrains.anko:anko-appcompat-v7-coroutines:$anko_version"&#125; è¿™ä¸ªä¾èµ–å¯ä»¥ç›´æ¥å¯¼å…¥æ‰€æœ‰çš„å¯ç”¨ç‰¹æ€§ï¼ˆåŒ…æ‹¬Commons, Layouts, SQLite)ã€‚ ä½¿ç”¨Anko layoutåˆ›å»ºç®€å•å¸ƒå±€ä½¿ç”¨Ankoåˆ›å»ºå¸ƒå±€å¾ˆç®€å•ï¼š 12345678910111213141516171819class MainActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) verticalLayout &#123; padding = dip(30) editText &#123; hint = "Name" textSize = 24f &#125; editText &#123; hint = "Password" textSize = 24f &#125; button("ç™»å½•") &#123; textSize = 26f &#125; &#125; &#125;&#125; ä½ åªéœ€è¦åœ¨Activityä¸­å†™å…¥DSLä»£ç å°±èƒ½ä½¿ç”¨å®ƒã€‚ AnkoComponentå°½ç®¡æˆ‘ä»¬ç°åœ¨å¯ä»¥ç›´æ¥åœ¨Activityä¸­å†™å…¥DSLä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—æŠŠä»£ç å’Œå¸ƒå±€æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ä¸å¤ªå¥½ï¼Œå¸Œæœ›æŠŠActivityå’ŒDSlä»£ç æ”¾åˆ°ä¸¤ä¸ªä¸åŒçš„ç±»é‡Œé¢ï¼Œæ‰€ä»¥AnkoComponentå°±å‡ºæ¥äº†ã€‚ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425class MainActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) MainActivityUI().setContentView(this) &#125;&#125;class MainActivityUI : AnkoComponent&lt;MainActivity&gt; &#123; override fun createView(ui: AnkoContext&lt;MainActivity&gt;) = with(ui) &#123; verticalLayout &#123; padding = dip(30) editText &#123; hint = "Name" textSize = 24f &#125; editText &#123; hint = "Password" textSize = 24f &#125; button("ç™»å½•") &#123; textSize = 26f &#125; &#125; &#125;&#125; Themeåœ¨Ankoå¦‚æœä½ æƒ³è®¾ç½®Themeéœ€è¦ä½¿ç”¨themeable 1234verticalLayout &#123; padding = dip(30) themedButton("ç™»é™†", theme = R.style.Base_TextAppearance_AppCompat_Button)&#125; LayoutParamsåœ¨Ankoä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨LayoutParamsã€‚ æ¯”æ–¹è¯´æˆ‘ç°åœ¨è¦æ˜¾ç¤ºä¸€ä¸ªbuttonï¼Œä¸‹é¢æ˜¾ç¤ºä¸€ä¸ªå›¾ç‰‡ã€‚ å¦‚æœä½¿ç”¨XML: 12345678910111213141516171819202122&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical" tools:context=".MainActivity"&gt; &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Hello World!" android:gravity=center android:textSize="20sp" /&gt; &lt;ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:background="@color/colorAccent" /&gt;&lt;/LinearLayout&gt; ä½†æ˜¯ä½¿ç”¨Anko: 12345678910verticalLayout &#123; textView ("Hello World!") &#123; textSize = sp(12).toFloat() &#125;.lparams(height = wrapContent, width = wrapContent) &#123; horizontalGravity = Gravity.CENTER_HORIZONTAL &#125; imageView &#123; backgroundColor = Color.BLUE &#125;.lparams(height = matchParent, width = matchParent)&#125; æ³¨æ„ï¼š horizontalMargin åŒæ—¶è®¾ç½® left å’Œ right margins verticalMargin åŒæ—¶è®¾ç½® top å’Œ bottom margin åŒæ—¶è®¾ç½®4ä¸ªæ–¹å‘çš„ margins Listenersåœ¨Ankoä¸­è®¾ç½®Listenerséå¸¸ç®€å•ï¼Œæˆ‘ä¸‹é¢ä»¥Buttonçš„OnClickä¸¾ä¾‹ï¼š 12345button("ç™»å½•") &#123; id = buttonLogin textSize = 26f onClick &#123; toast("OnClickLoginButton") &#125;&#125; ä½¿ç”¨FragmentåŠ è½½å…ˆåˆ›å»ºä¸€ä¸ªActivityï¼ŒæŠŠFragmentåŠ è¿›å» 123456789class AnkoFragmentActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) linearLayout &#123; id = R.id.fragment_id supportFragmentManager.beginTransaction().replace(id, AnkoFragment.newInstance()).commit() &#125; &#125;&#125; ç„¶ååœ¨Fragmentçš„onCreateView()ä¸­åŠ å…¥DSLä»£ç ï¼Œç„¶åè¿”å›Viewå³å¯ 12345678910111213141516class AnkoFragment : Fragment() &#123; override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? &#123; // return inflater.inflate(R.layout.fragment_anko, container, false) return UI &#123; verticalLayout &#123; editText() button("OK") &#125; &#125;.view &#125; companion object &#123; fun newInstance(): AnkoFragment &#123; return AnkoFragment() &#125; &#125;&#125; ä¸è¶³AnkoLayoutç¡®å®æŒºå¥½çš„ï¼Œå› ä¸ºä»–æŠŠUIä»£ç é›†æˆåˆ°äº†ä»£ç æ–‡ä»¶ä¸­ï¼Œä¸ç”¨å†åƒä»¥å‰ä¸€æ ·å†™ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è¿˜å¾—å…ˆfindViewBuIdï¼Œç„¶åå†setOnClickListenersã€‚ä»£ç èƒ½éå¸¸ç®€æ´ã€‚ ä½†æ˜¯AnkoLayoutè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œæ„Ÿè§‰å†™èµ·æ¥è¿˜æ˜¯æ²¡æœ‰XMLé‚£ä¸ªé¡ºæ‰‹ï¼ˆå¯èƒ½æ˜¯æˆ‘å†™æƒ¯äº†XMLï¼Œåˆšå¼€å§‹ç”¨Ankoè¿˜ä¸å¤Ÿç†Ÿç»ƒï¼‰ï¼Œè€Œä¸”Ankoè¿˜æœ‰å¾ˆå¤šæ§ä»¶éƒ½ä¸æ”¯æŒã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä»–æ²¡æœ‰å®æ—¶é¢„è§ˆï¼ï¼ï¼ Android Studioé‡Œé¢æœ‰ä¸€ä¸ªå«Anko Supportçš„æ’ä»¶ï¼Œå¯ä»¥å®ç°ankoçš„é¢„è§ˆï¼Œä½†æ˜¯ä»–å¿…é¡»æ˜¯å…ˆå°†é¡¹ç›®æ„å»ºäº†å†é¢„è§ˆçš„ï¼Œä¸ç®—æ˜¯å®æ—¶é¢„è§ˆ]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç±»ä¹‹SharedPreferences]]></title>
    <url>%2Fposts%2F8a47fe84.html</url>
    <content type="text"><![CDATA[Androidç±»ä¹‹SharedPreferencesç®€ä»‹SharedPreferencesæ˜¯ä¸€ä¸ªè½»é‡çš„å­˜å‚¨ç±»ï¼Œç”¨äºæŠŠä¸€äº›åªéœ€è¦å°‘é‡ç®€å•ç±»å‹æ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¾‹å¦‚æœç´¢å†å²ã€ç”¨æˆ·è®¾ç½®ç­‰ã€‚ ä»–åªé€‚åˆå¤„ç†ç®€å•çš„æ•°æ®ï¼Œå¤„ç†å¤ªè¿‡äºåºå¤§çš„æ•°æ®ä¼šå‡æ…¢ç¨‹åºè¿è¡Œã€‚ ä½¿ç”¨æ­¥éª¤1. å­˜å‚¨æ•°æ® ä½¿ç”¨Activityç±»çš„getSharedPreferences()æ–¹æ³•è·å¾—SharedPreferenceså¯¹è±¡ï¼Œå…¶ä¸­å­˜å‚¨key-valueçš„æ–‡ä»¶åç”±getSharedPreferences()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šã€‚ ä½¿ç”¨SharedPreferencesæ¥å£çš„edit()è·å¾—SharedPreferences.Editorå¯¹è±¡ã€‚ é€šè¿‡SharedPreferences.Editoræ¥å£çš„putXxx()æ–¹æ³•ä¿å­˜key-valueå¯¹ï¼Œå…¶ä¸­Xxxè¡¨ç¤ºä¸åŒçš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦ä¸²ç±»å‹çš„valueéœ€è¦ç”¨putStringæ–¹æ³•ã€‚ é€šè¿‡SharedPreferences.Editoræ¥å£çš„commit()æ–¹æ³•ä¿å­˜key-valueå¯¹ï¼Œcommitæ–¹æ³•ç›¸å½“äºæ•°æ®åº“äº‹åŠ¡ä¸­çš„æäº¤æ“ä½œã€‚ 12345SharedPreferences sharedPreferences = getSharedPreferences("test", Context.MODE_PRIVATE);Editor editor = sharedPreferences.edit();//è·å–ç¼–è¾‘å™¨editor.putString("name", "å°æ˜");editor.putInt("age", 24);editor.commit();//æäº¤ä¿®æ”¹ 2. è¯»å–æ•°æ® ä½¿ç”¨Activityç±»çš„getSharedPreferences()æ–¹æ³•è·å¾—SharedPreferenceså¯¹è±¡ã€‚ é€šè¿‡SharedPreferenceså¯¹è±¡çš„getXxx()æ–¹æ³•å¾—åˆ°æ•°æ®ã€‚ 1234SharedPreferences sharedPreferences= getSharedPreferences("test", Activity.MODE_PRIVATE);// ä½¿ç”¨getStringæ–¹æ³•è·å¾—valueï¼Œæ³¨æ„ç¬¬2ä¸ªå‚æ•°æ˜¯valueçš„é»˜è®¤å€¼ String name =sharedPreferences.getString("name", "");int age =sharedPreferences.getInt("age", 0); SharedPreferencesçš„å››ç§æ¨¡å¼ 1234Context.MODE_PRIVATEï¼šä¸ºé»˜è®¤æ“ä½œæ¨¡å¼,ä»£è¡¨è¯¥æ–‡ä»¶æ˜¯ç§æœ‰æ•°æ®,åªèƒ½è¢«åº”ç”¨æœ¬èº«è®¿é—®,åœ¨è¯¥æ¨¡å¼ä¸‹,å†™å…¥çš„å†…å®¹ä¼šè¦†ç›–åŸæ–‡ä»¶çš„å†…å®¹Context.MODE_APPENDï¼šæ¨¡å¼ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨,å­˜åœ¨å°±å¾€æ–‡ä»¶è¿½åŠ å†…å®¹,å¦åˆ™å°±åˆ›å»ºæ–°æ–‡ä»¶.Context.MODE_WORLD_READABLEï¼šè¡¨ç¤ºå½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨è¯»å–.Context.MODE_WORLD_WRITEABLEï¼šè¡¨ç¤ºå½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨å†™å…¥.]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidViewä¹‹PopupWindow]]></title>
    <url>%2Fposts%2F1900f7eb.html</url>
    <content type="text"><![CDATA[AndroidViewä¹‹PopupWindowå› ä¸ºé¡¹ç›®ä¸­æœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨PopupWindowï¼Œæ‰€ä»¥ç‰¹åˆ«æŸ¥äº†ä¸€ä¸‹ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼Œè¿‡ä¸¤å¤©å°±åŠ åˆ°é¡¹ç›®ä¸­å»ã€‚ PopupWindowPopupWindowï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºå¼¹çª—çš„ç»„ä»¶ã€‚ åˆ›å»ºæ­¥éª¤ åˆ›å»ºPopupWindowå®ä¾‹ è®¾ç½®ä¸€äº›åŸºæœ¬å‚æ•° æ˜¾ç¤ºPopupWindowæ„é€ æ–¹æ³• 1PopupWindow window = new PopupWindow(View contentView, int width, int height, boolean focusable); è¿™ä¸ªæ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨äºPopupWindowä¸­çš„Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowçš„å®½åº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯PopupWindowçš„é«˜åº¦ï¼Œç¬¬å››ä¸ªå‚æ•°æŒ‡å®šPopupWindowèƒ½å¦è·å¾—ç„¦ç‚¹ã€‚ ç¤ºä¾‹ä»£ç  12View contentView = LayoutInflater.from(MainActivity.this).inflate(R.layout.popuplayout, null);PopupWindwo window = PopupWindow (contentView, ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, true); åŸºæœ¬æ–¹æ³• window.setBackgroundDrawable(Drawable background); è®¾ç½®PopupWindowçš„èƒŒæ™¯ window.setOutsideTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ window.setTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”ç‚¹å‡»äº‹ä»¶åªæœ‰åŒæ—¶è®¾ç½®PopupWindowçš„èƒŒæ™¯å’Œå¯ä»¥å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ï¼Œå®ƒæ‰èƒ½â€œçœŸæ­£â€å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ã€‚ æ˜¾ç¤ºPopupWindow window.showAtLocation(View parent, int gravity, int x, int y); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„çˆ¶Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„ä½ç½®ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„xã€yåç§» window.showAsDropDown(View anchor, int xoff, int yoff, int gravity); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„é”šç‚¹ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹é”šç‚¹çš„xã€yåç§» ä¸ºPopupWindowæ·»åŠ åŠ¨ç”» è¿›å…¥æ—¶åŠ¨ç”»ï¼š(context_menu_enter.xml) 1234567891011&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:duration="@android:integer/config_shortAnimTime" android:fromXDelta="0" android:fromYDelta="100%p" android:interpolator="@android:anim/accelerate_decelerate_interpolator" android:toXDelta="0" android:toYDelta="0"/&gt; &lt;/set&gt; é€€å‡ºæ—¶åŠ¨ç”»ï¼š(context_menu_exit.xml) 123456789101112&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android" &gt; &lt;translate android:duration="@android:integer/config_shortAnimTime" android:fromXDelta="0" android:fromYDelta="0" android:interpolator="@android:anim/accelerate_decelerate_interpolator" android:toXDelta="0" android:toYDelta="100%p" /&gt; &lt;/set&gt; ç”Ÿæˆstyle 1234&lt;style name=&quot;contextMenuAnim&quot; parent=&quot;@android:style/Animation.Activity&quot;&gt; &lt;item name=&quot;android:windowEnterAnimation&quot;&gt;@anim/context_menu_enter&lt;/item&gt; &lt;item name=&quot;android:windowExitAnimation&quot;&gt;@anim/context_menu_exit&lt;/item&gt;&lt;/style&gt;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
      </tags>
  </entry>
</search>
