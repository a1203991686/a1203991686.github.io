<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ4--è¿›ç¨‹çš„é€šä¿¡å’Œçº¿ç¨‹]]></title>
    <url>%2Fposts%2F30b7e738.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 4.1 è¿›ç¨‹é€šä¿¡è¿›ç¨‹é€šä¿¡å°±æ˜¯æŒ‡è¿›ç¨‹ä¹‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚ æ—©æœŸçš„æ—¶å€™ï¼Œç”±äºæŠ€æœ¯ä¸å‘è¾¾ï¼Œä»¥åŠç”±äºè¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥éœ€è¦åœ¨è¿›ç¨‹é—´äº¤æ¢ä¸€å®šçš„æ•°æ®ï¼Œæ‰€ä»¥ä¸å°‘äººä¹Ÿå°†ä»–ä»¬ç§°ä¸ºè¿›ç¨‹é€šä¿¡ï¼Œä½†æ˜¯å®è´¨ä¸Šä»–ä»¬åªèƒ½è¢«æˆä¸ºä½çº§çš„è¿›ç¨‹é€šä¿¡ã€‚ä»¥ä¿¡å·é‡ä¸ºä¾‹ï¼Œä»– æ•ˆç‡ä½ ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…æ¯æ¬¡åªèƒ½å‘ç¼“å†²åŒºæŠ•æ”¾ä¸€ä¸ªäº§å“æˆ–è€…å–å‡ºä¸€ä¸ªäº§å“ã€‚ é€šä¿¡å¯¹ç”¨æˆ·ä¸é€æ˜ è€Œå…³äºè¿›ç¨‹é—´é€šä¿¡æ‰€éœ€çš„æ•°æ®ç»“æ„çš„è®¾ç½®å’Œæ•°æ®çš„ä¼ é€ã€è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ï¼Œéƒ½éœ€è¦ç¨‹åºå‘˜å»å®Œæˆï¼Œæ˜¾ç„¶æ˜¯éå¸¸ä¸æ–¹ä¾¿çš„ã€‚ æ‰€ä»¥é«˜çº§è¿›ç¨‹é€šä¿¡å¿…é¡»æ»¡è¶³å¦‚ä¸‹ç‰¹ç‚¹ï¼š ä½¿ç”¨æ–¹ä¾¿ã€‚ OSéšè—äº†å®ç°è¿›ç¨‹é€šä¿¡çš„å…·ä½“ç»†èŠ‚ï¼Œå‘ç”¨æˆ·æä¾›äº†ä¸€ç»„ç”¨äºå®ç°é«˜çº§é€šä¿¡çš„å‘½ä»¤ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°ç›´æ¥åˆ©ç”¨å®ƒå®ç°è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ é«˜æ•ˆçš„ä¼ é€æ•°æ®ã€‚ ç”¨æˆ·å¯ä»¥ç›´æ¥åˆ©ç”¨é«˜çº§é€šä¿¡å‘½ä»¤é«˜æ•ˆçš„ä¼ é€å¤§é‡çš„æ•°æ®ã€‚ è¿›ç¨‹é€šä¿¡ä¸»è¦æœ‰å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿã€ç®¡é“é€šä¿¡ç³»ç»Ÿã€æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿä»¥åŠå®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿã€‚ 4.1.1 å…±äº«å­˜å‚¨å™¨ç³»ç»Ÿå…±äº«å­˜å‚¨å™¨ç³»ç»Ÿåˆåˆ†ä¸ºäº†ä¸¤ç§ï¼š åŸºäºå…±äº«æ•°æ®ç»“æ„çš„é€šä¿¡æ–¹å¼ åœ¨è¿™ç§é€šä¿¡æ–¹å¼ä¸‹ï¼Œè¦æ±‚è¿›ç¨‹å…¬ç”¨æŸäº›æ•°æ®ç»“æ„ï¼Œå€Ÿä»¥å®ç°è¯¸è¿›ç¨‹é—´çš„ä¿¡æ¯äº¤æ¢ã€‚è¿™ç§æ–¹å¼ä»…é€‚ç”¨äºä¼ é€’ç›¸å¯¹å°‘é‡çš„æ•°æ®ï¼Œé€šä¿¡æ•ˆç‡ä½ä¸‹ï¼Œå±äºä½çº§é€šä¿¡ã€‚ åŸºäºå…±äº«å­˜å‚¨åŒºçš„é€šä¿¡æ–¹å¼ ä¸ºäº†ä¼ è¾“å¤§é‡æ•°æ®ï¼Œå°±åœ¨å†…å­˜ä¸­åˆ’å‡ºäº†ä¸€å—å…±äº«å­˜å‚¨åŒºåŸŸï¼Œè¯¸è¿›ç¨‹å¯é€šè¿‡å¯¹è¯¥å…±äº«åŒºçš„è¯»æˆ–å†™äº¤æ¢æ•°æ®ï¼Œå®ç°é€šä¿¡ï¼Œæ•°æ®çš„å½¢å¼å’Œä½ç½®ç”šè‡³è®¿é—®æ§åˆ¶éƒ½æ˜¯ç”±è¿›ç¨‹è´Ÿè´£ï¼Œè€Œä¸æ˜¯OSã€‚ 4.1.2 ç®¡é“é€šä¿¡ç³»ç»Ÿæ‰€è°“ç®¡é“ï¼Œæ˜¯æŒ‡ç”¨äºè¿æ¥ä¸€ä¸ªè¯»è¿›ç¨‹å’Œä¸€ä¸ªå†™è¿›ç¨‹ä»¥å®ç°ä»–ä»¬ä¹‹é—´é€šä¿¡çš„ä¸€å—å…±äº«å­˜å‚¨æ–‡ä»¶ï¼Œåˆå«pipeæ–‡ä»¶ã€‚å‘ç®¡é“æä¾›è¾“å…¥çš„å‘é€è¿›ç¨‹ä»¥å­—ç¬¦æµå½¢å¼å°†è¾¾é‡çš„æ•°æ®é€å…¥ç®¡é“ï¼Œè€Œæ¥æ”¶ç®¡é“è¾“å‡ºçš„æ¥æ”¶è¿›ç¨‹åˆ™ä»ç®¡é“ä¸­æ¥æ”¶æ•°æ®ã€‚è¿™ç§æ–¹å¼æ˜¯UNIXç³»ç»ŸIPCæœ€å¤è€çš„å½¢å¼ã€‚ ä¸ºäº†åè°ƒåŒæ–¹çš„é€šä¿¡ï¼Œä»–å¿…é¡»æä¾›ä¸€ä¸‹ä¸‰ä¸ªåŠŸèƒ½çš„åè°ƒèƒ½åŠ›ï¼š äº’æ–¥ åŒæ­¥ ç¡®å®šå¯¹æ–¹æ˜¯å¦å­˜åœ¨ 4.1.3 æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œé›†æˆä¸å†å€ŸåŠ©ä»»ä½•å…±äº«å­˜å‚¨åŒºæˆ–æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä»¥æ ¼å¼åŒ–çš„æ¶ˆæ¯(Message)ä¸ºå•ä½ï¼Œå°†é€šä¿¡çš„æ•°æ®å°è£…åœ¨æ¶ˆæ¯ä¸­ï¼Œå¹¶åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ä¸€ç»„é€šä¿¡å‘½ä»¤ï¼Œåœ¨è¿›ç¨‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’ï¼Œå®Œæˆè¿›ç¨‹é—´çš„æ•°æ®äº¤æ¢ã€‚ è¯¥æ–¹å¼éšè—äº†é€šä¿¡å®ç°ç»†èŠ‚ï¼Œä½¿é€šä¿¡è¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜åŒ–ï¼Œé™ä½äº†é€šä¿¡ç¨‹åºè®¾è®¡çš„å¤æ‚æ€§å’Œé”™è¯¯ç‡ï¼Œæˆä¸ºå½“å‰åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç±»è¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶. 4.1.4 å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿå‰é¢çš„å‡ ç§é€šä¿¡ç³»ç»Ÿï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç”¨äºå®ç°ä¸åŒè®¡ç®—æœºé—´è¿›ç¨‹çš„åŒå‘é€šä¿¡ï¼Œä½†æ˜¯å®¢æˆ·æœº-æœåŠ¡å™¨ç³»ç»Ÿçš„é€šä¿¡æœºåˆ¶ï¼Œåœ¨ç½‘ç»œç¯å¢ƒçš„å„ç§åº”ç”¨é¢†åŸŸå·²æˆä¸ºå½“å‰ä¸»æµçš„é€šä¿¡å®ç°æœºåˆ¶ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šå¥—æ¥å­—ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å’Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚åœ¨è¿™å°±ä¸å¤šèµ˜è¿°äº†ã€‚ 4.2 çº¿ç¨‹4.2.1 ä¸ºä»€ä¹ˆè¦å¼•å…¥çº¿ç¨‹æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè¿›ç¨‹æœ‰ä¸¤ä¸ªåŸºæœ¬å±æ€§ï¼šâ‘ è¿›ç¨‹æ˜¯ä¸€ä¸ªå¯æ‹¥æœ‰èµ„æºçš„ç‹¬ç«‹å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹è¦èƒ½ç‹¬ç«‹è¿è¡Œï¼Œä»–å¿…é¡»æ‹¥æœ‰ä¸€å®šçš„æ•°æ®ç»“æ„ã€‚â‘¡è¿›ç¨‹åŒæ—¶åˆæ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹è°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚ ä¸ºäº†ç¨‹åºèƒ½å¹¶å‘æ‰§è¡Œï¼Œç³»ç»Ÿå¿…é¡»èƒ½è¿›è¡Œåˆ›å»ºè¿›ç¨‹ã€æ’¤é”€è¿›ç¨‹å’Œåˆ‡æ¢è¿›ç¨‹æ“ä½œã€‚ä½†æ˜¯ç”±äºè¿›ç¨‹æ˜¯èµ„æºçš„æ‹¥æœ‰è€…ï¼Œæ‰€ä»¥åœ¨ä¸Šè¿°è¿™äº›æ“ä½œä¸­ï¼Œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹ä»˜å‡ºè¾ƒå¤§çš„æ—¶ç©ºå¼€é”€ã€‚è¿™å°±é™åˆ¶äº†ç³»ç»Ÿä¸­æ‰€è®¾ç½®è¿›ç¨‹çš„æ•°ç›®ï¼Œè€Œä¸”è¿›ç¨‹åˆ‡æ¢ä¹Ÿä¸å®œè¿‡äºé¢‘ç¹ï¼Œä»è€Œé™åˆ¶äº†å¹¶å‘ç¨‹åº¦çš„è¿›ä¸€æ­¥æé«˜ã€‚ 4.2.2 çº¿ç¨‹çš„æ¦‚å¿µåœ¨ä¸Šè¿°åŸå› ä¸‹ï¼Œå¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µã€‚å­¦è€…ä»¬å°†è¿›ç¨‹çš„ä¸¤ä¸ªå±æ€§åˆ†å¼€ï¼Œè®©ä½œä¸ºè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ä¸æ‹¥æœ‰èµ„æºï¼Œè®©æ‹¥æœ‰èµ„æºçš„åŸºæœ¬å•å€ä¸è¢«é¢‘ç¹çš„è°ƒåº¦ã€‚è¿™æ ·çš„è¯ï¼Œå°±å½¢æˆäº†çº¿ç¨‹çš„æ¦‚å¿µã€‚ ä¸‹é¢æˆ‘ä»¬ä»6ä¸ªæ–¹é¢æ¥æ¯”è¾ƒä¸‹è¿›å’Œçº¿ç¨‹ï¼š è°ƒåº¦çš„åŸºæœ¬å•ä½ ä¼ ç»ŸOSä¸­ï¼Œè¿›ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼Œéƒ½éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€å¤§ã€‚åœ¨å¼•å…¥äº†çº¿ç¨‹çš„OSä¸­ï¼Œçº¿ç¨‹æ˜¯ä½œä¸ºç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶åªéœ€è¦ä¿å­˜å’Œè®¾ç½®å°‘é‡çš„å¯„å­˜å™¨å†…å®¹ï¼Œåˆ‡æ¢ä»£ä»·è¿œå°äºè¿›ç¨‹ã€‚ å¹¶å‘æ€§ åœ¨å¼•å…¥çº¿ç¨‹çš„OSä¸­ï¼Œä¸ä»…è¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸”åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´äº¦å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œç”šè‡³è¿˜å…è®¸åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½èƒ½å¹¶å‘æ‰§è¡Œã€‚ æ‹¥æœ‰èµ„æº è¿›ç¨‹å¯ä»¥æ‹¥æœ‰èµ„æºï¼Œè€Œä¸”è¿˜æ˜¯ç³»ç»Ÿä¸­æ‹¥æœ‰èµ„æºçš„ä¸€ä¸ªåŸºæœ¬å•ä½ã€‚ä½†æ˜¯çº¿ç¨‹æœ¬èº«å¹¶ä¸æ‹¥æœ‰èµ„æºï¼Œè€Œæ˜¯ä»…æœ‰ä¸€ç‚¹å¿…ä¸å¯å°‘çš„ã€èƒ½ä¿è¯ç‹¬ç«‹è¿è¡Œçš„èµ„æºã€‚ ç‹¬ç«‹æ€§ åŒä¸€è¿›ç¨‹ä¸­çš„çº¿ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§æ¯”ä¸åŒè¿›ç¨‹é—´çš„ç‹¬ç«‹æ€§ä½å¾—å¤šã€‚ ç³»ç»Ÿå¼€é”€ è¿›ç¨‹åˆ‡æ¢éœ€è¦å¤§é‡çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œçº¿ç¨‹é—´åˆ™éœ€è¦çš„å¾ˆå°‘ æ”¯æŒå¤šå¤„ç†æœºç³»ç»Ÿ åœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œå¯¹äºä¼ ç»Ÿè¿›ç¨‹ï¼Œä¸ç®¡æœ‰å¤šå°‘å¤„ç†æœºï¼Œè¯¥è¿›ç¨‹åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†æœºä¸Šã€‚ä½†æ˜¯å¯¹äºå¤šçº¿ç¨‹è¿›ç¨‹ï¼Œå¯ä»¥å°†ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹åˆ†é…åˆ°å¤šä¸ªå¤„ç†æœºä¸Šã€‚ 4.2.3 çº¿ç¨‹çš„çŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—ä¸è¿›ç¨‹ä¸€æ ·ï¼Œçº¿ç¨‹ä¹Ÿæ‹¥æœ‰ä¸‰ä¸ªçŠ¶æ€å’Œçº¿ç¨‹æ§åˆ¶å—ã€‚ 4.2.3.1 çº¿ç¨‹è¿è¡Œçš„ä¸‰ä¸ªçŠ¶æ€çº¿ç¨‹çš„ä¸‰ä¸ªçŠ¶æ€å’Œè¿›ç¨‹ç±»ä¼¼ã€‚ è¿è¡ŒçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²è·å¾—å¤„ç†æœºè€Œæ­£åœ¨è¿è¡Œã€‚ å°±ç»ªçŠ¶æ€ï¼Œè¡¨ç¤ºçº¿ç¨‹å·²å…·å¤‡å„ç§æ‰§è¡Œæ¡ä»¶ï¼Œåªé¡»å†è·å¾—CPUä¾¿å¯ç«‹å³æ‰§è¡Œã€‚ é˜»å¡çŠ¶æ€ï¼Œåªçº¿ç¨‹åœ¨æ‰§è¡Œä¸­å› æŸäº‹ä»¶å—é˜»è€Œå¤„äºæš‚åœçŠ¶æ€ã€‚ 4.2.3.2 çº¿ç¨‹æ§åˆ¶å—TCBçº¿ç¨‹æ§åˆ¶å—ç”¨æ¥çºªå½•ç”¨äºæ§åˆ¶å’Œç®¡ç†çº¿ç¨‹çš„ä¿¡æ¯ã€‚çº¿ç¨‹æ§åˆ¶å—ä¸­é€šå¸¸ç”±è¿™å‡ é¡¹ï¼š çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹è®¾ç½®å”¯ä¸€åœ°æ ‡è¯†ç¬¦ã€‚ ä¸€ç»„å¯„å­˜å™¨ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨PCã€çŠ¶æ€å¯„å­˜å™¨å’Œé€šç”¨å¯„å­˜å™¨çš„å†…å®¹ã€‚ çº¿ç¨‹è¿è¡ŒçŠ¶æ€ï¼Œç”¨äºæè¿°çº¿ç¨‹æ­£å¤„äºä½•ç§è¿è¡ŒçŠ¶æ€ã€‚ ä¼˜å…ˆçº§ï¼Œæè¿°çº¿ç¨‹æ‰§è¡Œçš„ä¼˜å…ˆç¨‹åº¦ã€‚ çº¿ç¨‹ä¸“æœ‰å­˜å‚¨åŒºï¼Œç”¨äºçº¿ç¨‹åˆ‡æ¢æ—¶å­˜æ”¾ç°åœºä¿æŠ¤ä¿¡æ¯ï¼Œå’Œä¸è¯¥çº¿ç¨‹ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚ ä¿¡å·å±è”½ï¼Œå³å¯¹æŸäº›ä¿¡å·åŠ ä»¥å±è”½ã€‚ å †æ ˆæŒ‡é’ˆã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[uCropæ¡†æ¶ç”¨æ³•å’Œæºç è§£æ]]></title>
    <url>%2Fposts%2F4e4b8b52.html</url>
    <content type="text"><![CDATA[æœ¬äººèƒ½åŠ›ä¸è¶³ï¼Œåœ¨çœ‹åˆ°æºç æœ€åä¸€éƒ¨åˆ†çš„æ—¶å€™å¤§é‡æŠ„è¢­å¯èƒ½æ˜¯æœ€è¯¦ç»†çš„UCropæºç è§£æ 1. uCropç®€ä»‹uCropæ˜¯ç›®å‰è¾ƒç«çš„å›¾ç‰‡è£å‰ªæ¡†æ¶ï¼Œå¼€å‘è€…å®£ç§°ä»–ä¼šæ¯”ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„å›¾ç‰‡è£å‰ªæ–¹æ¡ˆéƒ½è¦æ›´æµç•…ã€‚å¤–åŠ ä»–å°è£…ç¨‹åº¦è¾ƒé«˜ï¼Œå¯è‡ªå®šä¹‰ï¼Œè€Œä¸”é¢œå€¼å¾ˆé«˜ï¼ˆä¼¼ä¹è¿™ä¸ªæ‰æ˜¯é‡ç‚¹ï¼‰ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šAPPé€‰æ‹©ä½¿ç”¨å®ƒã€‚github 2. ä½¿ç”¨æ–¹æ³•å¾—ç›ŠäºuCropä¼˜ç§€çš„å°è£…ï¼ŒuCropçš„ä½¿ç”¨æ–¹æ³•ç‰¹ç®€å•ã€‚ 2.1 å¯¼å…¥ä¾èµ– å…ˆåœ¨é¡¹ç›®çš„build.gradleä¸­æ·»åŠ  123456allprojects &#123; repositories &#123; jcenter() maven &#123; url "https://jitpack.io" &#125; &#125;&#125; å¹¶åœ¨moduleçš„build.gradleä¸­æ·»åŠ  implementation &#39;com.github.yalantis:ucrop:2.2.3&#39; - è½»é‡çº§æ¡†æ¶ implementation &#39;com.github.yalantis:ucrop:2.2.3-native&#39; - è·å¾—æ¡†æ¶å…¨éƒ¨å¼ºå¤§çš„åŠŸèƒ½ä»¥åŠå›¾ç‰‡çš„é«˜è´¨é‡(æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´apkçš„å¤§å°å¢åŠ 1.5MBä»¥ä¸Š) ç”±äºæ¡†æ¶çš„æœ¬è´¨æ˜¯è°ƒç”¨åˆ°å¦ä¸€ä¸ªActivityå»å¤„ç†å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦åœ¨AndroidManifest.xmlä¸­å°†UCropActivityæ·»åŠ è¿›å» 1234&lt;activity android:name="com.yalantis.ucrop.UCropActivity" android:screenOrientation="portrait" android:theme="@style/Theme.AppCompat.Light.NoActionBar"/&gt; åˆ°è¿™ä½ å°±èƒ½æŠŠcUropå…¨éƒ¨å¯¼å…¥åˆ°ä½ çš„é¡¹ç›®é‡Œé¢äº†ï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±æ‹‰å°†å¦‚ä½•è°ƒç”¨ 2.2 å¼€å§‹åŸºæœ¬çš„è°ƒç”¨è°ƒç”¨èµ·æ¥å¾ˆç®€å•ï¼š 12UCrop.of(sourceUri, destinationUri) .start(context); å…¶ä¸­sourceUriæ˜¯è¾“å…¥å›¾ç‰‡çš„Uriï¼ŒdestinationUriæ˜¯è¾“å‡ºå›¾ç‰‡çš„Uriã€‚ç„¶åä»–å°±ä¼šç”±Intentçš„è°ƒåŠ¨è·³åˆ°UCropActivityï¼Œç”¨æˆ·å°±åœ¨UCropActivityé‡Œé¢è¿›è¡Œå›¾ç‰‡è£å‰ªæ“ä½œï¼Œç„¶åæœ€åç”±UCropActivityå‘èµ·ä¸€ä¸ªIntentå›åˆ°ä½ çš„Activityã€‚ 2.3 å¤„ç†å›æ¥çš„æ•°æ®ç”±äºæ˜¯ä»UCropAcitivityä¼ å›æ•°æ®ï¼Œæ‰€ä»¥ä½ éœ€è¦åœ¨ä½ çš„Activityé‡Œé¢çš„onActivityResultæ–¹æ³•å¤„ç†uCropè¿”å›çš„ä¿¡æ¯ï¼š 12345678@Overridepublic void onActivityResult(int requestCode, int resultCode, Intent data) &#123; if (resultCode == RESULT_OK &amp;&amp; requestCode == UCrop.REQUEST_CROP) &#123; final Uri resultUri = UCrop.getOutput(data); &#125; else if (resultCode == UCrop.RESULT_ERROR) &#123; final Throwable cropError = UCrop.getError(data); &#125;&#125; åˆ°è¿™ï¼ŒåŸºæœ¬ç”¨æ³•å°±å®Œäº†ï¼Œä½ å°±å¯ä»¥å°½æƒ…çš„ä½¿ç”¨uCropã€‚ä½†æ˜¯æˆ‘å‰é¢è¯´è¿‡ï¼ŒuCropå°è£…ç¨‹åº¦å¥½ï¼Œè¿™ç‚¹å¾ˆå¤šå›¾ç‰‡å¤„ç†æ¡†æ¶éƒ½å¯ä»¥åšåˆ°ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŠŠéœ€è¦çš„æ•°æ®ä¼ åˆ°è‡ªå·±çš„Activityä¹‹åç”±è‡ªå·±çš„Activityå¤„ç†ï¼Œæ‰€ä»¥å¾ˆå¤šæ¡†æ¶çœ‹èµ·æ¥éƒ½æœ‰ä¼˜ç§€çš„å°è£…ï¼Œé‚£uCropç›¸æ¯”å…¶ä»–åˆæœ‰å•¥å¥½å‘¢ï¼Œç­”æ¡ˆå°±æ˜¯è‡ªå®šä¹‰çµæ´»ï¼š 2.4 uCropé«˜é˜¶ç”¨æ³•2.4.1 é…ç½®uCrop12345678910111213141516171819202122232425262728293031323334353637383940414243/** * å¯åŠ¨è£å‰ª * @param activity ä¸Šä¸‹æ–‡ * @param sourceFilePath éœ€è¦è£å‰ªå›¾ç‰‡çš„ç»å¯¹è·¯å¾„ * @param requestCode æ¯”å¦‚ï¼šUCrop.REQUEST_CROP * @param aspectRatioX è£å‰ªå›¾ç‰‡å®½é«˜æ¯” * @param aspectRatioY è£å‰ªå›¾ç‰‡å®½é«˜æ¯” * @return */public static String startUCrop(Activity activity, String sourceFilePath, int requestCode, float aspectRatioX, float aspectRatioY) &#123; Uri sourceUri = Uri.fromFile(new File(sourceFilePath)); File outDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES); if (!outDir.exists()) &#123; outDir.mkdirs(); &#125; File outFile = new File(outDir, System.currentTimeMillis() + ".jpg"); //è£å‰ªåå›¾ç‰‡çš„ç»å¯¹è·¯å¾„ String cameraScalePath = outFile.getAbsolutePath(); Uri destinationUri = Uri.fromFile(outFile); //åˆå§‹åŒ–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ï¼šéœ€è¦è£å‰ªçš„å›¾ç‰‡ï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼šè£å‰ªåå›¾ç‰‡ UCrop uCrop = UCrop.of(sourceUri, destinationUri); //åˆå§‹åŒ–UCropé…ç½® UCrop.Options options = new UCrop.Options(); //è®¾ç½®è£å‰ªå›¾ç‰‡å¯æ“ä½œçš„æ‰‹åŠ¿ options.setAllowedGestures(UCropActivity.SCALE, UCropActivity.ROTATE, UCropActivity.ALL); //æ˜¯å¦éšè—åº•éƒ¨å®¹å™¨ï¼Œé»˜è®¤æ˜¾ç¤º options.setHideBottomControls(true); //è®¾ç½®toolbaré¢œè‰² options.setToolbarColor(ActivityCompat.getColor(activity, R.color.colorPrimary)); //è®¾ç½®çŠ¶æ€æ é¢œè‰² options.setStatusBarColor(ActivityCompat.getColor(activity, R.color.colorPrimary)); //æ˜¯å¦èƒ½è°ƒæ•´è£å‰ªæ¡† options.setFreeStyleCropEnabled(true); //UCropé…ç½® uCrop.withOptions(options); //è®¾ç½®è£å‰ªå›¾ç‰‡çš„å®½é«˜æ¯”ï¼Œæ¯”å¦‚16ï¼š9 uCrop.withAspectRatio(aspectRatioX, aspectRatioY); //uCrop.useSourceImageAspectRatio(); //è·³è½¬è£å‰ªé¡µé¢ uCrop.start(activity, requestCode); return cameraScalePath;&#125; 2.4.2 å…¶ä»–é…ç½®1234567891011121314151617181920212223242526//è®¾ç½®Toolbaræ ‡é¢˜void setToolbarTitle(@Nullable String text)//è®¾ç½®è£å‰ªçš„å›¾ç‰‡æ ¼å¼void setCompressionFormat(@NonNull Bitmap.CompressFormat format)//è®¾ç½®è£å‰ªçš„å›¾ç‰‡è´¨é‡ï¼Œå–å€¼0-100void setCompressionQuality(@IntRange(from = 0) int compressQuality)//è®¾ç½®æœ€å¤šç¼©æ”¾çš„æ¯”ä¾‹å°ºvoid setMaxScaleMultiplier(@FloatRange(from = 1.0, fromInclusive = false) float maxScaleMultiplier)//åŠ¨ç”»æ—¶é—´void setImageToCropBoundsAnimDuration(@IntRange(from = 100) int durationMillis)//è®¾ç½®å›¾ç‰‡å‹ç¼©æœ€å¤§å€¼void setMaxBitmapSize(@IntRange(from = 100) int maxBitmapSize)//æ˜¯å¦æ˜¾ç¤ºæ¤­åœ†è£å‰ªæ¡†é˜´å½±void setOvalDimmedLayer(boolean isOval) //è®¾ç½®æ¤­åœ†è£å‰ªæ¡†é˜´å½±é¢œè‰²void setDimmedLayerColor(@ColorInt int color)//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†void setShowCropFrame(boolean show)//è®¾ç½®è£å‰ªæ¡†è¾¹çš„å®½åº¦void setCropFrameStrokeWidth(@IntRange(from = 0) int width)//æ˜¯å¦æ˜¾ç¤ºè£å‰ªæ¡†ç½‘æ ¼void setShowCropGrid(boolean show) //è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼é¢œè‰²void setCropGridColor(@ColorInt int color)//è®¾ç½®è£å‰ªæ¡†ç½‘æ ¼å®½void setCropGridStrokeWidth(@IntRange(from = 0) int width) 3. æºç è§£æ åœ¨æˆ‘å¼€å§‹è¯´æºç ä¹‹å‰ï¼Œæˆ‘å»ºè®®å¤§å®¶å¯ä»¥å…ˆçœ‹ä¸‹æˆ‘ä¸‹é¢çš„è¿æ¥ï¼Œå› ä¸ºæœ¬æ¡†æ¶çš„ä½œè€…çœŸçš„æ˜¯ä¸ªå¥½äººï¼Œä»–ä¸ä»…ä¸ºæˆ‘ä»¬è´¡çŒ®äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªæ¡†æ¶ï¼Œè¿˜æŠŠè‡ªå·±å†™è¿™ä¸ªæ¡†æ¶çš„æ€è·¯éƒ½å†™äº†å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥çœ‹çœ‹è‹±æ–‡åŸç‰ˆå›½å†…ç½‘å‹ç¿»è¯‘ç‰ˆç™¾åº¦ç½‘é¡µç¿»è¯‘æœºç¿»ç‰ˆå…¶å®æˆ‘ä¸ªäººæ„Ÿè§‰ç™¾åº¦æœºç¿»æ²¡æœ‰è°·æ­Œç¿»è¯‘çš„å¥½ï¼Œå¤§å®¶æœ‰æ¡ä»¶çš„å¯ä»¥ä½¿ç”¨è°·æ­Œç¿»è¯‘æµè§ˆå™¨æ’ä»¶ç¿»è¯‘æ•´ä¸ªç½‘é¡µï¼ˆè°·æ­Œç¿»è¯‘å¥½åƒå›½å†…å¯ä»¥ç›´æ¥è®¿é—®ï¼‰ ä»£ç ç»“æ„å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†: 3.1 ç¬¬ä¸€éƒ¨åˆ†ï¼šUCropActivityï¼ˆæ•´ä¸ªæ¡†æ¶çš„å¤–åœ¨ï¼Œç”¨æˆ·æ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰ä»–çš„åŠŸèƒ½å°±æ˜¯é¡¹ç›®ä¸»è¦çš„ç•Œé¢ï¼Œä»¥åŠå®ç°ä¸€äº›åŸºæœ¬çš„åˆå§‹åŒ–ã€‚ä½ è·³è½¬åˆ°uCropçœ‹åˆ°çš„é‚£ä¸ªæ“ä½œå›¾ç‰‡çš„ç•Œé¢å°±æ˜¯å®ƒã€‚ è¿™å—çœ‹æºç çš„æ—¶å€™ä»£ç å±…å¤šï¼Œä½†æ˜¯ï¼Œè¯´å®è¯ï¼Œå°±åƒåˆšåˆšè¯´çš„ä¸€æ ·ï¼Œä»–é™¤äº†åˆå§‹åŒ–è¿˜æ˜¯åˆå§‹åŒ–ã€‚åˆå§‹åŒ–å®ŒToolbaræ¥ç€åˆå§‹åŒ–ViewGroupï¼Œåˆå§‹åŒ–å®ŒViewGroupæ¥ç€åˆå§‹åŒ–Imageæ•°æ®ç­‰ç­‰ã€‚æ‰€ä»¥è¿™å—æˆ‘å°±æ²¡å’‹ç»†çœ‹ï¼ˆå…¶å®æ˜¯å› ä¸ºä»£ç å¤ªé•¿äº†ï¼Œé€ƒï¼‰ 3.2 ç¬¬äºŒéƒ¨åˆ†ï¼šOverlayViewï¼ˆç»˜åˆ¶è£å‰ªæ¡†ï¼‰è¿™ä¸€å—ä¸»è¦å°±æ˜¯æ¥ç”»ä½ æ‰€çœ‹åˆ°çš„å›¾ç‰‡ä¸­çš„è£å‰ªçš„è¾…åŠ©çº¿ã€‚ åœ¨æ„é€ æ–¹æ³•é‡Œé¢å°±è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯init()ï¼Œè€Œinit()æ–¹æ³•ä¹Ÿå°±å¹²äº†ä¸€ä»¶äº‹â€”â€”åˆ¤æ–­ã€‚å½“ç³»ç»Ÿå°äºJELLY_BEA_MR2ä¹Ÿå°±æ˜¯Android4.3æ—¶ï¼Œå¯åŠ¨äº†ç¡¬ä»¶åŠ é€Ÿï¼Œè‡³äºä¸ºä»€ä¹ˆsetLayerType(LAYER_TYPE_SOFTWARE, null);è¿™ä¸ªçœ‹ç€å°±åƒå¯åŠ¨ç¡¬ä»¶åŠ é€Ÿçš„æ–¹æ³•ï¼Œç”šè‡³å‚æ•°é‡Œé¢è¿˜æœ‰è½¯ä»¶è¿™ä¸ªå•è¯çš„æ–¹æ³•èƒ½å¯åŠ¨ç¡¬ä»¶åŠ é€Ÿï¼Œè¯·å¤§å®¶ç§»æ­¥HenCoder Android è‡ªå®šä¹‰ View 1-8 ç¡¬ä»¶åŠ é€Ÿï¼ˆè¿›å»ç›´æ¥æœç´¢è¿™ä¸ªæ–¹æ³•å³å¯ï¼Œå°±èƒ½æ‰¾åˆ°è§£é‡Šçš„åœ°æ–¹ï¼‰ï¼Œæˆ‘å†æ¬¡ä¸åšè§£é‡Šã€‚ è¿™ä¸ªç±»ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³• drawDimmedLayer()ç»˜åˆ¶è£å‰ªæ¡†ä¹‹å¤–çš„ç°è‰²éƒ¨åˆ† drawCropGrid()ç»˜åˆ¶è£å‰ªæ¡† é‚£æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š 3.2.1 drawDimmedLayer()123456789101112131415161718192021protected void drawDimmedLayer(@NonNull Canvas canvas) &#123; //å…ˆä¿å­˜å½“å‰å½“å‰ç”»å¸ƒ canvas.save(); //åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºåœ†æ¡† if (mCircleDimmedLayer) &#123; //æŒ‰Pathè·¯å¾„è£å‰ª canvas.clipPath(mCircularPath, Region.Op.DIFFERENCE); &#125; else &#123; //è£å‰ªçŸ©å½¢ canvas.clipRect(mCropViewRect, Region.Op.DIFFERENCE); &#125; //ç€è‰² canvas.drawColor(mDimmedColor); //æ¢å¤ä¹‹å‰ä¿å­˜çš„Canvasçš„çŠ¶æ€ canvas.restore(); if (mCircleDimmedLayer) &#123; // ç»˜åˆ¶1pxç¬”åˆ’ä»¥ä¿®å¤åé”¯é½¿ canvas.drawCircle(mCropViewRect.centerX(), mCropViewRect.centerY(), Math.min(mCropViewRect.width(), mCropViewRect.height()) / 2.f, mDimmedStrokePaint); &#125;&#125; é¦–å…ˆå°±æ˜¯ä¸€ä¸ªmCircleDimmedLayerï¼Œè¿™ä¸ªæˆ‘çœŸçš„å¾ˆè¿·ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“å¥¹æ˜¯å’‹æ¥çš„ï¼Œäºæ˜¯æˆ‘å°±çœ‹OverlayViewæœ‰æ²¡æœ‰å¯¹è¿™ä¸ªå˜é‡çš„èµ‹å€¼ï¼Œäºæ˜¯æ•´ä¸ªç±»æˆ‘å°±æ‰¾åˆ°äº†ä¸€ä¸ªsetCircleDimmedLayer()æ–¹æ³•ï¼Œäºæ˜¯æˆ‘çœ‹è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å“ªè¢«è°ƒç”¨äº†çš„ï¼Œç„¶åæˆ‘å°±æ‰¾åˆ°ä»–åˆ†åˆ«è¢«UCropActivityå’ŒUCropFragmentä¸¤ä¸ªç±»è°ƒç”¨åˆ°ï¼Œè€Œä¸”ä¸€ä¸ªæ˜¯intent.getBooleanExtra()æ–¹æ³•ä¸€ä¸ªæ˜¯bundle.getBoolean()æ–¹æ³•ï¼Œçœ‹åˆ°è¿™ä¸ªæˆ‘ç›¸ä¿¡å¤§å®¶éƒ½æœ‰ç‚¹æ•°äº†ï¼Œè¿™æ˜æ˜¾å°±æ˜¯å…¶ä»–ç±»ä¼ è¿‡æ¥çš„å•Šï¼Œæˆ‘å‘ç°ä»–ä¸¤çš„keyçš„å€¼éƒ½æ˜¯UCrop.Options.EXTRA_CIRCLE_DIMMED_LAYERï¼Œé‚£æˆ‘å°±æ‡‚äº†ï¼Œæ‰¾æ•´ä¸ªæ¡†æ¶é‡Œé¢å“ªå„¿æåˆ°è¿‡è¿™ä¸ªå€¼ä¸å°±å¾—äº†ï¼Œäºæ˜¯æˆ‘å°±å‘ç°é™¤äº†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ä»¥åŠä»–çš„åˆå§‹åŒ–ä»¥å¤–ï¼Œæˆ‘å‘ç°äº†ç¬¬4ä¸ªè°ƒç”¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªè°ƒç”¨çš„åœ°æ–¹â€”â€”Ucrop.setCircleDimmedLayer()ï¼š 1234567/** * @param isCircle - set it to true if you want dimmed layer to have an circle inside * iscircle-å¦‚æœå¸Œæœ›æš—æ˜¾å±‚ä¸­æœ‰ä¸€ä¸ªåœ†ï¼Œè¯·å°†å…¶è®¾ç½®ä¸ºtrueã€‚ */public void setCircleDimmedLayer(boolean isCircle) &#123; mOptionBundle.putBoolean(EXTRA_CIRCLE_DIMMED_LAYER, isCircle);&#125; æ³¨é‡Šä¸Šé¢æ˜¯åŸè¯ï¼Œä¸‹é¢æ˜¯æˆ‘ç™¾åº¦æœºç¿»çš„ç¿»è¯‘ã€‚çœ‹äº†å°±æ‡‚äº†å§ï¼Œåæ­£æˆ‘æ²¡æ‡‚ï¼Œæˆ‘ä¹Ÿå®Œå…¨æ²¡æœ‰è§åˆ°å“ªè°ƒç”¨è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘æ›´ä¸æ‡‚å•¥å«å¸Œæœ›æš—æ˜¾å±‚æœ‰ä¸ªåœ†ï¼Œå•¥ç©æ„ï¼Ÿå……æ»¡çº¿æ¡çš„é»‘ï¼Ÿï¼Ÿï¼Ÿç›´åˆ°æˆ‘å°†UCropçš„è°ƒç”¨æ–¹æ³•ä¿®æ”¹äº†å¹¶è¿è¡Œä¹‹åæˆ‘æ‰æ‡‚äº†ï¼š 12345val options = UCrop.Options()options.setCircleDimmedLayer(true)UCrop.of(uri, destinationUri) .withOptions(options) .start(this) ç»“æœæ˜¯ï¼š ç„¶åå°±æ‡‚äº†ï¼Œåº”è¯¥æ˜¯èƒ½æˆªä¸€ä¸ªåœ†å½¢çš„å›¾æ¡ˆå§ï¼Œç„¶åæˆ‘ç‚¹ä¸‹äº†âœ”ï¸ï¼Œç„¶åâ€¦â€¦ æ— è¯å¯è¯´ï¼Œä½œè€…ç‰›é€¼ï¼ï¼ï¼ å›å»å›å»ï¼Œåˆšåˆšè¯´åˆ°drawDimmedLayer()ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœmCircleDimmedLayerä¸ºtrueå°±è°ƒç”¨clipPath()è·Ÿç€è·¯å¾„è£åˆ‡ä¸€ä¸ªçŸ©å½¢åŠ åŸï¼Œä¸ç„¶çš„è¯å°±è°ƒç”¨clipRect()è£åˆ‡ä¸€ä¸ªçŸ©å½¢ã€‚ç„¶ååŠ å…¥é¢œè‰²ï¼Œç„¶åå®Œäº† 3.2.2 drawCropGrid()1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950protected void drawCropGrid(@NonNull Canvas canvas) &#123; // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå‰ªè£æ¡† if (mShowCropGrid) &#123; // åˆ¤æ–­çŸ©å½¢æ•°æ®æ˜¯å¦ä¸ºç©ºï¼ŒmGridPoints å¦‚æœç­‰äºç©ºçš„è¯è¿›å…¥å¡«å……æ•°æ® if (mGridPoints == null &amp;&amp; !mCropViewRect.isEmpty()) &#123; // è¯¥æ•°ç»„ä¸º canvas.drawLines çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°è¦æ±‚å…¶å…ƒç´ ä¸ªæ•°ä¸º 4 çš„å€æ•° mGridPoints = new float[(mCropGridRowCount) * 4 + (mCropGridColumnCount) * 4]; int index = 0; // ç»„è£…æ•°æ®ï¼Œæ•°æ®ä¸ºæ¯ä¸€ç»„çº¿æ®µçš„åæ ‡ç‚¹ for (int i = 0; i &lt; mCropGridRowCount; i++) &#123; mGridPoints[index++] = mCropViewRect.left; mGridPoints[index++] = (mCropViewRect.height() * (((float) i + 1.0f) / (float) (mCropGridRowCount + 1))) + mCropViewRect.top; mGridPoints[index++] = mCropViewRect.right; mGridPoints[index++] = (mCropViewRect.height() * (((float) i + 1.0f) / (float) (mCropGridRowCount + 1))) + mCropViewRect.top; &#125; for (int i = 0; i &lt; mCropGridColumnCount; i++) &#123; mGridPoints[index++] = (mCropViewRect.width() * (((float) i + 1.0f) / (float) (mCropGridColumnCount + 1))) + mCropViewRect.left; mGridPoints[index++] = mCropViewRect.top; mGridPoints[index++] = (mCropViewRect.width() * (((float) i + 1.0f) / (float) (mCropGridColumnCount + 1))) + mCropViewRect.left; mGridPoints[index++] = mCropViewRect.bottom; &#125; &#125; //ç»˜åˆ¶çº¿æ®µ if (mGridPoints != null) &#123; canvas.drawLines(mGridPoints, mCropGridPaint); &#125; &#125; //ç»˜åˆ¶çŸ©å½¢åŒ…è£¹çº¿æ®µ if (mShowCropFrame) &#123; canvas.drawRect(mCropViewRect, mCropFramePaint); &#125; //ç»˜åˆ¶è¾¹è§’åŒ…è£¹,mFreestyleCropModeæ­¤å‚æ•°å¦‚æœç­‰äº1çš„è¯ å‰ªè£æ¡†ä¸ºå¯ç§»åŠ¨çŠ¶æ€ï¼Œä¸€èˆ¬ä¸ç”¨ if (mFreestyleCropMode != FREESTYLE_CROP_MODE_DISABLE) &#123; canvas.save(); mTempRect.set(mCropViewRect); mTempRect.inset(mCropRectCornerTouchAreaLineLength, -mCropRectCornerTouchAreaLineLength); canvas.clipRect(mTempRect, Region.Op.DIFFERENCE); mTempRect.set(mCropViewRect); mTempRect.inset(-mCropRectCornerTouchAreaLineLength, mCropRectCornerTouchAreaLineLength); canvas.clipRect(mTempRect, Region.Op.DIFFERENCE); canvas.drawRect(mCropViewRect, mCropFrameCornersPaint); canvas.restore(); &#125;&#125; ä¸€å¼€å¤´åˆæ˜¯ä¸€ä¸ªå’Œä¸Šé¢ç±»ä¼¼çš„å˜é‡mShowCropGridï¼Œè¿™ä¸‹æˆ‘å°±ä¸è¯´æˆ‘æ‰¾çš„å…·ä½“æ­¥éª¤ï¼Œä»–çš„åŠŸèƒ½å°±æ˜¯å¦‚æœä»–æ˜¯trueå°±ä¼šåœ¨è£å‰ªæ¡†ä¸­æ˜¾ç¤º9å®«æ ¼çº¿ï¼Œä¸ºfalseå°±æ²¡æœ‰ã€‚æ¥ç€å°±æ˜¯ç”»çº¿éƒ¨åˆ†ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæˆ‘ä¸ç”¨è®²å•¥ï¼Œä¹Ÿæ²¡å•¥è®²çš„ï¼Œå”¯ä¸€å°±æ˜¯ä¸ºä»€ä¹ˆmGridPointsè¿™ä¸ªæ•°ç»„çš„å¤§å°æ˜¯4çš„å€æ•°ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹è¿™ä¸ªåšå®¢Android Canvas DrawLinesä¸­ç¬¬ä¸€ä¸ªå‚æ•°çš„è§£é‡Š 3.3 ç¬¬ä¸‰éƒ¨åˆ†ï¼šGestureCropImageViewï¼ˆæ­£åœ¨æ¡†æ¶çš„å†…åœ¨ï¼Œä»£ç æ“ä½œæ“ä½œå›¾ç‰‡çš„åœ°æ–¹ï¼‰è¿™ä¸ªæ˜¯æ•´ä¸ªé¡¹ç›®æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚å‰é¢çš„ä¸¤éƒ¨åˆ†éƒ½æ˜¯UIçš„ï¼Œè€Œè¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æˆ‘æœ€æƒ³çŸ¥é“äº†è§£çš„éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†ä½œè€…ä¹Ÿåœ¨ä»–çš„åšå®¢é‡Œé¢è¯´çš„æœ€å¤šæœ€æ¸…æ¥šã€‚ä½œè€…æŠŠè¿™éƒ¨åˆ†çš„é€»è¾‘åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ† TransformImageView extends ImageView ä»–å¤„ç†äº† ä»æºæ‹¿åˆ°å›¾ç‰‡ å°†å›¾ç‰‡è¿›å˜æ¢ï¼ˆå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬ï¼‰ï¼Œå¹¶åº”ç”¨åˆ°å½“å‰å›¾ç‰‡ä¸Š CropImageView extends TransformImageView ä»–å¤„ç†äº† ç»˜åˆ¶è£å‰ªè¾¹æ¡†å’Œç½‘æ ¼ ä¸ºè£å‰ªåŒºåŸŸè®¾ç½®ä¸€å¼ å›¾ç‰‡ï¼ˆå¦‚æœç”¨æˆ·å¯¹å›¾ç‰‡æ“ä½œå¯¼è‡´è£å‰ªåŒºåŸŸå‡ºç°äº†ç©ºç™½ï¼Œé‚£ä¹ˆå›¾ç‰‡åº”è‡ªåŠ¨ç§»åŠ¨åˆ°è¾¹ç•Œå¡«å……ç©ºç™½åŒºåŸŸï¼‰ ç»§æ‰¿çˆ¶ç±»æ–¹æ³•ï¼Œä½¿ç”¨æ›´ç²¾å‡†çš„è§„åˆ™æ¥æ“ä½œçŸ©é˜µï¼ˆé™åˆ¶æœ€å¤§å’Œæœ€å°ç¼©æ”¾æ¯”ï¼‰ æ·»åŠ æ–¹æ³•å’Œç¼©å°çš„æ–¹æ³• è£å‰ªå›¾ç‰‡ GestureCropImageView extends CropImageView ä»–å¤„ç†äº† ç›‘å¬ç”¨æˆ·æ‰‹åŠ¿ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„æ­£ç¡®çš„æ–¹æ³• 3.3.1 TransformImageViewä½œè€…è¯´è¿™æ˜¯æœ€å®¹æ˜“çš„éƒ¨åˆ†ã€‚åœ¨çœ‹è¿™ä¸ªç±»ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹BitmapLoadTaskç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€åˆ‡å›¾åƒå¤„ç†çš„åŸºç¡€ï¼Œè¿™ä¸ªç±»è´Ÿè´£äº†Uriè§£ç bitmapï¼Œå¹¶å¤„ç†åˆ†è¾¨ç‡ï¼šé¦–å…ˆæ ¹æ®æ‹¿åˆ°çš„Uriè§£æä½å›¾ï¼š 12345678910111213final ParcelFileDescriptor parcelFileDescriptor;try &#123; parcelFileDescriptor = mContext.getContentResolver().openFileDescriptor(mInputUri, "r");&#125; catch (FileNotFoundException e) &#123; return new BitmapWorkerResult(e);&#125;final FileDescriptor fileDescriptor;if (parcelFileDescriptor != null) &#123; fileDescriptor = parcelFileDescriptor.getFileDescriptor();&#125; else &#123; return new BitmapWorkerResult(new NullPointerException("ParcelFileDescriptor was null for given Uri: [" + mInputUri + "]"));&#125; ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨BitmapFactoryæ–¹æ³•è§£ç FileDescriptorã€‚ ä½†åœ¨è§£ç ä½å›¾ä¹‹å‰ï¼Œæœ‰å¿…è¦çŸ¥é“å®ƒçš„å¤§å°ï¼Œå› ä¸ºå¦‚æœåˆ†è¾¨ç‡å¤ªé«˜ï¼Œä½å›¾å°†è¢«äºŒæ¬¡é‡‡æ ·ã€‚ 123456789101112131415161718192021222324252627282930313233final BitmapFactory.Options options = new BitmapFactory.Options();options.inJustDecodeBounds = true;BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);options.inSampleSize = calculateInSampleSize(options, requiredWidth, requiredHeight);options.inJustDecodeBounds = false;Bitmap decodeSampledBitmap = BitmapFactory.decodeFileDescriptor(fileDescriptor, null, options);close(parcelFileDescriptor);ExifInterface exif = getExif(uri);if (exif != null) &#123; int exifOrientation = exif.getAttributeInt(ExifInterface.TAG_ORIENTATION, ExifInterface.ORIENTATION_NORMAL); return rotateBitmap(decodeSampledBitmap, exifToDegrees(exifOrientation));&#125; else &#123; return decodeSampledBitmap;&#125; è¿™æ ·å°±æ‹¿åˆ°äº†bitmapå®ä¾‹äº†ï¼Œå°±å¯ä»¥å»TansformImageViewå»å¯¹å›¾ç‰‡è¿›è¡Œè°ƒæ•´äº†ã€‚å…¶å®è¿™ä¸ªç±»æˆ‘ä¹Ÿä¸çŸ¥é“è¯´å•¥ğŸ˜‚ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªç±»ä¹Ÿå°±æ˜¯æŠŠMatrixçš„postTranslate()ã€postRotate()å’ŒpostScale()æ–¹æ³•ç»™å°è£…äº†ä¸‹ã€‚å…³äºMatrixçš„çŸ¥è¯†å¤§å®¶å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼šå®‰å“è‡ªå®šä¹‰Viewè¿›é˜¶-MatrixåŸç† 3.3.2 CropImageViewè¿™ä¸€å±‚æ˜¯æœ€å¤æ‚çš„ä¸€å±‚ï¼Œä½œè€…çš„æ“ä½œå¤§è‡´å¯ä»¥åˆ†ä¸º3æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—ã€å›¾ç‰‡å½’ä¸ºåŠ¨ç”»å¤„ç†ã€è£å‰ªå›¾ç‰‡ ç¬¬ä¸€æ­¥ï¼šå›¾ç‰‡è£å‰ªæ¡†åç§»è®¡ç®—å½“ç”¨æˆ·æ‰‹æŒ‡ç§»å¼€æ—¶ï¼Œè¦ç¡®ä¿å›¾ç‰‡å¤„äºè£å‰ªåŒºåŸŸä¸­ï¼Œå¦‚æœä¸å¤„äºï¼Œéœ€è¦é€šè¿‡å¹³ç§»æŠŠå®ƒç§»è¿‡æ¥ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public void setImageToWrapCropBounds(boolean animate) &#123; //å¦‚æœå›¾ç‰‡åŠ è½½å®Œæ¯•å¹¶ä¸”å›¾ç‰‡ä¸å¤„äºå‰ªè£åŒºåŸŸ if (mBitmapLaidOut &amp;&amp; !isImageWrapCropBounds()) &#123; //è·å–ä¸­å¿ƒç‚¹X,Yåæ ‡ float currentX = mCurrentImageCenter[0]; float currentY = mCurrentImageCenter[1]; //è·å–ç¼©æ”¾æ¯”ä¾‹ float currentScale = getCurrentScale(); //è·å–åç§»è·ç¦» float deltaX = mCropRect.centerX() - currentX; float deltaY = mCropRect.centerY() - currentY; float deltaScale = 0; mTempMatrix.reset(); mTempMatrix.setTranslate(deltaX, deltaY); final float[] tempCurrentImageCorners = Arrays.copyOf(mCurrentImageCorners, mCurrentImageCorners.length); mTempMatrix.mapPoints(tempCurrentImageCorners); //åˆ¤æ–­å›¾ç‰‡æ˜¯å¦åŒ…å«åœ¨å‰ªè£åŒºåŸŸ boolean willImageWrapCropBoundsAfterTranslate = isImageWrapCropBounds(tempCurrentImageCorners); //å¦‚æœåŒ…å«åœ¨å‰ªè£åŒºåŸŸ if (willImageWrapCropBoundsAfterTranslate) &#123; //è·å–åç§»çš„è·ç¦» final float[] imageIndents = calculateImageIndents(); //åç§»çš„è·ç¦»ï¼Œæ¨ªåæ ‡åŠ æ¨ªåæ ‡ çºµåæ ‡åŠ çºµåæ ‡ deltaX = -(imageIndents[0] + imageIndents[2]); deltaY = -(imageIndents[1] + imageIndents[3]); &#125; else &#123; //å¦‚æœä¸åŒ…å«åœ¨å‰ªè£åŒºåŸŸï¼Œåˆ›å»ºä¸´æ—¶çŸ©å½¢ RectF tempCropRect = new RectF(mCropRect); mTempMatrix.reset(); //è®¾ç½®åç§»è§’åº¦ mTempMatrix.setRotate(getCurrentAngle()); mTempMatrix.mapRect(tempCropRect); //è·å¾—çŸ©å½¢çš„è¾¹é•¿åæ ‡ final float[] currentImageSides = RectUtils.getRectSidesFromCorners(mCurrentImageCorners); //è·å–æ”¾å¤§æ¯”ä¾‹ deltaScale = Math.max(tempCropRect.width() / currentImageSides[0], tempCropRect.height() / currentImageSides[1]); deltaScale = deltaScale * currentScale - currentScale; &#125; //å¦‚æœéœ€è¦åŠ¨ç”» if (animate) &#123; post(mWrapCropBoundsRunnable = new WrapCropBoundsRunnable( CropImageView.this, mImageToWrapCropBoundsAnimDuration, currentX, currentY, deltaX, deltaY, currentScale, deltaScale, willImageWrapCropBoundsAfterTranslate)); &#125; else &#123; //ä¸éœ€è¦åŠ¨ç”»ï¼Œç›´æ¥ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½® postTranslate(deltaX, deltaY); if (!willImageWrapCropBoundsAfterTranslate) &#123; zoomInImage(currentScale + deltaScale, mCropRect.centerX(), mCropRect.centerY()); &#125; &#125; &#125;&#125; ç¬¬äºŒæ­¥ï¼šå¤„ç†å¹³ç§»é€šè¿‡ä¸€ä¸ªRunnableçº¿ç¨‹æ¥å¤„ç†å¹³ç§»ï¼Œå¹¶ä¸”é€šè¿‡æ—¶é—´å·®å€¼çš„è®¡ç®—æ¥ç§»åŠ¨åŠ¨ç”»ï¼Œä½¿åŠ¨ç”»çœ‹èµ·æ¥æ›´çœŸå®ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162/** * æ­¤å¯è¿è¡Œæ–‡ä»¶ç”¨äºåŠ¨ç”»å›¾åƒï¼Œä½¿å…¶å®Œå…¨å¡«å……è£å‰ªè¾¹ç•Œã€‚ * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚ * runnableå¯ä»¥ç»ˆæ­¢äºvie&#123;@link #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;@link WrapCropBoundsRunnable#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚ */private static class WrapCropBoundsRunnable implements Runnable &#123; private final WeakReference&lt;CropImageView&gt; mCropImageView; private final long mDurationMs, mStartTime; private final float mOldX, mOldY; private final float mCenterDiffX, mCenterDiffY; private final float mOldScale; private final float mDeltaScale; private final boolean mWillBeImageInBoundsAfterTranslate; public WrapCropBoundsRunnable(CropImageView cropImageView, long durationMs, float oldX, float oldY, float centerDiffX, float centerDiffY, float oldScale, float deltaScale, boolean willBeImageInBoundsAfterTranslate) &#123; mCropImageView = new WeakReference&lt;&gt;(cropImageView); mDurationMs = durationMs; mStartTime = System.currentTimeMillis(); mOldX = oldX; mOldY = oldY; mCenterDiffX = centerDiffX; mCenterDiffY = centerDiffY; mOldScale = oldScale; mDeltaScale = deltaScale; mWillBeImageInBoundsAfterTranslate = willBeImageInBoundsAfterTranslate; &#125; @Override public void run() &#123; CropImageView cropImageView = mCropImageView.get(); if (cropImageView == null) &#123; return; &#125; long now = System.currentTimeMillis(); float currentMs = Math.min(mDurationMs, now - mStartTime); float newX = CubicEasing.easeOut(currentMs, 0, mCenterDiffX, mDurationMs); float newY = CubicEasing.easeOut(currentMs, 0, mCenterDiffY, mDurationMs); float newScale = CubicEasing.easeInOut(currentMs, 0, mDeltaScale, mDurationMs); if (currentMs &lt; mDurationMs) &#123; cropImageView.postTranslate(newX - (cropImageView.mCurrentImageCenter[0] - mOldX), newY - (cropImageView.mCurrentImageCenter[1] - mOldY)); if (!mWillBeImageInBoundsAfterTranslate) &#123; cropImageView.zoomInImage(mOldScale + newScale, cropImageView.mCropRect.centerX(), cropImageView.mCropRect.centerY()); &#125; if (!cropImageView.isImageWrapCropBounds()) &#123; cropImageView.post(this); &#125; &#125; &#125;&#125; ä¸‹é¢è¿˜æœ‰å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºåŒå‡»æ”¾å¤§: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * æ­¤å¯è¿è¡Œé¡¹ç”¨äºè®¾ç½®å›¾åƒç¼©æ”¾çš„åŠ¨ç”»ã€‚ * ç»™å®šå€¼åœ¨åŠ¨ç”»æœŸé—´å†…æ’ã€‚ * runnableå¯ä»¥ç»ˆæ­¢vie &#123;@link #cancelAllAnimations()&#125;æ–¹æ³•ï¼Œ * ä¹Ÿå¯ä»¥åœ¨è§¦å‘&#123;@link ZoomImageToPosition#run()&#125;æ–¹æ³•å†…çš„æŸäº›æ¡ä»¶æ—¶ç»ˆæ­¢ã€‚ */private static class ZoomImageToPosition implements Runnable &#123; private final WeakReference&lt;CropImageView&gt; mCropImageView; private final long mDurationMs, mStartTime; private final float mOldScale; private final float mDeltaScale; private final float mDestX; private final float mDestY; public ZoomImageToPosition(CropImageView cropImageView, long durationMs, float oldScale, float deltaScale, float destX, float destY) &#123; mCropImageView = new WeakReference&lt;&gt;(cropImageView); mStartTime = System.currentTimeMillis(); mDurationMs = durationMs; mOldScale = oldScale; mDeltaScale = deltaScale; mDestX = destX; mDestY = destY; &#125; @Override public void run() &#123; CropImageView cropImageView = mCropImageView.get(); if (cropImageView == null) &#123; return; &#125; long now = System.currentTimeMillis(); float currentMs = Math.min(mDurationMs, now - mStartTime); float newScale = CubicEasing.easeInOut(currentMs, 0, mDeltaScale, mDurationMs); if (currentMs &lt; mDurationMs) &#123; cropImageView.zoomInImage(mOldScale + newScale, mDestX, mDestY); cropImageView.post(this); &#125; else &#123; cropImageView.setImageToWrapCropBounds(); &#125; &#125;&#125; ç¬¬ä¸‰æ­¥ï¼šè£å‰ªå›¾ç‰‡ 12345678910111213141516171819202122232425/** * å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»å¹¶è®¾ç½®å›¾åƒä»¥å¡«å……è£å‰ªåŒºåŸŸï¼ˆä¸å¸¦åŠ¨ç”»ï¼‰ã€‚ * ç„¶åç”¨é€‚å½“çš„å‚æ•°åˆ›å»ºå¹¶æ‰§è¡Œ&#123;@link BitmapCropTask&#125;ã€‚ */public void cropAndSaveImage(@NonNull Bitmap.CompressFormat compressFormat, int compressQuality, @Nullable BitmapCropCallback cropCallback) &#123; //ç»“æŸå­çº¿ç¨‹ cancelAllAnimations(); //è®¾ç½®è¦å‰ªè£çš„å›¾ç‰‡ï¼Œä¸éœ€è¦ä½ç§»åŠ¨ç”» setImageToWrapCropBounds(false); //å­˜å‚¨å›¾ç‰‡ä¿¡æ¯ï¼Œå››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šmCropRectè¦å‰ªè£çš„å›¾ç‰‡çŸ©é˜µï¼Œå½“å‰å›¾ç‰‡è¦å‰ªè£çš„çŸ©é˜µï¼Œå½“å‰æ”¾å¤§çš„å€¼ï¼Œå½“å‰æ—‹è½¬çš„è§’åº¦ final ImageState imageState = new ImageState( mCropRect, RectUtils.trapToRect(mCurrentImageCorners), getCurrentScale(), getCurrentAngle()); //å‰ªè£å‚æ•°ï¼ŒmMaxResultImageSizeXï¼ŒmMaxResultImageSizeYï¼šå‰ªè£å›¾ç‰‡çš„æœ€å¤§å®½åº¦ã€é«˜åº¦ã€‚ final CropParameters cropParameters = new CropParameters( mMaxResultImageSizeX, mMaxResultImageSizeY, compressFormat, compressQuality, getImageInputPath(), getImageOutputPath(), getExifInfo()); //å‰ªè£æ“ä½œæ”¾åˆ°AsyncTaskä¸­æ‰§è¡Œ new BitmapCropTask(getViewBitmap(), imageState, cropParameters, cropCallback).execute();&#125; è¿™å—æ ¸å¿ƒæ–¹æ³•è¿˜æ˜¯åœ¨BitmapCropTaskä¸­ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162//è°ƒæ•´å‰ªè£å¤§å°ï¼Œå¦‚æœæœ‰è®¾ç½®æœ€å¤§å‰ªè£å¤§å°ä¹Ÿä¼šåœ¨è¿™é‡Œåšè°ƒæ•´åˆ°è®¾ç½®èŒƒå›´private float resize() &#123; final BitmapFactory.Options options = new BitmapFactory.Options(); options.inJustDecodeBounds = true; BitmapFactory.decodeFile(mImageInputPath, options); boolean swapSides = mExifInfo.getExifDegrees() == 90 || mExifInfo.getExifDegrees() == 270; float scaleX = (swapSides ? options.outHeight : options.outWidth) / (float) mViewBitmap.getWidth(); float scaleY = (swapSides ? options.outWidth : options.outHeight) / (float) mViewBitmap.getHeight(); float resizeScale = Math.min(scaleX, scaleY); mCurrentScale /= resizeScale; resizeScale = 1; if (mMaxResultImageSizeX &gt; 0 &amp;&amp; mMaxResultImageSizeY &gt; 0) &#123; float cropWidth = mCropRect.width() / mCurrentScale; float cropHeight = mCropRect.height() / mCurrentScale; if (cropWidth &gt; mMaxResultImageSizeX || cropHeight &gt; mMaxResultImageSizeY) &#123; scaleX = mMaxResultImageSizeX / cropWidth; scaleY = mMaxResultImageSizeY / cropHeight; resizeScale = Math.min(scaleX, scaleY); mCurrentScale /= resizeScale; &#125; &#125; return resizeScale;&#125;// å‰ªè£å›¾ç‰‡private boolean crop(float resizeScale) throws IOException &#123; ExifInterface originalExif = new ExifInterface(mImageInputPath); //å››èˆäº”å…¥å–æ•´ cropOffsetX = Math.round((mCropRect.left - mCurrentImageRect.left) / mCurrentScale); cropOffsetY = Math.round((mCropRect.top - mCurrentImageRect.top) / mCurrentScale); mCroppedImageWidth = Math.round(mCropRect.width() / mCurrentScale); mCroppedImageHeight = Math.round(mCropRect.height() / mCurrentScale); //è®¡ç®—å‡ºå›¾ç‰‡æ˜¯å¦éœ€è¦è¢«å‰ªè£ boolean shouldCrop = shouldCrop(mCroppedImageWidth, mCroppedImageHeight); Log.i(TAG, "Should crop: " + shouldCrop); if (shouldCrop) &#123; //è°ƒç”¨C++æ–¹æ³•å‰ªè£ boolean cropped = cropCImg(mImageInputPath, mImageOutputPath, cropOffsetX, cropOffsetY, mCroppedImageWidth, mCroppedImageHeight, mCurrentAngle, resizeScale, mCompressFormat.ordinal(), mCompressQuality, mExifInfo.getExifDegrees(), mExifInfo.getExifTranslation()); //å‰ªè£æˆåŠŸå¤åˆ¶å›¾ç‰‡EXIFä¿¡æ¯ if (cropped &amp;&amp; mCompressFormat.equals(Bitmap.CompressFormat.JPEG)) &#123; ImageHeaderParser.copyExif(originalExif, mCroppedImageWidth, mCroppedImageHeight, mImageOutputPath); &#125; return cropped; &#125; else &#123; //ç›´æ¥å¤åˆ¶å›¾ç‰‡åˆ°ç›®æ ‡æ–‡ä»¶å¤¹ FileUtils.copyFile(mImageInputPath, mImageOutputPath); return false; &#125;&#125; 3.3.3 GestureCropImageViewè¿™ä¸ªç±»ä¸»è¦å°±æ˜¯å¯¹æ‰‹åŠ¿çš„ç›‘å¬ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•ç²—æš´ï¼Œç›´æ¥æ‰¾ä»–çš„onTouchEventæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536/** * å¦‚æœæ˜¯ACTION_DOWN eventï¼Œç”¨æˆ·è§¦æ‘¸å±å¹•ï¼Œå¿…é¡»å–æ¶ˆæ‰€æœ‰å½“å‰åŠ¨ç”»ã€‚ * å¦‚æœæ˜¯ACTION_UP eventï¼Œç”¨æˆ·ä»å±å¹•ä¸Šå–ä¸‹æ‰€æœ‰æ‰‹æŒ‡ï¼Œå¿…é¡»çº æ­£å½“å‰å›¾åƒä½ç½®ã€‚ * å¦‚æœæœ‰ä¸¤ä¸ªä»¥ä¸Šçš„æ‰‹æŒ‡-æ›´æ–°ç„¦ç‚¹åæ ‡ã€‚ * å¦‚æœå·²å¯ç”¨ï¼Œåˆ™å°†äº‹ä»¶ä¼ é€’ç»™æ‰‹åŠ¿æ£€æµ‹å™¨ã€‚ */@Overridepublic boolean onTouchEvent(MotionEvent event) &#123; if ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_DOWN) &#123; cancelAllAnimations(); &#125; if (event.getPointerCount() &gt; 1) &#123; mMidPntX = (event.getX(0) + event.getX(1)) / 2; mMidPntY = (event.getY(0) + event.getY(1)) / 2; &#125; //åŒå‡»ç›‘å¬å’Œæ‹–åŠ¨ç›‘å¬ mGestureDetector.onTouchEvent(event); //ä¸¤æŒ‡ç¼©æ”¾ç›‘å¬ if (mIsScaleEnabled) &#123; mScaleDetector.onTouchEvent(event); &#125; //æ—‹è½¬ç›‘å¬ if (mIsRotateEnabled) &#123; mRotateDetector.onTouchEvent(event); &#125; if ((event.getAction() &amp; MotionEvent.ACTION_MASK) == MotionEvent.ACTION_UP) &#123; //æœ€åä¸€æŒ‡æŠ¬èµ·æ—¶åˆ¤æ–­å›¾ç‰‡æ˜¯å¦å¡«å……å‰ªè£æ¡† setImageToWrapCropBounds(); &#125; return true;&#125;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç </tag>
        <tag>uCrop</tag>
        <tag>å›¾ç‰‡å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Aria2macOSå®‰è£…]]></title>
    <url>%2Fposts%2F4f46fdbb.html</url>
    <content type="text"><![CDATA[å¯¹ä¸èµ·å¤§å®¶ï¼Œåœ¨æˆ‘é…ç½®å¥½è¿™ä¸ªè½¯ä»¶ä¹‹åï¼Œæˆ‘å…´å†²å†²çš„æ‰“å¼€äº†githubæƒ³ä¸‹è½½ä¸‹ssr4.0forWindowsï¼Œè¿«ä¸åŠå¾…æƒ³æ„Ÿå—ä¸‹aria2çš„å¿«æ„Ÿï¼Œç»“æœå‘ç°æˆ‘é”™äº†ã€‚ä¸‹è½½é€Ÿåº¦å°±æ‰å‡ åk/sï¼Œé‚£ä¸€ç¬é—´ï¼Œæˆ‘æ„Ÿè§¦å¾ˆå¤šï¼Œæˆ‘çªç„¶æƒ³åˆ°æˆ‘æ˜¨æ™šçš„è¿…é›·ä¸‹è½½åŒæ ·çš„èµ„æºåŒæ ·çš„ç½‘åŒæ ·çš„vpnä¸‹å¤§å‡ ç™¾k/s çš„é€Ÿåº¦ï¼Œç„¶ååˆçœ‹åˆ°äº†æ­¤æ—¶æˆ‘ç»™äºˆå¸Œæœ›çš„ariaï¼Œæˆ‘é™·å…¥äº†æ²‰æ€ï¼Œæˆ–è®¸è¿™å°±æ˜¯äººç”Ÿå§ã€‚çªç„¶è§‰å¾—macOSè¿…é›·ï¼Œä¹Ÿè¿˜æŒºå¥½çœ‹çš„ï¼Œä¹ŸæŒºå¥½ç”¨çš„ï¼Œå®Œå…¨æ²¡æœ‰å¹¿å‘Šï¼Œè¦ä¸‹è½½æ‰“å¼€ï¼Œä¸‹è½½å®Œäº†å°±é€€å‡ºï¼Œå”¯ä¸€é—®é¢˜å°±æ˜¯Chromeçš„è¿…é›·æ‹“å±•ä¼¼ä¹å¤ªçµæ•äº†ç‚¹ï¼Œæˆ‘å•¥éƒ½æ²¡ç‚¹å°±è«åå…¶å¦™å¼¹å‡ºä¸‹è½½é¡µé¢ï¼Œé™¤äº†è¿™ä¸ªï¼Œä¼¼ä¹éå¸¸å®Œç¾ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘é…ç½®å¥½aria2å¹¶å†™ä¸‹è¿™ç¯‡åšå®¢åçš„ä¸åˆ°1ä¸ªå°æ—¶æ—¶é—´ï¼Œæˆ‘å¸è½½äº†aira2ï¼Œå¹¶é‡æ–°ç”¨ä¸Šäº†è¿…é›·ã€‚æ‰€ä»¥ï¼Œæˆ‘æœ€ååªæƒ³è¯´ä¸€å¥ï¼Œè´¢å¤§nbï¼è´¢å¤§nbï¼è´¢å¤§nbï¼å¯¹ä¸èµ·ï¼Œèµ°é”™ç‰‡åœºäº†ï¼Œé‡æ¥ï¼ŒIDMç‰›é€¼ï¼IDMç‰›é€¼ï¼IDMç‰›é€¼ï¼å¦‚æœå“ªä½ç‰›é€¼çš„å¤§å“¥çœ‹åˆ°äº†è¿™ç¯‡åšå®¢ï¼Œè®°å¾—å¸®æˆ‘ç»™IDMè¯´å£°ï¼Œä¸€ä¸ªWindowsçš„IDMæ­£ç‰ˆç”¨æˆ·æ€¥éœ€IDM macOSç‰ˆï¼ï¼ï¼ ä¸‹è½½Aira2é€šè¿‡githubå®‰è£… æ‰“å¼€githubä¸»é¡µ aria2/aria2-Release æ‰¾åˆ°å¯¹åº”çš„ç³»ç»Ÿä¸‹è½½å®‰è£…å³å¯ é€šè¿‡Homebrewå®‰è£…ç»ˆç«¯è¾“å…¥å‘½ä»¤brew install aria2å®‰è£…å³å¯ã€‚æ²¡æœ‰å®‰è£…Homebrewçš„åŒå­¦å¯ä»¥æœç´¢å®‰è£…Homebrewå³å¯ã€‚ è¿™ä¸ªè½¯ä»¶æ˜¯æ²¡æœ‰å›¾å½¢ç•Œé¢çš„ï¼Œæ‰€ä»¥å®‰è£…å¥½ä¹‹ååœ¨å¯åŠ¨å°é‡Œé¢æ˜¯æ‰¾ä¸åˆ°Aria2çš„å›¾æ ‡çš„ é…ç½®Aira2å…ˆåˆ›å»ºAria2çš„é…ç½®æ–‡ä»¶Aria2æä¾›äº†ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼š ç›´æ¥å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è½½ ä¸å¤ªæ¨èè¿™ç§ï¼Œå› ä¸ºå‘½ä»¤è¡Œä¸‹ä¸‹è½½æ¯”è¾ƒç¹çï¼Œè€Œä¸”ä¹Ÿä¸å¤ªå¥½æ“ä½œ RPCæ¨¡å¼ åœ¨è¿™ç§æ–¹å¼ï¼ŒAria2å¯åŠ¨ä¹‹åå°±ä¼šä»¥åå°çš„æ–¹å¼è¿è¡Œï¼Œä½ å°±å¯ä»¥é€šè¿‡WebUIæˆ–è€…å®‰è£…å®¢æˆ·ç«¯çš„æ–¹å¼æ¥ä½¿ç”¨å›¾å½¢ç•Œé¢æ§åˆ¶Aria2.ä½†æ˜¯è¿™ç§æ–¹å¼ä¸‹éœ€è¦é…ç½®æ–‡ä»¶ï¼Œç°åœ¨å°±å‘Šè¯‰å¤§å®¶å¦‚ä½•é…ç½®ï¼šé¦–å…ˆåˆ›å»ºæ–‡ä»¶ 1234cd ~mkdir /.aria2cd /.aria2touch aria2.conf ç„¶åæ‰“å¼€Finderï¼Œä½¿ç”¨å¿«æ·é”®Shift+Cmd+Gå¼¹å‡ºè·¯å¾„è¾“å…¥æ¡†ï¼Œæ¥ç€å¤åˆ¶ç²˜è´´~/.aria2/å›è½¦å°±è¿›å…¥äº†.aria2æ–‡ä»¶å¤¹ï¼Œä½ å°±ä¼šçœ‹åˆ°é‡Œé¢çš„aria2.confæ–‡ä»¶ï¼Œæ¥ç€ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹å†…å®¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#ç”¨æˆ·å#rpc-user=user#å¯†ç #rpc-passwd=passwd#ä¸Šé¢çš„è®¤è¯æ–¹å¼ä¸å»ºè®®ä½¿ç”¨,å»ºè®®ä½¿ç”¨ä¸‹é¢çš„tokenæ–¹å¼#è®¾ç½®åŠ å¯†çš„å¯†é’¥#rpc-secret=token#å…è®¸rpcenable-rpc=true#å…è®¸æ‰€æœ‰æ¥æº, webç•Œé¢è·¨åŸŸæƒé™éœ€è¦rpc-allow-origin-all=true#å…è®¸å¤–éƒ¨è®¿é—®ï¼Œfalseçš„è¯åªç›‘å¬æœ¬åœ°ç«¯å£rpc-listen-all=true#RPCç«¯å£, ä»…å½“é»˜è®¤ç«¯å£è¢«å ç”¨æ—¶ä¿®æ”¹#rpc-listen-port=6800#æœ€å¤§åŒæ—¶ä¸‹è½½æ•°(ä»»åŠ¡æ•°), è·¯ç”±å»ºè®®å€¼: 3max-concurrent-downloads=5#æ–­ç‚¹ç»­ä¼ continue=true#åŒæœåŠ¡å™¨è¿æ¥æ•°max-connection-per-server=5#æœ€å°æ–‡ä»¶åˆ†ç‰‡å¤§å°, ä¸‹è½½çº¿ç¨‹æ•°ä¸Šé™å–å†³äºèƒ½åˆ†å‡ºå¤šå°‘ç‰‡, å¯¹äºå°æ–‡ä»¶é‡è¦min-split-size=10M#å•æ–‡ä»¶æœ€å¤§çº¿ç¨‹æ•°, è·¯ç”±å»ºè®®å€¼: 5split=10#ä¸‹è½½é€Ÿåº¦é™åˆ¶max-overall-download-limit=0#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶max-download-limit=0#ä¸Šä¼ é€Ÿåº¦é™åˆ¶max-overall-upload-limit=0#å•æ–‡ä»¶é€Ÿåº¦é™åˆ¶max-upload-limit=0#æ–­å¼€é€Ÿåº¦è¿‡æ…¢çš„è¿æ¥#lowest-speed-limit=0#éªŒè¯ç”¨ï¼Œéœ€è¦1.16.1ä¹‹åçš„releaseç‰ˆæœ¬#referer=*#æ–‡ä»¶ä¿å­˜è·¯å¾„, é»˜è®¤ä¸ºå½“å‰å¯åŠ¨ä½ç½®dir=/Users/xxx/Downloads#æ–‡ä»¶ç¼“å­˜, ä½¿ç”¨å†…ç½®çš„æ–‡ä»¶ç¼“å­˜, å¦‚æœä½ ä¸ç›¸ä¿¡Linuxå†…æ ¸æ–‡ä»¶ç¼“å­˜å’Œç£ç›˜å†…ç½®ç¼“å­˜æ—¶ä½¿ç”¨, éœ€è¦1.16åŠä»¥ä¸Šç‰ˆæœ¬#disk-cache=0#å¦ä¸€ç§Linuxæ–‡ä»¶ç¼“å­˜æ–¹å¼, ä½¿ç”¨å‰ç¡®ä¿æ‚¨ä½¿ç”¨çš„å†…æ ¸æ”¯æŒæ­¤é€‰é¡¹, éœ€è¦1.15åŠä»¥ä¸Šç‰ˆæœ¬(?)#enable-mmap=true#æ–‡ä»¶é¢„åˆ†é…, èƒ½æœ‰æ•ˆé™ä½æ–‡ä»¶ç¢ç‰‡, æé«˜ç£ç›˜æ€§èƒ½. ç¼ºç‚¹æ˜¯é¢„åˆ†é…æ—¶é—´è¾ƒé•¿#æ‰€éœ€æ—¶é—´ none &lt; falloc ? trunc Â« prealloc, fallocå’Œtruncéœ€è¦æ–‡ä»¶ç³»ç»Ÿå’Œå†…æ ¸æ”¯æŒfile-allocation=prealloc#å¼€å¯BTä¸‹è½½enable-dht=truebt-enable-lpd=trueenable-peer-exchange=true# bt-tracker æ›´æ–°ï¼Œè§£å†³Aria2 BTä¸‹è½½é€Ÿåº¦æ…¢æ²¡é€Ÿåº¦çš„é—®é¢˜udp://tracker.coppersurfer.tk:6969/announce,http://tracker.internetwarriors.net:1337/announce,udp://tracker.opentrackr.org:1337/announce,udp://9.rarbg.to:2710/announce,udp://9.rarbg.me:2710/announce,udp://tracker.openbittorrent.com:80/announce,http://tracker3.itzmx.com:6961/announce,http://tracker1.itzmx.com:8080/announce,udp://exodus.desync.com:6969/announce,udp://retracker.lanta-net.ru:2710/announce,udp://tracker.torrent.eu.org:451/announce,udp://tracker.tiny-vps.com:6969/announce,udp://bt.xxx-tracker.com:2710/announce,udp://tracker2.itzmx.com:6961/announce,udp://tracker.cyberia.is:6969/announce,udp://open.demonii.si:1337/announce,udp://explodie.org:6969/announce,udp://denis.stalker.upeer.me:6969/announce,udp://open.stealth.si:80/announce,http://tracker4.itzmx.com:2710/announce ä¸ç”¨æ›´æ”¹å•¥ï¼Œä¹Ÿä¸å»ºè®®æ›´æ”¹å•¥ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„é…ç½®å†…å®¹ï¼Œè‡³å°‘è®°å¾—æ¯ä¸€é¡¹å¤§è‡´æ˜¯ä¸ªå•¥ï¼Œå› ä¸ºç­‰ä¼šé…ç½®å›¾å½¢ç•Œé¢éœ€è¦è¿™äº›ä¿¡æ¯ã€‚ æœ€åé¢çš„BTä¸‹è½½çš„bt-trackerå¤§å®¶é…ç½®è®°å¾—åˆ°è¿™ä¸ªé¡µé¢æ›´æ–°ï¼šhttps://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_best.txt ç„¶åå†æŠŠå†…å®¹å¤åˆ¶ç²˜è´´è¿‡å»ã€‚ ä¸‹è½½è·¯å¾„ä½ å¯ä»¥è‡ªå·±é€‰æ‹©ï¼Œå¯ä»¥å°±æŠŠ/Users/xxx/Downloadsä¸­çš„xxxæ¢æˆä½ è‡ªå·±çš„macOSç”¨æˆ·åå³å¯ã€‚ å¯åŠ¨Aria2 RPCæ¨¡å¼ç»ˆç«¯è¾“å…¥aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -Då°±å¯ä»¥å¯åŠ¨äº†ã€‚ä¸€æ ·çš„ï¼Œxxxæ˜¯ä½ çš„ç”¨æˆ·åã€‚ è¿›å…¥å›¾å½¢ç•Œé¢Aria2æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å›¾å½¢ç•Œé¢ï¼Œå®¢æˆ·ç«¯æœ‰ï¼Œä½†æ˜¯æˆ‘æ²¡ç”¨è¿‡æ‰€ä»¥æˆ‘ä¸åšä»‹ç»ï¼Œåœ¨è¿™ä¸»è¦ä»‹ç»WebUIã€‚ YAAWæ’ä»¶ åœ¨chromeçš„æ‹“å±•ä¸­å¿ƒæœç´¢YAAWï¼Œç„¶åå®‰è£…å³å¯ï¼Œæ¥ç€å°±ä¼šå‡ºç°YAAMçš„æ’ä»¶ ç‚¹å‡»æ‰“å¼€å®ƒï¼Œå°±ä¼šè¿›å…¥YAAWçš„WebUIã€‚ ç‚¹å‡»å³ä¸Šè§’çš„ğŸ”§å›¾æ ‡ï¼Œè¿›å…¥è®¾ç½®ç•Œé¢ å¦‚æœä½ ä¸Šé¢çš„aria2.confæ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚æ‰¾åˆ°éœ€è¦ä¸‹è½½çš„èµ„æºå³é”®ç„¶åé€‰æ‹©YAAWå°±ä¼šè‡ªåŠ¨å¼€å§‹ä¸‹è½½ã€‚ AriaNg WebUIè¿™ä¸ªæ¯”ä¸Šé¢é‚£ä¸ªå¥½çœ‹ç‚¹ï¼Œç¼ºç‚¹æ˜¯æ²¡æœ‰æ’ä»¶ï¼Œä½ åªèƒ½å¤åˆ¶ä¸‹è½½é“¾æ¥æ‰‹åŠ¨æ–°å»ºä¸‹è½½ä»»åŠ¡ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€ http://ariang.mayswind.net/latest/#!/downloading ç‚¹å‡»AriaNgè®¾ç½® ä¸€æ ·ï¼Œå¦‚æœä½ ä¸Šé¢çš„aria2.confæ˜¯ç›´æ¥å¤åˆ¶ç²˜è´´çš„æˆ‘çš„è¯ï¼Œç…§ç€æˆ‘å›¾ä¸­çš„å¡«å†™å°±å¯ä»¥äº†ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚ ä½ å¯ä»¥ç‚¹å‡»Aria2çŠ¶æ€ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å·²è¿æ¥ï¼Œå¦‚æœä¸æ˜¯å°±çœ‹çœ‹æœ‰æ²¡æœ‰å“ªå„¿å’Œaria2.confè®¾ç½®çš„ä¸ä¸€æ ·ã€‚ å…³é—­Aria2è¿™ä¸ªå¥½åƒå®˜æ–¹æ²¡æœ‰æ–¹æ³•å…³é—­ï¼Œäºæ˜¯æˆ‘ä»¬å°±ç”¨æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ã€‚ ç»ˆç«¯è¾“å…¥ps aux|grep aria2å¾—åˆ°Aria2çš„è¿›ç¨‹å· ç„¶åè¾“å…¥kill numberè°ƒç”¨ç³»ç»Ÿå‘½ä»¤ç›´æ¥æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œnumberæ”¹ä¸ºä¸Šé¢çš„åˆ°çš„è¿›ç¨‹å·å³å¯ã€‚ é…ç½®è‡ªå¯åŠ¨åˆ›å»ºshæ–‡ä»¶è¿›å…¥åˆ°å¸Œæœ›ä¿å­˜çš„ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶aria2.shï¼š 1touch aria2.sh ç„¶åè¾“å…¥ä¸‹é¢çš„ä»£ç å¹¶ä¿å­˜ï¼š 12345#!/bin/bashecho &quot;start aria2 server&quot;aria2c --conf-path=&quot;/Users/xxx/.aria2/aria2.conf&quot; -Decho &quot;exiting&quot;exit ä¿®æ”¹æ–‡ä»¶æƒé™ ç»™aria2.shæ–‡ä»¶æ‰§è¡Œæƒé™ï¼šchmod +x aria2.sh è®©aria2.shé»˜è®¤ç”¨è‡ªå·±å¸¸ç”¨çš„terminalå·¥å…·æ‰“å¼€ã€‚å³é”®æ–‡ä»¶ ï¼&gt; æ˜¾ç¤ºç®€ä»‹ï¼šè®¾ç½®â€œæ‰“å¼€æ–¹å¼-&gt;æ‰€æœ‰åº”ç”¨ç¨‹åºâ€ä¸ºè‡ªå·±çš„terminalå³å¯ã€‚ æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹ åœ¨Macæ¡Œé¢é¡¶éƒ¨èœå•ä¸­ï¼Œç‚¹å‡»è‹¹æœå›¾æ ‡ï¼Œåœ¨å¼¹å‡ºçš„èœå•ä¸­ï¼Œç‚¹å‡»è¿›å…¥ç³»ç»Ÿåå¥½è®¾ç½®ã€‚ åœ¨æ‰“å¼€ç³»ç»Ÿåå¥½è®¾ç½®åï¼Œç„¶åç‚¹å‡»è¿›å…¥ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®é€‰é¡¹ã€‚ ç„¶ååœ¨ç”¨æˆ·ä¸ç¾¤ç»„è®¾ç½®ç•Œé¢ï¼Œå…ˆåœ¨å·¦ä¾§é€‰æ‹©ç™»é™†ç”¨æˆ·-å½“å‰ç”¨æˆ·ï¼Œç„¶ååœ¨å³ä¾§åˆ‡æ¢åˆ°ç™»å½•é¡¹ ç„¶åç‚¹ä¸‹é¢çš„+è¿›è¡Œæ·»åŠ ï¼Œé€‰æ‹©åˆšæ‰æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶aria2.shï¼Œå¹¶å‹¾é€‰éšè—ã€‚è¿™æ · aria2 å°±å¯ä»¥åœ¨æ¯æ¬¡å¼€æœºçš„æ—¶å€™è‡ªå¯åŠ¨äº†ã€‚ æœ€åï¼ŒAria2å¸è½½æ–¹å¼ç»ˆç«¯ä¸‹æ‰§è¡Œsudo pkgutil --forget aria2ä»¥åŠsudo pkgutil --forget aria2.pathï¼Œç„¶åä¸Šé¢åˆ›å»ºçš„.aria2æ–‡ä»¶å¤¹]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Aria2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ3--è¿›ç¨‹çš„åŒæ­¥]]></title>
    <url>%2Fposts%2F362e394f.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 3.1 è¿›ç¨‹åŒæ­¥3.1.1 åŒæ­¥æ¦‚å¿µ3.1.1.1 è¿›ç¨‹åŒæ­¥çš„æ¦‚å¿µè¿›ç¨‹åŒæ­¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯å¯¹å¤šä¸ªç›¸å…³è¿›ç¨‹åœ¨æ‰§è¡Œæ¬¡åºä¸Šè¿›è¡Œåè°ƒï¼Œä½¿å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ä¹‹é—´èƒ½æŒ‰ç…§ä¸€å®šçš„è§„åˆ™å…±äº«ç³»ç»Ÿèµ„æºï¼Œå¹¶èƒ½å¾ˆå¥½çš„é…åˆå·¥ä½œï¼Œä»è€Œä½¿ç¨‹åºçš„æ‰§è¡Œå…·æœ‰å¯å†ç°æ€§ã€‚ 3.1.1.2 åˆ¶çº¦å…³ç³»å¯¹äºå¤„äºåŒä¸€ä¸ªç³»ç»Ÿä¸­çš„å¤šä¸ªè¿›ç¨‹ï¼Œç”±äºä»–ä»¬å…±äº«ç€ç³»ç»Ÿçš„èµ„æºï¼Œæˆ–è€…ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªä»»åŠ¡è€Œç›¸äº’åˆä½œï¼Œæ‰€ä»¥ä»–ä»¬ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸‹é¢ä¸¤ç§åˆ¶çº¦å…³ç³»ï¼š é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³» ç³»ç»Ÿä¸­çš„è¿›ç¨‹éš¾å…ä¼šè°ƒç”¨åƒæ‰“å°æœºã€CPUç­‰è¿™æ ·çš„ä¸´ç•Œèµ„æºã€‚å¦‚æœæƒ³è¿™äº›èµ„æºæ­£å¸¸è°ƒç”¨ï¼Œå¿…é¡»ä¿è¯å¤šä¸ªè¿›ç¨‹ä¹‹é—´äº’æ–¥åœ°è®¿é—®è¿™äº›èµ„æºï¼Œè¿›è€Œå°±åœ¨è¿™äº›è¿›ç¨‹é—´å½¢æˆäº†é—´æ¥ç›¸äº’åˆ¶çº¦å…³ç³»ã€‚ ä¸ºäº†ä¿è¯è¿™äº›è¿›ç¨‹èƒ½æœ‰åºçš„è¿›è¡Œï¼Œå¯¹äºç³»ç»Ÿä¸­çš„è¿™ç±»èµ„æºï¼Œå¿…é¡»ç”±ç³»ç»Ÿå®æ–½ç»Ÿä¸€åˆ†é…ï¼Œå³ç”¨æˆ·åœ¨ä½¿ç”¨ä¹‹å‰å¿…é¡»å…ˆæå‡ºç”³è¯·ï¼Œç»ä¸å…è®¸ç”¨æˆ·ç›´æ¥ä½¿ç”¨ã€‚ ç›´æ¥ç›¸äº’åˆ¶çº¦å…³ç³» åœ¨ç³»ç»Ÿä¸­ä¹Ÿä¼šå­˜åœ¨ä¸€äº›è¿›ç¨‹ï¼Œä»–ä»¬ä¸ºäº†å®ŒæˆåŒä¸€ä¸ªç›®æ ‡è€Œç›¸äº’é…åˆåˆä½œå·¥ä½œï¼Œè¿™ç§å°±æ˜¯ç›´æ¥äº’ç›¸åˆ¶çº¦å…³ç³»ã€‚ è¿›ç¨‹é—´çš„ç›´æ¥åˆ¶çº¦å…³ç³»å°±æ˜¯æºäºä»–ä»¬ä¹‹é—´çš„ç›¸äº’åˆä½œã€‚ 3.1.1.3 ä¸´ç•Œèµ„æºè™½ç„¶å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«ç³»ç»Ÿä¸­çš„å„ç§èµ„æºï¼Œä½†å…¶ä¸­è®¸å¤šèµ„æºä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œæˆ‘ä»¬æŠŠä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„èµ„æºç§°ä¸ºä¸´ç•Œèµ„æºã€‚è®¸å¤šç‰©ç†è®¾å¤‡éƒ½å±äºä¸´ç•Œèµ„æºï¼Œå¦‚æ‰“å°æœºç­‰ã€‚æ­¤å¤–ï¼Œå¦‚æœå˜é‡ã€æ•°æ®ç­‰éƒ½å¯ä»¥è¢«è‹¥å¹²è¿›ç¨‹å…±äº«ï¼Œä¹Ÿå±äºä¸´ç•Œèµ„æºã€‚ 3.1.1.4 ä¸´ç•ŒåŒºäººä»¬æŠŠåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­è®¿é—®ä¸´ç•Œèµ„æºçš„é‚£æ®µä»£ç ç§°ä¸ºä¸´ç•ŒåŒºã€‚è‹¥èƒ½ä¿è¯è¯¸è¿›ç¨‹äº’æ–¥åœ°è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä¾¿å¯å®ç°è¯¸è¿›ç¨‹å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—®ã€‚ä¸ºæ­¤ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œåº”å…ˆå¯¹è¦è®¿é—®çš„ä¸´ç•ŒåŒºè¿›ç¨‹æ£€æŸ¥ï¼šå¦‚æœä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®ï¼Œåˆ™è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºï¼›å¦‚æœä¸´ç•ŒåŒºæ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£è¿›ç¨‹å°±å¯è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¹¶å°†ä¸´ç•ŒåŒºæ­£åœ¨è¢«è®¿é—®çš„æ ‡å¿—ç½®ä¸ºæ­£è¢«è®¿é—®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¿é—®ä¸´ç•Œèµ„æºçš„çº¿ç¨‹çš„å¾ªç¯ä»£ç åˆ†ä¸ºå¦‚ä¸‹éƒ¨åˆ†ï¼š è®¿é—®ä¸´ç•ŒåŒºä¹‹å‰ç”¨äºä¸Šè¿°åˆ¤æ–­çš„ä»£ç åŒºç§°ä¸ºè¿›å…¥åŒº åœ¨è®¿é—®å®Œä¸´ç•ŒåŒºä¹‹åç”¨äºå°†ä¸´ç•ŒåŒºæ­£è¢«è®¿é—®çš„æ ‡å¿—æ¢å¤ä¸ºæœªè¢«è®¿é—®çš„æ ‡å¿—çš„ä»£ç åŒºç§°ä¸ºé€€å‡ºåŒº é™¤äº†è¿›å…¥å»ã€ä¸´ç•ŒåŒºã€é€€å‡ºåŒºä»£ç ä¹‹å¤–çš„å…¶å®ƒä»£ç ç§°ä¸ºå‰©ä½™åŒº 123456while (true) &#123; è¿›å…¥åŒº ä¸´ç•ŒåŒº é€€å‡ºåŒº å‰©ä½™åŒº&#125; 3.1.1.5 åŒæ­¥æœºåˆ¶åº”éµå¾ªçš„è§„åˆ™ ç©ºé—²è®©è¿›ï¼šå½“æ— è¿›ç¨‹å¤„äºä¸´ç•ŒåŒºæ—¶ï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºå¤„äºç©ºé—²çŠ¶æ€ï¼Œåº”å…è®¸ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ç«‹å³è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥æœ‰æ•ˆçš„åˆ©ç”¨ä¸´ç•Œèµ„æº å¿™åˆ™ç­‰å¾…ï¼šå½“å·²æœ‰è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œè¡¨æ˜ä¸´ç•Œèµ„æºæ­£åœ¨è¢«è®¿é—®ï¼Œå› è€Œå…¶å®ƒè§†å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œä»¥ä¿è¯å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—® æœ‰é™ç­‰å¾…ï¼šå¯¹è¦æ±‚è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹ï¼Œåº”ä¿è¯åœ¨æœ‰é™çš„æ—¶é—´å†…èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºï¼Œä»¥å…é™·å…¥â€œæ­»ç­‰â€çŠ¶æ€ è®©æƒç­‰å¾…ï¼šå½“è¿›ç¨‹ä¸èƒ½è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒºæ—¶ï¼Œåº”ç«‹å³é‡Šæ”¾å¤„ç†æœºï¼Œä»¥å…è¿›ç¨‹é™·å…¥â€œå¿™ç­‰â€çŠ¶æ€ 3.1.2 åŒæ­¥æœºåˆ¶3.2.2.1 ä¿¡å·é‡æœºåˆ¶1. ä»€ä¹ˆæ˜¯ä¿¡å·é‡ä¿¡å·é‡çš„æ•°æ®ç»“æ„ä¸ºä¸€ä¸ªå€¼å’Œä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ç­‰å¾…è¯¥ä¿¡å·é‡çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œå€¼åˆ™ä¸ç›¸åº”çš„èµ„æºçš„ä½¿ç”¨æƒ…å†µæœ‰å…³ï¼š å½“ä»–çš„å€¼å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå½“å‰å¯ç”¨èµ„æºçš„æ•°é‡ å½“ä»–çš„å€¼å°äº0æ—¶ï¼Œå…¶ç»å¯¹å€¼è¡¨ç¤ºç­‰å¾…ä½¿ç”¨è¯¥èµ„æºçš„è¿›ç¨‹ä¸ªæ•° 2. ä»€ä¹ˆæ˜¯ä¿¡å·é‡æœºåˆ¶ä¿¡å·é‡æœºåˆ¶å³åˆ©ç”¨pvæ“ä½œå¯¹ä¿¡å·é‡è¿›è¡Œå¤„ç†ã€‚è€Œä¸”ä¿¡å·é‡åªèƒ½ç”±pvæ“ä½œè¿›ç¨‹å¤„ç†ã€‚å½“S&gt;0æ—¶ï¼ŒSè¡¨ç¤ºå¯ç”¨èµ„æºçš„æ•°é‡ã€‚æ‰§è¡Œä¸€æ¬¡Pæ“ä½œæ„å‘³ç€åˆ†é…ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Så€¼å‡1ï¼›å½“S&lt;0æ—¶ï¼Œè¡¨ç¤ºå·²ç»æ²¡æœ‰å¯ç”¨èµ„æºï¼Œè¯·æ±‚è€…å¿…é¡»ç­‰å¾…åˆ«çš„è¿›ç¨‹é‡Šæ”¾è¯¥ç±»èµ„æºï¼Œä»–æ‰èƒ½è¿è¡Œä¸‹å»ã€‚è€Œæ‰§è¡Œä¸€ä¸ªVæ“ä½œä»¥ä¸ºç€é‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œå› æ­¤Sçš„å€¼åŠ 1ï¼›å½“S&gt;0ï¼Œè¡¨ç¤ºæœ‰æŸäº›èµ„æºæ­£åœ¨ç­‰å¾…è¯¥èµ„æºï¼Œå› æ­¤è¦å”¤é†’ä¸€ä¸ªç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹ï¼Œä½¿ä¹‹è¿è¡Œä¸‹å»ã€‚ 3.2.2.2 PVæ“ä½œ1. Pæ“ä½œç”³è¯·ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒº 1234wait (S) &#123; while (s &lt;= 0) ;// å¦‚æœæ²¡æœ‰èµ„æºåˆ™å¾ªç¯ç­‰å¾… S--;&#125; å°†ä¿¡å·é‡Sçš„å€¼å‡1ï¼Œå³S=S-1ï¼› å¦‚æœS&lt;=0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™è¯¥è¿›ç¨‹ç½®ä¸ºç­‰å¾…çŠ¶æ€ï¼Œæ’å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ 2. Væ“ä½œé‡Šæ”¾ä¸€ä¸ªå•ä½èµ„æºï¼Œè¿›ç¨‹ä»ä¸´ç•ŒåŒºå‡ºæ¥ 123signal (S) &#123; S++;&#125; å°†ä¿¡å·é‡Sçš„å€¼åŠ 1ï¼Œå³S=S+1ï¼› å¦‚æœS&gt;0ï¼Œåˆ™è¯¥è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼›å¦åˆ™é‡Šæ”¾é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ã€‚ 3. PVæ“ä½œçš„æ„ä¹‰ç”¨PVæ“ä½œæ¥å®ç°è¿›ç¨‹çš„åŒæ­¥å’Œäº’æ–¥ 3.2.3 ç®¡ç¨‹æœºåˆ¶å°½ç®¡ä¿¡å·é‡æœºåˆ¶å¾ˆæ–¹åˆé«˜æ•ˆï¼Œä½†æ˜¯æ¯ä¸ªè¦è®¿é—®ä¸´ç•Œèµ„æºçš„è¿›ç¨‹éƒ½å¿…é¡»å¿…å¤‡åŒæ­¥æ“ä½œï¼Œè¿™å°±ä½¿å¾—å¤§é‡çš„åŒæ­¥æ“ä½œåˆ†æ•£åœ¨å„ä¸ªè¿›ç¨‹ä¸­ã€‚è¿™ä¸ä»…ç»™ç³»ç»Ÿçš„ç®¡ç†å¸¦æ¥éº»çƒ¦ï¼Œè¿˜ä¼šå› åŒæ­¥æ“ä½œä¸å½“è€Œäº§ç”Ÿæ­»é”ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå˜äº§ç”Ÿäº†ä¸€ç§æ–°çš„åŒæ­¥å·¥å…·â€”â€”ç®¡ç¨‹ã€‚ 1. ç®¡ç¨‹çš„å®šä¹‰ç³»ç»Ÿä¸­å„ç§ç¡¬ä»¶èµ„æºå’Œè½¯ä»¶èµ„æºå‡å¯ç”¨æ•°æ®ç»“æ„æŠ½è±¡åœ°æè¿°å…¶èµ„æºç‰¹å¾ï¼Œå³ç”¨å°‘é‡ä¿¡æ¯å’Œå¯¹è¯¥èµ„æºæ‰€æ‰§è¡Œçš„æ“ä½œæ¥è¡¨å¾è¯¥èµ„æºã€‚æ‰€ä»¥å°±å‡ºç°äº†ç®¡ç¨‹ã€‚ç®¡ç¨‹å¯ä»¥çœ‹æˆä¸€ä¸ªè½¯ä»¶æ¨¡å—ï¼Œå®ƒæ˜¯å°†å…±äº«çš„å˜é‡å’Œå¯¹äºè¿™äº›å…±äº«å˜é‡çš„æ“ä½œå°è£…èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå…·æœ‰ä¸€å®šæ¥å£çš„åŠŸèƒ½æ¨¡å—ï¼Œè¿›ç¨‹å¯ä»¥è°ƒç”¨ç®¡ç¨‹æ¥å®ç°è¿›ç¨‹çº§åˆ«çš„å¹¶å‘æ§åˆ¶ã€‚åœ¨ç®¡ç¨‹å…¥å£å¤„çš„ç­‰å¾…é˜Ÿåˆ—ç§°ä¸ºå…¥å£ç­‰å¾…é˜Ÿåˆ—ï¼Œç”±äºè¿›ç¨‹ä¼šæ‰§è¡Œå”¤é†’æ“ä½œï¼Œå› æ­¤å¯èƒ½æœ‰å¤šä¸ªç­‰å¾…ä½¿ç”¨ç®¡ç¨‹çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„é˜Ÿåˆ—ç§°ä¸ºç´§æ€¥é˜Ÿåˆ—ï¼Œå®ƒçš„ä¼˜å…ˆçº§é«˜äºç­‰å¾…é˜Ÿåˆ—ã€‚ 2. ç®¡ç¨‹çš„ç‰¹å¾ æ¨¡å—åŒ– ç®¡ç¨‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è½¯ä»¶æ¨¡å—ï¼Œå¯ä»¥å•ç‹¬ç¼–è¯‘ æŠ½è±¡æ•°æ®ç±»å‹ ç®¡ç¨‹ä¸­å°è£…äº†æ•°æ®åŠå¯¹äºæ•°æ®çš„æ“ä½œ ä¿¡æ¯éšè— ç®¡ç¨‹å¤–çš„è¿›ç¨‹æˆ–å…¶ä»–è½¯ä»¶æ¨¡å—åªèƒ½é€šè¿‡ç®¡ç¨‹å¯¹å¤–çš„æ¥å£æ¥è®¿é—®ç®¡ç¨‹æä¾›çš„æ“ä½œï¼Œç®¡ç¨‹å†…éƒ¨çš„å®ç°ç»†èŠ‚å¯¹å¤–ç•Œæ˜¯é€æ˜çš„ ä½¿ç”¨çš„äº’æ–¥æ€§ ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œç®¡ç¨‹åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚è¿›å…¥ç®¡ç¨‹æ—¶çš„äº’æ–¥ç”±ç¼–è¯‘å™¨è´Ÿè´£å®Œæˆ 3. æ¡ä»¶å˜é‡ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡æˆ–æŒ‚èµ·çš„æ¡ä»¶ï¼ˆåŸå› ï¼‰æœ‰å¤šä¸ªï¼Œå› æ­¤åœ¨ç®¡ç¨‹ä¸­è®¾ç½®äº†å¤šä¸ªæ¡ä»¶å˜é‡ï¼Œå¯¹è¿™äº›æ¡ä»¶å˜é‡çš„è®¿é—®åªèƒ½åœ¨ç®¡ç¨‹ä¸­è¿›è¡Œã€‚ç®¡ç¨‹ä¸­æ¯ä¸ªæ¡ä»¶å˜é‡éƒ½éœ€äºˆä»¥è¯´æ˜ï¼Œå½¢å¼ä¸ºï¼šcondition xã€‚å¯¹å…¶çš„æ“ä½œåªæœ‰waitå’Œsignalï¼Œå…¶å«ä¹‰æ˜¯ï¼š x.waitï¼šæ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å› xæ¡ä»¶éœ€è¦è¢«é˜»å¡æˆ–æŒ‚èµ·ï¼Œåˆ™è°ƒç”¨x.waitå°†è‡ªå·±æ’å…¥åˆ°xæ¡ä»¶çš„ç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œå¹¶é‡Šæ”¾ç®¡ç¨‹ï¼ŒçŸ¥é“xæ¡ä»¶å‘ç”Ÿå˜åŒ–ã€‚æ­¤æ—¶å…¶å®ƒè¿›ç¨‹å¯ä»¥ä½¿ç”¨è¯¥ç®¡ç¨‹ã€‚ x.signalï¼š æ­£åœ¨è°ƒç”¨ç®¡ç¨‹çš„è¿›ç¨‹å‘ç°xæ¡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è°ƒç”¨x.signalï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªå› xæ¡ä»¶è€Œé˜»å¡æˆ–æŒ‚èµ·çš„è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªè¿™æ ·çš„è¿›ç¨‹ï¼Œåˆ™é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰ï¼Œç»§ç»­æ‰§è¡ŒåŸè¿›ç¨‹ï¼Œä¸äº§ç”Ÿä»»ä½•ç»“æœã€‚ï¼ˆä¸ä¿¡å·é‡çš„signalä¸åŒï¼Œæ²¡æœ‰s=s+1çš„æ“ä½œï¼‰ 3.2 è¿›ç¨‹åŒæ­¥çš„ç»å…¸é—®é¢˜3.2.1 ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜1. é—®é¢˜æè¿°æœ‰ä¸€ç¾¤ç”Ÿäº§è€…è¿›ç¨‹åœ¨ç”Ÿäº§äº§å“ï¼Œå¹¶å°†è¿™äº›äº§å“æä¾›ç»™æ¶ˆè´¹è€…è¿›ç¨‹å»æ¶ˆè´¹ã€‚ä¸ºä½¿ç”Ÿäº§è€…è¿›ç¨‹ä¸æ¶ˆè´¹è€…è¿›ç¨‹èƒ½å¹¶å‘æ‰§è¡Œï¼Œåœ¨ä¸¤è€…ä¹‹é—´è®¾ç½®äº†ä¸€ä¸ªå¤§å°ä¸ºnçš„ç¼“å†²åŒºï¼Œç”Ÿäº§è€…è¿›ç¨‹å°†å…¶æ‰€äº§ç”Ÿçš„äº§å“æ”¾å…¥ç¼“å†²åŒºä¸­ï¼›æ¶ˆè´¹è€…å¯ä»ç¼“å†²åŒºä¸­å–èµ°äº§å“å»æ¶ˆè´¹ã€‚ä»–ä»¬ä¹‹é—´å¿…é¡»ä¿æŒåŒæ­¥ï¼Œä¹Ÿå°±æ˜¯æ—¢ä¸å…è®¸æ¶ˆè´¹è€…è¿›ç¨‹åˆ°ä¸€ä¸ªç©ºç¼“å†²åŒºå»å–äº§å“ï¼Œä¹Ÿä¸å…è®¸ç”Ÿäº§è€…è¿›ç¨‹å‘ä¸€ä¸ªå·²è£…æ»¡äº§å“ä¸”å°šæœªè¢«å–èµ°çš„ç¼“å†²åŒºä¸­æŠ•æ”¾äº§å“ã€‚ 2. é—®é¢˜åˆ†æéœ€è¦æ³¨æ„çš„å‡ ç‚¹ï¼š åœ¨ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¸èƒ½å†è¿›è¡Œæ¶ˆè´¹ åœ¨ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¸èƒ½å†è¿›è¡Œç”Ÿäº§ å½“ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹æ—¶ï¼Œå…¶ä½™çº¿ç¨‹ä¸èƒ½å†è¿›è¡Œç”Ÿäº§æˆ–æ¶ˆè´¹ 3. ä¼ªä»£ç 12345678910111213141516171819202122232425262728293031var items = 0, space = 10, mutex = 1;var in = 0, out = 0;item buf[10] = &#123; NULL &#125;;producer &#123; while( true ) &#123; wait( space ); // ç­‰å¾…ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½®ï¼Œ åœ¨ä½¿ç”¨PVæ“ä½œæ—¶ï¼Œæ¡ä»¶å˜é‡éœ€è¦åœ¨äº’æ–¥é”ä¹‹å‰ wait( mutex ); // ä¿è¯åœ¨productæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº // product buf.push( item, in ); // å°†æ–°èµ„æºæ”¾åˆ°buf[in]ä½ç½® in = ( in + 1 ) % 10; signal( mutex ); // å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ signal( items ); // é€šçŸ¥consumerç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥å–èµ° &#125;&#125;consumer &#123; while( true ) &#123; wait( items ); // ç­‰å¾…ç¼“å†²åŒºæœ‰èµ„æºå¯ä»¥ä½¿ç”¨ wait( mutex ); // ä¿è¯åœ¨consumeæ—¶ä¸ä¼šæœ‰å…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å†²åŒº // consume buf.pop( out ); // å°†buf[out]ä½ç½®çš„çš„èµ„æºå–èµ° out = ( out + 1 ) % 10; signal( mutex ); // å”¤é†’çš„é¡ºåºå¯ä»¥ä¸åŒ signal( space ); // é€šçŸ¥ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½® &#125;&#125; ä¸èƒ½å°†çº¿ç¨‹é‡Œä¸¤ä¸ªwaitçš„é¡ºåºè°ƒæ¢å¦åˆ™ä¼šå‡ºç°æ­»é”ã€‚ä¾‹å¦‚(è°ƒæ¢å)ï¼Œå°†consumerçš„ä¸¤ä¸ªwaitè°ƒæ¢ï¼Œåœ¨producerå‘å‡ºsignalä¿¡å·åï¼Œå¦‚æœproducerçº¿ç¨‹æ­¤æ—¶å†æ¬¡è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œå®Œäº†wait(space)ï¼Œæ­¤æ—¶ï¼Œå¦ä¸€ä¸ªconsumerçº¿ç¨‹è·å¾—è¿è¡Œæœºä¼šï¼Œæ‰§è¡Œäº†wait(mutex)ï¼Œå¦‚æœæ­¤æ—¶ç¼“å†²åŒºä¸ºç©ºï¼Œé‚£ä¹ˆconsumerå°†ä¼šé˜»å¡åœ¨wait(items)ï¼Œè€Œproducerä¹Ÿä¼šå› ä¸ºæ— æ³•è·å¾—é”çš„æ‰€æœ‰æƒæ‰€ä»¥é˜»å¡åœ¨wait(mutex)ï¼Œè¿™æ ·ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨é˜»å¡ï¼Œä¹Ÿå°±é€ æˆäº†æ­»é”ã€‚ 3.2.2 å“²å­¦å®¶è¿›é¤é—®é¢˜1. é—®é¢˜æè¿°æœ‰äº”ä½å“²å­¦å®¶å…±ç”¨ä¸€å¼ åœ†æ¡Œï¼Œåˆ†åˆ«ååœ¨å‘¨å›´çš„äº”å¼ æ¤…å­ä¸Šï¼Œåœ¨åœ†æ¡Œä¸Šæœ‰äº”ä¸ªç¢—å’Œäº”æ”¯ç­·å­ã€‚ä»–ä»¬çš„ç”Ÿæ´»çš„æ–¹å¼æ˜¯äº¤æ›¿çš„è¿›è¡Œæ€è€ƒå’Œè¿›é¤ï¼šå¹³æ—¶ï¼Œä¸€ä¸ªå“²å­¦å®¶è¿›è¡Œæ€è€ƒï¼Œé¥¥é¥¿æ—¶ä¾¿è§†å›¾å–å…¶å·¦å³ç¦»ä»–æœ€è¿‘çš„ç­·å­ï¼Œåªæœ‰åœ¨ä»–æ‹¿åˆ°ä¸¤åªç­·å­æ—¶æ‰èƒ½è¿›é¤ï¼Œè¿›é¤å®Œæ¯•ï¼Œæ”¾ä¸‹ç­·å­ç»§ç»­æ€è€ƒã€‚ 2. é—®é¢˜åˆ†æ åªæœ‰æ‹¿åˆ°ä¸¤åªç­·å­æ—¶ï¼Œå“²å­¦å®¶æ‰èƒ½åƒé¥­ã€‚ å¦‚æœç­·å­å·²è¢«åˆ«äººæ‹¿èµ°ï¼Œåˆ™å¿…é¡»ç­‰åˆ«äººåƒå®Œä¹‹åæ‰èƒ½æ‹¿åˆ°ç­·å­ã€‚ ä»»ä¸€å“²å­¦å®¶åœ¨è‡ªå·±æœªæ‹¿åˆ°ä¸¤åªç­·å­åƒå®Œé¥­å‰ï¼Œä¸ä¼šæ”¾ä¸‹æ‰‹ä¸­å·²ç»æ‹¿åˆ°çš„ç­·å­ 3. ä¼ªä»£ç è‡³å¤šåªå…è®¸å››ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œä»¥ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶èƒ½å¤Ÿè¿›é¤ï¼Œæœ€ç»ˆæ€»ä¼šé‡Šæ”¾å‡ºä»–æ‰€ä½¿ç”¨è¿‡çš„ä¸¤æ”¯ç­·å­ï¼Œä»è€Œå¯ä½¿æ›´å¤šçš„å“²å­¦å®¶è¿›é¤ã€‚å®šä¹‰ä¿¡å·é‡countï¼Œåªå…è®¸4ä¸ªå“²å­¦å®¶åŒæ—¶è¿›é¤ï¼Œè¿™æ ·å°±èƒ½ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå“²å­¦å®¶å¯ä»¥å°±é¤ã€‚ 12345678910111213141516semaphore chopstick[5]=&#123;1,1,1,1,1&#125;;semaphore count=4; // è®¾ç½®ä¸€ä¸ªcountï¼Œæœ€å¤šæœ‰å››ä¸ªå“²å­¦å®¶å¯ä»¥è¿›æ¥void philosopher(int i)&#123; while(true) &#123; think(); wait(count); //è¯·æ±‚è¿›å…¥æˆ¿é—´è¿›é¤ å½“countä¸º0æ—¶ ä¸èƒ½å…è®¸å“²å­¦å®¶å†è¿›æ¥äº† wait(chopstick[i]); //è¯·æ±‚å·¦æ‰‹è¾¹çš„ç­·å­ wait(chopstick[(i+1)%5]); //è¯·æ±‚å³æ‰‹è¾¹çš„ç­·å­ eat(); signal(chopstick[i]); //é‡Šæ”¾å·¦æ‰‹è¾¹çš„ç­·å­ signal(chopstick[(i+1)%5]); //é‡Šæ”¾å³æ‰‹è¾¹çš„ç­·å­ signal(count); //ç¦»å¼€é¥­æ¡Œé‡Šæ”¾ä¿¡å·é‡ &#125;&#125; 3.2.3 è¯»è€…-å†™è€…é—®é¢˜1. é—®é¢˜æè¿°ä¸€ä¸ªæ•°æ®æ–‡ä»¶æˆ–è®°å½•å¯è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œæˆ‘ä»¬æŠŠåªè¦æ±‚è¯»è¯¥æ–‡ä»¶çš„è¿›ç¨‹ç§°ä¸ºâ€œReaderè¿›ç¨‹â€ï¼Œå…¶å®ƒè¿›ç¨‹åˆ™ç§°ä¸ºâ€œWriterè¿›ç¨‹â€ã€‚å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»ä¸€ä¸ªå…±äº«å¯¹è±¡ï¼Œå› ä¸ºè¯»æ“ä½œä¸ä¼šä½¿æ•°æ®æ–‡ä»¶æ··ä¹±ã€‚ä½†ä¸å…è®¸ä¸€ä¸ªWriterè¿›ç¨‹å’Œå…¶å®ƒReaderè¿›ç¨‹æˆ–Writerè¿›ç¨‹åŒæ—¶è®¿é—®å…±äº«å¯¹è±¡ï¼Œè¿™æ ·å¾ˆæœ‰å¯èƒ½é€ æˆå…±äº«æ•°æ®æ··ä¹±ã€‚ 2. é—®é¢˜åˆ†æ å…è®¸å¤šä¸ªReaderè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡ ä¸å…è®¸Writerè¿›ç¨‹å’Œå…¶å®ƒè¿›ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªå…±äº«å¯¹è±¡ 3. ä¼ªä»£ç 12345678910111213141516171819202122232425semaphore rmutex = 1,wmutex = 1;int readcount = 0;void reader()&#123; do&#123; wait(rmutex); if(readcount==0) wait(wmutex); readcount++; signal(rmutex); Â·Â·Â· perform read operation; Â·Â·Â· waitï¼ˆrmutexï¼‰ï¼› if(readcount==0) signal(wmutex); readcount--; signal(rmutex); &#125;while(TRUE);&#125;void writer()&#123; do&#123; wait(wmutex); perfrom write operation; signal(wmutex); &#125;while(TRUE);&#125;]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚3--è§£æOkHttpæºç ]]></title>
    <url>%2Fposts%2F151ac78a.html</url>
    <content type="text"><![CDATA[1. OkHttpç®€ä»‹okhttpæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“ï¼Œç”¨äºandroidä¸­è¯·æ±‚ç½‘ç»œã€‚ è¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®,æ˜¯å®‰å“ç«¯æœ€ç«çƒ­çš„è½»é‡çº§æ¡†æ¶,ç”±ç§»åŠ¨æ”¯ä»˜Squareå…¬å¸è´¡çŒ®ã€‚ç”¨äºæ›¿ä»£å› ç§»é™¤äº†HttpClientè€Œå¯¼è‡´æ²¡ç”¨çš„Volleyã€‚ ç›®å‰æ›´å¤šäººé€‰æ‹©äº†Retrofitã€‚ 2. æºç è§£æ æœ¬æ–‡å¯¹OkHttpçš„æ¢è®¨å…¨éƒ¨åŸºäºç›®å‰çš„æœ€æ–°ç‰ˆOkHttp:4.0.1ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬ä½œè€…å·²ç»ä½¿ç”¨kotlinå¯¹æºç è¿›è¡Œäº†é‡å†™ï¼Œæ‰€ä»¥æœ‰äº›å°ä¼™ä¼´å¯èƒ½é˜…è¯»ç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼Œä½†æ˜¯åˆ«æ‹…å¿ƒï¼Œæœ¬æ–‡ä¸­æ‰€æ¶‰åŠçš„æºç é˜…è¯»èµ·æ¥åŸºæœ¬ä¸Šå’ŒJavaä¸€æ ·ï¼Œæ‰€ä»¥è¯·ä¸ä¼škotlinçš„å°ä¼™ä¼´è¿˜æ˜¯è€å¿ƒçœ‹ä¸‹å»ï¼Œä¸å¤ªæ‡‚çš„è¯­æ³•å°±ç™¾åº¦ä¸‹ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¼šå¯¹æŸäº›è¯­æ³•ä½œæ³¨é‡Š 2.1 OkHttpè¯·æ±‚æµç¨‹2.1.1 ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ†ææˆ‘ä»¬æ— è®ºåœ¨ä½¿ç”¨OkHttpè¿›è¡Œä»€ä¹ˆè¯·æ±‚çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºOkHttpClientå¯¹è±¡å¹¶è°ƒç”¨ä»–çš„newCall()æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬å°±ä»è¿™ä¸ªæ–¹æ³•çœ‹èµ·ï¼š 123override fun newCall(request: Request): Call &#123;return RealCall.newRealCall(this, request, forWebSocket = false)&#125; å¯ä»¥çœ‹åˆ°è¿”å›äº†ä¸€ä¸ªRealCallå¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨OkHttpClientå¯¹è±¡è°ƒç”¨çš„execute()æ“ä½œå®é™…ä¸Šæ˜¯RealCallçš„execute()æ“ä½œï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹RealCallçš„execute()æ–¹æ³•ï¼š 123456789101112131415161718192021override fun execute(): Response &#123; // æ·»åŠ åŒæ­¥é” synchronized(this) &#123; // check()æ˜¯kotlinç‰¹æœ‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªifï¼Œ // ä½†æ˜¯å½“ä»–çš„åˆ¤æ–­è¯­å¥æ˜¯falseçš„è¯ï¼Œ // ä»–å°±ä¼šæŠ›å‡ºä¸€ä¸ªIllegalStateExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸çš„å†…å®¹å°±æ˜¯åé¢çš„è¯­å¥ check(!executed) &#123; "Already Executed" &#125; executed = true // executedæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»–çš„ä½œç”¨å°±æ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯æ‰§è¡Œè¿‡äº†ï¼Œ // å¦‚æœæ‰§è¡Œè¿‡äº†è¿˜æ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•çš„è¯å°±æŠ›å¼‚å¸¸ &#125; // transmitterç”¨äºè¿æ¥OKHTTPçš„åº”ç”¨ç¨‹åºå’Œç½‘ç»œå±‚ï¼Œä¸ç”¨å¤šç®¡ transmitter.timeoutEnter() transmitter.callStart() try &#123; client.dispatcher.executed(this) return getResponseWithInterceptorChain() &#125; finally &#123; client.dispatcher.finished(this) &#125;&#125; è¿™å—åˆè°ƒç”¨äº†client.dispatcherï¼Œç„¶åæ‰¾å›å»æ‰¾åˆ°OkHttpClientçš„dispatcherå¯¹è±¡ï¼Œå‘ç°ä»–å°±æ˜¯Dispatcherç±»çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹Dispatcherç±»ã€‚ 2.1.2 Dispatcherä»»åŠ¡è°ƒåº¦è¿›å…¥Dispatcherç±»ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æˆå‘˜å˜é‡å®šä¹‰: æ³¨ï¼škotlinä¸­ä¸€ä¸ªæˆå‘˜å˜é‡çš„@getå’Œ@setåˆ†åˆ«å¯¹åº”äº†Javaä¸­getå’Œsetæ–¹æ³•ï¼Œæ‰€ä»¥è¿™å—æˆ‘æ²¡æœ‰å®Œå®Œå…¨å…¨å¤åˆ¶ç²˜è´´åˆ°è¿™ï¼Œæˆ‘åªå–äº†å®šä¹‰éƒ¨åˆ† 123456789101112// æœ€å¤§å¹¶å‘è¯·æ±‚æ•°var maxRequests = 64// æ¯ä¸ªä¸»æœºçš„æœ€å¤§è¯·æ±‚æ•°var maxRequestsPerHost = 5// æ¶ˆè´¹è€…çº¿ç¨‹val executorService: ExecutorService// å°†è¦è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿåˆ—private val readyAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()// æ­£åœ¨è¿è¡Œçš„å¼‚æ­¥è¯·æ±‚é˜Ÿé˜Ÿåˆ—private val runningAsyncCalls = ArrayDeque&lt;AsyncCall&gt;()// æ­£åœ¨è¿è¡Œçš„åŒæ­¥è¯·æ±‚é˜Ÿåˆ—private val runningSyncCalls = ArrayDeque&lt;RealCall&gt;() æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Dispatcherçš„æ„é€ æ–¹æ³• 123456// ä¸»æ„é€ æ–¹æ³•ï¼Œæ²¡å†™å…·ä½“å®ç°class Dispatcher constructor() &#123;&#125; constructor(executorService: ExecutorService) : this() &#123; this.executorServiceOrNull = executorService&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–å°†ä¼ è¿›æ¥çš„executorServiceä¼ ç»™äº†executorServiceOrNullï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹executorServiceOrNullçš„å®šä¹‰ï¼š 123456789101112// executorServiceOrNullè¿™ä¸ªåº”è¯¥æ˜¯å› ä¸ºkotlinçš„ç©ºå®‰å…¨æ£€æŸ¥ç‰¹æ€§è€Œå®šä¹‰çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯executorServiceprivate var executorServiceOrNull: ExecutorService? = null@get:Synchronized@get:JvmName("executorService") val executorService: ExecutorService get() &#123; if (executorServiceOrNull == null) &#123; executorServiceOrNull = ThreadPoolExecutor(0, Int.MAX_VALUE, 60, TimeUnit.SECONDS, SynchronousQueue(), threadFactory("OkHttp Dispatcher", false)) &#125; return executorServiceOrNull!! &#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°executorServiceçš„setæ–¹æ³•ï¼Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚å†ç»“åˆä»–æœ‰ä¸¤ä¸ªæ„é€ å™¨å°±çŸ¥é“ï¼šå¦‚æœæ²¡æœ‰ç»™Dispatcherä¼ å…¥ä¸€ä¸ªçº¿ç¨‹æ± ä»–å°±ä¼šè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ã€‚è¿™ä¸ªçº¿ç¨‹æ± é€‚åˆæ‰§è¡Œå¤§é‡ä¸”è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡ã€‚ æ„é€ å™¨æˆ‘ä»¬çœ‹å®Œäº†ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä»–çš„enqueue()æ–¹æ³•ï¼š 12345678910111213internal fun enqueue(call: AsyncCall) &#123; synchronized(this) &#123; readyAsyncCalls.add(call) // Mutate the AsyncCall so that it shares the AtomicInteger of an existing running call to // the same host. if (!call.get().forWebSocket) &#123; val existingCall = findExistingCallWithHost(call.host()) if (existingCall != null)call.reuseCallsPerHostFrom(existingCall) &#125; &#125; promoteAndExecute()&#125; æ¥ä¸€ä¸ªè¯·æ±‚å°±æŠŠä»–æ·»åŠ åˆ°å°±ç»ªè¯·æ±‚é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå°±æ¥åˆ¤æ–­forWebSocketè¿™ä¸ªå±æ€§ã€‚çœ‹åˆ°è¿™ä¸ªå±æ€§æˆ‘è¿˜è¿·äº†ä¸‹ï¼Œæœ‰ç‚¹æä¸æ‡‚å¥¹æ˜¯å¹²å˜›çš„ï¼Œç„¶åç»è¿‡æˆ‘çš„ä¸€ç•ªæœç´¢åï¼Œå‘ç°åŸæ¥OkHttpè¿˜å¯ä»¥è¿›è¡ŒWebSocketé€šä¿¡ï¼Œè€Œè¿™ä¸ªå±æ€§å°±æ˜¯ä¸ºWebSocketé€šä¿¡å‡†å¤‡çš„ã€‚äºæ˜¯æˆ‘å°±åˆ°RealCallé‡Œé¢æ‰¾åœ¨å“ªå„¿å®šä¹‰äº†è¿™ä¸ªå±æ€§äº†ï¼Œç„¶åæˆ‘å°±å‘ç°äº†åœ¨RealCallçš„newRealCall()æ–¹æ³•è¿™å—ï¼Œè¿™ä¸ªæ–¹æ³•ä¼ å…¥çš„å‚æ•°ä¸­æœ‰ä¸€ä¸ªBooleanå€¼åå­—å°±å«forWebSocketã€‚ 123456789101112companion object &#123; fun newRealCall( client: OkHttpClient, originalRequest: Request, forWebSocket: Boolean ): RealCall &#123; // Safely publish the Call instance to the EventListener. return RealCall(client, originalRequest, forWebSocket).apply &#123; transmitter = Transmitter(client, this) &#125; &#125;&#125; ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰å°è±¡ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡ï¼Œæ‰§è¡ŒOkHttpClient.newCall()æ–¹æ³•å®é™…ä¸Šæ˜¯è¿”å›äº†ä¸€ä¸ªRealCallå¯¹è±¡ï¼Œäºæ˜¯åœ¨é‚£æ‰¾åˆ°äº†è¿™ä¸ªçš„ç­”æ¡ˆï¼ŒforWebSocket=falseæ‰€ä»¥è¯´è¿™ä¸ªifå’±ä»¬ä¸ç”¨ç®¡ï¼Œç›´æ¥çœ‹promoteAndExecute()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031private fun promoteAndExecute(): Boolean &#123; // ä¸çŸ¥é“å¤§å®¶è¿˜è®°ä¸è®°å¾—å’±ä»¬ä¹‹å‰è¯´çš„kotliné‡Œé¢çš„check()è¯­æ³•ï¼Œ // è¿™ä¸ªå’Œcheckä¹Ÿä¸€æ ·ï¼Œåªä¸è¿‡æŠ›å‡ºçš„æ˜¯AssertionErrorå¼‚å¸¸ assert(!Thread.holdsLock(this)) // mutableListOfæ˜¯kotliné‡Œé¢çš„å¯å˜listé›†åˆ val executableCalls = mutableListOf&lt;AsyncCall&gt;() val isRunning: Boolean synchronized(this) &#123; val i = readyAsyncCalls.iterator() while (i.hasNext()) &#123; val asyncCall = i.next() if (runningAsyncCalls.size &gt;= this.maxRequests) break // æœ€å¤§å®¹é‡ if (asyncCall.callsPerHost().get() &gt;= this.maxRequestsPerHost) continue // ä¸»æœºæœ€å¤§å®¹é‡ i.remove() asyncCall.callsPerHost().incrementAndGet() executableCalls.add(asyncCall) runningAsyncCalls.add(asyncCall) &#125; isRunning = runningCallsCount() &gt; 0 &#125; for (i in 0 until executableCalls.size) &#123; val asyncCall = executableCalls[i] asyncCall.executeOn(executorService) &#125; return isRunning&#125; é¦–å…ˆå°†å·²å°±ç»ªé˜Ÿåˆ—éå†ä¸€éï¼Œåˆ¤æ–­æ­£åœ¨è¿è¡Œçš„æ•°é‡æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºçš„è¯ç›´æ¥é€€å‡ºå¾ªç¯ï¼›å¦‚æœä¸å¤§äºåˆ™åœ¨åˆ¤æ–­è¿™ä¸ªè¯·æ±‚çš„ä¸»æœºè¯·æ±‚æ•°æ˜¯ä¸æ˜¯å¤§äºå®šä¹‰çš„æ¯ä¸ªä¸»æœºæœ€å¤§è¯·æ±‚æ•°ï¼Œå¦‚æœå¤§äºå°±è·³è¿‡è¿™ä¸ªè¯·æ±‚æ¢ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼›ä¸å¤§äºå°±æŠŠå®ƒè°ƒå…¥æ­£åœ¨è¿è¡Œçš„è¯·æ±‚é˜Ÿåˆ—é‡Œé¢ï¼Œç›´åˆ°éå†å®Œæˆã€‚ç„¶ååˆ¤æ–­è¿˜æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚ï¼Œå¦‚æœæœ‰å°±isRunningç½®trueã€‚æ¥ç€å†å–å‡ºexecutableCallsé‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæ‰§è¡ŒexecutteOn()æ–¹æ³•ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹AsyncCallçš„executeOn()æ–¹æ³•ï¼š 1234567891011121314151617fun executeOn(executorService: ExecutorService) &#123; assert(!Thread.holdsLock(client.dispatcher)) var success = false try &#123; executorService.execute(this) success = true &#125; catch (e: RejectedExecutionException) &#123; val ioException = InterruptedIOException("executor rejected") ioException.initCause(e) transmitter.noMoreExchanges(ioException) responseCallback.onFailure(this@RealCall, ioException) &#125; finally &#123; if (!success) &#123; client.dispatcher.finished(this) // This call is no longer running! &#125; &#125;&#125; è¿™æ®µä»£ç å°±æ˜¯åœ¨æ‰§è¡Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œå°±å°†successç½®trueï¼Œå¦‚æœä¸æˆåŠŸï¼Œåˆ™æŠ›å¼‚å¸¸å¹¶è¿”å›ç»™responseCallbackçš„onFailure()æ–¹æ³•ã€‚å¹¶ä¸”å¦‚æœæ²¡æœ‰æˆåŠŸæ‰§è¡Œä¹Ÿå°±æ˜¯successä¸ºfalseï¼Œé‚£ä¹ˆåœ¨finallyä¸­å°±ä¼šæ‰§è¡Œclient.dispatcher.finished()æ–¹æ³•: 1234internal fun finished(call: AsyncCall) &#123; call.callsPerHost().decrementAndGet() finished(runningAsyncCalls, call) &#125; è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„AsyncCallçš„callsPerHostç»™å‡1ï¼Œç„¶åå†è°ƒç”¨äº†finished()æ–¹æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªfinished()æ–¹æ³•ï¼š 12345678910111213private fun &lt;T&gt; finished(calls: Deque&lt;T&gt;, call: T) &#123; val idleCallback: Runnable? synchronized(this) &#123; if (!calls.remove(call)) throw AssertionError("Call wasn't in-flight!") idleCallback = this.idleCallback &#125; val isRunning = promoteAndExecute() if (!isRunning &amp;&amp; idleCallback != null) &#123; idleCallback.run() &#125;&#125; ä»–è®²æ­¤æ¬¡è¯·æ±‚ä»runningAsyncCallsä¸­ç§»é™¤ï¼Œç„¶åæ‰§è¡Œäº†promoteAndExecute()æ–¹æ³•ï¼Œå’±ä»¬åœ¨ä¸Šé¢è¯´è¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä»–çš„è¿”å›å€¼å°±æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ªè¿è¡Œé˜Ÿåˆ—ä¸­è¿˜æœ‰æ²¡æœ‰è¯·æ±‚ï¼Œå¦‚æœè¿˜æœ‰å°±è¿”å›trueï¼Œæ²¡æœ‰å°±falseã€‚æ¥ç€ä¸€ä¸ªifï¼Œåˆ¤æ–­isRunningå’ŒidleCallbackçš„ï¼Œé‚£ä¹ˆå¦‚æœå½“å‰è¿™ä¸ªè¯·æ±‚è¿˜æ²¡æœ‰æ‰§è¡Œçš„è¯ï¼Œå°±è°ƒç”¨run()æ–¹æ³•æ‰§è¡Œå½“å‰è¯·æ±‚ã€‚è¿™æ ·æ¯ä¸ªè¯·æ±‚éƒ½æ‰§è¡Œå®Œæ¯•äº†ã€‚é‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ä»–çš„run()æ–¹æ³•ï¼š 1234567891011121314151617181920override fun run() &#123; threadName("OkHttp $&#123;redactedUrl()&#125;") &#123; var signalledCallback = false transmitter.timeoutEnter() try &#123; val response = getResponseWithInterceptorChain() signalledCallback = true responseCallback.onResponse(this@RealCall, response) &#125; catch (e: IOException) &#123; if (signalledCallback) &#123; // Do not signal the callback twice! Platform.get().log(INFO, "Callback failure for $&#123;toLoggableString()&#125;", e) &#125; else &#123; responseCallback.onFailure(this@RealCall, e) &#125; &#125; finally &#123; client.dispatcher.finished(this) &#125; &#125;&#125; è¿™å—è°ƒç”¨äº†ä¸€ä¸ªgetResponseWithInterceptorChain()æ–¹æ³•ï¼Œå¹¶è¿”å›äº†responseï¼Œå¹¶å°†å®ƒè¿”å›ç»™äº†responseCallback.onResponse()æ–¹æ³•ã€‚å¦‚æœå¤±è´¥äº†å°±å°†ç»“æœè¿”å›ç»™responseCallback.onFailure()æ–¹æ³•ã€‚æœ€åè°ƒç”¨client.dispatcher.finished()æ–¹æ³•ã€‚ 2.1.3 Interceptoræ‹¦æˆªå™¨2.1.3.1 getResponseWithInterceptorChain()æ–¹æ³•é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹getResponseWithInterceptorChain()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334@Throws(IOException::class)fun getResponseWithInterceptorChain(): Response &#123; // Build a full stack of interceptors. val interceptors = mutableListOf&lt;Interceptor&gt;() interceptors += client.interceptors interceptors += RetryAndFollowUpInterceptor(client) interceptors += BridgeInterceptor(client.cookieJar) interceptors += CacheInterceptor(client.cache) interceptors += ConnectInterceptor if (!forWebSocket) &#123; interceptors += client.networkInterceptors &#125; interceptors += CallServerInterceptor(forWebSocket) val chain = RealInterceptorChain(interceptors, transmitter, null, 0, originalRequest, this, client.connectTimeoutMillis, client.readTimeoutMillis, client.writeTimeoutMillis) var calledNoMoreExchanges = false try &#123; val response = chain.proceed(originalRequest) if (transmitter.isCanceled) &#123; response.closeQuietly() throw IOException("Canceled") &#125; return response &#125; catch (e: IOException) &#123; calledNoMoreExchanges = true throw transmitter.noMoreExchanges(e) as Throwable &#125; finally &#123; if (!calledNoMoreExchanges) &#123; transmitter.noMoreExchanges(null) &#125; &#125;&#125; é¦–å…ˆå°±åˆ›å»ºäº†ä¸€å¤§å †çš„è¿æ¥å™¨å¹¶æ·»åŠ åˆ°interceptorsé›†åˆä¸­ã€‚ç„¶ååˆ›å»ºäº†ä¸€ä¸ªRealInterceptorChainå¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†ä»–çš„proceed()æ–¹æ³•ï¼Œæ¥ç€ä¸»è¦ç›®çš„å°±æ˜¯è®²proceed()è¿”å›çš„responseç»™è¿”å›å»ã€‚é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹RealInterceptorChainçš„proceed()æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738override fun proceed(request: Request): Response &#123; return proceed(request, transmitter, exchange)&#125; @Throws(IOException::class)fun proceed(request: Request, transmitter: Transmitter, exchange: Exchange?): Response &#123; if (index &gt;= interceptors.size) throw AssertionError() calls++ // If we already have a stream, confirm that the incoming request will use it. check(this.exchange == null || this.exchange.connection()!!.supportsUrl(request.url)) &#123; "network interceptor $&#123;interceptors[index - 1]&#125; must retain the same host and port" &#125; // If we already have a stream, confirm that this is the only call to chain.proceed(). check(this.exchange == null || calls &lt;= 1) &#123; "network interceptor $&#123;interceptors[index - 1]&#125; must call proceed() exactly once" &#125; // Call the next interceptor in the chain. val next = RealInterceptorChain(interceptors, transmitter, exchange, index + 1, request, call, connectTimeout, readTimeout, writeTimeout) val interceptor = interceptors[index] @Suppress("USELESS_ELVIS") val response = interceptor.intercept(next) ?: throw NullPointerException( "interceptor $interceptor returned null") // Confirm that the next interceptor made its required call to chain.proceed(). check(exchange == null || index + 1 &gt;= interceptors.size || next.calls == 1) &#123; "network interceptor $interceptor must call proceed() exactly once" &#125; check(response.body != null) &#123; "interceptor $interceptor returned a response with no body" &#125; return response &#125; é¦–å…ˆå°±æ˜¯ä¸€ä¸ªindexï¼Œindexæ˜¯RealInterceptorChainæ„é€ å™¨ä¸­ä¼ å…¥çš„å‚æ•°ï¼Œå¥¹æ˜¯ç¬¬å››ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹getResponseWithInterceptorChain()æ–¹æ³•ä¸­åˆ›å»ºRealInterceptorChainå¯¹è±¡æ—¶æ„é€ å™¨çš„ç¬¬å››ä¸ªä¼ å…¥çš„å€¼ä¸º0ã€‚ç„¶ååˆ¤æ–­indexçš„å€¼æ˜¯ä¸æ˜¯å¤§äºinterceptorsçš„å¤§å°ï¼Œå¦‚æœå¤§äºå°±æŠ›å¼‚å¸¸ï¼Œå¦åˆ™å°±ç»§ç»­ä¸€é¡¿æ£€æŸ¥ï¼ï¼ï¼ç„¶åå†åˆ›å»ºRealInterceptorChainå¯¹è±¡ï¼Œæ­¤æ—¶åˆ›å»ºçš„å¯¹è±¡ä¼ å…¥çš„indexä¸ºæ­¤æ—¶çš„index+1ï¼Œç„¶åå†è°ƒç”¨interceptorçš„intercept()æ–¹æ³•ï¼Œå¹¶è¿”å›responseã€‚ interceptorçš„intercept()ä½œç”¨æ˜¯å½“å­˜åœ¨å¤šä¸ªæ‹¦æˆªå™¨æ—¶éƒ½ä¼šåœ¨ä¸Šé¢ä»£ç æ³¨é‡Š1å¤„é˜»å¡ï¼Œå¹¶ç­‰å¾…ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨çš„è°ƒç”¨è¿”å›ã€‚ 2.1.3.2 Interceptoræºç é‚£ç°åœ¨æˆ‘ä»¬å†æ¥è®²å‡ ä¸ªé‡è¦çš„æ‹¦æˆªå™¨å§ã€‚OkHttpä¸­Interceptorçš„å®ç°ç±»æœ‰ï¼š ConnectInterceptorï¼šè¿æ¥æ‹¦æˆªå™¨ã€‚ CallServerInterceptorï¼šè¯·æ±‚æœåŠ¡å™¨æ‹¦æˆªå™¨ CacheInterceptorï¼šç¼“å­˜æ‹¦æˆªå™¨ BridgeInterceptorï¼šæ¡¥æ¢æ‹¦æˆªå™¨ã€‚ å…¶ä¸­è¾ƒä¸ºé‡è¦çš„å°±æ˜¯ConnectInterceptorå’ŒCallServerInterceptorï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªã€‚ 2.1.3.2.1 ConnectInterceptorè¿™ä¸ªç±»ä¸»è¦ç”¨æ¥å®ç°ç½‘ç»œè¯·æ±‚è¿æ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹ä»–çš„interceptæ–¹æ³•ï¼š 123456789101112@Throws(IOException::class)override fun intercept(chain: Interceptor.Chain): Response &#123; val realChain = chain as RealInterceptorChain val request = realChain.request() val transmitter = realChain.transmitter() // We need the network to satisfy this request. Possibly for validating a conditional GET. val doExtensiveHealthChecks = request.method != "GET" val exchange = transmitter.newExchange(chain, doExtensiveHealthChecks) return realChain.proceed(request, transmitter, exchange)&#125; è¿™ä¸ªæ–¹æ³•å…ˆå°†ä¼ å…¥çš„chainå¯¹è±¡é€ å‹æˆäº†RealInterceptorChainçš„å¯¹è±¡ï¼Œè¿™ä¸ªç±»æˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°è¿‡ï¼Œç„¶åè°ƒç”¨ä»–çš„response()å’Œtransmitter()æ–¹æ³•ï¼Œåˆ†åˆ«å¾—åˆ°å½“å‰chainçš„responseå’Œtransmitterã€‚ç„¶åæ‰§è¡Œäº†requestçš„method()æ–¹æ³•ï¼Œåˆ¤æ–­requestçš„ç±»å‹æ˜¯ä¸æ˜¯GETï¼Œå¦‚æœæ˜¯doExtensiveHealthCheckså°±ä¸ºfalseï¼Œå¦åˆ™ä¸ºtrueï¼Œæ¥ç€æŠŠdoExtensiveHealthChecksä¼ å…¥transmitterçš„newExchange()æ–¹æ³•ä¸­å»ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ç­‰ä¼šå†è¯´ï¼Œç„¶åå†è°ƒç”¨äº†proceed()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åœ¨ä¸Šé¢è¯´è¿‡ã€‚ 2.1.3.2.2 CallServerInterceptorè¿™ä¸ªç±»æ˜¯ç½‘ç»œè¯·æ±‚çš„æœ¬è´¨ã€‚å®ƒçš„interceptæ–¹æ³•æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103@Throws(IOException::class) override fun intercept(chain: Interceptor.Chain): Response &#123; val realChain = chain as RealInterceptorChain val exchange = realChain.exchange() val request = realChain.request() val requestBody = request.body val sentRequestMillis = System.currentTimeMillis() // å†™å…¥è¯·æ±‚å¤´ exchange.writeRequestHeaders(request) var responseHeadersStarted = false var responseBuilder: Response.Builder? = null // å†™å…¥è¯·æ±‚ä½“ä¿¡æ¯ if (HttpMethod.permitsRequestBody(request.method) &amp;&amp; requestBody != null) &#123; // å¦‚æœè¯·æ±‚ä¸Šæœ‰â€œexpect:100 continueâ€å¤´ // è¯·ç­‰å¾…â€œhttp/1.1 100 continueâ€å“åº”ï¼Œç„¶åå†ä¼ è¾“è¯·æ±‚ä¸»ä½“. // å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¾—åˆ°ï¼Œè¿”å›æˆ‘ä»¬å¾—åˆ°çš„ï¼ˆä¾‹å¦‚4xxå“åº”ï¼‰ï¼Œè€Œä¸ä¼ è¾“è¯·æ±‚ä½“ã€‚ if ("100-continue".equals(request.header("Expect"), ignoreCase = true)) &#123; exchange.flushRequest() responseHeadersStarted = true exchange.responseHeadersStart() responseBuilder = exchange.readResponseHeaders(true) &#125; if (responseBuilder == null) &#123; if (requestBody.isDuplex()) &#123; // å‡†å¤‡ä¸€ä¸ªåŒå·¥ä¸»ä½“ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºç¨åå¯ä»¥å‘é€è¯·æ±‚ä¸»ä½“ã€‚ exchange.flushRequest() val bufferedRequestBody = exchange.createRequestBody(request, true).buffer() requestBody.writeTo(bufferedRequestBody) &#125; else &#123; // å¦‚æœæ»¡è¶³â€œexpect:100 continueâ€é¢„æœŸï¼Œåˆ™ç¼–å†™è¯·æ±‚æ­£æ–‡ã€‚ val bufferedRequestBody = exchange.createRequestBody(request, false).buffer() requestBody.writeTo(bufferedRequestBody) bufferedRequestBody.close() &#125; &#125; else &#123; exchange.noRequestBody() if (!exchange.connection()!!.isMultiplexed) &#123; // å¦‚æœä¸æ»¡è¶³â€œexpect:100 continueâ€çš„è¦æ±‚ï¼Œè¯·é˜²æ­¢é‡ç”¨HTTP/1è¿æ¥ã€‚ // å¦åˆ™ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¹‰åŠ¡ä¼ è¾“è¯·æ±‚ä¸»ä½“ä»¥ä½¿è¿æ¥ä¿æŒä¸€è‡´çŠ¶æ€ã€‚ exchange.noNewExchangesOnConnection() &#125; &#125; &#125; else &#123; exchange.noRequestBody() &#125; // ç»“æŸè¯·æ±‚ if (requestBody == null || !requestBody.isDuplex()) &#123; exchange.finishRequest() &#125; if (!responseHeadersStarted) &#123; exchange.responseHeadersStart() &#125; if (responseBuilder == null) &#123; responseBuilder = exchange.readResponseHeaders(false)!! &#125; // è¯»å–å“åº”å¤´ä¿¡æ¯ var response = responseBuilder .request(request) .handshake(exchange.connection()!!.handshake()) .sentRequestAtMillis(sentRequestMillis) .receivedResponseAtMillis(System.currentTimeMillis()) .build() var code = response.code if (code == 100) &#123; // æœåŠ¡å™¨å‘é€äº†ä¸€ä¸ª100ç»§ç»­ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¯·æ±‚ã€‚ // å†æ¬¡å°è¯•è¯»å–å®é™…å“åº” response = exchange.readResponseHeaders(false)!! .request(request) .handshake(exchange.connection()!!.handshake()) .sentRequestAtMillis(sentRequestMillis) .receivedResponseAtMillis(System.currentTimeMillis()) .build() code = response.code &#125; exchange.responseHeadersEnd(response) // openResponseBody è·å–å“åº”ä½“ä¿¡æ¯ response = if (forWebSocket &amp;&amp; code == 101) &#123; // è¿æ¥æ­£åœ¨å‡çº§ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿æ‹¦æˆªå™¨çœ‹åˆ°éç©ºçš„å“åº”ä¸»ä½“ã€‚ response.newBuilder() .body(EMPTY_RESPONSE) .build() &#125; else &#123; response.newBuilder() .body(exchange.openResponseBody(response)) .build() &#125; if ("close".equals(response.request.header("Connection"), ignoreCase = true) || "close".equals(response.header("Connection"), ignoreCase = true)) &#123; exchange.noNewExchangesOnConnection() &#125; if ((code == 204 || code == 205) &amp;&amp; response.body?.contentLength() ?: -1L &gt; 0L) &#123; throw ProtocolException( "HTTP $code had non-zero Content-Length: $&#123;response.body?.contentLength()&#125;") &#125; //è¿”å›ä¸€ä¸ªå“åº” return response&#125; å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹ä»£ç ä¸­çš„æ³¨é‡Šï¼Œå®ƒä¸»è¦æ˜¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ•°æ®å’Œæ¥å—æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€‚ 2.1.4 TransmiterTransmitterç±»æ˜¯OkHttpçš„åº”ç”¨å±‚å’Œç½‘ç»œå±‚çš„ä¸€ä¸ªæ¡¥æ¢ç±»ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¯¥ç±»çš„åˆå§‹åŒ–ï¼š 12345678910111213class Transmitter( private val client: OkHttpClient, private val call: Call) &#123; private val connectionPool: RealConnectionPool = client.connectionPool.delegate private val eventListener: EventListener = client.eventListenerFactory.create(call) private val timeout = object : AsyncTimeout() &#123; override fun timedOut() &#123; cancel() &#125; &#125;.apply &#123; timeout(client.callTimeoutMillis.toLong(), MILLISECONDS) &#125; Transmitterä¸»è¦çš„ä¸€äº›æˆå‘˜å˜é‡å°±è¿™äº›ï¼Œé¦–å…ˆæ„é€ å™¨ä¸­ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªOkHttpClientï¼Œä¸€ä¸ªCallã€‚ç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ªè¿æ¥æ± connectionPoolï¼Œè¿˜æœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±•è¿™ä¸ªç±»æ¥ç›‘å¬ç¨‹åºçš„HTTPçš„è°ƒç”¨æ•°é‡ã€å¤§å°å’ŒæŒç»­æ—¶é—´ã€‚ 2.1.5 RealConnectionæˆ‘ä»¬å…ˆçœ‹çœ‹ä»–çš„ä¸€äº›å±æ€§ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546class RealConnection( val connectionPool: RealConnectionPool, private val route: Route) : Http2Connection.Listener(), Connection &#123; // ä»¥ä¸‹å­—æ®µç”±connectï¼ˆï¼‰åˆå§‹åŒ–ï¼Œä»ä¸é‡æ–°åˆ†é…ã€‚ // åº•å±‚socket private var rawSocket: Socket? = null /** * åº”ç”¨å±‚å¥—æ¥å­—ã€‚å¦‚æœæ­¤è¿æ¥ä¸ä½¿ç”¨SSLï¼Œåˆ™å¯ä»¥æ˜¯[sslsocket]åˆ†å±‚åœ¨[rawsocket]ä¸Šï¼Œä¹Ÿå¯ä»¥æ˜¯[rawsocket]æœ¬èº«ã€‚ */ // åº”ç”¨å±‚socket private var socket: Socket? = null // æ¡æ‰‹ private var handshake: Handshake? = null // åè®® private var protocol: Protocol? = null // http2çš„è¿æ¥ private var http2Connection: Http2Connection? = null // ä¸æœåŠ¡å™¨äº¤äº’çš„è¾“å…¥è¾“å‡ºæµ private var source: BufferedSource? = null private var sink: BufferedSink? = null // è·Ÿè¸ªè¿æ¥çŠ¶æ€ä¸‹çš„å­—æ®µç”±è¿æ¥æ± ä¿æŠ¤ã€‚ /** * å¦‚æœä¸ºtrueï¼Œåˆ™ä¸èƒ½åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°çš„äº¤æ¢ã€‚ä¸€æ—¦æ˜¯trueçš„ï¼Œè¿™æ€»æ˜¯trueçš„ã€‚ * ç”±[ConnectionPool]ç›‘è§†ã€‚ */ var noNewExchanges = false /** * å»ºç«‹å¯èƒ½ç”±äºæ‰€é€‰è·¯ç”±è€Œå¯¼è‡´çš„æµæ—¶å‡ºç°é—®é¢˜çš„æ¬¡æ•°ã€‚ç”±[ConnectionPool]ä¿æŠ¤ã€‚ */ internal var routeFailureCount = 0 internal var successCount = 0 private var refusedStreamCount = 0 /** * æ­¤è¿æ¥å¯ä»¥æ‰¿è½½çš„æœ€å¤§å¹¶å‘æµæ•°ã€‚ * å¦‚æœâ€œallocations.sizeï¼ˆï¼‰&lt;allocationlimitâ€ï¼Œåˆ™å¯ä»¥åœ¨æ­¤è¿æ¥ä¸Šåˆ›å»ºæ–°æµã€‚ */ private var allocationLimit = 1 æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ä»–çš„connect()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788fun connect( connectTimeout: Int, readTimeout: Int, writeTimeout: Int, pingIntervalMillis: Int, connectionRetryEnabled: Boolean, call: Call, eventListener: EventListener) &#123; check(protocol == null) &#123; "already connected" &#125; // çº¿è·¯çš„é€‰æ‹© var routeException: RouteException? = null val connectionSpecs = route.address.connectionSpecs val connectionSpecSelector = ConnectionSpecSelector(connectionSpecs) if (route.address.sslSocketFactory == null) &#123; if (ConnectionSpec.CLEARTEXT !in connectionSpecs) &#123; throw RouteException(UnknownServiceException( "CLEARTEXT communication not enabled for client")) &#125; val host = route.address.url.host if (!Platform.get().isCleartextTrafficPermitted(host)) &#123; throw RouteException(UnknownServiceException( "CLEARTEXT communication to $host not permitted by network security policy")) &#125; &#125; else &#123; if (Protocol.H2_PRIOR_KNOWLEDGE in route.address.protocols) &#123; throw RouteException(UnknownServiceException( "H2_PRIOR_KNOWLEDGE cannot be used with HTTPS")) &#125; &#125; // è¿æ¥å¼€å§‹ while (true) &#123; try &#123; // å¦‚æœè¦æ±‚éš§é“æ¨¡å¼ï¼Œå»ºç«‹é€šé“è¿æ¥ï¼Œé€šå¸¸ä¸æ˜¯è¿™ç§ if (route.requiresTunnel()) &#123; connectTunnel(connectTimeout, readTimeout, writeTimeout, call, eventListener) if (rawSocket == null) &#123; // æˆ‘ä»¬æ— æ³•è¿æ¥éš§é“ï¼Œä½†é€‚å½“å…³é—­äº†æˆ‘ä»¬çš„èµ„æºã€‚ break &#125; &#125; else &#123; // ä¸€èˆ¬éƒ½èµ°è¿™æ¡é€»è¾‘äº†ï¼Œå®é™…ä¸Šå¾ˆç®€å•å°±æ˜¯socketçš„è¿æ¥ connectSocket(connectTimeout, readTimeout, call, eventListener) &#125; // httpsçš„å»ºç«‹ establishProtocol(connectionSpecSelector, pingIntervalMillis, call, eventListener) eventListener.connectEnd(call, route.socketAddress, route.proxy, protocol) break &#125; catch (e: IOException) &#123; socket?.closeQuietly() rawSocket?.closeQuietly() socket = null rawSocket = null source = null sink = null handshake = null protocol = null http2Connection = null eventListener.connectFailed(call, route.socketAddress, route.proxy, null, e) if (routeException == null) &#123; routeException = RouteException(e) &#125; else &#123; routeException.addConnectException(e) &#125; if (!connectionRetryEnabled || !connectionSpecSelector.connectionFailed(e)) &#123; throw routeException &#125; &#125; &#125; if (route.requiresTunnel() &amp;&amp; rawSocket == null) &#123; throw RouteException(ProtocolException( "Too many tunnel connections attempted: $MAX_TUNNEL_ATTEMPTS")) &#125; val http2Connection = this.http2Connection if (http2Connection != null) &#123; synchronized(connectionPool) &#123; allocationLimit = http2Connection.maxConcurrentStreams() &#125; &#125;&#125; é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»å»ºç«‹è¿æ¥ï¼Œå¦‚æœå·²ç»å»ºç«‹å°±æŠ›å¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯å°±ç»§ç»­ã€‚æ¥ç€å°±å¾—åˆ°äº†ConnectionSpecsï¼Œç„¶åæ ¹æ®ä»–å»ºç«‹äº†ä¸€ä¸ªconnectionSpecSelectoré›†åˆã€‚æ¥ç€åˆ¤æ–­æ˜¯ä¸æ˜¯å®‰å…¨è¿æ¥ï¼Œä¹Ÿå°±æ˜¯sslè¿æ¥ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±åˆ¤æ–­äº†ä¸€äº›å±æ€§ï¼Œå…ˆç¡®å®šæ˜¯ä¸æ˜¯æ˜æ–‡ç„¶åå†ç¡®å®šä¸»æœºèƒ½ä¸èƒ½æ¥å—æ˜æ–‡æ“ä½œã€‚æ¥ç€å°±å¼€å§‹è¿æ¥ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯è¦è¿›è¡Œéš§é“é€šä¿¡ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨connectTunnel()å»ºç«‹éš§é“é€šä¿¡ï¼Œå¦‚æœä¸æ˜¯å°±è°ƒç”¨connectSocket()å»ºç«‹æ™®é€šçš„é€šä¿¡ã€‚ç„¶åé€šè¿‡establishProtocol()å»ºç«‹åè®®ã€‚å¦‚æœæ˜¯HTTP/2å°±è®¾ç½®ç›¸å…³å±æ€§ã€‚ ç„¶åæˆ‘ä»¬å°±æ¥çœ‹çœ‹ä»–å…·ä½“å¦‚ä½•å®ç°çš„ï¼Œå…ˆçœ‹çœ‹connectSocket()æ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243@Throws(IOException::class)private fun connectSocket( connectTimeout: Int, readTimeout: Int, call: Call, eventListener: EventListener) &#123; val proxy = route.proxy val address = route.address // æ ¹æ®ä»£ç†ç±»å‹é€‰æ‹©socketç±»å‹æ˜¯ä»£ç†è¿˜æ˜¯ç›´è¿ val rawSocket = when (proxy.type()) &#123; Proxy.Type.DIRECT, Proxy.Type.HTTP -&gt; address.socketFactory.createSocket()!! else -&gt; Socket(proxy) &#125; this.rawSocket = rawSocket eventListener.connectStart(call, route.socketAddress, proxy) rawSocket.soTimeout = readTimeout try &#123; // è¿æ¥socketï¼Œä¹‹æ‰€ä»¥è¿™æ ·å†™æ˜¯å› ä¸ºæ”¯æŒä¸åŒçš„å¹³å° // é‡Œé¢å®é™…ä¸Šæ˜¯ socket.connect(address, connectTimeout); Platform.get().connectSocket(rawSocket, route.socketAddress, connectTimeout) &#125; catch (e: ConnectException) &#123; throw ConnectException("Failed to connect to $&#123;route.socketAddress&#125;").apply &#123; initCause(e) &#125; &#125; // ä¸‹é¢çš„Try/Catchå—æ˜¯ä¸€ç§é¿å…Android 7.0å´©æºƒçš„ä¼ªé»‘å®¢æ–¹æ³• // More details: // https://github.com/square/okhttp/issues/3245 // https://android-review.googlesource.com/#/c/271775/ try &#123; // å¾—åˆ°è¾“å…¥ï¼è¾“å‡ºæµ source = rawSocket.source().buffer() sink = rawSocket.sink().buffer() &#125; catch (npe: NullPointerException) &#123; if (npe.message == NPE_THROW_WITH_NULL) &#123; throw IOException(npe) &#125; &#125;&#125; é¦–å…ˆå…ˆåˆ¤æ–­è¿æ¥ç±»å‹ï¼Œå¦‚æœæ˜¯ç›´è¿æˆ–è€…HTTPè¿æ¥å°±ç›´è¿ï¼Œå¦åˆ™çš„è¯èµ°Socketä»£ç†ï¼Œç„¶åé€šè¿‡eventListener.connectStart()æ–¹æ³•åˆ›å»ºè¿æ¥ï¼Œå†è®¾å®šè¶…æ—¶-&gt;å®Œæˆè¿æ¥-&gt;åˆ›å»ºç”¨äºI/Oçš„sourceå’Œsinkã€‚ æˆ‘ä»¬æ¥ç€å†æ¥çœ‹connectTunnel()æ–¹æ³•ï¼š 123456789101112131415161718192021222324@Throws(IOException::class)private fun connectTunnel( connectTimeout: Int, readTimeout: Int, writeTimeout: Int, call: Call, eventListener: EventListener) &#123; var tunnelRequest: Request = createTunnelRequest() val url = tunnelRequest.url for (i in 0 until MAX_TUNNEL_ATTEMPTS) &#123; connectSocket(connectTimeout, readTimeout, call, eventListener) tunnelRequest = createTunnel(readTimeout, writeTimeout, tunnelRequest, url) ?: break // å·²æˆåŠŸåˆ›å»ºéš§é“ã€‚ // ä»£ç†å†³å®šåœ¨èº«ä»½éªŒè¯è´¨è¯¢åå…³é—­è¿æ¥ã€‚ // æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œä½†è¿™æ¬¡éœ€è¦ä½¿ç”¨èº«ä»½éªŒè¯å‡­æ®ã€‚ rawSocket?.closeQuietly() rawSocket = null sink = null source = null eventListener.connectEnd(call, route.socketAddress, route.proxy, null) &#125;&#125; å¤§ä½“å°±æ˜¯å…ˆåˆ›å»ºéš§é“è¯·æ±‚ï¼Œç„¶åå»ºç«‹socketè¿æ¥ï¼Œå†å‘é€è¯·æ±‚å»ºç«‹éš§é“ã€‚ 3. è¯·æ±‚æµç¨‹å›¾é‚£æˆ‘ä»¬æœ€åæ¥æ€»ç»“ä¸‹ 3.1 åŒæ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ 3.2 å¼‚æ­¥è¯·æ±‚æ˜¯å¦‚ä½•æ“ä½œçš„ï¼Ÿ]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>æºç </tag>
        <tag>OkHttp</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç½‘ç»œè¯·æ±‚2--è§£æVolleyæºç ]]></title>
    <url>%2Fposts%2Fdf8fd75e.html</url>
    <content type="text"><![CDATA[æœ¬æ–‡å¤§ç¯‡å¹…å‚è€ƒæ­¤ç¯‡æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸¤ç¯‡æ–‡ç« çœ‹ä¸€ä¸‹ 1. Volleyç®€ä»‹åœ¨å¾ˆæ—©ä»¥å‰ï¼Œå¦‚æœAndroidå¼€å‘è€…æƒ³ä½¿ç”¨ç½‘ç»œè¯·æ±‚çš„è¯ï¼Œå¿…é¡»è‡ªå·±é€šè¿‡HttpClientæˆ–è€…HttpURLConnectionç¼–å†™ä»£ç æ¥è®¿é—®ã€‚ä½†æ˜¯ä»–ä¸¤çš„ç”¨æ³•è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œå¦‚æœä¸é€‚å½“çš„å°è£…çš„è¯ï¼Œå°±ä¼šæœ‰å¾ˆå¤šå¤šä½™ä»£ç ç”šè‡³æ•ˆç‡é™ä½ã€‚æ‰€ä»¥å½“æ—¶å‡ºç°äº†å¾ˆå¤šç¬¬ä¸‰æ–¹ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œä½†æ˜¯éƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ï¼Œè€Œè°·æ­Œå®˜æ–¹ä¸€ç›´æ²¡æœ‰ä½œä¸ºã€‚æœ€ç»ˆåœ¨2013å¹´ï¼Œè°·æ­Œç»ˆäºæ„è¯†åˆ°äº†é—®é¢˜ï¼Œäºæ˜¯ä»–ä»¬æ¨å‡ºäº†ä¸€ä¸ªå®˜æ–¹çš„å…¨æ–°çš„ç½‘ç»œæ¡†æ¶â€”â€”Volleyã€‚Volleyå®ƒåˆèƒ½éå¸¸ç®€å•çš„è¿›è¡ŒHTTPé€šä¿¡ï¼Œåˆèƒ½è½»æ¾åŠ è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚ä»–çš„è®¾è®¡ç›®çš„å°±æ˜¯åº”å¯¹æ•°æ®é‡ä¸å¤§ä½†æ˜¯é¢‘å‘çš„ç½‘ç»œæ“ä½œï¼Œä½†æ˜¯å¯¹äºä¸‹è½½ç­‰éœ€è¦å¤§æ•°æ®é‡çš„ç½‘ç»œæ“ä½œï¼Œä»–å°±ä¸å¤ªé€‚åˆã€‚ 2. æºç è§£æ2.1 ä»RequestQueueå…¥æ‰‹å¦‚æœä½ ä½¿ç”¨Volleyçš„è¯ï¼Œå°±ä¼šå‘ç°Volleyä¸ç®¡è¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œé¦–å…ˆç¬¬ä¸€æ­¥å°±æ˜¯å…ˆåˆ›å»ºRequestQueueå¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥è®¤å®šä»–ä¸ºVolleyçš„å…¥å£ã€‚åˆ›å»ºRequestQueueçš„æ–¹æ³•æ˜¯RequestQueue mQueue = Volley.newRequestQueue(getApplicationContext());,æˆ‘ä»¬å°±çœ‹çœ‹newRequestQueueå¹²äº†ä»€ä¹ˆï¼š 1234567891011121314151617181920212223242526272829public static RequestQueue newRequestQueue(Context context, BaseHttpStack stack) &#123; BasicNetwork network; if (stack == null) &#123; if (Build.VERSION.SDK_INT &gt;= 9) &#123; network = new BasicNetwork(new HurlStack()); &#125; else &#123; // åœ¨Android 2.3ä¹‹å‰ï¼ŒHttpURLConnectionæ˜¯ä¸å¯é çš„ã€‚ // è¯·å‚é˜…ï¼šhttp://android-developers.blogspot.com/2011/09/androids-http-clients.html // åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°†æŠŠminsdkversionç§»åˆ°Android 2.2ä¹‹ä¸Šï¼Œ // å¹¶å¯ä»¥åˆ é™¤è¿™ä¸ªå›é€€ï¼ˆè¿åŒæ‰€æœ‰ApacheHTTPä»£ç ï¼‰ã€‚ String userAgent = "volley/0"; try &#123; String packageName = context.getPackageName(); PackageInfo info = context.getPackageManager().getPackageInfo(packageName, /* flags= */ 0); userAgent = packageName + "/" + info.versionCode; &#125; catch (NameNotFoundException e) &#123; &#125; network = new BasicNetwork( new HttpClientStack(AndroidHttpClient.newInstance(userAgent))); &#125; &#125; else &#123; network = new BasicNetwork(stack); &#125; return newRequestQueue(context, network);&#125; è°ƒç”¨æ–¹æ³•åï¼Œå…ˆæŸ¥çœ‹Androidç‰ˆæœ¬æ˜¯å¦å¤§äºç­‰äº2.3ï¼Œå¦‚æœå¤§äºåˆ™è°ƒç”¨åŸºäºHttpURLConnectionçš„HurlStackï¼Œå¦åˆ™è°ƒç”¨åŸºäºHttpClientçš„HttpClientStackã€‚æ¥ä¸‹æ¥åˆ›å»ºBasicNetworkå¹¶è°ƒç”¨newRequestQueue(context, network)æ–¹ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªnewRequestQueue()æ–¹æ³•ï¼š 1234567891011121314151617181920private static RequestQueue newRequestQueue(Context context, Network network) &#123; final Context appContext = context.getApplicationContext(); // å¯¹ç¼“å­˜ç›®å½•ä½¿ç”¨æƒ°æ€§ä¾›åº”å•†ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸Šè°ƒç”¨newRequestQueueï¼ˆï¼‰ï¼Œ // è€Œä¸ä¼šå¯¼è‡´ä¸¥æ ¼çš„æ¨¡å¼å†²çªã€‚ DiskBasedCache.FileSupplier cacheSupplier = new DiskBasedCache.FileSupplier() &#123; private File cacheDir = null; @Override public File get() &#123; if (cacheDir == null) &#123; cacheDir = new File(appContext.getCacheDir(), DEFAULT_CACHE_DIR); &#125; return cacheDir; &#125; &#125;; RequestQueue queue = new RequestQueue(new DiskBasedCache(cacheSupplier), network); queue.start(); return queue;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ä¸ºVolleyåˆ›å»ºäº†ä¸€ä¸ªç¡¬ç›˜ç¼“å­˜DiskBasedCacheï¼Œç„¶åé€šè¿‡è¿™ä¸ªç£ç›˜ç¼“å­˜å’ŒNetworkåˆ›å»ºäº†ä¸€ä¸ªRequestQueueå¯¹è±¡ï¼Œå¹¶è°ƒç”¨äº†start()æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹start()æ–¹æ³•: 123456789101112131415public void start() &#123; stop(); // ç¡®ä¿å½“å‰è¿è¡Œçš„æ‰€æœ‰è°ƒåº¦ç¨‹åºéƒ½å·²åœæ­¢ã€‚ // åˆ›å»ºç¼“å­˜è°ƒåº¦å™¨å¹¶å¼€å§‹å®ƒã€‚ mCacheDispatcher = new CacheDispatcher(mCacheQueue, mNetworkQueue, mCache, mDelivery); mCacheDispatcher.start(); // åˆ›å»ºè¾¾åˆ°æ± å¤§å°çš„ç½‘ç»œè°ƒåº¦ç¨‹åºï¼ˆå’Œç›¸åº”çš„çº¿ç¨‹ï¼‰ã€‚ for (int i = 0; i &lt; mDispatchers.length; i++) &#123; NetworkDispatcher networkDispatcher = new NetworkDispatcher(mNetworkQueue, mNetwork, mCache, mDelivery); mDispatchers[i] = networkDispatcher; networkDispatcher.start(); &#125;&#125; CacheDispatcheræ˜¯ä¸€ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œå¹¶è°ƒç”¨äº†start()æ–¹æ³•ã€‚åœ¨å¾ªç¯ä¸­è°ƒç”¨NetworkDispatcherçš„start()æ–¹æ³•ã€‚NetworkDispatcheræ˜¯ç½‘ç»œè°ƒåº¦çº¿ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹mDispatchers.lengthä¸º4ï¼Œé»˜è®¤å¼€å¯äº†4ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œå¤–åŠ 1ä¸ªç¼“å­˜è°ƒåº¦çº¿ç¨‹ï¼Œæ€»å…±5ä¸ªçº¿ç¨‹ã€‚æ¥ä¸‹æ¥Volleyä¼šåˆ›å»ºå„ç§Requestï¼Œå¹¶è°ƒç”¨RequestQueueçš„add()æ–¹æ³•ï¼š 123456789101112131415161718192021public &lt;T&gt; Request&lt;T&gt; add(Request&lt;T&gt; request) &#123; // å°†è¯·æ±‚æ ‡è®°ä¸ºå±äºæ­¤é˜Ÿåˆ—ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å½“å‰è¯·æ±‚é›†ã€‚ request.setRequestQueue(this); synchronized (mCurrentRequests) &#123; //mCurrentRequestsæ˜¯ä¸€ä¸ªHashSet mCurrentRequests.add(request); &#125; // æŒ‰æ·»åŠ çš„é¡ºåºå¤„ç†è¯·æ±‚ã€‚ request.setSequence(getSequenceNumber()); request.addMarker("add-to-queue"); sendRequestEvent(request, RequestEvent.REQUEST_QUEUED); // å¦‚æœè¯·æ±‚æ˜¯ä¸å¯æ‰§è¡Œçš„ï¼Œè·³è¿‡ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åç›´æ¥è¿›å…¥ç½‘ç»œã€‚ if (!request.shouldCache()) &#123; mNetworkQueue.add(request); return request; &#125; mCacheQueue.add(request); return request;&#125; è¿™å—åœ°æ–¹çš„ä»£ç å°±å¾ˆç®€å•äº†ï¼Œå°±æ˜¯æ ¹æ®requestçš„shouldCache()æ–¹æ³•æ¥è¿”å›requestçš„mShouldCacheå±æ€§æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥ç¼“å­˜ï¼Œé»˜è®¤æ˜¯å¯ä»¥çš„ã€‚å¦‚æœèƒ½ç¼“å­˜ï¼Œå°†æ­¤è¯·æ±‚åŠ å…¥mCacheQueueé˜Ÿåˆ—ï¼Œä¸å†é‡å¤è¯·æ±‚ï¼›ä¸å¯ä»¥çš„è¯å°±å°†è¯·æ±‚åŠ å…¥ç½‘ç»œè¯·æ±‚é˜Ÿåˆ—mNetworkQueueã€‚ 2.2 CacheDispatcherç¼“å­˜è°ƒåº¦çº¿ç¨‹RequestQueueçš„add()æ–¹æ³•å¹¶æ²¡æœ‰è¯·æ±‚ç½‘ç»œæˆ–è€…å¯¹ç¼“å­˜è¿›è¡Œæ“ä½œã€‚å½“å°†è¯·æ±‚æ·»åŠ åˆ°ç½‘ç»œè¯·æ±‚é˜Ÿ åˆ—æˆ–è€…ç¼“å­˜é˜Ÿåˆ—æ—¶ï¼Œåœ¨åå°çš„ç½‘ç»œè°ƒåº¦çº¿ç¨‹å’Œç¼“å­˜è°ƒåº¦çº¿ç¨‹è½®è¯¢å„è‡ªçš„è¯·æ±‚é˜Ÿåˆ—ï¼Œè‹¥å‘ç°æœ‰è¯·æ±‚ä»»åŠ¡åˆ™å¼€ å§‹æ‰§è¡Œã€‚ä¸‹é¢å…ˆçœ‹çœ‹ç¼“å­˜è°ƒåº¦çº¿ç¨‹ã€‚ é¦–å…ˆå…ˆæ¥çœ‹çœ‹CacheDispatcherçš„add()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627@Overridepublic void run() &#123; if (DEBUG) VolleyLog.v("start new dispatcher"); Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); // Process.THREAD_PRIORITY_BACKGROUNDé»˜è®¤å€¼ä¸º10 // è¿›è¡Œé˜»å¡è°ƒç”¨ä»¥åˆå§‹åŒ–ç¼“å­˜ã€‚ mCache.initialize(); while (true) &#123; try &#123; processRequest(); &#125; catch (InterruptedException e) &#123; // å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™è¦é€€å‡ºäº†ã€‚ if (mQuit) &#123; Thread.currentThread().interrupt(); return; &#125; VolleyLog.e( "Ignoring spurious interrupt of CacheDispatcher thread; " + "use quit() to terminate it"); // å¿½ç•¥cachedispatcherçº¿ç¨‹çš„å‡ä¸­æ–­ï¼› // ä½¿ç”¨quitï¼ˆï¼‰ç»ˆæ­¢å®ƒ &#125; &#125;&#125; è¿™å—å¯ä»¥çœ‹å‡ºä¸»è¦å°±æ˜¯åˆå§‹åŒ–äº†ç¼“å­˜é˜Ÿåˆ—ï¼Œç„¶åå¼€äº†ä¸ªæ­»å¾ªç¯ï¼Œä¸€ç›´è°ƒç”¨processRequest()ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182private void processRequest() throws InterruptedException &#123; // ä»CacheQueueä¸­å–å‡ºä¸€ä¸ªå¯ç”¨çš„request final Request&lt;?&gt; request = mCacheQueue.take(); processRequest(request);&#125;@VisibleForTestingvoid processRequest(final Request&lt;?&gt; request) throws InterruptedException &#123; request.addMarker("cache-queue-take"); request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_STARTED); try &#123; //requestå¦‚æœè¢«å–æ¶ˆäº†ï¼Œå°±ç›´æ¥è¿”å› if (request.isCanceled()) &#123; request.finish("cache-discard-canceled"); return; &#125; Cache.Entry entry = mCache.get(request.getCacheKey()); // æ²¡æœ‰ç¼“å­˜å°±æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­ if (entry == null) &#123; request.addMarker("cache-miss"); // æ²¡æœ‰ç¼“å­˜ï¼Œå¹¶ä¸”ç­‰å¾…é˜Ÿåˆ—ä¸­ä¹Ÿæ²¡æœ‰æ­¤requestï¼Œé‚£ä¹ˆå°±ç›´æ¥åŠ å…¥åˆ°NetworkQueueä¸­ if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; mNetworkQueue.put(request); &#125; return; &#125; // å¦‚æœç¼“å­˜è¿‡æœŸäº†ï¼Œä¹Ÿæ˜¯ä¸€æ ·æŠŠrequestæ·»åŠ åˆ°NetworkQueueä¸­ if (entry.isExpired()) &#123; request.addMarker("cache-hit-expired"); request.setCacheEntry(entry); if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; mNetworkQueue.put(request); &#125; return; &#125; // æœ‰ç¼“å­˜å¹¶ä¸”æ²¡æœ‰è¿‡æœŸ request.addMarker("cache-hit"); // æ ¹æ®ç¼“å­˜çš„å†…å®¹è§£æ Response&lt;?&gt; response = request.parseNetworkResponse( new NetworkResponse(entry.data, entry.responseHeaders)); request.addMarker("cache-hit-parsed"); // æ˜¯å¦éœ€è¦æ›´æ–° if (!entry.refreshNeeded()) &#123; // ä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); &#125; else &#123; request.addMarker("cache-hit-refresh-needed"); request.setCacheEntry(entry); response.intermediate = true; // åˆ¤æ–­æ˜¯å¦æœ‰ç›¸åŒç¼“å­˜é”®çš„ä»»åŠ¡åœ¨æ‰§è¡Œ if (!mWaitingRequestManager.maybeAddToWaitingRequests(request)) &#123; // éœ€è¦æ›´æ–°ç»“æœï¼Œå…ˆå°†ç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åæ‰§è¡Œnew runnable()&#123;&#125; // runnableä¸­å°±æ˜¯å°†requestæ·»åŠ åˆ°NetworkQueueä¸­ï¼Œæ›´æ–°ä¸€ä¸‹å†…å®¹ mDelivery.postResponse( request, response, new Runnable() &#123; @Override public void run() &#123; try &#123; mNetworkQueue.put(request); &#125; catch (InterruptedException e) &#123; // Restore the interrupted status Thread.currentThread().interrupt(); &#125; &#125; &#125;); &#125; else &#123; // requestå·²ç»åŠ å…¥åˆ°mWaitingRequestsä¸­ // ç›´æ¥æŠŠç»“æœè°ƒåº¦åˆ°ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); &#125; &#125; &#125; finally &#123; request.sendEvent(RequestQueue.RequestEvent.REQUEST_CACHE_LOOKUP_FINISHED); &#125;&#125; æˆ‘ä»¬åœ¨processRequestä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ–¹æ³•ç»å¸¸å‡ºç°ï¼Œé‚£å°±æ˜¯mWaitingRequestManager.maybeAddToWaitingRequests(request)ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ¤æ–­å½“å‰è¿™ä¸ªrequestæ˜¯å¦æœ‰å­˜åœ¨ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªrequeståŠ å…¥åˆ°ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç­‰åˆ°ç›¸åŒç¼“å­˜é”®çš„è¯·æ±‚å®Œæˆã€‚ æ€»ç»“ä¸€ä¸‹CacheDispatcherä¸»è¦æ­¥éª¤ï¼š ä»CacheQueueä¸­å¾ªç¯å–å‡ºrequestï¼› å¦‚æœç¼“å­˜ä¸¢å¤±ï¼ŒåŠ å…¥åˆ°NetworkQueueä¸­ï¼› å¦‚æœç¼“å­˜è¿‡æœŸï¼ŒåŠ å…¥åˆ°NetworkQueueä¸­ï¼› å°†ç¼“å­˜ä¸­çš„æ•°æ®è§£ææˆResponseå¯¹è±¡ï¼› å¦‚æœä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥å°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œå›è°ƒæ“ä½œç­‰ä»‹ç»å®ŒNetworkDispatcherä¹‹åä¸€èµ·æ·±å…¥å‰–æï¼› å¦‚æœéœ€è¦æ›´æ–°ï¼Œå…ˆå°†ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ï¼Œç„¶åå†å°†requeståŠ å…¥åˆ°NetworkQueueä¸­ã€‚ ä¸‹é¢æ¥çœ‹çœ‹ç½‘ç»œè°ƒåº¦çº¿ç¨‹ã€‚ 2.3 NetWorkDispatcherç½‘ç»œè°ƒåº¦çº¿ç¨‹NetworkDispatcherçš„runæ–¹æ³•ä»£ç å¦‚ä¸‹æ‰€ç¤º: 123456789101112131415161718@Overridepublic void run() &#123; Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); while (true) &#123; try &#123; processRequest(); &#125; catch (InterruptedException e) &#123; // æˆ‘ä»¬å¯èƒ½è¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæ˜¯æ—¶å€™é€€å‡ºäº†ã€‚ if (mQuit) &#123; Thread.currentThread().interrupt(); return; &#125; VolleyLog.e( "Ignoring spurious interrupt of NetworkDispatcher thread; " + "use quit() to terminate it"); &#125; &#125;&#125; ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼ŒNetWordDispatchå’ŒCacheDispatchéå¸¸ç±»ä¼¼ã€‚ä»–çš„run()æ–¹æ³•å’ŒCacheDispatchçš„æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œè¿™å°±ä¸å¤šåšä»‹ç»ï¼Œä¸‹é¢æ¥çœ‹çœ‹ä»–çš„processRequest()æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263private void processRequest() throws InterruptedException &#123; // ä»NetworkQueueä¸­å–å‡ºrequest Request&lt;?&gt; request = mQueue.take(); processRequest(request);&#125;@VisibleForTestingvoid processRequest(Request&lt;?&gt; request) &#123; long startTimeMs = SystemClock.elapsedRealtime(); request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_STARTED); try &#123; request.addMarker("network-queue-take"); // å¦‚æœrequestè¢«å–æ¶ˆäº†ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œæ­¤request if (request.isCanceled()) &#123; request.finish("network-discard-cancelled"); request.notifyListenerResponseNotUsable(); return; &#125; addTrafficStatsTag(request); // è¿˜è®°å¾—è¿™ä¸ªmNetworkä¹ˆï¼Œå®ƒå°±æ˜¯Volley.newRequestQueue()æ–¹æ³•é‡Œçš„BasicNetworkå¯¹è±¡ï¼Œä¸€ä¼šæˆ‘ä»¬æ¥çœ‹çœ‹mNetwork.performRequest()æ–¹æ³•æ˜¯å¦‚ä½•å¾—åˆ°NetworkResponseçš„ NetworkResponse networkResponse = mNetwork.performRequest(request); request.addMarker("network-http-complete"); // notModifiedæ˜¯æœåŠ¡ç«¯è¿”å›304ï¼ŒhasHadResponseDelivered()æ˜¯requestå·²ç»å›è°ƒè¿‡äº† if (networkResponse.notModified &amp;&amp; request.hasHadResponseDelivered()) &#123; request.finish("not-modified"); request.notifyListenerResponseNotUsable(); return; &#125; // å°†NetworkResponseè§£ææˆResponseå¯¹è±¡ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ Response&lt;?&gt; response = request.parseNetworkResponse(networkResponse); request.addMarker("network-parse-complete"); // å°†requestå†™å…¥ç¼“å­˜ if (request.shouldCache() &amp;&amp; response.cacheEntry != null) &#123; mCache.put(request.getCacheKey(), response.cacheEntry); request.addMarker("network-cache-written"); &#125; request.markDelivered(); // å›è°ƒç»“æœè‡³ä¸»çº¿ç¨‹ mDelivery.postResponse(request, response); request.notifyListenerResponseReceived(response); &#125; // ä»¥ä¸‹éƒ½æ˜¯å¤„ç†å¼‚å¸¸é”™è¯¯ï¼Œç„¶åä¹Ÿéœ€è¦å›è°ƒè‡³ä¸»çº¿ç¨‹ catch (VolleyError volleyError) &#123; volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs); parseAndDeliverNetworkError(request, volleyError); request.notifyListenerResponseNotUsable(); &#125; catch (Exception e) &#123; VolleyLog.e(e, "Unhandled exception %s", e.toString()); VolleyError volleyError = new VolleyError(e); volleyError.setNetworkTimeMs(SystemClock.elapsedRealtime() - startTimeMs); mDelivery.postError(request, volleyError); request.notifyListenerResponseNotUsable(); &#125; finally &#123; request.sendEvent(RequestQueue.RequestEvent.REQUEST_NETWORK_DISPATCH_FINISHED); &#125;&#125; é€šè¿‡NetworkDispatcher.processRequest()æ–¹æ³•å¯ä»¥å‘ç°ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š é€šè¿‡BasicNetwork.performRequest(request)å¾—åˆ°NetworkResponseå¯¹è±¡ï¼› é€šè¿‡request.parseNetworkResponse(networkResponse)è§£æå¾—åˆ°Responseå¯¹è±¡ï¼› é€šè¿‡mDeliveryå°†æˆåŠŸç»“æœæˆ–è€…å¤±è´¥ç»“æœå›è°ƒåˆ°ä¸»çº¿ç¨‹ã€‚ ç°åœ¨æˆ‘ä»¬ä¾æ¬¡æ¥åˆ†æè¿™ä¸‰æ­¥ï¼š è¯·æ±‚ç½‘ç»œï¼Œå¾—åˆ°NetworkResponse æˆ‘ä»¬çœ‹çœ‹BasicNetworkçš„performRequest()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627@Overridepublic NetworkResponse performRequest(Request&lt;?&gt; request) throws VolleyError &#123; long requestStart = SystemClock.elapsedRealtime(); while (true) &#123; HttpResponse httpResponse = null; byte[] responseContents = null; List&lt;Header&gt; responseHeaders = Collections.emptyList(); try &#123; // Gather headers. Map&lt;String, String&gt; additionalRequestHeaders = getCacheHeaders(request.getCacheEntry()); httpResponse = mBaseHttpStack.executeRequest(request, additionalRequestHeaders); int statusCode = httpResponse.getStatusCode(); responseHeaders = httpResponse.getHeaders(); // Handle cache validation. if (statusCode == HttpURLConnection.HTTP_NOT_MODIFIED) &#123; Entry entry = request.getCacheEntry(); if (entry == null) &#123; return new NetworkResponse( HttpURLConnection.HTTP_NOT_MODIFIED, /* data= */ null, /* notModified= */ true, SystemClock.elapsedRealtime() - requestStart, responseHeaders); &#125; â€¦â€¦â€¦â€¦çœç•¥ é€šè¿‡ä¸Šé¢æºç å¯ä»¥çœ‹å‡ºï¼ŒBasicNetworkå°±æ˜¯å°è£…äº†ä¸€ä¸‹NetworkResponseï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥åˆ°BaseHttpStack.executeRequest(request, additionalRequestHeaders)æºç ä¸­ã€‚ 123public abstract HttpResponse executeRequest( Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders) throws IOException, AuthFailureError; è¿™æ—¶å‘ç°è¿™ä¸ªBaseHttpStackå°±æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œè¿™ä¸ªexecuteRequest()ä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚æˆ‘å½“æ—¶å°±å¡åœ¨è¿™äº†ï¼Œè°ƒç”¨äº†ä¸€ä¸ªæŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œè¿™å’‹æ“ä½œå˜›ã€‚ç„¶åæˆ‘å°±å¥½å¥½å†çœ‹äº†ä¸€éï¼Œæ‰¾åˆ°BasicNetworkçš„æ„é€ å‡½æ•°ä¸­å¯¹mBaseHttpStckå®šä¹‰çš„åœ°æ–¹ï¼Œå‘ç°è¿™ä¸ªæ˜¯æ„é€ å‡½æ•°ä¼ è¿›æ¥çš„ï¼Œç„¶åå°±æƒ³åˆ°äº†åœ¨è°ƒç”¨Volley.newRequestQueue()æ—¶ï¼Œæ˜¯æ ¹æ®Androidç‰ˆæœ¬ä¼ å…¥äº†ä¸åŒçš„Stackï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹HurlStack.executeRequest()æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@Overridepublic HttpResponse executeRequest(Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders) throws IOException, AuthFailureError &#123; String url = request.getUrl(); HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;(); map.putAll(additionalHeaders); // request.getheadersï¼ˆï¼‰ä¼˜å…ˆäºç»™å®šçš„é™„åŠ ï¼ˆç¼“å­˜ï¼‰å¤´. map.putAll(request.getHeaders()); if (mUrlRewriter != null) &#123; String rewritten = mUrlRewriter.rewriteUrl(url); if (rewritten == null) &#123; throw new IOException("URL blocked by rewriter: " + url); &#125; url = rewritten; &#125; URL parsedUrl = new URL(url); HttpURLConnection connection = openConnection(parsedUrl, request); boolean keepConnectionOpen = false; try &#123; for (String headerName : map.keySet()) &#123; connection.setRequestProperty(headerName, map.get(headerName)); &#125; setConnectionParametersForRequest(connection, request); // ä½¿ç”¨æ¥è‡ªhttpurlConnectionçš„æ•°æ®åˆå§‹åŒ–httpResponseã€‚ int responseCode = connection.getResponseCode(); if (responseCode == -1) &#123; // å¦‚æœæ— æ³•æ£€ç´¢å“åº”ä»£ç ï¼ŒgetResponseCodeï¼ˆï¼‰å°†è¿”å›-1ã€‚ // å‘å‘¼å«è€…å‘å‡ºä¿¡å·ï¼Œè¯´æ˜è¿æ¥æœ‰é—®é¢˜ã€‚ throw new IOException("Could not retrieve response code from HttpUrlConnection."); &#125; if (!hasResponseBody(request.getMethod(), responseCode)) &#123; return new HttpResponse(responseCode, convertHeaders(connection.getHeaderFields())); &#125; // éœ€è¦ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°è°ƒç”¨æ–¹ä½¿ç”¨æµã€‚åŒ…è£…æµï¼Œä»¥ä¾¿closeï¼ˆï¼‰å°†æ–­å¼€è¿æ¥ã€‚ keepConnectionOpen = true; return new HttpResponse( responseCode, convertHeaders(connection.getHeaderFields()), connection.getContentLength(), new UrlConnectionInputStream(connection)); &#125; finally &#123; if (!keepConnectionOpen) &#123; connection.disconnect(); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦å°±æ˜¯å€ŸåŠ©äº†HttpURLConnectionå¯¹è±¡æ¥è¯·æ±‚ç½‘ç»œï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ¡ä»¶è¿”å›ä¸åŒçš„HttpResponseå¯¹è±¡ã€‚ è§£æNetworkResponse, å¾—åˆ°Responseï¼š è§£æè¿‡ç¨‹æ˜¯å®šä¹‰åœ¨Requestç±»ä¸­ï¼Œä½†æ˜¯ä»–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸åŒçš„Requestéƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œæˆ‘ä»¬ç°åœ¨å°±ä»¥JsonRequestä¸ºä¾‹çœ‹çœ‹ï¼šç„¶åå‘ç°ä»–åˆæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹JsonRequestå…¶ä¸­ä¸€ä¸ªå®ç°ç±»JsonObjectRequestçš„parseNetworkResponse()æ–¹æ³•ï¼š 123456789101112131415@Overrideprotected Response&lt;JSONObject&gt; parseNetworkResponse(NetworkResponse response) &#123; try &#123; String jsonString = new String( response.data, HttpHeaderParser.parseCharset(response.headers, PROTOCOL_CHARSET)); return Response.success( new JSONObject(jsonString), HttpHeaderParser.parseCacheHeaders(response)); &#125; catch (UnsupportedEncodingException e) &#123; return Response.error(new ParseError(e)); &#125; catch (JSONException je) &#123; return Response.error(new ParseError(je)); &#125;&#125; è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ï¼Œæ ¹æ®è¿”å›æ¥çš„responseå»ºäº†ä¸€ä¸ªStringç„¶åæŠŠè¿™ä¸ªStringæ”¾åˆ°Responseé‡Œé¢å»ç„¶åå†è¿”å›å»ã€‚ å›è°ƒä¸»çº¿ç¨‹å›è°ƒä¸»è¦æ˜¯é€šè¿‡Deliveryçš„postResponse()æ–¹æ³•å®ç°çš„ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•,æ‰¾è¿‡å»åˆæ‰¾åˆ°äº†ä¸€ä¸ªResponseDeliveryæŠ½è±¡ç±»ï¼Œç„¶ååˆå¾—æ‰¾ä»–çš„å®ç°ç±»ï¼Œè¿™æ—¶å¤§å®¶åº”è¯¥è®°å¾—RequestQueue()çš„æ—¶å€™åˆå§‹åŒ–äº†ä¸€ä¸ªDeliveryï¼š 1234567public RequestQueue(Cache cache, Network network, int threadPoolSize) &#123; this( cache, network, threadPoolSize, new ExecutorDelivery(new Handler(Looper.getMainLooper())));&#125; ä»–è¿”å›äº†ä¸€ä¸ªExecutorDeliveryï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªç±»ï¼Œç„¶åå°±æƒŠå–œçš„å‘ç°ï¼Œæˆ‘ä»¬ç»ˆäºæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿äº†ï¼š 123456789101112131415/** * Creates a new response delivery interface. * * @param handler &#123;@link Handler&#125; to post responses on */public ExecutorDelivery(final Handler handler) &#123; // Make an Executor that just wraps the handler. mResponsePoster = new Executor() &#123; @Override public void execute(Runnable command) &#123; handler.post(command); &#125; &#125;;&#125; çŸ¥é“äº†å®ƒçš„åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°å›è°ƒçš„ï¼š Volleyä¸­å›è°ƒæ˜¯é€šè¿‡postResponse()æ–¹æ³•çš„ : 12345678910public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response) &#123; postResponse(request, response, null);&#125;@Overridepublic void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response, Runnable runnable) &#123; request.markDelivered(); request.addMarker("post-response"); mResponsePoster.execute(new ResponseDeliveryRunnable(request, response, runnable));&#125; postResponse()æœ€ç»ˆä¼šè°ƒç”¨mResponsePosterå¯¹è±¡çš„execute()æ–¹æ³•ï¼Œä¼ å…¥äº†ä¸€ä¸ªResponseDeliveryRunnableå¯¹è±¡ï¼Œå®ƒå®ç°äº†Runnableæ¥å£ï¼Œexecute()æ–¹æ³•ä¼šé€šè¿‡Handler.post(runnable)å°†ResponseDeliveryRunnableæ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªResponseDeliveryRunnableçš„run()æ–¹æ³•åœ¨ä¸»çº¿ç¨‹ä¸­åšäº†ä»€ä¹ˆæ“ä½œï¼š 12345678910111213141516171819202122232425262728293031@SuppressWarnings("unchecked")@Overridepublic void run() &#123; // If this request has canceled, finish it and don't deliver. if (mRequest.isCanceled()) &#123; mRequest.finish("canceled-at-delivery"); return; &#125; if (mResponse.isSuccess()) &#123; // æ‰§è¡ŒæˆåŠŸçš„å›è°ƒï¼Œåœ¨å…·ä½“çš„Requestå®ç°ç±»ä¸­ï¼Œæ¯”å¦‚StringRequestå°±ä¼šè°ƒç”¨listener.onResponse(string)å›è°ƒ mRequest.deliverResponse(mResponse.result); &#125; else &#123; // æ‰§è¡Œå¤±è´¥çš„å›è°ƒï¼Œåœ¨requestä¸­ï¼Œç›´æ¥å›è°ƒäº†listener.onErrorResponse(error) mRequest.deliverError(mResponse.error); &#125; // intermediateé»˜è®¤ä¸ºfalseï¼Œä½†æ˜¯åœ¨CacheDispatcherçš„run()ä¸­ï¼Œå¦‚æœéœ€è¦æ›´æ–°ç¼“å­˜ï¼Œé‚£ä¹ˆå°±ä¼šç½®ä¸ºtrue if (mResponse.intermediate) &#123; mRequest.addMarker("intermediate-response"); &#125; else &#123; mRequest.finish("done"); &#125; // å¦‚æœä¼ å…¥äº†runnableä¸ä¸ºç©ºï¼Œé‚£å°±å°±æ‰§è¡Œrunnable.run()æ–¹æ³• // å›å¿†ä¸‹åœ¨CacheDispatcherçš„run()æ–¹æ³•ä¸­ï¼Œå¦‚æœrequestæœ‰ç¼“å­˜ï¼Œä½†æ˜¯éœ€è¦æ›´æ–°ç¼“å­˜çš„æ—¶å€™ï¼ŒmDeliveryæ˜¯ä¸æ˜¯è°ƒç”¨çš„å¸¦runnableçš„æ–¹æ³• if (mRunnable != null) &#123; mRunnable.run(); &#125;&#125; 3 è¯·æ±‚æµç¨‹å›¾æœ€åé™„ä¸ŠVolleyçš„è¯·æ±‚æµç¨‹å›¾]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>kotlin</tag>
        <tag>Volley</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ2--è¿›ç¨‹çš„æè¿°å’Œæ§åˆ¶]]></title>
    <url>%2Fposts%2F2e847144.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 [TOC] 2.1 è¿›ç¨‹çš„æè¿°2.1.1 è¿›ç¨‹çš„å®šä¹‰å’Œç‰¹å¾2.1.1.1 è¿›ç¨‹çš„å®šä¹‰ä¸ºäº†èƒ½å¤Ÿä½¿ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥å¯¹å¹¶å‘æ‰§è¡Œçš„ç¨‹åºåŠ ä»¥æè¿°å’Œæ§åˆ¶ï¼Œäººä»¬å¼•å…¥äº†â€œè¿›ç¨‹â€çš„æ¦‚å¿µã€‚ä¸ºäº†ä½¿å‚ä¸å¹¶å‘æ‰§è¡Œçš„æ¯ä¸ªç¨‹åºéƒ½èƒ½ç‹¬ç«‹åœ°è¿è¡Œï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºä¹‹é…ç½®ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç»“æ„ï¼Œç§°ä¸ºè¿›ç¨‹æ•°æ®å—ï¼ˆPCBï¼‰ã€‚ä»–ç”¨æ¥çºªå½•è¿›ç¨‹çš„å„ç§å±æ€§ï¼Œæè¿°è¿›ç¨‹çš„åŠ¨æ€å˜åŒ–è¿‡ç¨‹ã€‚ä¸»è¦åŒ…å«æœ‰è¿›ç¨‹çš„æè¿°ä¿¡æ¯ï¼ˆè¿›ç¨‹æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹åï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹ç»„å…³ç³»ç­‰ï¼‰ã€è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ï¼ˆå½“å‰çŠ¶æ€ï¼Œä¼˜å…ˆçº§ï¼Œä»£ç æ‰§è¡Œå…¥å£åœ°å€ï¼Œä¿å­˜çš„ç£ç›˜åœ°å€ç­‰ç­‰ï¼‰ã€æ‰€æ‹¥æœ‰çš„èµ„æºå’Œä½¿ç”¨æƒ…å†µï¼ˆè™šæ‹Ÿåœ°å€ç©ºé—´çš„çŠ¶æ€ï¼Œæ–‡ä»¶æ‰“å¼€åˆ—è¡¨ç­‰ï¼‰å’ŒCPUç°åœºä¿¡æ¯ç­‰å†…å®¹ã€‚PCBæ˜¯ç³»ç»Ÿæ„ŸçŸ¥è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å®ä½“å°±ç®€ç§°ä¸ºè¿›ç¨‹ï¼Œåˆ›å»ºè¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯åˆ›å»ºè¿›ç¨‹å®ä½“ä¸­çš„PCBï¼›æ’¤é”€è¿›ç¨‹ï¼Œå®è´¨ä¸Šæ˜¯æ’¤é”€è¿›ç¨‹çš„PCBã€‚å¯¹äºè¿›ç¨‹çš„å®šä¹‰ï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰ï¼š è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºåŠå…¶æ•°æ®åœ¨å¤„ç†æœºä¸Šé¡ºåºæ‰§è¡Œæ—¶æ‰€å‘ç”Ÿçš„æ´»åŠ¨ è¿›ç¨‹æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šè¿è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ 2.1.1.2 è¿›ç¨‹çš„ç‰¹å¾ ç»“æ„æ€§è¿›ç¨‹å®ä½“æ˜¯ç”±ç¨‹åºæ®µã€æ•°æ®æ®µåŠè¿›ç¨‹æ§åˆ¶å¿«ä¸‰éƒ¨åˆ†ç»„æˆã€‚ åŠ¨æ€æ€§è¿›ç¨‹çš„å®è´¨æ˜¯è¿›ç¨‹å®ä½“çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè€Œä¸”è¿›ç¨‹â€œç”±åˆ›å»ºè€Œäº§ç”Ÿï¼Œç”±è°ƒåº¦è€Œæ‰§è¡Œï¼Œç”±æ’¤é”€è€Œæ¶ˆäº¡â€ã€‚ å¹¶å‘æ€§å¤šä¸ªè¿›ç¨‹å®ä½“åŒå­˜äºå†…å­˜ä¸­ï¼Œä¸”èƒ½åœ¨ä¸€æ®µæ—¶é—´å†…åŒæ—¶è¿è¡Œã€‚ ç‹¬ç«‹æ€§è¿›ç¨‹å®ä½“æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹è·å¾—èµ„æºå’Œç‹¬ç«‹æ¥æ”¶è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚ å¼‚æ­¥æ€§è¿›ç¨‹æ˜¯æŒ‰å¼‚æ­¥æ–¹å¼è¿è¡Œçš„ã€‚ 2.1.2 è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€åŠè½¬æ¢2.1.2.1 è¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€è¿›ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼š è¿è¡Œæ€æŒ‡è¿›ç¨‹å·²ç»è·å¾—äº†CPUï¼Œä»–æ­£åœ¨CPUä¸Šæ‰§è¡Œã€‚ å°±ç»ªæ€æŒ‡è¿›ç¨‹å·²ç»å‡†å¤‡å°±ç»ªï¼Œå‡†å¤‡å¥½äº†è¢«CPUæ‰§è¡Œçš„çŠ¶æ€ã€‚å¦‚æœç³»ç»Ÿä¸­æœ‰å¾ˆå¤šå¤„äºå°±ç»ªæ€çš„è¿›ç¨‹ï¼Œé€šå¸¸æŠŠä»–ä»¬æŒ‰ä¸€å®šçš„ç­–ç•¥æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ç§°ä¸ºå°±ç»ªé˜Ÿåˆ—ã€‚ ç­‰å¾…æ€æŒ‡æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ç”±äºå‘ç”ŸæŸäº‹ä»¶ï¼ˆå¦‚I/Oè¯·æ±‚ã€ç”³è¯·ç¼“å†²åŒºå¤±è´¥ç­‰é—®é¢˜ï¼‰æš‚æ—¶æ— æ³•ç»§ç»­æ‰§è¡Œæ—¶çš„çŠ¶æ€ã€‚æ­¤æ—¶å¼•èµ·è¿›ç¨‹è°ƒåº¦ï¼ŒOSæŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªä¸­çš„è¿›ç¨‹ï¼Œè®©å—é˜»çš„è¿›ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚ 2.1.2.2 ä¸‰ç§çŠ¶æ€çš„è½¬æ¢ 2.1.2.3 åˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ä¸ºäº†æ»¡è¶³è¿›ç¨‹æ§åˆ¶å—å¯¹æ•°æ®åŠæ“ä½œçš„å®Œæ•´æ€§è¦æ±‚ä»¥åŠå¢å¼ºç®¡ç†çš„çµæ´»æ€§ï¼Œé€šå¸¸åœ¨ç³»ç»Ÿä¸­åˆä¸ºè¿›ç¨‹å¼•å…¥äº†ä¸¤ç§å¸¸è§çš„çŠ¶æ€ï¼šåˆ›å»ºçŠ¶æ€å’Œç»ˆæ­¢çŠ¶æ€ã€‚ 2.1.3 è¿›ç¨‹ç®¡ç†ä¸­çš„æ•°æ®ç»“æ„åœ¨æœ€å¼€å§‹æˆ‘å·²ç»ç»æåˆ°äº†è¿›ç¨‹æ§åˆ¶å—PCBè¿™ä¸ªä¸œè¥¿ï¼Œç°åœ¨æˆ‘ä»¬å°±è¿›ä¸€æ­¥æ¥äº†è§£ä»–ã€‚ 2.1.3.1 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä½œç”¨PCBçš„ä½œç”¨ä¸»è¦å°±æ˜¯ä½¿ä¸€ä¸ªåœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ä¸èƒ½ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºç§°ä¸ºä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªèƒ½ä¸å…¶å®ƒè¿›ç¨‹å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹ã€‚ ä½œä¸ºç‹¬ç«‹è¿è¡ŒåŸºæœ¬å•ä½çš„æ ‡å¿—ã€‚ å½“ä¸€ä¸ªç¨‹åºé…ç½®äº†PCBä¹‹åï¼Œå°±è¡¨ç¤ºä»–å·²æ˜¯ä¸€ä¸ªèƒ½åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ç‹¬ç«‹è¿è¡Œçš„ã€åˆæ³•çš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±å…·æœ‰å–å¾—OSæœåŠ¡çš„æƒåˆ©ã€‚å½“ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹çš„æ—¶å€™ï¼Œå°±ä¸ºä»–åˆ›å»ºäº†ä¸€ä¸ªPCBï¼Œè¿›ç¨‹ç»“æŸåæ”¶å›PCBã€‚ èƒ½å®ç°é—´æ–­æ€§è¿è¡Œæ–¹å¼ã€‚ åœ¨å¤šé“ç¨‹åºè¿è¡Œç¯å¢ƒä¸‹ï¼Œç”±äºå­˜åœ¨æ—¶é—´ç‰‡æˆ–è€…æœ‰ç­‰å¾…I/Oè¯·æ±‚çš„æƒ…å†µï¼Œæ‰€ä»¥è¿›ç¨‹ä¸€èˆ¬éƒ½æ˜¯å‡ºäºèµ°èµ°åœåœçš„çŠ¶æ€ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è¢«é˜»å¡çš„æ—¶å€™ï¼Œä»–åº”è¯¥æœ‰ä¸€ç§èƒ½ä¿å­˜å½“å‰è¿è¡ŒçŠ¶æ€çš„èƒ½åŠ›ä¹Ÿå°±æ˜¯ä¿æŠ¤ç°åœºæœºåˆ¶ï¼Œæ–¹ä¾¿åœ¨æ­¤è¢«è°ƒåº¦æ‰§è¡Œæ—¶æ¢å¤é˜»å¡å‰çš„çŠ¶æ€ã€‚æ‰€ä»¥å°±éœ€è¦åœ¨PCBé‡Œé¢æä¾›ä¸€ä¸ªæ•°æ®ç»“æ„æ¥ä¿å­˜è¯¥è¿›ç¨‹è¢«ä¸­æ–­æ—¶çš„ä¸€äº›ä¿¡æ¯ã€‚ æä¾›è¿›ç¨‹ç®¡ç†æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´å§ã€‚ æä¾›è¿›ç¨‹è°ƒåº¦æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ åªæœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œï¼Œè€Œåœ¨PCBä¸­å°±æä¾›äº†è¿›ç¨‹å¤„äºä½•ç§çŠ¶æ€çš„ä¿¡æ¯ã€‚ å®ç°ä¸å…¶å®ƒè¿›ç¨‹çš„åŒæ­¥ä¸é€šä¿¡ã€‚ 2.1.3.2 è¿›ç¨‹æ§åˆ¶å—ä¸­çš„ä¿¡æ¯æ ¹æ®ä¸Šé¢è¿›ç¨‹æ§åˆ¶å—ä½œç”¨çš„æè¿°ï¼Œå¯¹åº”çš„è¿›ç¨‹æ§åˆ¶å—ä¸­å°±éœ€è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ã€‚ è¿›ç¨‹æ ‡è¯†ç¬¦ è¿›ç¨‹æ ‡è¯†ç¬¦ç”¨äºå”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹é€šå¸¸å…·æœ‰ä¸¤ç§æ ‡è¯†ç¬¦ï¼š å¤–éƒ¨æ ‡è¯†ç¬¦ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰å¯¹è¿›ç¨‹çš„è®¿é—®ï¼Œè¿›ç¨‹éœ€è¦æä¾›ä¸€ä¸ªç”¨äºç”¨æˆ·ï¼ˆè¿›ç¨‹ï¼‰è®¿é—®çš„æ ‡è¯†ç¬¦ã€‚ å†…éƒ¨æ ‡è¯†ç¬¦ ä¸ºäº†æ–¹ä¾¿ç³»ç»Ÿå¯¹è¿›ç¨‹çš„ä½¿ç”¨ï¼Œåœ¨OSä¸­åˆä¸ºè¿›ç¨‹è®¾ç½®äº†å†…éƒ¨æ ‡è¯†ç¬¦ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„åºå·ã€‚ å¤„ç†æœºçŠ¶æ€ å¤„ç†æœºçŠ¶æ€ä¿¡æ¯ä¹Ÿç§°ä¸ºå¤„ç†æœºçš„ä¸Šä¸‹æ–‡ï¼Œä¸»è¦æ˜¯ç”±å¤„ç†æœºçš„å„ç§å¯„å­˜å™¨ä¸­çš„å†…å®¹ç»„æˆçš„ã€‚è¿™äº›å¯„å­˜å™¨ä¿¡æ¯åŒ…æ‹¬é€šç”¨å¯„å­˜å™¨ã€æŒ‡ä»¤å¯„å­˜å™¨ã€ç¨‹åºçŠ¶æ€å­—PSWå’Œç”¨æˆ·æ ˆæŒ‡é’ˆã€‚ è¿›ç¨‹è°ƒåº¦ä¿¡æ¯ åœ¨OSè¿›è¡Œè°ƒåº¦çš„æ—¶å€™ï¼Œå¿…é¡»äº†è§£è¿›ç¨‹çš„çŠ¶æ€åŠæœ‰å…³è¿›ç¨‹è°ƒåº¦çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼šè¿›ç¨‹çŠ¶æ€ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹è°ƒåº¦æ‰€éœ€å…¶ä»–ä¿¡æ¯ï¼ˆä¸æ‰€é‡‡ç”¨çš„çš„è°ƒåº¦ç®—æ³•æœ‰å…³ï¼‰å’Œäº‹ä»¶ï¼ˆé˜»å¡åŸå› ï¼‰ã€‚ è¿›ç¨‹æ§åˆ¶ä¿¡æ¯ ç”¨äºè¿›ç¨‹æ§åˆ¶æ‰€å¿…é¡»çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç¨‹åºå’Œæ•°æ®çš„åœ°å€ã€è¿›ç¨‹åŒæ­¥å’Œé€šä¿¡æœºåˆ¶ã€èµ„æºæ¸…å•å’Œé“¾æ¥æŒ‡é’ˆã€‚ 2.1.3.3 è¿›ç¨‹æ§åˆ¶å—çš„ç»„ç»‡æ–¹å¼ä¸€ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šä¸ªPCBï¼Œä¸ºäº†å¯¹ä»–ä»¬è¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ï¼Œåº”è¯¥ç”¨é€‚å½“çš„æ–¹å¼å°†è¿™äº›PCBç»„ç»‡èµ·æ¥ï¼Œå¸¸ç”¨çš„ç»„ç»‡æ–¹å¼æœ‰ä¸‰ç§ çº¿æ€§æ–¹å¼ç›´æ¥å°†æ‰€æœ‰PCBæ”¾åœ¨ä¸€å¼ çº¿æ€§è¡¨ä¸­ï¼Œä¼˜ç‚¹æ˜¯ç®€å•ï¼Œå¼€é”€å°ï¼Œä½†æ˜¯æ¯æ¬¡æŸ¥æ‰¾èµ·æ¥å¾ˆéº»çƒ¦ã€‚ é“¾æ¥æ–¹å¼æŠŠå…·æœ‰ç›¸åŒçŠ¶æ€çš„PCBåˆ†åˆ«é€šè¿‡PCBä¸­çš„é“¾æ¥å­—é“¾æ¥æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ ç´¢å¼•æ–¹å¼æ ¹æ®æ‰€æœ‰è¿›ç¨‹çŠ¶æ€çš„ä¸åŒå»ºç«‹å‡ å¼ ç´¢å¼•è¡¨ï¼Œå¹¶æŠŠä¸ªç´¢å¼•è¡¨åœ¨å†…å­˜çš„é¦–åœ°å€çºªå½•åœ¨å†…å­˜çš„ä¸€äº›ä¸“ç”¨å•å…ƒä¸­ã€‚ 2.2 è¿›ç¨‹æ§åˆ¶2.2.1 è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„åœ¨OSä¸­ï¼Œå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šå¸¸æŠŠåˆ›å»ºè¿›ç¨‹çš„è¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œè¢«åˆ›å»ºçš„è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚ç„¶åå­è¿›ç¨‹å¯ä»¥ä½œä¸ºçˆ¶è¿›ç¨‹ç»§ç»­å»åˆ›å»ºå­è¿›ç¨‹ï¼Œè¿›è€Œå½¢æˆä¸€ä¸ªè¿›ç¨‹å®¶æ—ã€‚ 2.2.2 è¿›ç¨‹çš„åˆ›å»ºæ¯å½“å‡ºç°äº†åˆ›å»ºæ–°è¿›ç¨‹çš„è¯·æ±‚åï¼ŒOSä¾¿è°ƒç”¨è¿›ç¨‹åˆ›å»ºåŸè¯­CreatæŒ‰ä¸‹è¿°æ­¥éª¤åˆ›å»ºæ–°è¿›ç¨‹ï¼š ç”³è¯·ç©ºç™½PCBï¼Œä¸ºæ–°è¿›ç¨‹ç”³è¯·è·å¾—å”¯ä¸€çš„æ•°å­—æ ‡è¯†ç¬¦ï¼Œå¹¶ä»PCBé›†åˆä¸­ç´¢å–ä¸€ä¸ªç©ºç™½PCBã€‚ ä¸ºæ–°è¿›ç¨‹åˆ†é…å…¶è¿è¡Œæ‰€éœ€çš„èµ„æºï¼ŒåŒ…æ‹¬å„ç§ç‰©ç†å’Œé€»è¾‘èµ„æºã€‚ åˆå§‹åŒ–è¿›ç¨‹æ§åˆ¶å—PCBã€‚ å¦‚æœè¿›ç¨‹å°±ç»ªé˜Ÿåˆ—èƒ½å¤Ÿæ¥çº³æ–°è¿›ç¨‹ï¼Œä¾¿å°†æ–°è¿›ç¨‹æ’å…¥å°±ç»ªé˜Ÿåˆ—ã€‚ 2.2.3 è¿›ç¨‹çš„ç»ˆæ­¢ æ ¹æ®è¢«ç»ˆæ­¢è¿›ç¨‹çš„æ ‡è¯†ç¬¦ï¼Œä»PCBé›†åˆä¸­æ£€ç´¢å‡ºè¿›ç¨‹çš„PCBï¼Œä»ä¸­è¯»å‡ºè¯¥è¿›ç¨‹çš„çŠ¶æ€ã€‚ è‹¥è¢«ç»ˆæ­¢è¿›ç¨‹æ­£å¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåº”ç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶ç½®è°ƒåº¦æ ‡å¿—ä½çœŸï¼Œç”¨äºæŒ‡ç¤ºè¯¥è¿›ç¨‹è¢«ç»ˆæ­¢ååº”é‡æ–°è¿›è¡Œè°ƒåº¦ã€‚ è‹¥è¯¥è¿›ç¨‹è¿˜æœ‰å­å­™è¿›ç¨‹ï¼Œè¿˜åº”å°†å…¶æ‰€æœ‰å­å­™è¿›ç¨‹ä¹Ÿéƒ½äºˆä»¥ç»ˆæ­¢ï¼Œä»¥é˜²å®ƒä»¬ç§°ä¸ºä¸å¯æ§çš„è¿›ç¨‹ã€‚ å°†è¢«ç»ˆæ­¢è¿›ç¨‹æ‰€æ‹¥æœ‰çš„çš„å…¨éƒ¨èµ„æºæˆ–è€…å½’è¿˜ç»™å…¶çˆ¶è¿›ç¨‹ï¼Œæˆ–è€…å½’è¿˜ç»™ç³»ç»Ÿã€‚ å°†è¢«ç»ˆæ­¢è¿›ç¨‹ï¼ˆPCBï¼‰ä»æ‰€åœ¨é˜Ÿåˆ—ï¼ˆæˆ–é“¾è¡¨ï¼‰ä¸­ç§»å‡ºï¼Œç­‰å¾…å…¶ä»–ç¨‹åºæ¥æœé›†ä¿¡æ¯ã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ“ä½œç³»ç»Ÿ1--æ“ä½œç³»ç»Ÿæ¦‚è¿°]]></title>
    <url>%2Fposts%2F62248b34.html</url>
    <content type="text"><![CDATA[å¤§å®¶å¯ä»¥çœ‹ä¸‹æˆ‘ä½¿ç”¨å¹•å¸ƒè½¯ä»¶ç”»çš„æ€ç»´å¯¼å›¾ï¼Œå¦‚æœå¤§å®¶æƒ³ä½¿ç”¨å¹•å¸ƒå¯ä»¥é€šè¿‡æˆ‘çš„é‚€è¯·é“¾æ¥æ³¨å†Œï¼Œå¯å…è´¹è·å¾—ä¸€ä¸ªæœˆé«˜çº§ä¼šå‘˜https://mubu.com/inv/477598 ç°å¦‚ä»Šä¸»æµçš„æ“ä½œç³»ç»Ÿ1.1.1 PC1.1.1.1 WindowsMicrosoft Windowsæ˜¯å¾®è½¯å…¬å¸æ¨å‡ºçš„ä¸€ç³»åˆ—æ“ä½œç³»ç»Ÿã€‚å…¶é—®ä¸–æ—¶é—´ä¸º1985å¹´ï¼Œèµ·åˆä¸ºè¿è¡ŒäºMS-DOSä¹‹ä¸‹çš„æ¡Œé¢ç¯å¢ƒï¼Œå…¶åç»­ç‰ˆæœ¬é€æ¸å‘å±•æˆä¸ºä¸»è¦ä¸ºä¸ªäººè®¡ç®—æœºå’ŒæœåŠ¡å™¨ç”¨æˆ·è®¾è®¡çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶æœ€ç»ˆè·å¾—äº†ä¸–ç•Œä¸ªäººè®¡ç®—æœºæ“ä½œç³»ç»Ÿçš„å„æ–­åœ°ä½ã€‚æ­¤æ“ä½œç³»ç»Ÿå¯ä»¥åœ¨å‡ ç§ä¸åŒç±»å‹çš„å¹³å°ä¸Šè¿è¡Œï¼Œå¦‚ä¸ªäººè®¡ç®—æœºã€ç§»åŠ¨è®¾å¤‡ã€æœåŠ¡å™¨å’ŒåµŒå…¥å¼ç³»ç»Ÿç­‰ç­‰ï¼Œå…¶ä¸­åœ¨ä¸ªäººè®¡ç®—æœºçš„é¢†åŸŸåº”ç”¨å†…æœ€ä¸ºæ™®éã€‚Windowsæ“ä½œç³»ç»Ÿå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯äº2015å¹´7æœˆ29æ—¥å‘å¸ƒçš„ Windows 10ã€‚Windows Serverå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´10æœˆ2æ—¥å‘å¸ƒçš„Windows Server 2019ã€‚Windows Phoneå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯Windows10 Mobileï¼Œä½†æ˜¯å·²åœæ­¢å¼€å‘æ–°ç‰ˆæœ¬ï¼Œä»…å¯¹ç°æœ‰ç‰ˆæœ¬è¿›è¡Œå®‰å…¨è¡¥ä¸å’Œç»´æŠ¤ï¼Œç›´åˆ°2019å¹´12æœˆã€‚ 1.1.1.2 macOSmacOSï¼ˆ2011å¹´åŠä¹‹å‰ç§°Mac OS Xï¼Œ2012å¹´è‡³2015å¹´ç§°OS Xï¼‰æ˜¯è‹¹æœå…¬å¸æ¨å‡ºçš„åŸºäºå›¾å½¢ç”¨æˆ·ç•Œé¢æ“ä½œç³»ç»Ÿï¼Œä¸ºéº¦é‡‘å¡”ï¼ˆMacintoshï¼‰çš„ä¸»æ“ä½œç³»ç»Ÿã€‚StatCounteråœ¨2018å¹´8æœˆçš„æ•°æ®è¡¨ç¤ºï¼Œåœ¨æ¡Œé¢æ“ä½œç³»ç»Ÿä¸­ï¼ŒmacOSçš„ä½¿ç”¨ä»½é¢ä¸º12.65%ï¼Œæ¬¡äºWindowsçš„82.51%ä½å±…ç¬¬äºŒã€‚macOSå½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæ˜¯2018å¹´9æœˆ25æ—¥å‘å¸ƒçš„macOS 10.14 Mojaveï¼Œ2019å¹´6æœˆ4æ—¥æ¨å‡ºmacOS 10.15 Catalinaçš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç‰ˆæœ¬ã€‚ 1.1.1.3 LinuxLinuxæ˜¯ä¸€ç§è‡ªç”±å’Œå¼€æ”¾æºç çš„ç±»UNIX æ“ä½œç³»ç»Ÿã€‚è¯¥æ“ä½œç³»ç»Ÿçš„å†…æ ¸ç”±æ—çº³æ–¯Â·æ‰˜ç“¦å…¹åœ¨1991å¹´10æœˆ5æ—¥é¦–æ¬¡å‘å¸ƒï¼Œåœ¨åŠ ä¸Šç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºä¹‹åï¼Œæˆä¸º Linux æ“ä½œç³»ç»Ÿã€‚Linuxä¹Ÿæ˜¯è‡ªç”±è½¯ä»¶å’Œå¼€æ”¾æºä»£ç è½¯ä»¶å‘å±•ä¸­æœ€è‘—åçš„ä¾‹å­ã€‚åªè¦éµå¾ª GNU é€šç”¨å…¬å…±è®¸å¯è¯ï¼ˆGPLï¼‰ï¼Œä»»ä½•ä¸ªäººå’Œæœºæ„éƒ½å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ Linux çš„æ‰€æœ‰åº•å±‚æºä»£ç ï¼Œä¹Ÿå¯ä»¥è‡ªç”±åœ°ä¿®æ”¹å’Œå†å‘å¸ƒã€‚å¤§å¤šæ•° Linux ç³»ç»Ÿè¿˜åŒ…æ‹¬åƒæä¾› GUI çš„ X Window ä¹‹ç±»çš„ç¨‹åºã€‚é™¤äº†ä¸€éƒ¨åˆ†ä¸“å®¶ä¹‹å¤–ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ç›´æ¥ä½¿ç”¨ Linux å‘è¡Œç‰ˆï¼Œè€Œä¸æ˜¯è‡ªå·±é€‰æ‹©æ¯ä¸€æ ·ç»„ä»¶æˆ–è‡ªè¡Œè®¾ç½®ã€‚ 1.1.1.4 UnixUNIXæ“ä½œç³»ç»Ÿï¼ˆå°¤å°¼æ–¯ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼ŒæŒ‰ç…§æ“ä½œç³»ç»Ÿçš„åˆ†ç±»ï¼Œå±äºåˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œæœ€æ—©ç”±KenThompsonã€Dennis Ritchieå’ŒDouglas McIlroyäº1969å¹´åœ¨AT&amp;Tçš„è´å°”å®éªŒå®¤å¼€å‘ã€‚å®ƒçš„å•†æ ‡æƒç”±å›½é™…å¼€æ”¾æ ‡å‡†ç»„ç»‡æ‰€æ‹¥æœ‰ï¼Œåªæœ‰ç¬¦åˆå•ä¸€UNIXè§„èŒƒçš„UNIXç³»ç»Ÿæ‰èƒ½ä½¿ç”¨UNIXè¿™ä¸ªåç§°ï¼Œå¦åˆ™åªèƒ½ç§°ä¸ºç±»UNIXï¼ˆUNIX-likeï¼‰ã€‚ 1.1.2 ç§»åŠ¨ç«¯1.1.2.1 AndroidAndroidï¼Œå¸¸è§çš„éå®˜æ–¹ä¸­æ–‡åç§°ä¸ºå®‰å“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºLinuxå†…æ ¸çš„å¼€æ”¾æºä»£ç ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œç”±Googleæˆç«‹çš„Open Handset AllianceæŒç»­é¢†å¯¼ä¸å¼€å‘ï¼Œä¸»è¦è®¾è®¡ç”¨äºè§¦æ‘¸å±ç§»åŠ¨è®¾å¤‡å¦‚æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘ä¸å…¶ä»–ä¾¿æºå¼è®¾å¤‡ã€‚Android Inc.äº2003å¹´10æœˆç”±å®‰è¿ªÂ·é²å®¾ã€åˆ©å¥‡Â·ç±³çº³å°”ã€å°¼å…‹Â·å¸­å°”æ–¯ã€å…‹é‡Œæ–¯Â·æ€€ç‰¹åœ¨åŠ å·å¸•ç½—å¥¥å›¾åˆ›å»ºã€‚Androidæœ€åˆç”±å®‰è¿ªÂ·é²å®¾ç­‰äººå¼€å‘åˆ¶ä½œï¼Œæœ€åˆå¼€å‘è¿™ä¸ªç³»ç»Ÿçš„æ—©æœŸæ–¹å‘æ˜¯åˆ›å»ºä¸€ä¸ªæ•°å­—ç›¸æœºçš„å…ˆè¿›æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯åæ¥å‘ç°å¸‚åœºéœ€æ±‚ä¸å¤Ÿå¤§ï¼ŒåŠ ä¸Šæ™ºèƒ½æ‰‹æœºå¸‚åœºå¿«é€Ÿæˆé•¿ï¼Œäºæ˜¯Androidæˆä¸ºä¸€æ¬¾é¢å‘æ™ºèƒ½æ‰‹æœºçš„æ“ä½œç³»ç»Ÿã€‚äº2005å¹´7æœˆ11æ—¥Android Inc.è¢«ç¾å›½ç§‘æŠ€ä¼ä¸šGoogleæ”¶è´­ã€‚2017å¹´3æœˆï¼ŒAndroidå…¨çƒç½‘ç»œæµé‡å’Œè®¾å¤‡è¶…è¶ŠMicrosoft Windowsï¼Œæ­£å¼æˆä¸ºå…¨çƒç¬¬ä¸€å¤§æ“ä½œç³»ç»Ÿã€‚ 1.1.2.2 iOSiOSï¼ˆåŸåä¸ºiPhone OSï¼‰æ˜¯è‹¹æœå…¬å¸ä¸ºå…¶ç§»åŠ¨è®¾å¤‡æ‰€å¼€å‘çš„ä¸“æœ‰ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œä¸ºå…¶å…¬å¸çš„è®¸å¤šç§»åŠ¨è®¾å¤‡æä¾›æ“ä½œç•Œé¢ï¼Œæ”¯æŒè®¾å¤‡åŒ…æ‹¬iPhoneã€iPadå’ŒiPod touchã€‚iPhone OSè‡ªiOS 4èµ·ä¾¿æ”¹åä¸ºiOSï¼Œå®ƒæ˜¯ç»§Androidåå…¨çƒç¬¬äºŒå¤§æœ€å—æ¬¢è¿çš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œå¸‚å ç‡å·²ä¸Šå‡è‡³çº¦24.5% ï¼Œä½†ä»è¿œä½äºGoogleå¼€å‘çš„Androidç³»ç»Ÿçš„72.2%ã€‚ 1.2 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹ä¸ä½œç”¨1.2.1 æ“ä½œç³»ç»Ÿçš„ç®€ä»‹æ“ä½œç³»ç»Ÿæ˜¯é…ç½®åœ¨è®¡ç®—æœºç¡¬ä»¶ä¸Šçš„ç¬¬ä¸€å±‚è½¯ä»¶ï¼Œæ˜¯å¯¹ç¡¬ä»¶ç³»ç»Ÿçš„é¦–æ¬¡æ‰©å……ã€‚ä¸»è¦ä½œç”¨æ˜¯å¯¹ç®¡ç†å¥½è®¡ç®—æœºç¡¬ä»¶è®¾å¤‡ï¼Œæé«˜ä»–ä»¬çš„åˆ©ç”¨ç‡å’Œç³»ç»Ÿçš„ååé‡ï¼Œå¹¶ä¸ºç”¨æˆ·å’Œåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªç®€å•æ¥å£ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ã€‚ 1.2.2 æ“ä½œç³»ç»Ÿçš„ç›®çš„ æ–¹ä¾¿æ€§ å¦‚æœä¸€ä¸ªè®¡ç®—æœºæ²¡æœ‰OSï¼Œé‚£ä¹ˆä»–ä¼šéå¸¸éš¾ç”¨ã€‚ç”¨æˆ·ä¸ç®¡è¿›è¡Œå•¥æ“ä½œéƒ½å¾—é€šè¿‡æœºå™¨è¯­è¨€ç¼–å†™ç¨‹åºç„¶åè¿è¡Œï¼Œè€Œå¦‚æœæœ‰OSçš„è¯ï¼Œç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨å„ç§å„æ ·çš„è¯­è¨€ç¼–å†™ç¨‹åºï¼Œç„¶åé€šè¿‡ç¼–è¯‘å°†é«˜çº§è¯­è¨€ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œæ–¹ä¾¿äº†ç”¨æˆ·ã€‚ æœ‰æ•ˆæ€§ æœ‰æ•ˆæ€§åˆ†ä¸¤å±‚å«ä¹‰â€”â€”æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚æ—©æœŸæ²¡æœ‰OSçš„è®¡ç®—æœºä¸­ï¼Œå¤„ç†æœºå’ŒI/Oè®¾å¤‡ç­‰ç»å¸¸å¤„äºç©ºé—²çŠ¶æ€ï¼Œå„ç§èµ„æºä¸èƒ½å¾—åˆ°åˆç†åˆ©ç”¨ï¼Œæ‰€ä»¥æé«˜ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡æ˜¯æ¨åŠ¨OSå‘å±•çš„ä¸»è¦åŠ¨åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼ŒOSå¯ä»¥é€šè¿‡åˆç†ç»„ç»‡è®¡ç®—æœºçš„å·¥ä½œæµç¨‹ï¼ŒåŠ é€Ÿç¨‹åºçš„è¿è¡Œï¼Œç¼©çŸ­ç¨‹åºçš„è¿è¡Œå‘¨æœŸï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚ å¯æ‰©å……æ€§ ä¸ºäº†é€‚åº”ç°åœ¨è¶Šæ¥è¶Šå¤šçš„è®¡ç®—æœºç¡¬ä»¶ä»¥åŠä½“ç³»ç»“æ„ï¼ŒOSå¿…ä¿®æœ‰è‰¯å¥½çš„å¯æ‰©å……æ€§ã€‚ å¼€æ”¾æ€§ OSéœ€è¦éµå¾ªä¸–ç•Œæ ‡å‡†è§„èŒƒï¼Œå‡¡éµå¾ªå›½é™…æ ‡å‡†æ‰€å¼€å‘çš„ç¡¬ä»¶å’Œè½¯ä»¶éƒ½èƒ½å½¼æ­¤å…¼å®¹ï¼Œæ–¹ä¾¿åœ°å®ç°äº’è”ã€‚ 1.2.3 æ“ä½œç³»ç»Ÿçš„ä½œç”¨ OSä½œä¸ºç”¨æˆ·ä¸è®¡ç®—æœºç¡¬ä»¶ç³»ç»Ÿä¹‹é—´çš„æ¥å£ OSå¤„äºç”¨æˆ·å’Œç¡¬ä»¶ä¹‹é—´ï¼Œæ–¹ä¾¿ç”¨æˆ·é€šè¿‡OSä½¿ç”¨ç¡¬ä»¶ã€‚æˆ–è€…è¯´ï¼Œç”¨æˆ·åœ¨OSçš„å¸®åŠ©ä¸‹èƒ½å¤Ÿæ–¹ä¾¿ã€å¿«æ·ã€å¯é åœ°æ“çºµè®¡ç®—æœºç¡¬ä»¶å’Œè¿è¡Œè‡ªå·±çš„ç¨‹åºã€‚ OSä½œä¸ºè®¡ç®—æœºç³»ç»Ÿèµ„æºçš„ç®¡ç†è€… è®¡ç®—æœºç³»ç»Ÿèµ„æºä¸»è¦å¯åˆ†ä¸ºå¤„ç†æœºã€å­˜å‚¨å™¨ã€I/Oè®¾å¤‡ä»¥åŠæ–‡ä»¶ã€‚OSä¸»è¦åŠŸèƒ½ä¹Ÿå°±æ˜¯å¯¹è¿™å››ç±»èµ„æºè¿›è¡Œæœ‰æ•ˆçš„ç®¡ç†ã€‚å¤„ç†æœºç®¡ç†æ˜¯ç”¨äºåˆ†é…å’Œæ§åˆ¶å¤„ç†æœºï¼›å­˜å‚¨å™¨ç®¡ç†ä¸»è¦è´Ÿè´£å†…å­˜çš„åˆ†é…ä¸å›æ”¶ï¼›I/Oè®¾å¤‡ç®¡ç†æ˜¯è´Ÿè´£I/Oè®¾å¤‡çš„åˆ†é…ä¸æ“çºµï¼›æ–‡ä»¶ç®¡ç†æ˜¯ç”¨äºå®ç°å¯¹æ–‡ä»¶çš„å­˜å–ã€å…±äº«å’Œä¿æŠ¤ã€‚ OSå®ç°äº†å¯¹è®¡ç®—æœºèµ„æºçš„æŠ½è±¡ åœ¨è£¸æœºä¸­ï¼Œç”¨æˆ·å¦‚æœæƒ³è¦å¯¹è®¡ç®—å™¨è¿›è¡Œæ“ä½œï¼Œå¿…é¡»å¯¹ç‰©ç†æ¥å£çš„å®ç°ç»†èŠ‚æœ‰å……åˆ†çš„äº†è§£ã€‚ä½†åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„ç‰©ç†ï¼Œè€Œç”±æ“ä½œç³»ç»Ÿæ¥å®ç°å…·ä½“çš„æ“ä½œç»†èŠ‚ï¼Œå¹¶å‘ä¸Šè®²æ“ä½œè®¾å¤‡æŠ½è±¡ä¸ºä¸€ç»„æ•°æ®ç»“æ„ä»¥åŠä¸€ç»„æ“ä½œå‘½ä»¤ã€‚æ­¤æ—¶åœ¨ç”¨æˆ·çœ¼é‡Œï¼Œçœ‹åˆ°çš„æ˜¯ä¸€å°æ¯”è£¸æœºåŠŸèƒ½æ›´å¼ºï¼Œä½¿ç”¨æ›´æ–¹ä¾¿çš„æœºå™¨ã€‚ 1.2.4 æ¨åŠ¨æ“ä½œç³»ç»Ÿå‘å±•çš„ä¸»è¦åŠ¨åŠ› ä¸æ–­æé«˜è®¡ç®—æœºèµ„æºåˆ©ç”¨ç‡ æ–¹ä¾¿ç”¨æˆ· å™¨ä»¶çš„ä¸æ–­æ›´æ–°æ¢ä»£ è®¡ç®—æœºä½“ç³»ç»“æ„çš„ä¸æ–­å‘å±• ä¸æ–­æå‡ºæ–°çš„åº”ç”¨éœ€æ±‚ 1.3 æ“ä½œç³»ç»Ÿçš„å‘å±•1.3.1 å•é“æ‰¹å¤„ç†ç³»ç»Ÿåœ¨è¯´å•é“æ‰¹å¤„ç†ä¹‹å‰ç°è¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µâ€”â€”ä½œä¸šã€‚ä½œä¸šåŒ…æ‹¬ç”¨æˆ·ç¨‹åºã€æ•°æ®ã€ä½œä¸šè¯´æ˜ä¹¦ã€‚è¿™æ ·æ¯ä¸€ä¸ªå¤„ç†å¯¹è±¡éƒ½æ˜¯ä½œä¸šã€‚ 1. å¤„ç†è¿‡ç¨‹æ¯ä¸ªå•é“æ‰¹å¤„ç†ç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªç³»ç»Ÿæ“ä½œå‘˜ã€‚ç”¨æˆ·å…ˆå°†ä½œä¸šäº¤ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œç„¶åæ“ä½œç³»ç»Ÿæ“ä½œå‘˜å°±å°†ä¸€ä¸ªä¸ªä½œä¸šç»„æˆä¸€æ‰¹ä½œä¸šï¼Œè¾“å…¥åˆ°è®¡ç®—æœºä¸­ï¼Œåœ¨ç³»ç»Ÿä¸­å½¢æˆä¸€ä¸ªè‡ªåŠ¨è½¬æ¥çš„ä½œä¸šæµï¼Œç„¶åå¯åŠ¨æ“ä½œç³»ç»Ÿå¯¹ä½œä¸šè‡ªåŠ¨ã€ä¾æ¬¡çš„å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†å°†å¤„ç†ç»“æœè¿”å›ç»™ç³»ç»Ÿæ“ä½œå‘˜ï¼Œæ“ä½œå‘˜åœ¨è¿”å›ç»™ç”¨æˆ·ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå•é“æ‰¹å¤„ç†è¿‡ç¨‹ã€‚ 2. ç¼ºç‚¹ç³»ç»Ÿèµ„æºå¾—ä¸åˆ°å……åˆ†åˆ©ç”¨ã€‚è¿™æ˜¯å› ä¸ºåœ¨å†…å­˜ä¸­ä»…æœ‰ä¸€é“ç¨‹åºï¼Œæ¯é€¢ç¨‹åºåœ¨è¿è¡Œä¸­å‘å‡ºI/Oè¯·æ±‚åï¼ŒCPUä¾¿å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¿…é¡»åœ¨I/Oå®Œæˆåæ‰ç»§ç»­è¿è¡Œã€‚ 1.3.2 å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ1. å¤„ç†è¿‡ç¨‹åœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æ‰€æäº¤çš„ä½œä¸šå…ˆæ”¾åœ¨å¤–å­˜ä¸­ï¼Œå¹¶æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç§°ä¸ºâ€œåå¤‡é˜Ÿåˆ—â€œã€‚ç„¶åç”±ä½œä¸šè°ƒåº¦ç¨‹åºæŒ‰ä¸€å®šçš„ç®—æ³•ï¼Œä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©è‹¥å¹²ä½œä¸šè°ƒå…¥å†…å­˜ã€‚ç”±äºåŒæ—¶åœ¨å†…å­˜ä¸­è£…æœ‰è‹¥å¹²é“ç¨‹åºï¼Œè¿™æ ·ä¾¿å¯ä»¥åœ¨è¿è¡Œç¨‹åºAæ—¶ï¼Œåˆ©ç”¨å…¶I/Oæ“ä½œæš‚åœæ‰§è¡Œæ—¶çš„CPUç©ºæ¡£æœŸï¼Œå†è°ƒåº¦å¦ä¸€é“ç¨‹åºBè¿è¡Œã€‚ 2. ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ èµ„æºåˆ©ç”¨ç‡é«˜ ç³»ç»Ÿååé‡å¤§ ç¼ºç‚¹ å¹³å‡å‘¨è½¬æ—¶é—´é•¿ æ— äº¤äº’èƒ½åŠ› 1.3.3 åˆ†æ—¶ç³»ç»Ÿ1. è¿è¡Œæ–¹å¼ ä½œä¸šç›´æ¥è¿›å…¥å†…å­˜ã€‚å› ä¸ºä½œä¸šåœ¨ç£ç›˜ä¸Šä¸å¯è¿è¡Œï¼Œæ‰€ä»¥ä½œä¸šåº”ç›´æ¥è¿›å…¥å†…å­˜ é‡‡ç”¨è½®è½¬è¿è¡Œæ–¹å¼ã€‚å¦‚æœä¸€ä¸ªä½œä¸šç‹¬å CPUè¿ç»­è¿è¡Œï¼Œé‚£ä¹ˆå…¶ä»–ä½œä¸šæ²¡æ³•è¿è¡Œã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¼•å…¥äº†æ—¶é—´ç‰‡æ¦‚å¿µã€‚ä¸€ä¸ªæ—¶é—´ç‰‡æ˜¯ä¸€ä¸ªå¾ˆçŸ­çš„æ—¶é—´ï¼Œç³»ç»Ÿè§„å®šäº†æ¯ä¸ªä½œä¸šæ¯æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç„¶åå°±æš‚åœè¯¥ä½œä¸šçš„è¿è¡Œï¼Œå¹¶ç«‹å³è°ƒåº¦ä¸‹ä¸€ä¸ªä½œä¸šè¿è¡Œã€‚å¦‚æœåœ¨ä¸é•¿çš„æ—¶é—´å†…èƒ½ä½¿æ‰€æœ‰çš„ä½œä¸šéƒ½æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶é—´ï¼Œä¾¿å¯ä»¥ä½¿æ¯ä¸ªç”¨æˆ·éƒ½èƒ½åŠæ—¶åœ°ä¸è‡ªå·±çš„ä½œä¸šè¿›è¡Œäº¤äº’ï¼Œä»è€Œä½¿ç”¨æˆ·çš„è¯·æ±‚çš„åˆ°åŠæ—¶å“åº”ã€‚ 2. ç‰¹å¾ å¤šè·¯æ€§ ç‹¬ç«‹æ€§ åŠæ—¶æ€§ äº¤äº’æ€§ 1.3.4 å®æ—¶ç³»ç»Ÿå®æ—¶ç³»ç»Ÿæ˜¯æŒ‡ç³»ç»Ÿèƒ½åŠæ—¶å“åº”å¤–éƒ¨äº‹ä»¶çš„è¯·æ±‚ï¼Œåœ¨è§„å®šæ—¶é—´å†…å®Œæˆå¯¹è¯¥äº‹ä»¶çš„å¤„ç†ï¼Œå¹¶æ§åˆ¶æ‰€æœ‰å®æ—¶ä»»åŠ¡åè°ƒä¸€è‡´åœ°è¿è¡Œã€‚å®æ—¶ç³»ç»Ÿä¸»è¦åº”ç”¨äºï¼š å·¥ä¸šï¼ˆæ­¦å™¨ï¼‰æ§åˆ¶ç³»ç»Ÿ ä¿¡æ¯æŸ¥è¯¢ç³»ç»Ÿ å¤šåª’ä½“ç³»ç»Ÿ åµŒå…¥å¼ç³»ç»Ÿ 1.4 æ“ä½œç³»ç»Ÿçš„åŸºæœ¬ç‰¹å¾1.4.1 å¹¶å‘æ­£æ˜¯ç³»ç»Ÿä¸­æœ‰è¿™ä¸€ç‰¹å¾ï¼Œæ‰ä½¿å¾—OSèƒ½æœ‰æ•ˆåœ°æé«˜ç³»ç»Ÿä¸­çš„èµ„æºåˆ©ç”¨ç‡ï¼Œå¢åŠ ç³»ç»Ÿçš„ååé‡ã€‚ å¹¶å‘ä¸å¹¶è¡Œå¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼Œå¾®è§‚ä¸Šæ˜¯åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åœ¨CPUä¸Šè¿è¡Œã€‚å¹¶å‘æ˜¯æŒ‡å®è§‚ä¸Šä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´å‘ç”Ÿï¼Œå¾®è§‚ä¸Šç¼ºæ˜¯æŸä¸€æ—¶åˆ»CPUä¸Šåªæœ‰ä¸€ä¸ªè¿›ç¨‹ã€‚ 1.4.2 å…±äº«èµ„æºå…±äº«ï¼Œå³æ“ä½œç³»ç»Ÿä¸­çš„èµ„æºå¯ä¾›å¤šä¸ªå¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹å…±åŒä½¿ç”¨ï¼Œç”±äºèµ„æºå±æ€§ä¸åŒï¼Œå¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„å…±äº«æ–¹å¼ä¹Ÿä¸åŒã€‚å¯åˆ†ä¸ºï¼šäº’æ–¥å…±äº«æ–¹å¼å’ŒåŒæ—¶è®¿é—®æ–¹å¼ã€‚ 1. äº’æ–¥å…±äº«æ–¹å¼ä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºï¼Œå¦‚ç£å¸¦æœº,æ‰“å°æœºç­‰ã€‚è™½ç„¶å¯ä»¥ä¾›å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œä½†æ˜¯ä¸ºäº†æ‰“å°æˆ–è®°å½•ç»“æœä¸é€ æˆæ··æ·†ï¼Œåº”è§„å®šä¸€æ®µæ—¶é—´å†…åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è®¿é—®è¯¥èµ„æºã€‚ 2. åŒæ—¶è®¿é—®æ–¹å¼æŸäº›èµ„æºï¼Œä¸€æ®µæ—¶é—´å†…æ˜¯å¯ä»¥å…è®¸å¤šä¸ªè¿›ç¨‹â€œåŒæ—¶â€åŒæ—¶å¯¹ä»–ä»¬è¿›è¡Œè®¿é—®ï¼Œè¿™ä¸ªåŒæ—¶æ˜¯å®è§‚ä¸Šçš„ï¼Œåœ¨å¾®è§‚ä¸Šå¯èƒ½æ˜¯åˆ†æ—¶å…±äº«ã€‚ 1.4.3 è™šæ‹Ÿåœ¨OSä¸­ï¼ŒæŠŠé€šè¿‡æŸç§æŠ€æœ¯å°†ä¸€ä¸ªç‰©ç†å®ä½“å˜ä¸ºè‹¥å¹²ä¸ªé€»è¾‘ä¸Šçš„å¯¹åº”ç‰©çš„åŠŸèƒ½ç§°ä¸ºâ€è™šæ‹Ÿâ€œã€‚ 1.4.4 å¼‚æ­¥åœ¨å¤šé“ç¯å¢ƒä¸‹ï¼Œå…è®¸å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ä½†ç”±äºèµ„æºæœ‰é™ï¼Œè¿›ç¨‹çš„æ‰§è¡Œä¸æ˜¯ä¸€è´¯åˆ°åº•ã€‚è€Œæ˜¯èµ°èµ°åœåœï¼Œä»¥ä¸å¯é¢„çŸ¥çš„é€Ÿåº¦å‘å‰æ¨è¿›ï¼Œè¿™å°±æ˜¯è¿›ç¨‹çš„å¼‚æ­¥ã€‚ 1.5 æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½åº”åˆ†ä¸ºå¤„ç†æœºç®¡ç†ã€å­˜å‚¨å™¨ç®¡ç†ã€è®¾å¤‡ç®¡ç†å’Œæ–‡ä»¶ç®¡ç†ã€‚æ­¤å¤–ï¼Œè¿˜åº”å‘ç”¨æˆ·æä¾›æ–¹ä¾¿çš„ç”¨æˆ·æ¥å£ã€‚ 1.5.1 å¤„ç†æœºç®¡ç†åŠŸèƒ½1. è¿›ç¨‹æ§åˆ¶åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸­ï¼Œä¸ºäº†ä½¿ä½œä¸šèƒ½å¹¶å‘æ‰§è¡Œï¼Œå¿…é¡»ä¸ºæ¯é“ä½œä¸šåˆ›å»ºä¸€ä¸ªæˆ–å‡ ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºä¹‹åˆ†é…å¿…è¦çš„èµ„æºã€‚å½“è¿›ç¨‹è¿è¡Œç»“æŸæ—¶ï¼Œåº”ç«‹å³æ’¤é”€è¯¥è¿›ç¨‹ï¼Œä»¥ä¾¿èƒ½åŠæ—¶å›æ”¶è¯¥è¿›ç¨‹æ‰€å ç”¨çš„å„ç§èµ„æºï¼Œä¾›å…¶å®ƒè¿›ç¨‹ä½¿ç”¨ã€‚ 2. è¿›ç¨‹åŒæ­¥ä¸ºäº†ä½¿å¤šä¸ªè¿›ç¨‹èƒ½æœ‰æ¡ä¸ç´Šçš„è¿è¡Œï¼Œç³»ç»Ÿä¸­å¿…é¡»è®¾ç½®ç›¸åº”çš„è¿›ç¨‹åŒæ­¥æœºåˆ¶ã€‚è¯¥æœºåˆ¶çš„ä¸»è¦ä»»åŠ¡æ˜¯ä¸ºå¤šä¸ªè¿›ç¨‹çš„è¿è¡Œè¿›è¡Œåè°ƒã€‚ 3. è¿›ç¨‹é€šä¿¡å¦‚æœä¸€ç»„ç›¸äº’åˆä½œçš„è¿›ç¨‹å»å®Œæˆä¸€ä¸ªå…±åŒçš„ä»»åŠ¡æ—¶ï¼Œåœ¨ä»–ä»¬ä¹‹é—´å¾€å¾€éœ€è¦äº¤æ¢ä¿¡æ¯ã€‚ 4. è°ƒåº¦åœ¨ä¼ ç»ŸOSä¸­ï¼Œè°ƒåº¦åŒ…æ‹¬ä½œä¸šè°ƒåº¦å’Œè¿›ç¨‹è°ƒåº¦ã€‚ ä½œä¸šè°ƒåº¦ ä½œä¸šè°ƒåº¦çš„åŸºæœ¬ä»»åŠ¡å°±æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰æ‹©å‡ºè‹¥å¹²ä¸ªä½œä¸šï¼Œä¸ºä»–ä»¬åˆ†é…æ‰€éœ€èµ„æºï¼Œåœ¨è¿™äº›ä½œä¸šè°ƒå…¥å†…å­˜åï¼Œåˆ†åˆ«ä¸ºä»–ä»¬åˆ›å»ºè¿›ç¨‹ï¼Œæ˜¯ä»–ä»¬éƒ½ç§°ä¸ºå¯èƒ½è·å¾—å¤„ç†æœºçš„å°±ç»ªè¿›ç¨‹ï¼Œå¹¶å°†ä»–ä»¬æ’å…¥å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚ è¿›ç¨‹è°ƒåº¦ è¿›ç¨‹è°ƒåº¦çš„ä»»åŠ¡æ˜¯ä»è¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—ä¸­æŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™ä»–ï¼Œå¹¶ä¸ºä»–è®¾ç½®è¿è¡Œçº¿ç¨‹ï¼Œä½¿å…¶æŠ•å…¥æ‰§è¡Œã€‚ 1.5.2 å­˜å‚¨å™¨ç®¡ç†åŠŸèƒ½å­˜å‚¨å™¨ç®¡ç†è§†ä¸ºå¤šé“ç¨‹åºçš„è¿è¡Œæä¾›è‰¯å¥½çš„ç¯å¢ƒï¼Œæé«˜å­˜å‚¨å™¨åˆ©ç”¨ç‡ï¼Œå¹¶èƒ½ä»é€»è¾‘ä¸Šæ‰©å……å†…å­˜ã€‚ä¸ºæ­¤ï¼Œå­˜å‚¨å™¨ç®¡ç†åº”å…·æœ‰å†…å­˜åˆ†é…å’Œå›æ”¶ã€å†…å­˜ä¿æŠ¤ã€åœ°å€æ˜ å°„å’Œå†…å­˜æ‰©å……ç­‰åŠŸèƒ½ã€‚ 1. å†…å­˜åˆ†é…å†…å­˜åˆ†é…ä¸»è¦ä»»åŠ¡æ˜¯ï¼š ä¸ºæ¯é“ç¨‹åºåˆ†é…å†…å­˜ç©ºé—´ æé«˜å­˜å‚¨å™¨çš„åˆ©ç”¨ç‡ï¼Œå°½é‡å‡å°‘ä¸å¯ç”¨çš„å†…å­˜ç©ºé—´ å…è®¸æ­£åœ¨è¿è¡Œçš„ç¨‹åºç”³è¯·é™„åŠ çš„å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®åŠ¨æ€å¢é•¿çš„éœ€è¦ã€‚ OSåœ¨å®ç°å†…å­˜åˆ†é…æ—¶ï¼Œå¯é‡‡å–é™æ€å’ŒåŠ¨æ€ä¸¤ç§æ–¹å¼ï¼š é™æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šçš„å†…å­˜ç©ºé—´åœ¨ä½œä¸šè£…å…¥æ—¶ç¡®å®šï¼Œç¡®å®šåä¸å†æ”¹å˜ã€‚ åŠ¨æ€åˆ†é…å†…å­˜ã€‚æ¯ä¸ªä½œä¸šæ‰€è¦æ±‚çš„çš„åŸºæœ¬å†…å­˜ç©ºé—´è™½ç„¶ä¹Ÿæ˜¯åœ¨è£…å…¥æ—¶ç¡®å®šçš„ï¼Œä½†å…è®¸ä½œä¸šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç»§ç»­ç”³è¯·æ–°çš„é™„åŠ å†…å­˜ç©ºé—´ï¼Œä»¥é€‚åº”ç¨‹åºå’Œæ•°æ®çš„åŠ¨æ€å¢é•¿ã€‚ 2. å†…å­˜ä¿æŠ¤ç¡®ä¿æ¯é“ç”¨æˆ·ç¨‹åºéƒ½åœ¨è‡ªå·±çš„å†…å­˜ç©ºé—´å†…è¿è¡Œï¼Œå½¼æ­¤äº’ä¸å¹²æ‰°ã€‚å†³ä¸å…è®¸ç”¨æˆ·ç¨‹åºè®¿é—®æ“ä½œç³»ç»Ÿçš„ç¨‹åºå’Œæ•°æ®ï¼Œä¹Ÿä¸å…è®¸ç”¨æˆ·ç¨‹åºè½¬ç§»åˆ°éå…±äº«çš„å…¶ä»–ç”¨æˆ·ç¨‹åºä¸­å»æ‰§è¡Œã€‚ 3. åœ°å€æ˜ å°„æ¯é“ç¨‹åºç»ç¼–è¯‘è¿æ¥åæ‰€å½¢æˆçš„çš„å¯è£…å…¥ç¨‹åºå…¶åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œä½†æ˜¯ä¸å¯èƒ½å°†ä»–ä»¬ä»â€œ0â€åœ°å€å¼€å§‹è£…å…¥å†…å­˜ï¼Œæ‰€ä»¥ç‰©ç†åœ°å€å’Œé€»è¾‘åœ°å€å¹¶ä¸ä¸€è‡´ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ°å€æ˜ å°„æ¥è®©ç¨‹åºèƒ½æ­£å¸¸è¿è¡Œã€‚ 4. å†…å­˜æ‰©å……å€ŸåŠ©è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯æ¥å®ç°å†…å­˜æ‰©å……ï¼Œä¸»è¦è§£å†³ï¼š å†…å­˜å’ŒI/Oä¹‹é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ å¦‚æœå†…å­˜ç©ºé—´ä¸è¶³çš„é—®é¢˜ 1.5.3 è®¾å¤‡ç®¡ç†åŠŸèƒ½ä¸»è¦ä»»åŠ¡ï¼š å®Œæˆç”¨æˆ·è¿›ç¨‹æå‡ºçš„I/Oè¯·æ±‚ï¼Œä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…æ‰€éœ€çš„I/Oè®¾å¤‡ï¼Œå¹¶å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œ æé«˜CPUä¸I/Oè®¾å¤‡çš„åˆ©ç”¨ç‡ï¼Œæé«˜I/Oé€Ÿåº¦ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨I/O ä¸ºäº†å®ç°ä»¥ä¸ŠåŠŸèƒ½ï¼Œåº”å…·æœ‰ç¼“å†²ç®¡ç†ã€è®¾å¤‡åˆ†é…å’Œè®¾å¤‡å¤„ç†ä»¥åŠè™šæ‹Ÿè®¾å¤‡ç­‰åŠŸèƒ½ã€‚ 1. ç¼“å†²ç®¡ç†ä¸ºäº†æœ‰æ•ˆçš„ç¼“å’ŒCPUä¸I/Oè®¾å¤‡é—´é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œæé«˜CPUåˆ©ç”¨ç‡ï¼Œäºæ˜¯å¼•å…¥äº†ç¼“å†²ç®¡ç†ã€‚ 2. è®¾å¤‡åˆ†é…è®¾å¤‡åˆ†é…çš„åŸºæœ¬ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·è¿›ç¨‹çš„I/Oè¯·æ±‚ã€ç³»ç»Ÿç°æœ‰èµ„æºæƒ…å†µä»¥åŠæŒ‰ç…§æŸç§è®¾å¤‡åˆ†é…ç­–ç•¥ï¼Œä¸ºä¹‹åˆ†é…å…¶æ‰€éœ€çš„è®¾å¤‡ã€‚ 3. è®¾å¤‡å¤„ç†å®ç°CPUå’Œè®¾å¤‡æ§åˆ¶å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œå³ç”±CPUå‘è®¾å¤‡æ§åˆ¶å™¨å‘å‡ºI/Oå‘½ä»¤ï¼Œè¦æ±‚ä»–å®ŒæˆæŒ‡å®šçš„I/Oæ“ä½œï¼›åä¹‹ï¼Œç”±CPUæ§åˆ¶ä»æ¥æ”¶å™¨å‘æ¥çš„ä¸­æ–­è¯·æ±‚ï¼Œå¹¶ç»™äºˆè¿…é€Ÿçš„å“åº”å’Œç›¸åº”çš„å¤„ç†ã€‚ 1.5.4 æ–‡ä»¶ç®¡ç†åŠŸèƒ½ä¸»è¦æ˜¯å¯¹ç”¨æˆ·æ–‡ä»¶å’Œç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç®¡ç†ä»¥æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§ã€‚ä¸ºæ­¤ï¼Œæ–‡ä»¶ç®¡ç†åº”å…·æœ‰å¯¹æ–‡ä»¶å­˜å‚¨ç©ºé—´ç®¡ç†ã€ç›®å½•ç®¡ç†ã€æ–‡ä»¶çš„è¯»/å†™ç®¡ç†ä»¥åŠæ–‡ä»¶çš„å…±äº«ä¸ä¿æŠ¤ç­‰åŠŸèƒ½ã€‚ 1. æ–‡ä»¶å­˜å‚¨ç©ºé—´çš„ç®¡ç†ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…å¿…è¦çš„å¤–å­˜ç©ºé—´ï¼Œæé«˜æˆ‘æ‘åˆ©ç”¨ç‡ï¼Œè¿›è€Œæé«˜æ–‡ä»¶ç³»ç»Ÿçš„å­˜ã€å–é€Ÿåº¦ã€‚ 2. ç›®å½•ç®¡ç†ä¸ºæ¯ä¸ªæ–‡ä»¶å»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ï¼Œç›®å½•é¡¹åŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶å±æ€§ã€æ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„ç‰©ç†ä½ç½®ç­‰ï¼Œå¹¶å¯¹ä¼—å¤šçš„ç›®å½•é¡¹åŠ ä»¥æœ‰æ•ˆçš„ç»„ç»‡ï¼Œä»¥å®ç°æ–¹ä¾¿çš„æŒ‰åå­—å­˜å–ã€‚ 3. æ–‡ä»¶çš„è¯»/å†™ç®¡ç†å’Œä¿æŠ¤æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚ï¼Œä»å¤–å­˜ä¸­è¯»å–æ•°æ®æˆ–å°†æ•°æ®å†™å…¥å¤–å­˜ã€‚å¹¶ä¸”ä¿æŠ¤æ–‡ä»¶é˜²æ­¢å…¶è¢«éæ³•ç›—å–å’Œç ´åã€‚ 1.5.5 æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·é—´çš„æ¥å£æ¥å£ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç”¨æˆ·æ¥å£å’Œç¨‹åºæ¥å£ã€‚ç”¨æˆ·æ¥å£æ˜¯ä¾›ç”¨æˆ·è°ƒç”¨ï¼Œæ–¹ä¾¿ç”¨æˆ·ç›´æ¥æˆ–é—´æ¥æ§åˆ¶è‡ªå·±çš„ä½œä¸šã€‚ç¨‹åºæ¥å£æ˜¯ä¸ºç”¨æˆ·ç¨‹åºåœ¨æ‰§è¡Œä¸­è®¿é—®ç³»ç»Ÿèµ„æºè€Œè®¾å®šçš„ï¼Œæ˜¯ç”¨æˆ·å–å¾—æ“ä½œç³»ç»ŸæœåŠ¡çš„å”¯ä¸€é€”å¾„ã€‚]]></content>
      <categories>
        <category>æ“ä½œç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¤šçº¿ç¨‹2--Javaä¸­çš„çº¿ç¨‹æ± ]]></title>
    <url>%2Fposts%2Fb39fd0ab.html</url>
    <content type="text"><![CDATA[ç®€ä»‹æˆ‘ä»¬åœ¨å†™é¡¹ç›®ç»å¸¸è¦ç”¨åˆ°å¤šçº¿ç¨‹ã€‚ä½†æ˜¯çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯éƒ½æ˜¯è¾ƒæ¶ˆè€—èµ„æºå’Œæ€§èƒ½çš„ï¼Œå¦‚æœä½ æ¯éœ€è¦ä¸€ä¸ªä»»åŠ¡å°±æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å¯èƒ½ä¼šåœ¨çº¿ç¨‹çš„åˆ›å»ºå’Œæ‘§æ¯ä¸Šæµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚é‚£å¦‚æœæˆ‘ä»¬è®©çº¿ç¨‹æ‰§è¡Œä»»åŠ¡åä¸æ‘§æ¯ï¼Œæ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±èƒ½é¿å…è¿™ç§æƒ…å†µäº†ã€‚Java1.5ä¸­æä¾›äº†Executoræ¡†æ¶ç”¨äºæŠŠä»»åŠ¡çš„æäº¤å’Œæ‰§è¡Œè§£è€¦ï¼Œä»»åŠ¡çš„æ‰§è¡Œå°±äº¤ç»™Runnableæˆ–è€…Callableï¼Œè€ŒExecutoræ¡†æ¶ç”¨äºå¤„ç†ä»»åŠ¡ã€‚Executorä¸­æœ€æ ¸å¿ƒçš„æˆå‘˜å°±æ˜¯ThreadPoolExecutorï¼Œä»–å°±æ˜¯çº¿ç¨‹æ± æ ¸å¿ƒå®ç°ç±»ã€‚ ThreadPoolExecutoræˆ‘ä»¬ç°åœ¨å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚æ„é€ å™¨ï¼š 123456789101112131415161718192021public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize,markdownlint long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™äº›å‚æ•°ï¼š corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚çº¿ç¨‹æ± åˆšåˆ›å»ºçš„æ—¶å€™ï¼Œçº¿ç¨‹æ•°é‡ä¸º0ï¼Œåªæœ‰ä»»åŠ¡æäº¤çš„æ—¶å€™æ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼›å¦‚æœç­‰äºæˆ–è€…å¤§äºï¼Œåˆ™ä¸å†åˆ›å»ºã€‚ maximumPoolSizeï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“workQueueæ»¡äº†è€Œä¸”çº¿ç¨‹æ•°å°äºmaximumPoolSizeæ—¶ï¼Œçº¿ç¨‹æ± ä»ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ä½†æ˜¯å¦‚æœè¶…è¿‡äº†maximumPoolSizeæ—¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ keepAliveTimeï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®çš„è¶…è¿‡æ—¶é—´ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤§äºworkQueueï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¤§äºkeepAliveTimeï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«å›æ”¶ã€‚å¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡ çš„æ‰§è¡Œäº‹ä»¶å¾ˆçŸ­ï¼Œåˆ™å¯ä»¥è°ƒå¤§keepAliveTimeæ¥æé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚å¦å¤–ï¼Œå¦‚æœè®¾ç½® allowCoreThreadTimeOutå±æ€§ä¸ºtrueæ—¶ï¼ŒkeepAliveTimeä¹Ÿä¼šåº”ç”¨åˆ°æ ¸å¿ƒçº¿ç¨‹ä¸Šã€‚ timeUnitï¼škeepAliveTimeå‚æ•°çš„æ—¶é—´å•ä½ã€‚å¯é€‰çš„å•ä½æœ‰å¤©(DAYS)ã€å°æ—¶(HOURS)ã€åˆ†é’Ÿ(MINUTES)ã€ç§’(SECONDS)ã€æ¯«ç§’(MILLISECONDS)ç­‰ã€‚ workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°æ­¤ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚è¯¥ä»»åŠ¡ é˜Ÿåˆ—æ˜¯BlockingQueueç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚ threadFactoryï¼šçº¿ç¨‹å·¥å‚ã€‚å¯ä»¥ç”¨çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®åå­—ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ— é¡»è®¾ç½®è¯¥å‚æ•°ã€‚ RejectedExecutionHandlerï¼šé¥±å’Œç­–ç•¥ã€‚è¿™æ˜¯å½“ä»»åŠ¡é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†æ—¶æ‰€é‡‡å–çš„åº”å¯¹ç­–ç•¥ï¼Œé»˜è®¤æ˜¯AbordPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡ï¼Œå¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚æ­¤å¤–è¿˜æœ‰3ç§ç­–ç•¥ï¼Œå®ƒä»¬åˆ†åˆ«å¦‚ä¸‹: CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ã€‚æ­¤ç­–ç•¥æä¾›ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œèƒ½å¤Ÿå‡ç¼“æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚ DiscardPolicyï¼šä¸èƒ½æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°†è¯¥ä»»åŠ¡åˆ é™¤ã€‚ DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€è¿‘çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰çš„ä»»åŠ¡ã€‚ çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹çº¿ç¨‹æ± çš„ä»»åŠ¡å¤„ç†ä¸»è¦åˆ†ä¸º3ä¸ªæ­¥éª¤ æäº¤ä»»åŠ¡åï¼Œçº¿ç¨‹æ± å…ˆåˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æ ¸å¿ƒçº¿ç¨‹æ•°corePoolSizeã€‚å¦‚æœæœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ æ¥ç€çº¿ç¨‹æ± åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ã€‚å¦‚æœæ²¡æ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ æ¥ç€å› ä¸ºä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œçº¿ç¨‹æ± å°±åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦è¾¾åˆ°äº†æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœæœªè¾¾åˆ°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ï¼›å¦åˆ™ï¼Œå°±æ‰§è¡Œé¥±å’Œç­–ç•¥ï¼Œé»˜è®¤ä¼šæŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹å¤„ç†ä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°å¤§äºæˆ–è€…ç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™å°†ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹ä¼šä¸æ–­åœ°ä» ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œå¤„ç†ã€‚ å¦‚æœä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ•°æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å»å¤„ç†ä»»åŠ¡ã€‚ å¦‚æœçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™æ‰§è¡Œé¥±å’Œç­–ç•¥ã€‚ çº¿ç¨‹æ± çš„ç§ç±»CachedThreadPoolï¼šå¯ç¼“å­˜çº¿ç¨‹æ±  çº¿ç¨‹æ•°æ— é™åˆ¶ æœ‰ç©ºé—²çº¿ç¨‹åˆ™å¤ç”¨ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— ç©ºé—²çº¿ç¨‹åˆ™æ–°å»ºçº¿ç¨‹ ä¸€å®šç¨‹åºå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿå¼€é”€ åˆ›å»ºæºç ï¼š 12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; CachedThreadPoolçš„corePoolSizeä¸º0ï¼ŒmaximumPoolSizeè®¾ç½®ä¸ºInteger.MAX_VALUEï¼Œè¿™æ„å‘³ç€CachedThreadPoolæ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œéæ ¸å¿ƒçº¿ç¨‹æ˜¯æ— ç•Œçš„ã€‚keepAliveTimeè®¾ç½®ä¸º60Lï¼Œåˆ™ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡ çš„æœ€é•¿æ—¶é—´ä¸º60sã€‚åœ¨æ­¤ç”¨äº†é˜»å¡é˜Ÿåˆ—SynchronousQueueï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„ç§»é™¤æ“ä½œï¼ŒåŒæ ·ä»»ä½•ä¸€ä¸ªç§»é™¤æ“ä½œéƒ½ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ’å…¥æ“ä½œã€‚ FixedThreadPoolï¼šå®šé•¿çº¿ç¨‹æ±  å¯æ§åˆ¶çº¿ç¨‹æœ€å¤§å¹¶å‘æ•°ï¼ˆåŒæ—¶æ‰§è¡Œçš„çº¿ç¨‹æ•°ï¼‰ è¶…å‡ºçš„çº¿ç¨‹ä¼šåœ¨é˜Ÿåˆ—ä¸­ç­‰å¾… åˆ›å»ºæºç ï¼š 12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125; FixedThreadPoolçš„corePoolSizeå’ŒmaximumPoolSizeéƒ½è®¾ç½®ä¸ºåˆ›å»ºFixedThreadPoolæŒ‡å®šçš„å‚æ•°nThreadsï¼Œä¹Ÿå°±æ„å‘³ç€FixedThreadPoolåªæœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œå¹¶ä¸”æ•°é‡æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰éæ ¸å¿ƒçº¿ç¨‹ã€‚keepAliveTimeè®¾ç½®ä¸º0Læ„å‘³ç€å¤šä½™çš„çº¿ç¨‹ä¼šè¢«ç«‹å³ç»ˆæ­¢ã€‚å› ä¸ºä¸ä¼šäº§ç”Ÿå¤šä½™çš„çº¿ç¨‹ï¼Œæ‰€ä»¥keepAliveTimeæ˜¯æ— æ•ˆçš„å‚æ•°ã€‚å¦å¤–ï¼Œä»»åŠ¡é˜Ÿåˆ—é‡‡ç”¨äº†æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueã€‚ ScheduledThreadPoolï¼šå®šé•¿çº¿ç¨‹æ± æ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ åˆ›å»ºæºç ï¼š 1234public static ScheduledExecutorService newScheduledThreadPool( int corePoolSize, ThreadFactory threadFactory) &#123; return new ScheduledThreadPoolExecutor(corePoolSize, threadFactory);&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºæºç ä¸­ä»–è·³è½¬åˆ°äº†ScheduledThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹è¿›å»ï¼š 123456public ScheduledThreadPoolExecutor(int corePoolSize, ThreadFactory threadFactory) &#123; super(corePoolSize, Integer.MAX_VALUE, DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS, new DelayedWorkQueue(), threadFactory);&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒScheduledThreadPoolExecutorçš„æ„é€ æ–¹æ³•æœ€ç»ˆè°ƒç”¨çš„æ˜¯ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ã€‚corePoolSizeæ˜¯ä¼ è¿›æ¥çš„å›ºå®šæ•°å€¼ï¼ŒmaximumPoolSizeçš„å€¼æ˜¯Integer.MAX_VALUEã€‚å› ä¸ºé‡‡ç”¨çš„DelayedWorkQueueæ˜¯æ— ç•Œçš„ï¼Œæ‰€ä»¥maximumPoolSizeè¿™ä¸ªå‚æ•°æ˜¯æ— æ•ˆçš„ã€‚ SingleThreadExecutorï¼šå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ±  æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåºæ‰§è¡Œï¼Œå³éµå¾ªé˜Ÿåˆ—çš„å…¥é˜Ÿå‡ºé˜Ÿè§„åˆ™ åˆ›å»ºæºç ï¼š 123456public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));&#125; corePoolSizeå’ŒmaximumPoolSizeéƒ½ä¸º1ï¼Œæ„å‘³ç€SingleThreadExecutoråªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå…¶ä»–çš„å‚æ•°éƒ½å’ŒFixedThreadPoolä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nexté…ç½®å¤‡ä»½]]></title>
    <url>%2Fposts%2F5b6e53a4.html</url>
    <content type="text"><![CDATA[Hexoé…ç½®å¤‡ä»½ è¯„è®ºç³»ç»Ÿ æ¥å¿…åŠ› - https://www.livere.com/ valine(åœ¨ç”¨) - https://valine.js.org/ é˜…è¯»é‡æ˜¾ç¤º leancloud - https://leancloud.cn/ valine(åœ¨ç”¨) - https://valine.js.org/]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå¤šçº¿ç¨‹1--Javaä¸­çš„é˜»å¡é˜Ÿåˆ—]]></title>
    <url>%2Fposts%2F63ab42b7.html</url>
    <content type="text"><![CDATA[é˜»å¡é˜Ÿåˆ—å‰è¨€åœ¨è°ˆè®ºé˜»å¡é˜Ÿåˆ—ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸‹æ“ä½œç³»ç»Ÿå¤šçº¿ç¨‹éƒ¨åˆ†ä¸€ä¸ªç»å…¸çš„ä¾‹å­â€”â€”ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ï¼š ç°åœ¨æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç”Ÿäº§è€…ä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…ï¼Œè¿˜æœ‰ä¸€ä¸ªçº¿ç¨‹ç¼“å†²åŒºã€‚ç”Ÿäº§è€…ä¸»è¦ä½œç”¨å°±æ˜¯å‘ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®ï¼Œæ¶ˆè´¹è€…å°±æ˜¯ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•ç¡®ä¿ç”Ÿäº§è€…ä¸ä¼šåœ¨ç¼“å†²åŒºæ»¡äº†çš„æ—¶å€™è¿˜å¾€å…¶ä¸­æ·»åŠ å…ƒç´ ï¼Œæ¶ˆè´¹è€…ä¸ä¼šåœ¨ç¼“å†²åŒºç©ºäº†çš„æ—¶å€™è¿˜è¦æ±‚å–å‡ºæ•°æ®ã€‚ å…³äºè¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³•æˆ‘ä»¬ä»¥åå†è¯´ï¼Œæˆ‘ä»¬ç°åœ¨ä¸»è¦è®¨è®ºçº¿ç¨‹ç¼“å†²åŒºâ€”â€”é˜»å¡é˜Ÿåˆ—ã€‚ é˜»å¡é˜Ÿåˆ—ç®€ä»‹é˜»å¡é˜Ÿåˆ—å°±æ˜¯é˜Ÿåˆ—ï¼Œåªæ˜¯åœ¨ä¸€èˆ¬çš„é˜Ÿåˆ—ä¸Šæ·»åŠ äº†ä¸¤ä¸ªæ¡ä»¶ï¼š å½“é˜Ÿåˆ—æ»¡äº†çš„æ—¶å€™ä¸å…è®¸å†æ·»åŠ æ•°æ® å½“é˜Ÿåˆ—ç©ºäº†çš„æ—¶å€™ä¸å…è®¸ä»ä¸­å–æ•°æ® åœ¨Javaä¸­ï¼Œé˜»å¡é˜Ÿåˆ—æ˜¯é€šè¿‡BlockingQueueæ¥å®ç°çš„ï¼ŒBlockingQueueæ˜¯Java.util.concurrentåŒ…ä¸‹ä¸€ä¸ªé‡è¦çš„æ•°æ®ç»“æ„ã€‚ BlockingQueueçš„æ“ä½œæ–¹æ³• æ–¹æ³• æŠ›å¼‚å¸¸ è¿”å›ç‰¹å®šå€¼ é˜»å¡ è¶…æ—¶ æ’å…¥ add(E e) offer(E e) put(E e) offer(E e, long timeout, TimeUnit unit) ç§»é™¤ remove() poll() take() poll(time, unit) æ£€æŸ¥ element() peek() ä¸å¯ç”¨ ä¸å¯ç”¨ è§£é‡Šï¼š æŠ›å¼‚å¸¸ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ ç‰¹å®šå€¼ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™è¿”å›ä¸€ä¸ªç‰¹å®šçš„å€¼ é˜»å¡ï¼š å¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œ è¶…æ—¶ï¼šå¦‚æœæ“ä½œæ— æ³•æ‰§è¡Œï¼Œåˆ™æ–¹æ³•è°ƒç”¨è¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥æ‰§è¡Œæˆ–è€…è¶…è¿‡é™å®šçš„æ—¶é—´ã€‚è¿”å›ä¸€ä¸ªç‰¹å®šå€¼ä»¥å‘ŠçŸ¥è¯¥æ“ä½œæ˜¯å¦æˆåŠŸ(å…¸å‹çš„æ˜¯true / false)ã€‚ Javaä¸­çš„å„ç§é˜»å¡é˜Ÿåˆ—JavaåŸºäºBlockingQueueç»™å¼€å‘è€…æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š ArrayBlockingQueueï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æœ‰ç•Œå°±æ„å‘³ç€ä»–æœ‰ä¸€ä¸ªæœ€å¤§é™åº¦ï¼Œæ‰€å­˜å‚¨çš„çº¿ç¨‹çš„æ•°é‡ä¸èƒ½è¶…è¿‡è¿™ä¸ªé™å®šå€¼ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å¯¹å…¶åˆå§‹åŒ–çš„æ—¶å€™ç»™å®šè¿™ä¸ªé™å®šå€¼ã€‚ä½†æ˜¯ç”±äºå®ƒæ˜¯åŸºäºæ•°ç»„æ‰€ä»¥ä»–å’Œæ•°ç»„ä¸€æ ·ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™é™å®šäº†è¿™ä¸ªå¤§å°ä»¥åå°±ä¸èƒ½æ”¹å˜ã€‚ LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ã€‚å®ƒå†…éƒ¨ä»¥ä¸€ä¸ªé“¾å¼ç»“æ„(é“¾æ¥èŠ‚ç‚¹)å¯¹å…¶å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚å¦‚æœéœ€è¦çš„è¯ï¼Œè¿™ä¸€é“¾å¼ç»“æ„å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸Šé™ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ä¸Šé™ï¼Œå°†ä½¿ç”¨Integer.MAX_VALUEä½œä¸ºä¸Šé™ã€‚LinkedBlockingQueueå†…éƒ¨ä»¥FIFO(å…ˆè¿›å…ˆå‡º)çš„é¡ºåºå¯¹å…ƒç´ è¿›è¡Œå­˜å‚¨ã€‚é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ åœ¨æ‰€æœ‰å…ƒç´ ä¹‹ä¸­æ˜¯æ”¾å…¥æ—¶é—´æœ€ä¹…çš„é‚£ä¸ªï¼Œè€Œå°¾å…ƒç´ åˆ™æ˜¯æœ€çŸ­çš„é‚£ä¸ªã€‚ç”±äºé»˜è®¤æ˜¯æ— ä¸Šé™çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä»–çš„æ—¶å€™ï¼Œå¦‚æœç”Ÿäº§è€…çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…çš„é€Ÿåº¦ï¼Œç³»ç»Ÿå†…å­˜å¯èƒ½ä¼šè¢«è€—å°½ã€‚æ‰€ä»¥ä½¿ç”¨ä»–ä¸€å®šè¦è®¾ç½®åˆå€¼ã€‚ PriorityBlockingQueueï¼šæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µæŒ‰ç…§è‡ªç„¶é¡ºåºç”Ÿåºæ’åˆ—ï¼Œä½ å¯ä»¥é‡å†™compateTo()æ–¹æ³•æ¥åˆ¶å®šå…ƒç´ æŒ‰è§„å®šæ’åºã€‚ DelayQueueï¼šæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç°Delayedæ¥å£ã€‚ SynchromousQueueï¼šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ã€‚ä»–ä¸èƒ½å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œä»–çš„æ¯ä¸€æ¬¡æ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„åˆ é™¤æ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ LinkedTransferQueueï¼šåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜Ÿåˆ—ï¼Œä»–å¤šäº†transfer(E e)ã€tryTransfer(E e) å’Œ tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ã€‚ LinkedBlockingDequeï¼šæ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚å¯åœ¨ä¸¤ç«¯å…¥é˜Ÿå‡ºå¯¹ã€‚æ‰€ä»¥å½“å¤šçº¿ç¨‹å…¥é˜Ÿæ—¶ï¼Œå‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ é˜»å¡é˜Ÿåˆ—å®ç°åŸç†ä¸‹é¢æˆ‘ä»¬ä»¥ArrayBlockingQueueæºç ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹é˜»å¡é˜Ÿåˆ—å®ç°åŸç†ï¼š å®šä¹‰é¦–å…ˆå°±æ˜¯ä¸€å †å˜é‡çš„å®šä¹‰ï¼š 123456789101112131415161718192021222324252627/** The queued items */final Object[] items;/** items index for next take, poll, peek or remove */int takeIndex;/** items index for next put, offer, or add */int putIndex;/** Number of elements in the queue */int count;/* * Concurrency control uses the classic two-condition algorithm * found in any textbook. *//** Main lock guarding all access */final ReentrantLock lock;/** Condition for waiting takes */privatefinal Condition notEmpty;/** Condition for waiting puts */privatefinal Condition notFull; itemsæ˜¯å­˜å‚¨é˜Ÿåˆ—å…ƒç´ çš„æ•°ç»„ï¼ŒtakeIndexå’ŒputIndexåˆ†åˆ«æ˜¯å–æ•°æ®å’Œå­˜æ•°æ®çš„ç´¢å¼•ï¼Œcountæ˜¯é˜Ÿåˆ—ä¸­å…ƒç´ ä¸ªæ•°ï¼Œlockä¸ºçœ‹ä¸€ä¸ªå¯é‡å…¥é”ï¼ŒnotEmptyå’ŒnotFullå‡ä¸ºç­‰å¾…æ¡ä»¶ï¼Œç”±lockåˆ›å»ºã€‚ æ„é€ å™¨æ¥ä¸‹æ¥çœ‹ä¸‹å®ƒçš„æ„é€ å™¨ 12345678public ArrayBlockingQueue(int capacity) &#123;&#125;public ArrayBlockingQueue(int capacity, boolean fair) &#123; &#125;public ArrayBlockingQueue(int capacity, boolean fair, Collection&lt;? extends E&gt; c) &#123;&#125; æ„é€ å™¨æœ‰ä¸‰ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªæ„é€ å™¨åªæœ‰ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå®¹é‡ï¼Œç¬¬äºŒä¸ªæ„é€ å™¨å¤šäº†ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šè®¿é—®ç­–ç•¥ï¼Œç¬¬ä¸‰ä¸ªæ„é€ å™¨åˆå¤šäº†ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šç”¨å¦å¤–ä¸€ä¸ªé›†åˆè¿›è¡Œåˆå§‹åŒ–ã€‚ æ•°æ®çš„æ·»åŠ æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹BlockingQueueçš„ä¸‰ä¸ªæ’å…¥çš„æ–¹æ³•ï¼šput()ã€add()å’Œoffer()ï¼š put() æ–¹æ³•ï¼šé˜Ÿåˆ—æ»¡ï¼Œä¼šé˜»å¡è°ƒç”¨å­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ 1234567891011121314151617public void put(E e) throws InterruptedException &#123; // å…ˆæ£€æŸ¥eæ˜¯ä¸æ˜¯ç©ºï¼Œå¦‚æœç©ºåˆ™æŠ›å¼‚å¸¸ Objects.requireNonNull(e); // è·å–ä¸€ä¸ªé‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é”ï¼Œä¿è¯è°ƒç”¨putæ–¹æ³•çš„æ—¶å€™åªæœ‰1ä¸ªçº¿ç¨‹ lock.lockInterruptibly(); try &#123; // å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´  while (count == items.length) notFull.await(); enqueue(e); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; add()æ–¹æ³•ï¼šå®é™…ä¸Šè°ƒç”¨äº†offer()æ–¹æ³• 123456public boolean add(E e) &#123; if (offer(e)) return true; else throw new IllegalStateException("Queue full");&#125; offer()æ–¹æ³•ï¼šæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false 1234567891011121314151617181920public boolean offer(E e) &#123; // æ£€æŸ¥eæ˜¯å¦ä¸ºç©º Objects.requireNonNull(e); // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äºå½“å‰æ•°ç»„çš„é•¿åº¦ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒè¿”å›falseï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™enqueueæ–¹æ³•æ’å…¥å…ƒç´ å¹¶è¿”å›true if (count == items.length) return false; else &#123; enqueue(e); return true; &#125; &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†enqueue()æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ï¼š 123456789101112131415/** * Inserts element at current put position, advances, and signals. * Call only when holding lock. */private void enqueue(E e) &#123; // assert lock.isHeldByCurrentThread(); // assert lock.getHoldCount() == 1; // assert items[putIndex] == null; final Object[] items = this.items; items[putIndex] = e; if (++putIndex == items.length) putIndex = 0; count++; notEmpty.signal();&#125; å…ˆè·å–å…ƒç´ æ•°ç»„itemsï¼Œç„¶åæ·»åŠ putIndexä¸Šï¼Œå¦‚æœ++putIndexç­‰äºitemsçš„é•¿åº¦ï¼Œåˆ™è¯æ˜å½“å‰è¿™ä¸ªitemsæ‰€æœ‰å…ƒç´ éƒ½æ·»åŠ è¿›äº†ï¼Œå°±è®©putIndexç­‰äº0.ç„¶åè°ƒç”¨notEmpty.signal()æ–¹æ³•å”¤é†’æ­£åœ¨è·å–å…ƒç´ çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬ä»é˜Ÿåˆ—ä¸­å–æ•°æ®ã€‚ æ•°æ®çš„å–å‡ºArrayBlockingQueueçš„å–æ•°æ®æ–¹æ³•æ€»å…±ä¹Ÿæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼špoll()ã€take()å’Œremove() poll()æ–¹æ³•ï¼šè·å–å…ƒç´ ï¼Œå­˜åœ¨è¿”å›å…ƒç´ e,ä¸å­˜åœ¨è¿”å›null 12345678910111213public E poll() &#123; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå…ƒç´ æ•°é‡ç­‰äº0å°±è¿”å›nullï¼Œå¦åˆ™è°ƒç”¨dequeue()æ–¹æ³• return (count == 0) ? null : dequeue(); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; take()æ–¹æ³•ï¼šå–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©º,åˆ™ä¼šé˜»å¡è°ƒç”¨è·å–å…ƒç´ çš„çº¿ç¨‹ 123456789101112131415public E take() throws InterruptedException &#123; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lockInterruptibly(); try &#123; // å¦‚æœçº¿ç¨‹ä¸­çš„å…ƒç´ æ•°é‡æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœç›¸ç­‰åˆ™è°ƒç”¨awaitæ–¹æ³•ç­‰å¾…ï¼Œå¦‚æœä¸ç›¸ç­‰åˆ™dequeueæ–¹æ³•åˆ é™¤å…ƒç´  while (count == 0) notEmpty.await(); return dequeue(); &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; remove()æ–¹æ³•ï¼šå–å…ƒç´ ï¼Œå®ƒæ˜¯å–ç‰¹å®šçš„é‚£ä¸ªå…ƒç´  1234567891011121314151617181920212223242526public boolean remove(Object o) &#123; // åˆ¤æ–­oæ˜¯å¦ä¸ºç©º if (o == null) return false; // è·å–é‡å…¥é”lock final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try &#123; // å¦‚æœå…ƒç´ æ•°é‡å¤§äº0ï¼Œåˆ™è·å–itemsï¼Œç„¶åä¾¿åˆ©å…ƒç´ ï¼Œåˆ¤æ–­oæ˜¯å…¶ä¸­çš„å“ªä¸ªï¼Œç„¶ååˆ é™¤é‚£ä¸ª if (count &gt; 0) &#123; final Object[] items = this.items; for (int i = takeIndex, end = putIndex, to = (i &lt; end) ? end : items.length; ; i = 0, to = end) &#123; for (; i &lt; to; i++) if (o.equals(items[i])) &#123; removeAt(i); return true; &#125; if (to == end) break; &#125; &#125; return false; &#125; finally &#123; // è§£é” lock.unlock(); &#125;&#125; poll()å’Œtake()ä¸¤ä¸ªæ–¹æ³•éƒ½è°ƒç”¨äº†dequeue()æ–¹æ³•ï¼Œæˆ‘ä»¬å°±çœ‹ä¸‹dequeue()æ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼š 12345678910111213141516171819/** * Extracts element at current take position, advances, and signals. * Call only when holding lock. */private E dequeue() &#123; // assert lock.isHeldByCurrentThread(); // assert lock.getHoldCount() == 1; // assert items[takeIndex] != null; final Object[] items = this.items; @SuppressWarnings("unchecked") E e = (E) items[takeIndex]; items[takeIndex] = null; if (++takeIndex == items.length) takeIndex = 0; count--; if (itrs != null) itrs.elementDequeued(); notFull.signal(); return e;&#125; å’Œä¸Šé¢çš„enqueue()æ–¹æ³•ç±»ä¼¼ï¼Œå†æ¬¡å°±ä¸å†èµ˜è¿°ã€‚ é˜»å¡é˜Ÿåˆ—çš„åº”ç”¨å‰é¢æˆ‘è¯´è¿‡ï¼Œé˜»å¡é˜Ÿåˆ—ä¸»è¦ç”¨åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œé‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªç®€å•çš„å°demo è¿™æ®µä»£ç æ¥è‡ªåˆ˜æœ›èˆ’æ‰€è‘—ã€ŠAndroidè¿›é˜¶ä¹‹å…‰ã€‹ å¦‚æœä¸ç”¨é˜»å¡é˜Ÿåˆ—ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import java.util.PriorityQueue;public class Test &#123; private int queueSize = 10; private PriorityQueue&lt;Integer&gt; queue = new PriorityQueue&lt;&gt;(queueSize); public static void main(String[] args) &#123; Test test = new Test(); Producer producer = test.new Producer(); Consumer consumer = test.new Consumer(); producer.start(); consumer.start(); &#125; class Consumer extends Thread &#123; @Override public void run() &#123; while (true) &#123; synchronized (queue) &#123; while (queue.size() == 0) &#123; try &#123; System.out.println("é˜Ÿåˆ—ç©ºï¼Œç­‰å¾…æ•°æ®"); queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); queue.notify(); &#125; &#125; // æ¯æ¬¡ç§»èµ°é˜Ÿé¦–å…ƒç´  queue.poll(); queue.notify(); &#125; &#125; &#125; &#125; private class Producer extends Thread &#123; @Override public void run() &#123; while (true) &#123; synchronized (queue) &#123; try &#123; System.out.println("é˜Ÿåˆ—æ»¡ï¼Œç­‰å¾…æœ‰ç©ºä½™ç©ºé—´"); queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); queue.notify(); &#125; &#125; // æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´  queue.offer(1); queue.notify(); &#125; &#125; &#125;&#125; ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ArrayBlockingQueueï¼š 12345678910111213141516171819202122232425262728293031323334353637383940import java.util.concurrent.ArrayBlockingQueue;public class BlockingQueueTest &#123; private int queueSize = 10; private ArrayBlockingQueue&lt;Integer&gt; queue = new ArrayBlockingQueue&lt;&gt;(queueSize); public static void main(String[] args) &#123; BlockingQueueTest test = new BlockingQueueTest(); BlockingQueueTest.Producer producer = test.new Producer(); BlockingQueueTest.Consumer consumer = test.new Consumer(); producer.start(); consumer.start(); &#125; class Consumer extends Thread &#123; @Override public void run() &#123; while (true) &#123; try &#123; queue.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; private class Producer extends Thread &#123; @Override public void run() &#123; while (true) &#123; try &#123; queue.put(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kotlinå…¥é—¨1:Kotlinå’ŒJavaåŒºåˆ«åŸºç¡€ç¯‡]]></title>
    <url>%2Fposts%2F343b01ae.html</url>
    <content type="text"><![CDATA[Koltinå…¥é—¨Kotlinç®€ä»‹ ç§‘ç‰¹æ—å²›(ĞšĞ¾Ñ‚Ğ»Ğ¸Ğ½)æ˜¯ä¸€åº§ä¿„ç½—æ–¯çš„å²›å±¿,ä½äºåœ£å½¼å¾—å ¡ä»¥è¥¿çº¦30å…¬é‡Œå¤„,å½¢çŠ¶ç‹­é•¿,ä¸œè¥¿é•¿åº¦çº¦14å…¬é‡Œ,å—åŒ—å®½åº¦çº¦2å…¬é‡Œ,é¢ç§¯æœ‰16å¹³æ–¹å…¬é‡Œ,æ‰¼å®ˆä¿„å›½è¿›å…¥èŠ¬å…°æ¹¾çš„æ°´é“ã€‚ç§‘ç‰¹æ—å²›ä¸Šå»ºæœ‰å–€ç…æ–½å¡”å¾—å¸‚,ä¸ºåœ£å½¼å¾—å ¡ä¸‹è¾–çš„åŸå¸‚ã€‚ è€Œæˆ‘ä»¬è™½è¯´çš„kotlinï¼Œå°±æ˜¯ä¸€é—¨æ ¹æ®å®ƒå‘½åçš„ä¸€ç§ç°ä»£ç¨‹åºè®¾è®¡è¯­è¨€ã€‚Kotlin æ˜¯ä¸€ä¸ªç”¨äºç°ä»£å¤šå¹³å°åº”ç”¨çš„é™æ€ç¼–ç¨‹è¯­è¨€ï¼Œç”± JetBrains å¼€å‘ã€‚Kotlinå¯ä»¥ç¼–è¯‘æˆJavaå­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥ç¼–è¯‘JavaScriptï¼Œæ–¹ä¾¿åœ¨æ²¡æœ‰JVMçš„è®¾å¤‡ä¸Šè¿è¡Œã€‚Kotlinå·²æ­£å¼æˆä¸ºAndroidå®˜æ–¹æ”¯æŒå¼€å‘è¯­è¨€ã€‚ å˜é‡kotlinå’ŒJavaçš„æœ€åŸºæœ¬çš„åŒºåˆ«å°±æ˜¯kotlinä¸­ä¸‡ç‰©çš†å¯¹è±¡ï¼ŒJavaä¸­è¿˜å­˜åœ¨ç€intã€floatç­‰åŸºæœ¬ç±»å‹ï¼Œä½†æ˜¯åœ¨kotlinä¸­ï¼Œå®ƒæŠŠè¿™äº›éƒ½å®šä¹‰æˆäº†å¯¹è±¡ï¼Œç±»ä¼¼äºJavaä¸­çš„å°è£…ç±» å˜é‡çš„å£°æ˜ä¸Šé¢è¯´äº†ï¼Œkotlinä¸‡ç‰©çš†å¯¹è±¡ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å˜é‡ä¹Ÿéƒ½æ˜¯å¯¹è±¡ã€‚åœ¨kotlinå®šä¹‰å¯¹è±¡å’ŒJavaæœ‰ç‚¹å°åŒºåˆ«ã€‚kotlinå®šä¹‰å¯¹è±¡çš„æ ¼å¼ä¸º å£°æ˜ç±»å‹ å˜é‡åï¼š å˜é‡ç±»å‹ å…¶ä¸­ï¼š å£°æ˜ç±»å‹åˆ†ä¸ºvalå’Œvarã€‚valæ˜¯ä¸å¯å˜ç±»å‹ï¼Œç±»ä¼¼äºconstï¼Œå®šä¹‰æ—¶å¿…é¡»èµ‹å€¼ï¼Œèµ‹å€¼åä¸èƒ½è¢«ä¿®æ”¹ã€‚varæ˜¯å¯å˜ç±»å‹ã€‚ å˜é‡åå°±æ˜¯ä½ å®šä¹‰çš„è¿™ä¸ªå˜é‡çš„åç§°ã€‚ å˜é‡ç±»å‹å°±æ˜¯ä½ è¿™ä¸ªå˜é‡å¯¹åº”çš„ç±»çš„åå­—ã€‚ ç±»å‹æ¨æ–­çœå»å˜é‡ç±»å‹kotliné‡Œé¢ç±»ä¼¼c++çš„autoç±»å‹ï¼Œå¯¹äºåŸºæœ¬ç±»å‹ï¼Œä½ å¯ä»¥ä¸å†™å˜é‡ç±»å‹ï¼Œkotlinä¼šè‡ªåŠ¨å¸®ä½ åˆ¤æ–­ã€‚ 1234567891011var a = 5println(a is Int)var b = â€œ123println(b is String)var c = 1.3println(c is Float)var d = trueprintln(d is Boolean) iså…³é”®å­—isé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ¤æ–­è¿™ä¸ªå˜é‡æ˜¯ä¸æ˜¯è¿™ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¾‹å­è§ä¸Šã€‚ æ•°å­—ç±»å‹ ç±»å‹ å®½åº¦(bit) Byte 8 Short 16 Int 32 Long 64 Float 32 Double 64 è¿™äº›ç±»å‹éƒ½ç»§æ‰¿è‡ªNumberå’ŒComparableç±»ã€‚ å­—é¢å¸¸é‡å€¼ åè¿›åˆ¶ï¼š123 åå…­è¿›åˆ¶ï¼š0x0f äºŒè¿›åˆ¶ï¼š0b0010 Longç±»å‹ï¼š123L doubleç±»å‹ï¼š123.4 Floatç±»å‹ï¼š123.4fæˆ–è€…123.4F æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿_æ¥æ–¹ä¾¿æˆ‘ä»¬é˜…è¯» 121_000_000 // 10000000xFF_EC // 0xFFEC æ˜¾ç¤ºè½¬æ¢kotlinä¸­ä¸å¯éšå¼è½¬æ¢æ¯”å¦‚Java ä¸­ 12int a = 2;long b = a; ä½†æ˜¯åœ¨kotlinä¸­ 123var a : Int? = 2var b : Long? = a; // errorvar b : Long? = a.toLong() Charç±»å‹kotlinä¸­çš„Charè¡¨ç¤ºå­—ç¬¦ã€‚ä½†æ˜¯å’ŒJavaä¸åŒï¼Œä»–ä¸èƒ½ç›´æ¥å½“ASCIIç å€¼ã€‚ 12345fun check(c : Char) &#123; if (c == 1) &#123; // error &#125;&#125; Booleanç±»å‹kotlinä¸­çš„å¸ƒå°”ç±»å‹ç”¨Booleanæ¥è¡¨ç¤ºï¼Œä»–æœ‰ä¸¤ä¸ªå€¼trueå’Œfalseã€‚ç”¨æ³•å’ŒJavaä¸€æ ·ã€‚ Stringç±»å‹å’ŒJavaä¸€æ ·ï¼Œkotlinä¸­çš„å­—ç¬¦ä¸²ä¹Ÿæ˜¯Stringã€‚ä½†æ˜¯kotlinä¸­Stringæ˜¯ä¸å¯å˜çš„ã€‚æ‰€ä»¥kotlinä¸­Stringå¿…é¡»æ˜¯valç±»å‹ã€‚åŒæ—¶ï¼ŒStringæ˜¯finalä¸å¯ç»§æ‰¿çš„ã€‚ Arrayç±»å‹kotlinä¸­æ•°ç»„å¿…é¡»ä½¿ç”¨Arrayè¡¨ç¤ºã€‚åŸºæœ¬å†™æ³• val array: Array&lt;ç±»å‹&gt; = arrayOf(..) ä¾‹å¦‚ 12345678910111213141516171819202122232425262728293031/**æ•´å‹Intçš„æ•°ç»„*/val arrayOfInt: IntArray = intArrayOf(1,3,5,7,9)/**å­—ç¬¦Charç±»å‹çš„æ•°ç»„*/val arrayOfChar: CharArray = charArrayOf('H','e','l','l','o','W','o','r','l','d')/**å­—ç¬¦ä¸²Stringæ•°ç»„*/val arrayOfString: Array&lt;String&gt; = arrayOf("Hello","World")fun main(args: Array&lt;String&gt;) &#123; //æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªå…ƒç´  println(arrayOfInt.size) //éå†æ•°ç»„ for (char in arrayOfChar)&#123; println(char) &#125; //æ ¹æ®æ‰€å¼•è·å–æ•°æ®,æ•°ç»„æ˜¯ä»0å¼€å§‹çš„ï¼Œç°åœ¨è·å–ç¬¬äºŒä¸ªä¸œäº¬å¤§å­¦ println(arrayOfUniversity[1]) //é‡æ–°ç»™æ•°ç»„èµ‹å€¼ï¼Œæ—©ç¨»ç”°å¤§å­¦ arrayOfUniversity[1] = University("æ—©ç¨»ç”°å¤§å­¦") println(arrayOfUniversity[1]) //å°†charè¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²,é»˜è®¤æ˜¯è‡ªåŠ¨ç”±é€—å·","åˆ†å‰²çš„ï¼Œè¾“å‡ºH, e, l, l, o, W, o, r, l, d println(arrayOfChar.joinToString()) //å¦‚æœæƒ³è¦è¿æˆHelloWorld println(arrayOfChar.joinToString ("")) //æ•°ç»„çš„åˆ‡ç‰‡,è¾“å‡º3ï¼Œ5,ç»“å°¾éœ€è¦arrayOfInt-1ï¼Œä¸ç„¶ä¼šæŠ¥ç´¢å¼•è¶Šç•Œå¼‚å¸¸ println(arrayOfInt.slice(1..2)) println(arrayOfInt.size)&#125;]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
        <tag>è¯­è¨€åŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Kotlin Ankoå…¥é—¨]]></title>
    <url>%2Fposts%2F62bb1dd7.html</url>
    <content type="text"><![CDATA[Kotlin Ankoå…¥é—¨ç®€ä»‹Ankoçš„å®˜ç½‘å°±æ˜¯ä»–çš„GitHubåœ°å€ https://github.com/Kotlin/anko å®˜æ–¹å¯¹Ankoçš„è§£é‡Šæ˜¯ Ankoæ˜¯ä¸€ä¸ª Kotlin åº“ï¼Œå®ƒä½¿Androidåº”ç”¨ç¨‹åºå¼€å‘æ›´å¿«æ›´å®¹æ˜“ã€‚å®ƒä½¿æ‚¨çš„ä»£ç æ¸…æ™°æ˜“è¯»ï¼Œè®©æ‚¨å¿˜è®°Android SDK for Javaçš„ç²—ç³™è¾¹ç¼˜ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿæ¯”æ–¹è¯´å¦‚æœä½ å†™Androidï¼Œä½ åœ¨xmlä¸­å®šä¹‰äº†ä¸€ä¸ªButtonï¼Œä»–çš„IDæ˜¯button_loginã€‚ å¦‚æœæ˜¯Javaï¼š 12setContentView(R.layout.activity_words_detail);Button button = findViewById(R.Id.button_login); è€Œå¦‚æœä½ ä½¿ç”¨kotlinçš„è¯ï¼Œä½ å¯ä»¥å°±æŒ‰å¦‚ä¸‹ä»£ç å†™ 123import kotlinx.android.synthetic.main.activity_kotlin_main.*...button_login.setText("Kotlin Android Extensions æˆ‘ä¸å¤ªå–œæ¬¢"); è¿™æ ·ç¡®å®æ¯”Javaæ–¹ä¾¿å¤šäº†ï¼Œä¸éœ€è¦å¯¹æ¯ä¸€ä¸ªç»„ä»¶éƒ½å®šä¹‰å†findViewByIdï¼Œå¯ä»¥å°±ç›´æ¥è¾“å…¥ç»„ä»¶çš„idç„¶åå°±èƒ½ä½¿ç”¨äº†ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå•Šï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½å°±ç›´æ¥åœ¨ä»£ç ä¸­å†™å…¥å„ä¸ªç»„ä»¶å‘¢ï¼Œäºæ˜¯ï¼ŒAnkoæ¥äº†ã€‚ å¯¼å…¥AnkoAnkoç”±å‡ éƒ¨åˆ†ç»„æˆï¼š Anko Commonsï¼šä¸€ä¸ªè½»é‡çº§çš„åº“ï¼ŒåŒ…å«ç”¨äºLayoutsï¼ŒIntentï¼ŒLogç­‰çš„å¸®åŠ©ç¨‹åº; Anko Layoutsï¼šä¸€ç§å¿«é€Ÿä¸”ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥ç¼–å†™åŠ¨æ€Androidå¸ƒå±€; Anko SQLiteï¼šAndroid SQLiteçš„æŸ¥è¯¢DSLå’Œè§£æå™¨é›†åˆ; Anko Coroutinesï¼šåŸºäºkotlinx.coroutinesåº“çš„å®ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥åœ¨appçš„build.gradleä¸­æ·»åŠ  12345678dependencies &#123; // Anko Layouts implementation "org.jetbrains.anko:anko-sdk25:$anko_version" // sdk15, sdk19, sdk21, sdk23 are also available implementation "org.jetbrains.anko:anko-appcompat-v7:$anko_version" // Coroutine listeners for Anko Layouts implementation "org.jetbrains.anko:anko-sdk25-coroutines:$anko_version" implementation "org.jetbrains.anko:anko-appcompat-v7-coroutines:$anko_version"&#125; è¿™ä¸ªä¾èµ–å¯ä»¥ç›´æ¥å¯¼å…¥æ‰€æœ‰çš„å¯ç”¨ç‰¹æ€§ï¼ˆåŒ…æ‹¬Commons, Layouts, SQLite)ã€‚ ä½¿ç”¨Anko layoutåˆ›å»ºç®€å•å¸ƒå±€ä½¿ç”¨Ankoåˆ›å»ºå¸ƒå±€å¾ˆç®€å•ï¼š 12345678910111213141516171819class MainActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) verticalLayout &#123; padding = dip(30) editText &#123; hint = "Name" textSize = 24f &#125; editText &#123; hint = "Password" textSize = 24f &#125; button("ç™»å½•") &#123; textSize = 26f &#125; &#125; &#125;&#125; ä½ åªéœ€è¦åœ¨Activityä¸­å†™å…¥DSLä»£ç å°±èƒ½ä½¿ç”¨å®ƒã€‚ AnkoComponentå°½ç®¡æˆ‘ä»¬ç°åœ¨å¯ä»¥ç›´æ¥åœ¨Activityä¸­å†™å…¥DSLä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è§‰å¾—æŠŠä»£ç å’Œå¸ƒå±€æ–‡ä»¶æ”¾åœ¨ä¸€èµ·ä¸å¤ªå¥½ï¼Œå¸Œæœ›æŠŠActivityå’ŒDSlä»£ç æ”¾åˆ°ä¸¤ä¸ªä¸åŒçš„ç±»é‡Œé¢ï¼Œæ‰€ä»¥AnkoComponentå°±å‡ºæ¥äº†ã€‚ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425class MainActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) MainActivityUI().setContentView(this) &#125;&#125;class MainActivityUI : AnkoComponent&lt;MainActivity&gt; &#123; override fun createView(ui: AnkoContext&lt;MainActivity&gt;) = with(ui) &#123; verticalLayout &#123; padding = dip(30) editText &#123; hint = "Name" textSize = 24f &#125; editText &#123; hint = "Password" textSize = 24f &#125; button("ç™»å½•") &#123; textSize = 26f &#125; &#125; &#125;&#125; Themeåœ¨Ankoå¦‚æœä½ æƒ³è®¾ç½®Themeéœ€è¦ä½¿ç”¨themeable 1234verticalLayout &#123; padding = dip(30) themedButton("ç™»é™†", theme = R.style.Base_TextAppearance_AppCompat_Button)&#125; LayoutParamsåœ¨Ankoä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨LayoutParamsã€‚ æ¯”æ–¹è¯´æˆ‘ç°åœ¨è¦æ˜¾ç¤ºä¸€ä¸ªbuttonï¼Œä¸‹é¢æ˜¾ç¤ºä¸€ä¸ªå›¾ç‰‡ã€‚ å¦‚æœä½¿ç”¨XML: 12345678910111213141516171819202122&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="vertical" tools:context=".MainActivity"&gt; &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Hello World!" android:gravity=center android:textSize="20sp" /&gt; &lt;ImageView android:layout_width="match_parent" android:layout_height="match_parent" android:background="@color/colorAccent" /&gt;&lt;/LinearLayout&gt; ä½†æ˜¯ä½¿ç”¨Anko: 12345678910verticalLayout &#123; textView ("Hello World!") &#123; textSize = sp(12).toFloat() &#125;.lparams(height = wrapContent, width = wrapContent) &#123; horizontalGravity = Gravity.CENTER_HORIZONTAL &#125; imageView &#123; backgroundColor = Color.BLUE &#125;.lparams(height = matchParent, width = matchParent)&#125; æ³¨æ„ï¼š horizontalMargin åŒæ—¶è®¾ç½® left å’Œ right margins verticalMargin åŒæ—¶è®¾ç½® top å’Œ bottom margin åŒæ—¶è®¾ç½®4ä¸ªæ–¹å‘çš„ margins Listenersåœ¨Ankoä¸­è®¾ç½®Listenerséå¸¸ç®€å•ï¼Œæˆ‘ä¸‹é¢ä»¥Buttonçš„OnClickä¸¾ä¾‹ï¼š 12345button("ç™»å½•") &#123; id = buttonLogin textSize = 26f onClick &#123; toast("OnClickLoginButton") &#125;&#125; ä½¿ç”¨FragmentåŠ è½½å…ˆåˆ›å»ºä¸€ä¸ªActivityï¼ŒæŠŠFragmentåŠ è¿›å» 123456789class AnkoFragmentActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; super.onCreate(savedInstanceState) linearLayout &#123; id = R.id.fragment_id supportFragmentManager.beginTransaction().replace(id, AnkoFragment.newInstance()).commit() &#125; &#125;&#125; ç„¶ååœ¨Fragmentçš„onCreateView()ä¸­åŠ å…¥DSLä»£ç ï¼Œç„¶åè¿”å›Viewå³å¯ 12345678910111213141516class AnkoFragment : Fragment() &#123; override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? &#123; // return inflater.inflate(R.layout.fragment_anko, container, false) return UI &#123; verticalLayout &#123; editText() button("OK") &#125; &#125;.view &#125; companion object &#123; fun newInstance(): AnkoFragment &#123; return AnkoFragment() &#125; &#125;&#125; ä¸è¶³AnkoLayoutç¡®å®æŒºå¥½çš„ï¼Œå› ä¸ºä»–æŠŠUIä»£ç é›†æˆåˆ°äº†ä»£ç æ–‡ä»¶ä¸­ï¼Œä¸ç”¨å†åƒä»¥å‰ä¸€æ ·å†™ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è¿˜å¾—å…ˆfindViewBuIdï¼Œç„¶åå†setOnClickListenersã€‚ä»£ç èƒ½éå¸¸ç®€æ´ã€‚ ä½†æ˜¯AnkoLayoutè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œæ„Ÿè§‰å†™èµ·æ¥è¿˜æ˜¯æ²¡æœ‰XMLé‚£ä¸ªé¡ºæ‰‹ï¼ˆå¯èƒ½æ˜¯æˆ‘å†™æƒ¯äº†XMLï¼Œåˆšå¼€å§‹ç”¨Ankoè¿˜ä¸å¤Ÿç†Ÿç»ƒï¼‰ï¼Œè€Œä¸”Ankoè¿˜æœ‰å¾ˆå¤šæ§ä»¶éƒ½ä¸æ”¯æŒã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä»–æ²¡æœ‰å®æ—¶é¢„è§ˆï¼ï¼ï¼ Android Studioé‡Œé¢æœ‰ä¸€ä¸ªå«Anko Supportçš„æ’ä»¶ï¼Œå¯ä»¥å®ç°ankoçš„é¢„è§ˆï¼Œä½†æ˜¯ä»–å¿…é¡»æ˜¯å…ˆå°†é¡¹ç›®æ„å»ºäº†å†é¢„è§ˆçš„ï¼Œä¸ç®—æ˜¯å®æ—¶é¢„è§ˆ]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidç±»ä¹‹SharedPreferences]]></title>
    <url>%2Fposts%2F8a47fe84.html</url>
    <content type="text"><![CDATA[Androidç±»ä¹‹SharedPreferencesç®€ä»‹SharedPreferencesæ˜¯ä¸€ä¸ªè½»é‡çš„å­˜å‚¨ç±»ï¼Œç”¨äºæŠŠä¸€äº›åªéœ€è¦å°‘é‡ç®€å•ç±»å‹æ•°æ®ä¿å­˜åˆ°æœ¬åœ°ï¼Œä¾‹å¦‚æœç´¢å†å²ã€ç”¨æˆ·è®¾ç½®ç­‰ã€‚ ä»–åªé€‚åˆå¤„ç†ç®€å•çš„æ•°æ®ï¼Œå¤„ç†å¤ªè¿‡äºåºå¤§çš„æ•°æ®ä¼šå‡æ…¢ç¨‹åºè¿è¡Œã€‚ ä½¿ç”¨æ­¥éª¤1. å­˜å‚¨æ•°æ® ä½¿ç”¨Activityç±»çš„getSharedPreferences()æ–¹æ³•è·å¾—SharedPreferenceså¯¹è±¡ï¼Œå…¶ä¸­å­˜å‚¨key-valueçš„æ–‡ä»¶åç”±getSharedPreferences()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šã€‚ ä½¿ç”¨SharedPreferencesæ¥å£çš„edit()è·å¾—SharedPreferences.Editorå¯¹è±¡ã€‚ é€šè¿‡SharedPreferences.Editoræ¥å£çš„putXxx()æ–¹æ³•ä¿å­˜key-valueå¯¹ï¼Œå…¶ä¸­Xxxè¡¨ç¤ºä¸åŒçš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼šå­—ç¬¦ä¸²ç±»å‹çš„valueéœ€è¦ç”¨putStringæ–¹æ³•ã€‚ é€šè¿‡SharedPreferences.Editoræ¥å£çš„commit()æ–¹æ³•ä¿å­˜key-valueå¯¹ï¼Œcommitæ–¹æ³•ç›¸å½“äºæ•°æ®åº“äº‹åŠ¡ä¸­çš„æäº¤æ“ä½œã€‚ 12345SharedPreferences sharedPreferences = getSharedPreferences("test", Context.MODE_PRIVATE);Editor editor = sharedPreferences.edit();//è·å–ç¼–è¾‘å™¨editor.putString("name", "å°æ˜");editor.putInt("age", 24);editor.commit();//æäº¤ä¿®æ”¹ 2. è¯»å–æ•°æ® ä½¿ç”¨Activityç±»çš„getSharedPreferences()æ–¹æ³•è·å¾—SharedPreferenceså¯¹è±¡ã€‚ é€šè¿‡SharedPreferenceså¯¹è±¡çš„getXxx()æ–¹æ³•å¾—åˆ°æ•°æ®ã€‚ 1234SharedPreferences sharedPreferences= getSharedPreferences("test", Activity.MODE_PRIVATE);// ä½¿ç”¨getStringæ–¹æ³•è·å¾—valueï¼Œæ³¨æ„ç¬¬2ä¸ªå‚æ•°æ˜¯valueçš„é»˜è®¤å€¼ String name =sharedPreferences.getString("name", "");int age =sharedPreferences.getInt("age", 0); SharedPreferencesçš„å››ç§æ¨¡å¼ 1234Context.MODE_PRIVATEï¼šä¸ºé»˜è®¤æ“ä½œæ¨¡å¼,ä»£è¡¨è¯¥æ–‡ä»¶æ˜¯ç§æœ‰æ•°æ®,åªèƒ½è¢«åº”ç”¨æœ¬èº«è®¿é—®,åœ¨è¯¥æ¨¡å¼ä¸‹,å†™å…¥çš„å†…å®¹ä¼šè¦†ç›–åŸæ–‡ä»¶çš„å†…å®¹Context.MODE_APPENDï¼šæ¨¡å¼ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨,å­˜åœ¨å°±å¾€æ–‡ä»¶è¿½åŠ å†…å®¹,å¦åˆ™å°±åˆ›å»ºæ–°æ–‡ä»¶.Context.MODE_WORLD_READABLEï¼šè¡¨ç¤ºå½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨è¯»å–.Context.MODE_WORLD_WRITEABLEï¼šè¡¨ç¤ºå½“å‰æ–‡ä»¶å¯ä»¥è¢«å…¶ä»–åº”ç”¨å†™å…¥.]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidViewä¹‹PopupWindow]]></title>
    <url>%2Fposts%2F1900f7eb.html</url>
    <content type="text"><![CDATA[AndroidViewä¹‹PopupWindowå› ä¸ºé¡¹ç›®ä¸­æœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨PopupWindowï¼Œæ‰€ä»¥ç‰¹åˆ«æŸ¥äº†ä¸€ä¸‹ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„æ€»ç»“ï¼Œè¿‡ä¸¤å¤©å°±åŠ åˆ°é¡¹ç›®ä¸­å»ã€‚ PopupWindowPopupWindowï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºå¼¹çª—çš„ç»„ä»¶ã€‚ åˆ›å»ºæ­¥éª¤ åˆ›å»ºPopupWindowå®ä¾‹ è®¾ç½®ä¸€äº›åŸºæœ¬å‚æ•° æ˜¾ç¤ºPopupWindowæ„é€ æ–¹æ³• 1PopupWindow window = new PopupWindow(View contentView, int width, int height, boolean focusable); è¿™ä¸ªæ–¹æ³•æœ‰å››ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨äºPopupWindowä¸­çš„Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowçš„å®½åº¦ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯PopupWindowçš„é«˜åº¦ï¼Œç¬¬å››ä¸ªå‚æ•°æŒ‡å®šPopupWindowèƒ½å¦è·å¾—ç„¦ç‚¹ã€‚ ç¤ºä¾‹ä»£ç  12View contentView = LayoutInflater.from(MainActivity.this).inflate(R.layout.popuplayout, null);PopupWindwo window = PopupWindow (contentView, ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, true); åŸºæœ¬æ–¹æ³• window.setBackgroundDrawable(Drawable background); è®¾ç½®PopupWindowçš„èƒŒæ™¯ window.setOutsideTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ window.setTouchable(boolean touchable); è®¾ç½®PopupWindowæ˜¯å¦èƒ½å“åº”ç‚¹å‡»äº‹ä»¶åªæœ‰åŒæ—¶è®¾ç½®PopupWindowçš„èƒŒæ™¯å’Œå¯ä»¥å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ï¼Œå®ƒæ‰èƒ½â€œçœŸæ­£â€å“åº”å¤–éƒ¨ç‚¹å‡»äº‹ä»¶ã€‚ æ˜¾ç¤ºPopupWindow window.showAtLocation(View parent, int gravity, int x, int y); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„çˆ¶Viewï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„ä½ç½®ï¼Œç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹çˆ¶Viewçš„xã€yåç§» window.showAsDropDown(View anchor, int xoff, int yoff, int gravity); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯PopupWindowçš„é”šç‚¹ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯PopupWindowç›¸å¯¹é”šç‚¹çš„xã€yåç§» ä¸ºPopupWindowæ·»åŠ åŠ¨ç”» è¿›å…¥æ—¶åŠ¨ç”»ï¼š(context_menu_enter.xml) 1234567891011&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android"&gt; &lt;translate android:duration="@android:integer/config_shortAnimTime" android:fromXDelta="0" android:fromYDelta="100%p" android:interpolator="@android:anim/accelerate_decelerate_interpolator" android:toXDelta="0" android:toYDelta="0"/&gt; &lt;/set&gt; é€€å‡ºæ—¶åŠ¨ç”»ï¼š(context_menu_exit.xml) 123456789101112&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;set xmlns:android="http://schemas.android.com/apk/res/android" &gt; &lt;translate android:duration="@android:integer/config_shortAnimTime" android:fromXDelta="0" android:fromYDelta="0" android:interpolator="@android:anim/accelerate_decelerate_interpolator" android:toXDelta="0" android:toYDelta="100%p" /&gt; &lt;/set&gt; ç”Ÿæˆstyle 1234&lt;style name=&quot;contextMenuAnim&quot; parent=&quot;@android:style/Animation.Activity&quot;&gt; &lt;item name=&quot;android:windowEnterAnimation&quot;&gt;@anim/context_menu_enter&lt;/item&gt; &lt;item name=&quot;android:windowExitAnimation&quot;&gt;@anim/context_menu_exit&lt;/item&gt;&lt;/style&gt;]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>View</tag>
      </tags>
  </entry>
</search>
